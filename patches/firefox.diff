diff --git a/.gitmodules b/.gitmodules
new file mode 100644
index 0000000000000..a2c7a5d42d66d
--- /dev/null
+++ b/.gitmodules
@@ -0,0 +1,3 @@
+[submodule "playwright"]
+	path = playwright
+	url = https://github.com/microsoft/playwright.git
diff --git a/accessible/android/moz.build b/accessible/android/moz.build
index f8a185da48ffb..699584f891a68 100644
--- a/accessible/android/moz.build
+++ b/accessible/android/moz.build
@@ -33,3 +33,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/aom/moz.build b/accessible/aom/moz.build
index 88b941435ee8e..9c749a6d4574b 100644
--- a/accessible/aom/moz.build
+++ b/accessible/aom/moz.build
@@ -42,3 +42,6 @@ else:
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/atk/moz.build b/accessible/atk/moz.build
index 092ecada57b0f..18fabbd0216f9 100644
--- a/accessible/atk/moz.build
+++ b/accessible/atk/moz.build
@@ -62,3 +62,6 @@ if CONFIG["CC_TYPE"] in ("clang", "gcc"):
         "-Wno-error=unused-function",
         "-Wno-unused-local-typedefs",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/base/NotificationController.h b/accessible/base/NotificationController.h
index 137963f117092..41fa27bc4a3da 100644
--- a/accessible/base/NotificationController.h
+++ b/accessible/base/NotificationController.h
@@ -244,6 +244,8 @@ class NotificationController final : public EventQueue,
   }
 #endif
 
+  bool IsUpdatePendingForJugglerAccessibility() { return IsUpdatePending(); }
+
  protected:
   virtual ~NotificationController();
 
diff --git a/accessible/base/moz.build b/accessible/base/moz.build
index b65c90ceba915..585aa59f261cd 100644
--- a/accessible/base/moz.build
+++ b/accessible/base/moz.build
@@ -120,3 +120,6 @@ else:
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/basetypes/moz.build b/accessible/basetypes/moz.build
index c0e3fdf9ac2ee..583a749c57467 100644
--- a/accessible/basetypes/moz.build
+++ b/accessible/basetypes/moz.build
@@ -23,3 +23,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/generic/moz.build b/accessible/generic/moz.build
index 06e229b99999e..fb58f87d55b19 100644
--- a/accessible/generic/moz.build
+++ b/accessible/generic/moz.build
@@ -61,3 +61,6 @@ else:
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/html/moz.build b/accessible/html/moz.build
index 3a246373da0af..90ba982b02aeb 100644
--- a/accessible/html/moz.build
+++ b/accessible/html/moz.build
@@ -50,3 +50,6 @@ else:
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/interfaces/ia2/moz.build b/accessible/interfaces/ia2/moz.build
index 9d39b2c1db9ab..6f1073e468221 100644
--- a/accessible/interfaces/ia2/moz.build
+++ b/accessible/interfaces/ia2/moz.build
@@ -90,3 +90,6 @@ GeneratedFile(
         TOPSRCDIR + "/other-licenses/ia2",
     ],
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/interfaces/moz.build b/accessible/interfaces/moz.build
index cf568f1d18320..48b8556e78022 100644
--- a/accessible/interfaces/moz.build
+++ b/accessible/interfaces/moz.build
@@ -43,3 +43,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "accessibility"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/interfaces/msaa/moz.build b/accessible/interfaces/msaa/moz.build
index 7a1053317a37e..62c7268a6947d 100644
--- a/accessible/interfaces/msaa/moz.build
+++ b/accessible/interfaces/msaa/moz.build
@@ -55,3 +55,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
         "-Wno-missing-braces",
         "-Wno-unused-const-variable",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/interfaces/nsIAccessibleDocument.idl b/accessible/interfaces/nsIAccessibleDocument.idl
index 1886621c373fe..a0febf7288541 100644
--- a/accessible/interfaces/nsIAccessibleDocument.idl
+++ b/accessible/interfaces/nsIAccessibleDocument.idl
@@ -67,4 +67,9 @@ interface nsIAccessibleDocument : nsISupports
    * Return the child document accessible at the given index.
    */
   nsIAccessibleDocument getChildDocumentAt(in unsigned long index);
+
+  /**
+   * Return whether it is updating.
+   */
+  readonly attribute boolean isUpdatePendingForJugglerAccessibility;
 };
diff --git a/accessible/ipc/moz.build b/accessible/ipc/moz.build
index b8ff3b9c4f9d3..1c9f6795b90ba 100644
--- a/accessible/ipc/moz.build
+++ b/accessible/ipc/moz.build
@@ -60,3 +60,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/mac/moz.build b/accessible/mac/moz.build
index acf6c4443b3fc..bc6586fe25b59 100644
--- a/accessible/mac/moz.build
+++ b/accessible/mac/moz.build
@@ -68,3 +68,6 @@ GeneratedFile(
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/moz.build b/accessible/moz.build
index ed05b5b50ed34..d533c8303b52e 100644
--- a/accessible/moz.build
+++ b/accessible/moz.build
@@ -60,3 +60,6 @@ SPHINX_TREES["/accessible"] = "docs"
 
 with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/other/moz.build b/accessible/other/moz.build
index 728fff578383e..fa5d1a99db7a7 100644
--- a/accessible/other/moz.build
+++ b/accessible/other/moz.build
@@ -21,3 +21,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/tests/mochitest/moz.build b/accessible/tests/mochitest/moz.build
index fa8e1b3cdd780..1f3743bf2ba36 100644
--- a/accessible/tests/mochitest/moz.build
+++ b/accessible/tests/mochitest/moz.build
@@ -33,3 +33,6 @@ A11Y_MANIFESTS += [
     "treeupdate/a11y.toml",
     "value/a11y.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/windows/ia2/moz.build b/accessible/windows/ia2/moz.build
index 53f930fd5ada3..3f1f80579e544 100644
--- a/accessible/windows/ia2/moz.build
+++ b/accessible/windows/ia2/moz.build
@@ -59,3 +59,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
     CXXFLAGS += ["-Wno-extra-tokens"]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/windows/moz.build b/accessible/windows/moz.build
index 53afb61f113e1..3677a7e004015 100644
--- a/accessible/windows/moz.build
+++ b/accessible/windows/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["msaa", "ia2", "sdn", "uia"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/windows/msaa/moz.build b/accessible/windows/msaa/moz.build
index 1b56c2eacf13e..c3a112213c011 100644
--- a/accessible/windows/msaa/moz.build
+++ b/accessible/windows/msaa/moz.build
@@ -71,3 +71,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/windows/sdn/moz.build b/accessible/windows/sdn/moz.build
index 8d76b7482ef35..5e5624fd23bfa 100644
--- a/accessible/windows/sdn/moz.build
+++ b/accessible/windows/sdn/moz.build
@@ -22,3 +22,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/windows/uia/moz.build b/accessible/windows/uia/moz.build
index 058aacc579efa..299df10df56e2 100644
--- a/accessible/windows/uia/moz.build
+++ b/accessible/windows/uia/moz.build
@@ -20,3 +20,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/xpcom/moz.build b/accessible/xpcom/moz.build
index 2ce13081a2b07..6b75c4d454faf 100644
--- a/accessible/xpcom/moz.build
+++ b/accessible/xpcom/moz.build
@@ -78,3 +78,6 @@ GeneratedFile(
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/accessible/xpcom/xpcAccessibleDocument.cpp b/accessible/xpcom/xpcAccessibleDocument.cpp
index d616e476b2149..7a8a48d5e7303 100644
--- a/accessible/xpcom/xpcAccessibleDocument.cpp
+++ b/accessible/xpcom/xpcAccessibleDocument.cpp
@@ -131,6 +131,13 @@ xpcAccessibleDocument::GetChildDocumentAt(uint32_t aIndex,
   return *aDocument ? NS_OK : NS_ERROR_INVALID_ARG;
 }
 
+NS_IMETHODIMP
+xpcAccessibleDocument::GetIsUpdatePendingForJugglerAccessibility(bool* updating) {
+  NS_ENSURE_ARG_POINTER(updating);
+  *updating = Intl()->Controller()->IsUpdatePendingForJugglerAccessibility();
+  return NS_OK;
+}
+
 ////////////////////////////////////////////////////////////////////////////////
 // xpcAccessibleDocument
 
diff --git a/accessible/xpcom/xpcAccessibleDocument.h b/accessible/xpcom/xpcAccessibleDocument.h
index 8e9bf2b413585..5a3b194b54e38 100644
--- a/accessible/xpcom/xpcAccessibleDocument.h
+++ b/accessible/xpcom/xpcAccessibleDocument.h
@@ -47,6 +47,8 @@ class xpcAccessibleDocument : public xpcAccessibleHyperText,
   NS_IMETHOD GetChildDocumentAt(uint32_t aIndex,
                                 nsIAccessibleDocument** aDocument) final;
 
+  NS_IMETHOD GetIsUpdatePendingForJugglerAccessibility(bool* aUpdating) final;
+
   /**
    * Return XPCOM wrapper for the internal accessible.
    */
diff --git a/accessible/xul/moz.build b/accessible/xul/moz.build
index 4fccfff6e015a..dc187aed965f0 100644
--- a/accessible/xul/moz.build
+++ b/accessible/xul/moz.build
@@ -54,3 +54,6 @@ else:
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/actors/moz.build b/browser/actors/moz.build
index 25957ca7102a5..2b41ab64e7e98 100644
--- a/browser/actors/moz.build
+++ b/browser/actors/moz.build
@@ -90,3 +90,6 @@ FINAL_TARGET_FILES.actors += [
 BROWSER_CHROME_MANIFESTS += [
     "test/browser/browser.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/app/macbuild/Contents/moz.build b/browser/app/macbuild/Contents/moz.build
index b8b28926de460..795fa72cecffb 100644
--- a/browser/app/macbuild/Contents/moz.build
+++ b/browser/app/macbuild/Contents/moz.build
@@ -23,3 +23,6 @@ GeneratedFile(
     inputs=["MacOS-files.in"],
     flags=defs,
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/app/moz.build b/browser/app/moz.build
index a933a3cb9bdf1..d60535697379b 100644
--- a/browser/app/moz.build
+++ b/browser/app/moz.build
@@ -169,3 +169,6 @@ for icon in ("firefox", "document", "newwindow", "newtab", "pbmode", "document_p
         CONFIG["MOZ_BRANDING_DIRECTORY"],
         icon,
     )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/app/no-pie/moz.build b/browser/app/no-pie/moz.build
index a3b60f5fee569..a106463578922 100644
--- a/browser/app/no-pie/moz.build
+++ b/browser/app/no-pie/moz.build
@@ -18,3 +18,6 @@ CFLAGS += [
 # Use OS_LIBS instead of LDFLAGS to "force" the flag to come after -pie
 # from MOZ_PROGRAM_LDFLAGS.
 OS_LIBS += ["-no-pie"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/app/pbproxy/moz.build b/browser/app/pbproxy/moz.build
index bf9e0125e0ade..d9d8552384beb 100644
--- a/browser/app/pbproxy/moz.build
+++ b/browser/app/pbproxy/moz.build
@@ -27,3 +27,6 @@ DisableStlWrapping()
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Shell Integration")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/app/winlauncher/LauncherProcessWin.cpp b/browser/app/winlauncher/LauncherProcessWin.cpp
index b40e0fceb567c..2c4e6d5fbf8da 100644
--- a/browser/app/winlauncher/LauncherProcessWin.cpp
+++ b/browser/app/winlauncher/LauncherProcessWin.cpp
@@ -22,6 +22,7 @@
 #include "mozilla/WinHeaderOnlyUtils.h"
 #include "nsWindowsHelpers.h"
 
+#include <io.h>
 #include <windows.h>
 #include <processthreadsapi.h>
 
@@ -421,8 +422,18 @@ Maybe<int> LauncherMain(int& argc, wchar_t* argv[],
   HANDLE stdHandles[] = {::GetStdHandle(STD_INPUT_HANDLE),
                          ::GetStdHandle(STD_OUTPUT_HANDLE),
                          ::GetStdHandle(STD_ERROR_HANDLE)};
-
   attrs.AddInheritableHandles(stdHandles);
+  // Playwright pipe installation.
+  bool hasJugglerPipe =
+      mozilla::CheckArg(argc, argv, "juggler-pipe", nullptr,
+                        mozilla::CheckArgFlag::None) == mozilla::ARG_FOUND;
+  if (hasJugglerPipe) {
+    intptr_t stdio3 = _get_osfhandle(3);
+    intptr_t stdio4 = _get_osfhandle(4);
+    HANDLE pipeHandles[] = {reinterpret_cast<HANDLE>(stdio3),
+                            reinterpret_cast<HANDLE>(stdio4)};
+    attrs.AddInheritableHandles(pipeHandles);
+  }
 
   DWORD creationFlags = CREATE_SUSPENDED | CREATE_UNICODE_ENVIRONMENT;
 
diff --git a/browser/app/winlauncher/freestanding/moz.build b/browser/app/winlauncher/freestanding/moz.build
index 7a43d9a104ab8..3a52663e89fff 100644
--- a/browser/app/winlauncher/freestanding/moz.build
+++ b/browser/app/winlauncher/freestanding/moz.build
@@ -54,3 +54,6 @@ DisableStlWrapping()
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Launcher Process")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/app/winlauncher/moz.build b/browser/app/winlauncher/moz.build
index f2f321ae0c737..7c95627093ebc 100644
--- a/browser/app/winlauncher/moz.build
+++ b/browser/app/winlauncher/moz.build
@@ -59,3 +59,6 @@ DisableStlWrapping()
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Launcher Process")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/app/winlauncher/test/moz.build b/browser/app/winlauncher/test/moz.build
index a8503ddf55a38..b73f6bcdc6bb8 100644
--- a/browser/app/winlauncher/test/moz.build
+++ b/browser/app/winlauncher/test/moz.build
@@ -28,3 +28,6 @@ if CONFIG["CC_TYPE"] in ("gcc", "clang"):
     LDFLAGS += [
         "-municode",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/base/content/moz.build b/browser/base/content/moz.build
index f91487920fc9c..8133b30b41667 100644
--- a/browser/base/content/moz.build
+++ b/browser/base/content/moz.build
@@ -183,3 +183,6 @@ with Files("webext-panels*"):
 
 with Files("webrtcIndicator*"):
     BUG_COMPONENT = ("Firefox", "Site Permissions")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/base/content/test/performance/moz.build b/browser/base/content/test/performance/moz.build
index dce33b938dbf1..c1a2f6d420024 100644
--- a/browser/base/content/test/performance/moz.build
+++ b/browser/base/content/test/performance/moz.build
@@ -15,3 +15,6 @@ BROWSER_CHROME_MANIFESTS += [
 TESTING_JS_MODULES += [
     "PerfTestHelpers.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/base/moz.build b/browser/base/moz.build
index a501e996e25ee..ee862c1304b59 100644
--- a/browser/base/moz.build
+++ b/browser/base/moz.build
@@ -89,3 +89,6 @@ if CONFIG["OS_ARCH"] == "WINNT" and CONFIG["MOZ_DEFAULT_BROWSER_AGENT"]:
     DEFINES["MOZ_DEFAULT_BROWSER_AGENT"] = True
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/aurora/content/moz.build b/browser/branding/aurora/content/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/branding/aurora/content/moz.build
+++ b/browser/branding/aurora/content/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/aurora/locales/moz.build b/browser/branding/aurora/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/branding/aurora/locales/moz.build
+++ b/browser/branding/aurora/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/aurora/moz.build b/browser/branding/aurora/moz.build
index dd081ac44496d..600cc46b405db 100644
--- a/browser/branding/aurora/moz.build
+++ b/browser/branding/aurora/moz.build
@@ -11,3 +11,6 @@ export("DIST_SUBDIR")
 
 include("../branding-common.mozbuild")
 FirefoxBranding()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/moz.build b/browser/branding/moz.build
index 06ba31e105ec1..17bf4927b8ac7 100644
--- a/browser/branding/moz.build
+++ b/browser/branding/moz.build
@@ -8,3 +8,6 @@ SPHINX_TREES["docs"] = "docs"
 
 with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/nightly/content/moz.build b/browser/branding/nightly/content/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/branding/nightly/content/moz.build
+++ b/browser/branding/nightly/content/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/nightly/locales/moz.build b/browser/branding/nightly/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/branding/nightly/locales/moz.build
+++ b/browser/branding/nightly/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/nightly/moz.build b/browser/branding/nightly/moz.build
index dd081ac44496d..600cc46b405db 100644
--- a/browser/branding/nightly/moz.build
+++ b/browser/branding/nightly/moz.build
@@ -11,3 +11,6 @@ export("DIST_SUBDIR")
 
 include("../branding-common.mozbuild")
 FirefoxBranding()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/official/content/moz.build b/browser/branding/official/content/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/branding/official/content/moz.build
+++ b/browser/branding/official/content/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/official/locales/moz.build b/browser/branding/official/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/branding/official/locales/moz.build
+++ b/browser/branding/official/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/official/moz.build b/browser/branding/official/moz.build
index dd081ac44496d..600cc46b405db 100644
--- a/browser/branding/official/moz.build
+++ b/browser/branding/official/moz.build
@@ -11,3 +11,6 @@ export("DIST_SUBDIR")
 
 include("../branding-common.mozbuild")
 FirefoxBranding()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/unofficial/content/moz.build b/browser/branding/unofficial/content/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/branding/unofficial/content/moz.build
+++ b/browser/branding/unofficial/content/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/unofficial/locales/moz.build b/browser/branding/unofficial/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/branding/unofficial/locales/moz.build
+++ b/browser/branding/unofficial/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/branding/unofficial/moz.build b/browser/branding/unofficial/moz.build
index dd081ac44496d..600cc46b405db 100644
--- a/browser/branding/unofficial/moz.build
+++ b/browser/branding/unofficial/moz.build
@@ -11,3 +11,6 @@ export("DIST_SUBDIR")
 
 include("../branding-common.mozbuild")
 FirefoxBranding()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/about/moz.build b/browser/components/about/moz.build
index 994f084510a8a..0cc045bc2ad48 100644
--- a/browser/components/about/moz.build
+++ b/browser/components/about/moz.build
@@ -30,3 +30,6 @@ LOCAL_INCLUDES += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/aboutlogins/moz.build b/browser/components/aboutlogins/moz.build
index b0ac44a41caea..7a51d1e9ebfae 100644
--- a/browser/components/aboutlogins/moz.build
+++ b/browser/components/aboutlogins/moz.build
@@ -21,3 +21,6 @@ FINAL_TARGET_FILES.actors += [
 BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["tests/chrome/chrome.toml"]
 XPCSHELL_TESTS_MANIFESTS += ["tests/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/aboutwelcome/moz.build b/browser/components/aboutwelcome/moz.build
index a6037a301fe69..2facd782c4691 100644
--- a/browser/components/aboutwelcome/moz.build
+++ b/browser/components/aboutwelcome/moz.build
@@ -23,3 +23,6 @@ EXTRA_JS_MODULES.aboutwelcome += [
     "modules/AboutWelcomeTelemetry.jsm",
     "modules/AWScreenUtils.jsm",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/asrouter/moz.build b/browser/components/asrouter/moz.build
index 73fc66be034ab..068cee7e235e3 100644
--- a/browser/components/asrouter/moz.build
+++ b/browser/components/asrouter/moz.build
@@ -8,3 +8,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Messaging System")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/attribution/moz.build b/browser/components/attribution/moz.build
index 7bb14300f83f0..01ce9886240e6 100644
--- a/browser/components/attribution/moz.build
+++ b/browser/components/attribution/moz.build
@@ -23,3 +23,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "cocoa":
     EXTRA_JS_MODULES += [
         "MacAttribution.sys.mjs",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/build/moz.build b/browser/components/build/moz.build
index 901c6ddfed8dc..e88010d69ee44 100644
--- a/browser/components/build/moz.build
+++ b/browser/components/build/moz.build
@@ -20,3 +20,6 @@ LOCAL_INCLUDES += [
     "../sessionstore",
     "../shell",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/contentanalysis/moz.build b/browser/components/contentanalysis/moz.build
index b8484e6cc3d82..02f0061da3f7b 100644
--- a/browser/components/contentanalysis/moz.build
+++ b/browser/components/contentanalysis/moz.build
@@ -10,3 +10,6 @@ with Files("**"):
 EXTRA_JS_MODULES += [
     "content/ContentAnalysis.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/contextualidentity/moz.build b/browser/components/contextualidentity/moz.build
index 990f88ca9e3d7..95e3c949dbeba 100644
--- a/browser/components/contextualidentity/moz.build
+++ b/browser/components/contextualidentity/moz.build
@@ -12,3 +12,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "DOM: Security")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/customizableui/content/moz.build b/browser/components/customizableui/content/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/components/customizableui/content/moz.build
+++ b/browser/components/customizableui/content/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/customizableui/moz.build b/browser/components/customizableui/moz.build
index 5d1e0e4061e5e..601256bb388e4 100644
--- a/browser/components/customizableui/moz.build
+++ b/browser/components/customizableui/moz.build
@@ -26,3 +26,6 @@ EXTRA_JS_MODULES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Toolbars and Customization")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/doh/moz.build b/browser/components/doh/moz.build
index 05030b09ab76f..69bedc8c69ba7 100644
--- a/browser/components/doh/moz.build
+++ b/browser/components/doh/moz.build
@@ -20,3 +20,6 @@ TESTING_JS_MODULES += [
 
 XPCSHELL_TESTS_MANIFESTS += ["test/unit/xpcshell.toml"]
 BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/downloads/moz.build b/browser/components/downloads/moz.build
index a71810b5e6cd2..2b3f62404c1bb 100644
--- a/browser/components/downloads/moz.build
+++ b/browser/components/downloads/moz.build
@@ -28,3 +28,6 @@ with Files("**"):
     BUG_COMPONENT = ("Firefox", "Downloads Panel")
 
 XPCSHELL_TESTS_MANIFESTS += ["test/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/enterprisepolicies/helpers/moz.build b/browser/components/enterprisepolicies/helpers/moz.build
index 4429fa5928afa..4436d894e4353 100644
--- a/browser/components/enterprisepolicies/helpers/moz.build
+++ b/browser/components/enterprisepolicies/helpers/moz.build
@@ -12,3 +12,6 @@ EXTRA_JS_MODULES.policies += [
     "ProxyPolicies.sys.mjs",
     "WebsiteFilter.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/enterprisepolicies/moz.build b/browser/components/enterprisepolicies/moz.build
index 047108084b4ef..b08183eef62d7 100644
--- a/browser/components/enterprisepolicies/moz.build
+++ b/browser/components/enterprisepolicies/moz.build
@@ -23,3 +23,6 @@ EXTRA_JS_MODULES.policies += [
 FINAL_LIBRARY = "browsercomps"
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/enterprisepolicies/schemas/moz.build b/browser/components/enterprisepolicies/schemas/moz.build
index 47b6fbee19cf4..0461f9fa3322e 100644
--- a/browser/components/enterprisepolicies/schemas/moz.build
+++ b/browser/components/enterprisepolicies/schemas/moz.build
@@ -10,3 +10,6 @@ with Files("**"):
 EXTRA_PP_JS_MODULES.policies += [
     "schema.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/enterprisepolicies/tests/moz.build b/browser/components/enterprisepolicies/tests/moz.build
index d1f5dfe7c41b3..aa783e5badd48 100644
--- a/browser/components/enterprisepolicies/tests/moz.build
+++ b/browser/components/enterprisepolicies/tests/moz.build
@@ -18,3 +18,6 @@ BROWSER_CHROME_MANIFESTS += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/extensions/moz.build b/browser/components/extensions/moz.build
index 59a242cb10541..b5f24c65ab984 100644
--- a/browser/components/extensions/moz.build
+++ b/browser/components/extensions/moz.build
@@ -35,3 +35,6 @@ MOCHITEST_MANIFESTS += ["test/mochitest/mochitest.toml"]
 XPCSHELL_TESTS_MANIFESTS += [
     "test/xpcshell/xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/extensions/schemas/moz.build b/browser/components/extensions/schemas/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/components/extensions/schemas/moz.build
+++ b/browser/components/extensions/schemas/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/firefoxview/moz.build b/browser/components/firefoxview/moz.build
index 894deceffdbdc..60489c24d218e 100644
--- a/browser/components/firefoxview/moz.build
+++ b/browser/components/firefoxview/moz.build
@@ -20,3 +20,6 @@ TESTING_JS_MODULES += [
 BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 MOCHITEST_CHROME_MANIFESTS += ["tests/chrome/chrome.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/installerprefs/moz.build b/browser/components/installerprefs/moz.build
index bfe931196a776..ddaae0fe6c530 100644
--- a/browser/components/installerprefs/moz.build
+++ b/browser/components/installerprefs/moz.build
@@ -16,3 +16,6 @@ EXTRA_JS_MODULES += [
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/ion/moz.build b/browser/components/ion/moz.build
index 7a8e9dcfe3458..50983dfdc3927 100644
--- a/browser/components/ion/moz.build
+++ b/browser/components/ion/moz.build
@@ -15,3 +15,6 @@ TESTING_JS_MODULES += [
     "schemas/IonContentSchema.json",
     "schemas/IonStudyAddonsSchema.json",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/messagepreview/moz.build b/browser/components/messagepreview/moz.build
index 5b528d73f72bf..c221bdc428c5f 100644
--- a/browser/components/messagepreview/moz.build
+++ b/browser/components/messagepreview/moz.build
@@ -15,3 +15,6 @@ FINAL_TARGET_FILES.actors += [
     "actors/AboutMessagePreviewChild.sys.mjs",
     "actors/AboutMessagePreviewParent.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/migration/moz.build b/browser/components/migration/moz.build
index 8c958ab7d4d41..d7927b2bcfad8 100644
--- a/browser/components/migration/moz.build
+++ b/browser/components/migration/moz.build
@@ -83,3 +83,6 @@ FINAL_LIBRARY = "browsercomps"
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Migration")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/migration/tests/unit/insertIEHistory/moz.build b/browser/components/migration/tests/unit/insertIEHistory/moz.build
index 61ca96d48a953..faf6edd16ea07 100644
--- a/browser/components/migration/tests/unit/insertIEHistory/moz.build
+++ b/browser/components/migration/tests/unit/insertIEHistory/moz.build
@@ -17,3 +17,6 @@ SOURCES += [
 
 NO_PGO = True
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/moz.build b/browser/components/moz.build
index 6fd86955650e4..c5e5e09565993 100644
--- a/browser/components/moz.build
+++ b/browser/components/moz.build
@@ -115,3 +115,6 @@ if CONFIG["MOZ_UPDATER"]:
 MARIONETTE_MANIFESTS += ["tests/marionette/manifest.toml"]
 
 XPCSHELL_TESTS_MANIFESTS += ["tests/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/newtab/moz.build b/browser/components/newtab/moz.build
index 7fc7ae6a6fc6a..1274d4cd0f162 100644
--- a/browser/components/newtab/moz.build
+++ b/browser/components/newtab/moz.build
@@ -54,3 +54,6 @@ XPCOM_MANIFESTS += [
 ]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/originattributes/moz.build b/browser/components/originattributes/moz.build
index 21b004095ef5b..2754d0b9ec8ce 100644
--- a/browser/components/originattributes/moz.build
+++ b/browser/components/originattributes/moz.build
@@ -12,3 +12,6 @@ MOCHITEST_MANIFESTS += ["test/mochitest/mochitest.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "DOM: Security")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/pagedata/moz.build b/browser/components/pagedata/moz.build
index f1e49c4e4b9c2..1d3afaac01c1e 100644
--- a/browser/components/pagedata/moz.build
+++ b/browser/components/pagedata/moz.build
@@ -27,3 +27,6 @@ FINAL_TARGET_FILES.actors += [
 ]
 
 SPHINX_TREES["docs"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/places/moz.build b/browser/components/places/moz.build
index 496e83089db04..91a22ed8e6307 100644
--- a/browser/components/places/moz.build
+++ b/browser/components/places/moz.build
@@ -31,3 +31,6 @@ FINAL_TARGET_FILES.actors += [
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Bookmarks & History")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/pocket/moz.build b/browser/components/pocket/moz.build
index 3a5e2456d22a2..1d0437133d7df 100644
--- a/browser/components/pocket/moz.build
+++ b/browser/components/pocket/moz.build
@@ -14,3 +14,6 @@ BROWSER_CHROME_MANIFESTS += [
 ]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/preferences/dialogs/moz.build b/browser/components/preferences/dialogs/moz.build
index 603c56050521d..b8972b3b23a04 100644
--- a/browser/components/preferences/dialogs/moz.build
+++ b/browser/components/preferences/dialogs/moz.build
@@ -11,3 +11,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] in ("windows", "gtk", "cocoa"):
     DEFINES["HAVE_SHELL_SERVICE"] = 1
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/preferences/moz.build b/browser/components/preferences/moz.build
index 153dcca94bd7b..6ddd3658e5677 100644
--- a/browser/components/preferences/moz.build
+++ b/browser/components/preferences/moz.build
@@ -21,3 +21,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Settings UI")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/privatebrowsing/moz.build b/browser/components/privatebrowsing/moz.build
index 822b875e2addc..a3009fc8d665a 100644
--- a/browser/components/privatebrowsing/moz.build
+++ b/browser/components/privatebrowsing/moz.build
@@ -16,3 +16,6 @@ EXTRA_JS_MODULES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Private Browsing")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/prompts/moz.build b/browser/components/prompts/moz.build
index 98d52d5397948..a829399149b2c 100644
--- a/browser/components/prompts/moz.build
+++ b/browser/components/prompts/moz.build
@@ -12,3 +12,6 @@ EXTRA_JS_MODULES += [
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/protections/moz.build b/browser/components/protections/moz.build
index c79fefcc16536..1271098c10788 100644
--- a/browser/components/protections/moz.build
+++ b/browser/components/protections/moz.build
@@ -10,3 +10,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Protections UI")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/protocolhandler/moz.build b/browser/components/protocolhandler/moz.build
index 0bd67ba621238..f41ed16d484fc 100644
--- a/browser/components/protocolhandler/moz.build
+++ b/browser/components/protocolhandler/moz.build
@@ -16,3 +16,6 @@ XPCOM_MANIFESTS += [
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/reportbrokensite/moz.build b/browser/components/reportbrokensite/moz.build
index de81842f602cc..6f990b205aede 100644
--- a/browser/components/reportbrokensite/moz.build
+++ b/browser/components/reportbrokensite/moz.build
@@ -12,3 +12,6 @@ EXTRA_JS_MODULES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Web Compatibility", "Desktop")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/resistfingerprinting/moz.build b/browser/components/resistfingerprinting/moz.build
index af01529d86247..5f9b6909e5194 100644
--- a/browser/components/resistfingerprinting/moz.build
+++ b/browser/components/resistfingerprinting/moz.build
@@ -14,3 +14,6 @@ BROWSER_CHROME_MANIFESTS += [
 MOCHITEST_MANIFESTS += [
     "test/mochitest/mochitest.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/screenshots/moz.build b/browser/components/screenshots/moz.build
index d8fb17be0f418..c9f258d5f55ea 100644
--- a/browser/components/screenshots/moz.build
+++ b/browser/components/screenshots/moz.build
@@ -17,3 +17,6 @@ with Files("**"):
 BROWSER_CHROME_MANIFESTS += [
     "tests/browser/browser.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/search/moz.build b/browser/components/search/moz.build
index 9f89090aa2d73..3c138dc4a6bff 100644
--- a/browser/components/search/moz.build
+++ b/browser/components/search/moz.build
@@ -27,3 +27,6 @@ SPHINX_TREES["/browser/search"] = "docs"
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Search")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/sessionstore/moz.build b/browser/components/sessionstore/moz.build
index 15368267331d9..6ba5324c15225 100644
--- a/browser/components/sessionstore/moz.build
+++ b/browser/components/sessionstore/moz.build
@@ -36,3 +36,6 @@ TESTING_JS_MODULES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Session Restore")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/shell/moz.build b/browser/components/shell/moz.build
index fe70623907f8d..213fae7d5a57d 100644
--- a/browser/components/shell/moz.build
+++ b/browser/components/shell/moz.build
@@ -87,3 +87,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Shell Integration")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/shopping/moz.build b/browser/components/shopping/moz.build
index 1db819a6317b1..b142390aef1d4 100644
--- a/browser/components/shopping/moz.build
+++ b/browser/components/shopping/moz.build
@@ -19,3 +19,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Shopping")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/storybook/moz.build b/browser/components/storybook/moz.build
index acc6649e9d071..4ddbe6836a294 100644
--- a/browser/components/storybook/moz.build
+++ b/browser/components/storybook/moz.build
@@ -6,3 +6,6 @@ with Files("**"):
     BUG_COMPONENT = ("Firefox", "General")
 
 SPHINX_TREES["docs"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/syncedtabs/moz.build b/browser/components/syncedtabs/moz.build
index 8a702d39060e3..38440c86cdb01 100644
--- a/browser/components/syncedtabs/moz.build
+++ b/browser/components/syncedtabs/moz.build
@@ -21,3 +21,6 @@ EXTRA_JS_MODULES.syncedtabs += [
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Sync")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/tabpreview/moz.build b/browser/components/tabpreview/moz.build
index f8c362efe1511..85eef8e9c4e46 100644
--- a/browser/components/tabpreview/moz.build
+++ b/browser/components/tabpreview/moz.build
@@ -8,3 +8,6 @@ with Files("**"):
     BUG_COMPONENT = ("Firefox", "Tabbed Browser")
 
 SPHINX_TREES["docs"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/tabunloader/moz.build b/browser/components/tabunloader/moz.build
index b4408d3f367a6..1cd2a24adf938 100644
--- a/browser/components/tabunloader/moz.build
+++ b/browser/components/tabunloader/moz.build
@@ -10,3 +10,6 @@ with Files("**"):
     BUG_COMPONENT = ("Firefox", "Tabbed Browser")
 
 SPHINX_TREES["/browser/tabunloader"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/textrecognition/moz.build b/browser/components/textrecognition/moz.build
index c82a779e1181f..031da31ac429b 100644
--- a/browser/components/textrecognition/moz.build
+++ b/browser/components/textrecognition/moz.build
@@ -12,3 +12,6 @@ with Files("**"):
 BROWSER_CHROME_MANIFESTS += [
     "tests/browser/browser.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/touchbar/moz.build b/browser/components/touchbar/moz.build
index 46d1dbf919f23..da2091c218ba6 100644
--- a/browser/components/touchbar/moz.build
+++ b/browser/components/touchbar/moz.build
@@ -16,3 +16,6 @@ XPCOM_MANIFESTS += [
 ]
 
 SPHINX_TREES["/browser/touchbar"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/translations/moz.build b/browser/components/translations/moz.build
index 212b93e509739..3d3d0863216d2 100644
--- a/browser/components/translations/moz.build
+++ b/browser/components/translations/moz.build
@@ -8,3 +8,6 @@ with Files("**"):
 BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/uitour/moz.build b/browser/components/uitour/moz.build
index 7bed2830cb198..eae44b6104c11 100644
--- a/browser/components/uitour/moz.build
+++ b/browser/components/uitour/moz.build
@@ -12,3 +12,6 @@ SPHINX_TREES["docs"] = "docs"
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Tours")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/urlbar/moz.build b/browser/components/urlbar/moz.build
index ebea2842776b4..480563a6cffc0 100644
--- a/browser/components/urlbar/moz.build
+++ b/browser/components/urlbar/moz.build
@@ -93,3 +93,6 @@ XPCSHELL_TESTS_MANIFESTS += [
 ]
 
 SPHINX_TREES["/browser/urlbar"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/components/urlbar/unitconverters/moz.build b/browser/components/urlbar/unitconverters/moz.build
index 649522658fdd4..2aaf609077285 100644
--- a/browser/components/urlbar/unitconverters/moz.build
+++ b/browser/components/urlbar/unitconverters/moz.build
@@ -7,3 +7,6 @@ EXTRA_JS_MODULES += [
     "UnitConverterTemperature.sys.mjs",
     "UnitConverterTimezone.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/extensions/formautofill/locales/moz.build b/browser/extensions/formautofill/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/extensions/formautofill/locales/moz.build
+++ b/browser/extensions/formautofill/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/extensions/formautofill/moz.build b/browser/extensions/formautofill/moz.build
index 2a94a19341440..0ab66233fe853 100644
--- a/browser/extensions/formautofill/moz.build
+++ b/browser/extensions/formautofill/moz.build
@@ -56,3 +56,6 @@ SPHINX_TREES["docs"] = "docs"
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Form Autofill")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/extensions/moz.build b/browser/extensions/moz.build
index 3c6e7eb886892..7c773ba2a026f 100644
--- a/browser/extensions/moz.build
+++ b/browser/extensions/moz.build
@@ -12,3 +12,6 @@ DIRS += [
     "pictureinpicture",
     "search-detection",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/extensions/pictureinpicture/moz.build b/browser/extensions/pictureinpicture/moz.build
index 7cc77f9594aae..9bbb9cfbfe8ac 100644
--- a/browser/extensions/pictureinpicture/moz.build
+++ b/browser/extensions/pictureinpicture/moz.build
@@ -60,3 +60,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Picture-in-Picture")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/extensions/report-site-issue/locales/moz.build b/browser/extensions/report-site-issue/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/extensions/report-site-issue/locales/moz.build
+++ b/browser/extensions/report-site-issue/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/extensions/report-site-issue/moz.build b/browser/extensions/report-site-issue/moz.build
index 54367c1475618..c9dd0175a283c 100644
--- a/browser/extensions/report-site-issue/moz.build
+++ b/browser/extensions/report-site-issue/moz.build
@@ -29,3 +29,6 @@ BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Web Compatibility", "Tooling & Investigations")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/extensions/screenshots/moz.build b/browser/extensions/screenshots/moz.build
index 96f56822f2681..9aa513b22d3a0 100644
--- a/browser/extensions/screenshots/moz.build
+++ b/browser/extensions/screenshots/moz.build
@@ -58,3 +58,6 @@ FINAL_TARGET_FILES.features["screenshots@mozilla.org"]["selector"] += [
 # AUTOMATIC INSERTION END
 
 BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/extensions/search-detection/moz.build b/browser/extensions/search-detection/moz.build
index 65ed6854c1427..c3777ada026f4 100644
--- a/browser/extensions/search-detection/moz.build
+++ b/browser/extensions/search-detection/moz.build
@@ -8,3 +8,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("WebExtensions", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/extensions/webcompat/moz.build b/browser/extensions/webcompat/moz.build
index 7e5d2a44bbfe4..d4aa1be84fcfe 100644
--- a/browser/extensions/webcompat/moz.build
+++ b/browser/extensions/webcompat/moz.build
@@ -193,3 +193,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Web Compatibility", "Tooling & Investigations")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/fonts/moz.build b/browser/fonts/moz.build
index 7b9cb08f48e6b..c93a375f9cd42 100644
--- a/browser/fonts/moz.build
+++ b/browser/fonts/moz.build
@@ -7,3 +7,6 @@
 if CONFIG["MOZ_WIDGET_TOOLKIT"] in ("windows", "gtk"):
     DIST_SUBDIR = ""
     FINAL_TARGET_FILES.fonts += ["TwemojiMozilla.ttf"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/fxr/moz.build b/browser/fxr/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/fxr/moz.build
+++ b/browser/fxr/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/installer/allowed-dupes.mn b/browser/installer/allowed-dupes.mn
index f6d425f36a965..d60999ab2658b 100644
--- a/browser/installer/allowed-dupes.mn
+++ b/browser/installer/allowed-dupes.mn
@@ -73,6 +73,12 @@ browser/features/webcompat@mozilla.org/shims/empty-shim.txt
 removed-files
 #endif
 
+# Juggler/marionette files
+chrome/juggler/content/content/floating-scrollbars.css
+browser/chrome/devtools/skin/floating-scrollbars-responsive-design.css
+chrome/juggler/content/server/stream-utils.js
+chrome/marionette/content/stream-utils.js
+
 # Bug 1496075 - Switch searchplugins to Web Extensions
 browser/chrome/browser/search-extensions/amazon/favicon.ico
 browser/chrome/browser/search-extensions/amazondotcn/favicon.ico
diff --git a/browser/installer/package-manifest.in b/browser/installer/package-manifest.in
index 4068c0c165fce..fec7f8505d224 100644
--- a/browser/installer/package-manifest.in
+++ b/browser/installer/package-manifest.in
@@ -197,6 +197,9 @@
 @RESPATH@/chrome/remote.manifest
 #endif
 
+@RESPATH@/chrome/juggler@JAREXT@
+@RESPATH@/chrome/juggler.manifest
+
 ; [Extensions]
 @RESPATH@/components/extensions-toolkit.manifest
 @RESPATH@/browser/components/extensions-browser.manifest
diff --git a/browser/installer/windows/moz.build b/browser/installer/windows/moz.build
index 42eddc26c0805..c934cae8f5f53 100644
--- a/browser/installer/windows/moz.build
+++ b/browser/installer/windows/moz.build
@@ -17,3 +17,6 @@ if CONFIG["MOZ_DEFAULT_BROWSER_AGENT"]:
     DEFINES["MOZ_DEFAULT_BROWSER_AGENT"] = CONFIG["MOZ_DEFAULT_BROWSER_AGENT"]
 
 SPHINX_TREES["installer"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/locales/moz.build b/browser/locales/moz.build
index 53e3ac361f245..6c085853c59c0 100644
--- a/browser/locales/moz.build
+++ b/browser/locales/moz.build
@@ -36,3 +36,6 @@ with Files("en-US/**"):
 
 with Files("shipped-locales"):
     BUG_COMPONENT = ("Core", "Localization")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/modules/moz.build b/browser/modules/moz.build
index 79d8756eda1d7..ac87712f104f4 100644
--- a/browser/modules/moz.build
+++ b/browser/modules/moz.build
@@ -162,3 +162,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "windows":
         "BackgroundTask_install.sys.mjs",
         "BackgroundTask_uninstall.sys.mjs",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/moz.build b/browser/moz.build
index fdcef15ede8eb..2b16573dd1b9a 100644
--- a/browser/moz.build
+++ b/browser/moz.build
@@ -112,3 +112,6 @@ with Files("tools/**"):
 
 with Files("l10n-registry.manifest"):
     BUG_COMPONENT = ("Core", "Localization")
+
+include("/coverage/coverage.mozbuild")
+DIRS += ["/coverage"]
diff --git a/browser/themes/addons/moz.build b/browser/themes/addons/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/themes/addons/moz.build
+++ b/browser/themes/addons/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/themes/linux/moz.build b/browser/themes/linux/moz.build
index 20e4e3af75f52..17ff313e3233a 100644
--- a/browser/themes/linux/moz.build
+++ b/browser/themes/linux/moz.build
@@ -7,3 +7,6 @@
 JAR_MANIFESTS += ["jar.mn"]
 
 DEFINES["MENUBAR_CAN_AUTOHIDE"] = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/themes/moz.build b/browser/themes/moz.build
index 9856121071e5f..6d0b4ee4b61f9 100644
--- a/browser/themes/moz.build
+++ b/browser/themes/moz.build
@@ -39,3 +39,6 @@ with Files("linux/**"):
 
 with Files("windows/**"):
     SCHEDULES.exclusive = ["windows"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/themes/osx/moz.build b/browser/themes/osx/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/themes/osx/moz.build
+++ b/browser/themes/osx/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/themes/shared/app-marketplace-icons/moz.build b/browser/themes/shared/app-marketplace-icons/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/browser/themes/shared/app-marketplace-icons/moz.build
+++ b/browser/themes/shared/app-marketplace-icons/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/themes/windows/moz.build b/browser/themes/windows/moz.build
index 20e4e3af75f52..17ff313e3233a 100644
--- a/browser/themes/windows/moz.build
+++ b/browser/themes/windows/moz.build
@@ -7,3 +7,6 @@
 JAR_MANIFESTS += ["jar.mn"]
 
 DEFINES["MENUBAR_CAN_AUTOHIDE"] = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/tools/mozscreenshots/moz.build b/browser/tools/mozscreenshots/moz.build
index ffa4017a0ded3..a5332ae9eb561 100644
--- a/browser/tools/mozscreenshots/moz.build
+++ b/browser/tools/mozscreenshots/moz.build
@@ -35,3 +35,6 @@ TEST_DIRS += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/browser/tools/mozscreenshots/mozscreenshots/extension/moz.build b/browser/tools/mozscreenshots/mozscreenshots/extension/moz.build
index 173f6e6dae65e..3c19e8923d7ac 100644
--- a/browser/tools/mozscreenshots/mozscreenshots/extension/moz.build
+++ b/browser/tools/mozscreenshots/mozscreenshots/extension/moz.build
@@ -56,3 +56,6 @@ FINAL_TARGET_FILES.resources.lib.controlCenter += [
     "lib/controlCenter/password.html",
     "lib/controlCenter/tracking.html",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build-with-playwright.sh b/build-with-playwright.sh
new file mode 100755
index 0000000000000..cd2ef1b86feda
--- /dev/null
+++ b/build-with-playwright.sh
@@ -0,0 +1,65 @@
+#!/bin/bash
+
+OBJ_DIR="release-cov"
+PLAYWRIGHT_VERSION="release-1.44"
+
+BASE_DIR=$(dirname "$(readlink -f "$0")")
+
+_die() {
+    [[ $1 ]] || {
+        printf >&2 -- 'Usage:\n\t_die <message> [return code]\n'
+        [[ $- == *i* ]] && return 1 || exit 1
+    }
+
+    printf >&2 -- '%s\n' "$1"
+    exit "${2:-1}"
+}
+
+_status() {
+  echo -e "\e[1;34m${1}\e[0m"
+}
+
+_prepare_playwright() {
+  PLAYWRIGHT_DIR="$1"
+  _status "Resetting Playwright ($PLAYWRIGHT_DIR) to clean state"
+  if [ ! -d "$PLAYWRIGHT_DIR" ]; then
+    _die "$PLAYWRIGHT_DIR does not exist"
+  fi
+  cd $PLAYWRIGHT_DIR
+  git fetch origin
+  git reset --hard HEAD
+  git checkout "$PLAYWRIGHT_VERSION"
+  cd -
+}
+
+_apply_playwright_patches() {
+  PLAYWRIGHT_DIR="$1"
+  cp -r "$PLAYWRIGHT_DIR/browser_patches/firefox/juggler" "juggler"
+  # git apply --index --whitespace=nowarn "$PLAYWRIGHT_DIR/browser_patches/firefox/patches"/*
+}
+
+_build() {
+  _status "Building Firefox"
+  python3.11 mach build
+}
+
+_package() {
+    _status "Packaging"
+    python3.11 mach package
+    mkdir -p "$OBJ_DIR/dist/firefox/defaults/pref"
+    cp "$BASE_DIR/playwright.cfg" "$OBJ_DIR/dist/firefox/"
+    cp "$PLAYWRIGHT_DIR/browser_patches/firefox/preferences/00-playwright-prefs.js" "$OBJ_DIR/dist/firefox/defaults/pref/"
+    cd "$OBJ_DIR/dist"
+    zip -r firefox_linux.zip firefox
+    _status "Zip located at '$(pwd)/firefox.zip', done!"
+}
+
+_main() {
+    PLAYWRIGHT_DIR="playwright"
+    _prepare_playwright "$PLAYWRIGHT_DIR"
+    _apply_playwright_patches "$PLAYWRIGHT_DIR" # on the feat/ipc-fuzzer branch that already includes the patches
+    _build
+    _package "$PLAYWRIGHT_DIR"
+}
+
+_main
diff --git a/build/clang-plugin/moz.build b/build/clang-plugin/moz.build
index 34a626ee4dd34..fb09f24e3779b 100644
--- a/build/clang-plugin/moz.build
+++ b/build/clang-plugin/moz.build
@@ -127,3 +127,6 @@ if CONFIG["LLVM_CXXFLAGS"]:
 # Avoid -DDEBUG=1 on the command line, which conflicts with a #define
 # DEBUG(...) in llvm headers.
 DEFINES["DEBUG"] = False
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/clang-plugin/tests/moz.build b/build/clang-plugin/tests/moz.build
index 0d8b711d9dfa3..7e72b88d09fef 100644
--- a/build/clang-plugin/tests/moz.build
+++ b/build/clang-plugin/tests/moz.build
@@ -99,3 +99,6 @@ COMPILE_FLAGS["OS_CFLAGS"] = [
 # Don't reflect WARNINGS_CFLAGS into CFLAGS, as the warnings flags should be
 # as specified in OS_CFLAGS above.
 DisableCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/moz.build b/build/moz.build
index 12315382b7ec8..65eca8cad9ad3 100644
--- a/build/moz.build
+++ b/build/moz.build
@@ -134,3 +134,6 @@ if CONFIG["MOZ_VALGRIND"]:
         "valgrind/i386-pc-linux-gnu.sup",
         "valgrind/x86_64-pc-linux-gnu.sup",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/pure_virtual/moz.build b/build/pure_virtual/moz.build
index 2e5169fec6280..827bfd631ff2c 100644
--- a/build/pure_virtual/moz.build
+++ b/build/pure_virtual/moz.build
@@ -21,3 +21,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
     CFLAGS += ["-clang:-fno-lto"]
 else:
     CFLAGS += ["-fno-lto"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/rust/mozbuild/moz.build b/build/rust/mozbuild/moz.build
index 3cc09a7c5a5ec..48f7cefab9def 100644
--- a/build/rust/mozbuild/moz.build
+++ b/build/rust/mozbuild/moz.build
@@ -7,3 +7,6 @@
 GeneratedFile(
     "buildconfig.rs", script="generate_buildconfig.py", entry_point="generate"
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/unix/elfhack/inject/moz.build b/build/unix/elfhack/inject/moz.build
index 92f48e6c0aa0b..92dfbab18c10c 100644
--- a/build/unix/elfhack/inject/moz.build
+++ b/build/unix/elfhack/inject/moz.build
@@ -54,3 +54,6 @@ COMPILE_FLAGS["OS_CFLAGS"] += [
 
 AllowCompilerWarnings()
 NoVisibilityFlags()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/unix/elfhack/moz.build b/build/unix/elfhack/moz.build
index 6f8c81af25873..fb9a1fb664aad 100644
--- a/build/unix/elfhack/moz.build
+++ b/build/unix/elfhack/moz.build
@@ -44,3 +44,6 @@ NO_PGO = True
 COMPILE_FLAGS["OS_CXXFLAGS"] = [
     f for f in COMPILE_FLAGS["OS_CXXFLAGS"] if f != "-fno-exceptions"
 ] + ["-fexceptions"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/unix/moz.build b/build/unix/moz.build
index 259e7e9c7dcb2..f3657c37597fa 100644
--- a/build/unix/moz.build
+++ b/build/unix/moz.build
@@ -10,3 +10,6 @@ if CONFIG["USE_ELF_HACK"] or CONFIG["RELRHACK"]:
 FINAL_TARGET_FILES += [
     "run-mozilla.sh",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/unix/stdc++compat/moz.build b/build/unix/stdc++compat/moz.build
index a3681d15d8d4a..5d1e2836b7c07 100644
--- a/build/unix/stdc++compat/moz.build
+++ b/build/unix/stdc++compat/moz.build
@@ -22,3 +22,6 @@ DisableStlWrapping()
 COMPILE_FLAGS["CLANG_PLUGIN"] = []
 
 OS_LIBS += ["-Wl,--version-script,%s/hide_std.ld" % SRCDIR]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/win32/crashinjectdll/moz.build b/build/win32/crashinjectdll/moz.build
index ff113f61e6c10..793156228ed28 100644
--- a/build/win32/crashinjectdll/moz.build
+++ b/build/win32/crashinjectdll/moz.build
@@ -14,3 +14,6 @@ DEFFILE = "crashinjectdll.def"
 
 USE_STATIC_LIBS = True
 NO_PGO = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/build/win32/moz.build b/build/win32/moz.build
index d8d61a22db473..3bf50ab252668 100644
--- a/build/win32/moz.build
+++ b/build/win32/moz.build
@@ -30,3 +30,6 @@ if CONFIG["WIN32_REDIST_DIR"] and CONFIG["COMPILE_ENVIRONMENT"]:
     for f in ["MSVC_C_RUNTIME_DLL", "MSVC_C_RUNTIME_1_DLL", "MSVC_CXX_RUNTIME_DLL"]:
         if CONFIG[f]:
             FINAL_TARGET_FILES += ["%%%s/%s" % (CONFIG["WIN32_REDIST_DIR"], CONFIG[f])]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/builder/build.sh b/builder/build.sh
new file mode 100755
index 0000000000000..500151c281593
--- /dev/null
+++ b/builder/build.sh
@@ -0,0 +1,124 @@
+#!/usr/bin/bash
+
+FOXHOUND_VERSION="main" # or main for current
+#FOXHOUND_VERSION="v118.0.1" # or main for current
+FOXHOUND_OBJ_DIR="obj-tf-release" 
+PLAYWRIGHT_VERSION="release-1.42"
+
+CURRENT_DIR=$(dirname "$(readlink -f "$0")")
+BASEDIR=$(realpath "$CURRENT_DIR/..")
+
+_die() {
+    [[ $1 ]] || {
+        printf >&2 -- 'Usage:\n\t_die <message> [return code]\n'
+        [[ $- == *i* ]] && return 1 || exit 1
+    }
+
+    printf >&2 -- '%s\n' "$1"
+    exit "${2:-1}"
+}
+
+_status() {
+  echo -e "\e[1;34m${1}\e[0m"
+}
+
+# _checkout_foxhound() {
+#   FOXHOUND_DIR="$1"
+#   _status "Cloning foxhound into $FOXHOUND_DIR"
+#   git clone https://github.com/SAP/project-foxhound.git "$FOXHOUND_DIR"
+# }
+
+_checkout_playwright() {
+  PLAYWRIGHT_DIR="$1"
+  _status "Cloning playwright into $PLAYWRIGHT_DIR"
+  git clone https://github.com/microsoft/playwright.git "$PLAYWRIGHT_DIR"
+
+}
+
+_prepare_playwright() {
+  PLAYWRIGHT_DIR="$1"
+  _status "Resetting Playwright ($PLAYWRIGHT_DIR) to clean state"
+  if [ ! -d "$PLAYWRIGHT_DIR" ]; then
+    _die "$PLAYWRIGHT_DIR does not exist"
+  fi
+  pushd "$PLAYWRIGHT_DIR" > /dev/null || exit 1
+  git fetch origin
+  git reset --hard HEAD
+  git checkout "$PLAYWRIGHT_VERSION"
+  popd > /dev/null || exit 1
+}
+# _prepare_foxhound() {
+#   FOXHOUND_DIR="$1"
+#   _status "Resetting Foxhound ($FOXHOUND_DIR) to clean state"
+#   if [ ! -d "$FOXHOUND_DIR" ]; then
+#     _die "$FOXHOUND_DIR does not exist"
+#     exit 1
+#   fi
+#   pushd "$FOXHOUND_DIR" > /dev/null || exit 1
+#   git fetch origin
+#   git reset --hard HEAD
+#   _status "Checking out Foxhound version: $FOXHOUND_VERSION"
+#   git checkout "$FOXHOUND_VERSION"
+#   if [ -d "$FOXHOUND_DIR/juggler" ]; then
+#     _status "Deleting juggler"
+#     rm -rf "$FOXHOUND_DIR/juggler"
+#   fi
+#   if [ ! -f "${FOXHOUND_DIR}/.mozconfig" ]; then
+#     _status "Setting default mozconfig from Ubuntu profile"
+#     cp "$FOXHOUND_DIR/taintfox_mozconfig_ubuntu" "$FOXHOUND_DIR/.mozconfig"
+#   fi
+#   python3.11 mach --no-interactive clobber
+#   python3.11 mach --no-interactive bootstrap --no-system-changes --application-choice=browser
+#   if [ ! -d "$FOXHOUND_OBJ_DIR" ]; then
+#     OBJ_DIR="$(grep -v -e "^#" "$FOXHOUND_DIR/.mozconfig" | grep "MOZ_OBJDIR=@TOPSRCDIR@" | cut -d "/" -f 2)"
+#     _die "FOXHOUND_OBJ_DIR not set, suggesting to set it to: $OBJ_DIR" 1
+#   fi
+# }
+
+_build_foxhound() {
+  FOXHOUND_DIR="$1"
+  PLAYWRIGHT_DIR="$2"
+  cp -r "$PLAYWRIGHT_DIR/browser_patches/firefox/juggler" "juggler"
+  git apply --index --whitespace=nowarn "$PLAYWRIGHT_DIR/browser_patches/firefox/patches"/*
+  python3.11 mach build
+}
+
+_package_foxhound() {
+  _status "Packaging into $FOXHOUND_OBJ_DIR $PLAYWRIGHT_DIR"
+  FOXHOUND_DIR="$1"
+  PLAYWRIGHT_DIR="$2"
+  _status "Packaging foxhound.."
+  python3.11 mach package
+  mkdir -p "$FOXHOUND_OBJ_DIR/dist/firefox/defaults/pref"
+  _status "cp $PLAYWRIGHT_DIR/browser_patches/firefox/preferences/playwright.cfg $FOXHOUND_OBJ_DIR/dist/firefox/"
+  cp "$PLAYWRIGHT_DIR/browser_patches/firefox/preferences/playwright.cfg" "$FOXHOUND_OBJ_DIR/dist/firefox/"
+  _status "cp $PLAYWRIGHT_DIR/browser_patches/firefox/preferences/00-playwright-prefs.js $FOXHOUND_OBJ_DIR/dist/firefox/defaults/pref/"
+  cp "$PLAYWRIGHT_DIR/browser_patches/firefox/preferences/00-playwright-prefs.js" "$FOXHOUND_OBJ_DIR/dist/firefox/defaults/pref/"
+  pushd "$FOXHOUND_OBJ_DIR/dist" || exit 1
+  zip -r firefox_linux.zip firefox
+  _status "Zip located at '$(pwd)/firefox.zip', done!"
+}
+
+
+_main() {
+  echo "$BASEDIR"
+
+  FOXHOUND_DIR="$BASEDIR/project-foxhound"
+  PLAYWRIGHT_DIR="$BASEDIR/playwright"
+  # if [ ! -d "$FOXHOUND_DIR" ]; then
+  #   _checkout_foxhound "$FOXHOUND_DIR"
+  # fi
+  # _prepare_foxhound "$FOXHOUND_DIR"
+  # if [ ! -d "$PLAYWRIGHT_DIR" ]; then
+  #   # _checkout_playwright "$PLAYWRIGHT_DIR"
+  # fi
+  # _prepare_playwright "$PLAYWRIGHT_DIR"
+  _status "Current dir: $(pwd)"
+  # _build_foxhound "$FOXHOUND_DIR" "$PLAYWRIGHT_DIR"
+  _package_foxhound "$FOXHOUND_DIR" "$PLAYWRIGHT_DIR"
+  
+}
+
+_main
+
+
diff --git a/caps/BasePrincipal.cpp b/caps/BasePrincipal.cpp
index ca611b13f8232..192f0b7607ccb 100644
--- a/caps/BasePrincipal.cpp
+++ b/caps/BasePrincipal.cpp
@@ -45,6 +45,8 @@
 #include "json/json.h"
 #include "nsSerializationHelper.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
 namespace mozilla {
 
 const char* BasePrincipal::JSONEnumKeyStrings[4] = {
@@ -416,6 +418,11 @@ nsresult BasePrincipal::ToJSON(Json::Value& aObject) {
 
 bool BasePrincipal::FastSubsumesIgnoringFPD(
     nsIPrincipal* aOther, DocumentDomainConsideration aConsideration) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x80){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::FastSubsumesIgnoringFPD"));
+    return true;
+  }
   MOZ_ASSERT(aOther);
 
   if (Kind() == eContentPrincipal &&
@@ -429,6 +436,11 @@ bool BasePrincipal::FastSubsumesIgnoringFPD(
 
 bool BasePrincipal::Subsumes(nsIPrincipal* aOther,
                              DocumentDomainConsideration aConsideration) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x100){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::Subsumes"));
+    return true;
+  }
   MOZ_ASSERT(aOther);
   MOZ_ASSERT_IF(Kind() == eContentPrincipal, mOriginSuffix);
 
@@ -456,6 +468,13 @@ BasePrincipal::Equals(nsIPrincipal* aOther, bool* aResult) {
 NS_IMETHODIMP
 BasePrincipal::EqualsForPermission(nsIPrincipal* aOther, bool aExactHost,
                                    bool* aResult) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x200){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::EqualsForPermission"));
+    *aResult = true;
+    return NS_OK;
+  }
+
   *aResult = false;
   NS_ENSURE_ARG_POINTER(aOther);
   NS_ENSURE_ARG_POINTER(aResult);
@@ -576,6 +595,12 @@ BasePrincipal::EqualsForPermission(nsIPrincipal* aOther, bool aExactHost,
 
 NS_IMETHODIMP
 BasePrincipal::EqualsConsideringDomain(nsIPrincipal* aOther, bool* aResult) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x400){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::EqualsConsideringDomain"));
+    *aResult = true;
+    return NS_OK;
+  }
   NS_ENSURE_ARG_POINTER(aOther);
 
   *aResult = FastEqualsConsideringDomain(aOther);
@@ -585,6 +610,12 @@ BasePrincipal::EqualsConsideringDomain(nsIPrincipal* aOther, bool* aResult) {
 
 NS_IMETHODIMP
 BasePrincipal::EqualsURI(nsIURI* aOtherURI, bool* aResult) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x800){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::EqualsURI"));
+    *aResult = true;
+    return NS_OK;
+  }
   *aResult = false;
   nsCOMPtr<nsIURI> prinURI;
   nsresult rv = GetURI(getter_AddRefs(prinURI));
@@ -596,6 +627,12 @@ BasePrincipal::EqualsURI(nsIURI* aOtherURI, bool* aResult) {
 
 NS_IMETHODIMP
 BasePrincipal::Subsumes(nsIPrincipal* aOther, bool* aResult) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x1000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::Subsumes"));
+    *aResult = true;
+    return NS_OK;
+  }
   NS_ENSURE_ARG_POINTER(aOther);
 
   *aResult = FastSubsumes(aOther);
@@ -605,6 +642,12 @@ BasePrincipal::Subsumes(nsIPrincipal* aOther, bool* aResult) {
 
 NS_IMETHODIMP
 BasePrincipal::SubsumesConsideringDomain(nsIPrincipal* aOther, bool* aResult) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x2000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::SubsumesConsideringDomain"));
+    *aResult = true;
+    return NS_OK;
+  }
   NS_ENSURE_ARG_POINTER(aOther);
 
   *aResult = FastSubsumesConsideringDomain(aOther);
@@ -615,6 +658,12 @@ BasePrincipal::SubsumesConsideringDomain(nsIPrincipal* aOther, bool* aResult) {
 NS_IMETHODIMP
 BasePrincipal::SubsumesConsideringDomainIgnoringFPD(nsIPrincipal* aOther,
                                                     bool* aResult) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x4000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::SubsumesConsideringDomainIgnoringFPD"));
+    *aResult = true;
+    return NS_OK;
+  }
   NS_ENSURE_ARG_POINTER(aOther);
 
   *aResult = FastSubsumesConsideringDomainIgnoringFPD(aOther);
@@ -625,6 +674,11 @@ BasePrincipal::SubsumesConsideringDomainIgnoringFPD(nsIPrincipal* aOther,
 NS_IMETHODIMP
 BasePrincipal::CheckMayLoad(nsIURI* aURI, bool aAllowIfInheritsPrincipal) {
   AssertIsOnMainThread();
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x8000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::CheckMayLoad"));
+    return NS_OK;
+  }
   return CheckMayLoadHelper(aURI, aAllowIfInheritsPrincipal, false, 0);
 }
 
@@ -633,6 +687,11 @@ BasePrincipal::CheckMayLoadWithReporting(nsIURI* aURI,
                                          bool aAllowIfInheritsPrincipal,
                                          uint64_t aInnerWindowID) {
   AssertIsOnMainThread();
+    // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x10000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::CheckMayLoadWithReporting"));
+    return NS_OK;
+  }
   return CheckMayLoadHelper(aURI, aAllowIfInheritsPrincipal, true,
                             aInnerWindowID);
 }
@@ -643,6 +702,11 @@ nsresult BasePrincipal::CheckMayLoadHelper(nsIURI* aURI,
                                            uint64_t aInnerWindowID) {
   AssertIsOnMainThread();  // Accesses non-threadsafe URI flags and the
                            // non-threadsafe ExtensionPolicyService
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x20000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::CheckMayLoadHelper"));
+    return NS_OK;
+  }
   NS_ENSURE_ARG_POINTER(aURI);
   MOZ_ASSERT(
       aReport || aInnerWindowID == 0,
@@ -753,6 +817,12 @@ BasePrincipal::IsThirdPartyChannel(nsIChannel* aChan, bool* aRes) {
 
 NS_IMETHODIMP
 BasePrincipal::IsSameOrigin(nsIURI* aURI, bool* aRes) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x40000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::IsSameOrigin"));
+    *aRes = true;
+    return NS_OK;
+  }
   *aRes = false;
   nsCOMPtr<nsIURI> prinURI;
   nsresult rv = GetURI(getter_AddRefs(prinURI));
@@ -768,6 +838,13 @@ BasePrincipal::IsSameOrigin(nsIURI* aURI, bool* aRes) {
 NS_IMETHODIMP
 BasePrincipal::IsL10nAllowed(nsIURI* aURI, bool* aRes) {
   AssertIsOnMainThread();  // URI_DANGEROUS_TO_LOAD is not threadsafe to query.
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x80000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::IsL10nAllowed"));
+    *aRes = true;
+    return NS_OK;
+  }
+
   *aRes = false;
 
   if (nsContentUtils::IsErrorPage(aURI)) {
@@ -812,6 +889,12 @@ BasePrincipal::IsL10nAllowed(nsIURI* aURI, bool* aRes) {
 
 NS_IMETHODIMP
 BasePrincipal::AllowsRelaxStrictFileOriginPolicy(nsIURI* aURI, bool* aRes) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x100000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::AllowsRelaxStrictFileOriginPolicy"));
+    *aRes = true;
+    return NS_OK;
+  }
   *aRes = false;
   nsCOMPtr<nsIURI> prinURI;
   nsresult rv = GetURI(getter_AddRefs(prinURI));
@@ -864,9 +947,17 @@ BasePrincipal::HasFirstpartyStorageAccess(mozIDOMWindow* aCheckWindow,
                                           uint32_t* aRejectedReason,
                                           bool* aOutAllowed) {
   AssertIsOnMainThread();
+
   *aRejectedReason = 0;
   *aOutAllowed = false;
 
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x200000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::HasFirstpartyStorageAccess"));
+    *aOutAllowed = true;
+    return NS_OK;
+  }
+
   nsPIDOMWindowInner* win = nsPIDOMWindowInner::From(aCheckWindow);
   nsCOMPtr<nsIURI> uri;
   nsresult rv = GetURI(getter_AddRefs(uri));
@@ -1128,6 +1219,13 @@ BasePrincipal::IsContentAccessibleAboutURI(bool* aResult) {
 NS_IMETHODIMP
 BasePrincipal::GetIsOriginPotentiallyTrustworthy(bool* aResult) {
   AssertIsOnMainThread();
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x400000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::GetIsOriginPotentiallyTrustworthy"));
+    *aResult = true;
+    return NS_OK;
+  }
+
   *aResult = false;
 
   nsCOMPtr<nsIURI> uri;
@@ -1558,6 +1656,13 @@ BasePrincipal::GetStorageOriginKey(nsACString& aOriginKey) {
 NS_IMETHODIMP
 BasePrincipal::GetIsScriptAllowedByPolicy(bool* aIsScriptAllowedByPolicy) {
   AssertIsOnMainThread();
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x800000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::GetIsScriptAllowedByPolicy"));
+    *aIsScriptAllowedByPolicy = true;
+    return NS_OK;
+  }
+
   *aIsScriptAllowedByPolicy = false;
   nsCOMPtr<nsIURI> prinURI;
   nsresult rv = GetURI(getter_AddRefs(prinURI));
diff --git a/caps/ContentPrincipal.cpp b/caps/ContentPrincipal.cpp
index 5aeecaf2bd426..4c988e56a9359 100644
--- a/caps/ContentPrincipal.cpp
+++ b/caps/ContentPrincipal.cpp
@@ -40,6 +40,9 @@
 #include "nsSerializationHelper.h"
 #include "json/json.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
+
 using namespace mozilla;
 
 NS_IMPL_CLASSINFO(ContentPrincipal, nullptr, 0, NS_PRINCIPAL_CID)
@@ -222,6 +225,12 @@ bool ContentPrincipal::SubsumesInternal(
     BasePrincipal::DocumentDomainConsideration aConsideration) {
   MOZ_ASSERT(aOther);
 
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x1000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE ContentPrincipal::SubsumesInternal"));
+    return true;
+  }
+
   // For ContentPrincipal, Subsumes is equivalent to Equals.
   if (aOther == this) {
     return true;
diff --git a/caps/ExpandedPrincipal.cpp b/caps/ExpandedPrincipal.cpp
index ce8ccd8b82775..9c90ba452b563 100644
--- a/caps/ExpandedPrincipal.cpp
+++ b/caps/ExpandedPrincipal.cpp
@@ -12,6 +12,9 @@
 #include "mozilla/extensions/WebExtensionPolicy.h"
 #include "json/json.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
+
 using namespace mozilla;
 
 NS_IMPL_CLASSINFO(ExpandedPrincipal, nullptr, 0, NS_EXPANDEDPRINCIPAL_CID)
@@ -65,6 +68,11 @@ ExpandedPrincipal::SetDomain(nsIURI* aDomain) { return NS_OK; }
 bool ExpandedPrincipal::SubsumesInternal(
     nsIPrincipal* aOther,
     BasePrincipal::DocumentDomainConsideration aConsideration) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x40){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE ExpandedPrincipal::SubsumesInternal"));
+    return true;
+  }
   // If aOther is an ExpandedPrincipal too, we break it down into its component
   // nsIPrincipals, and check subsumes on each one.
   if (Cast(aOther)->Is<ExpandedPrincipal>()) {
diff --git a/caps/NullPrincipal.cpp b/caps/NullPrincipal.cpp
index f0a0ad4708776..697ab84c4d9c7 100644
--- a/caps/NullPrincipal.cpp
+++ b/caps/NullPrincipal.cpp
@@ -29,6 +29,9 @@
 
 #include "json/json.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
+
 using namespace mozilla;
 
 NS_IMPL_CLASSINFO(NullPrincipal, nullptr, 0, NS_NULLPRINCIPAL_CID)
@@ -166,6 +169,12 @@ NullPrincipal::GetURI(nsIURI** aURI) {
 }
 NS_IMETHODIMP
 NullPrincipal::GetIsOriginPotentiallyTrustworthy(bool* aResult) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().renderer_checks_deactivated()){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE NullPrincipal::GetIsOriginPotentiallyTrustworthy"));
+    *aResult = true;
+    return NS_OK;
+  }
   *aResult = false;
   return NS_OK;
 }
@@ -185,6 +194,11 @@ NullPrincipal::SetDomain(nsIURI* aDomain) {
 }
 
 bool NullPrincipal::MayLoadInternal(nsIURI* aURI) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().renderer_checks_deactivated()){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE NullPrincipal::MayLoadInternal"));
+    return true;
+  }
   // Also allow the load if we are the principal of the URI being checked.
   nsCOMPtr<nsIPrincipal> blobPrincipal;
   if (dom::BlobURLProtocolHandler::GetBlobURLPrincipal(
diff --git a/caps/moz.build b/caps/moz.build
index 1fdb1324c697c..32ec11e50d839 100644
--- a/caps/moz.build
+++ b/caps/moz.build
@@ -77,3 +77,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "Security: CAPS")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/caps/nsJSPrincipals.cpp b/caps/nsJSPrincipals.cpp
index d089bffdf5640..a324613bd3889 100644
--- a/caps/nsJSPrincipals.cpp
+++ b/caps/nsJSPrincipals.cpp
@@ -15,6 +15,9 @@
 #include "mozilla/ipc/BackgroundUtils.h"
 #include "mozilla/ipc/PBackgroundSharedTypes.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
+
 using namespace mozilla;
 using namespace mozilla::dom;
 using namespace mozilla::ipc;
@@ -41,6 +44,10 @@ nsJSPrincipals::Release() {
 
 /* static */
 bool nsJSPrincipals::Subsume(JSPrincipals* jsprin, JSPrincipals* other) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x10000000){
+    return true;
+  }
   bool result;
   nsresult rv = nsJSPrincipals::get(jsprin)->Subsumes(
       nsJSPrincipals::get(other), &result);
diff --git a/caps/nsScriptSecurityManager.cpp b/caps/nsScriptSecurityManager.cpp
index 842b41811e8d5..8bbfc16f64d04 100644
--- a/caps/nsScriptSecurityManager.cpp
+++ b/caps/nsScriptSecurityManager.cpp
@@ -73,12 +73,13 @@
 #include "nsILoadInfo.h"
 #include "js/ColumnNumber.h"  // JS::ColumnNumberOneOrigin
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
 // This should be probably defined on some other place... but I couldn't find it
 #define WEBAPPS_PERM_NAME "webapps-manage"
 
 using namespace mozilla;
 using namespace mozilla::dom;
-
 StaticRefPtr<nsIIOService> nsScriptSecurityManager::sIOService;
 std::atomic<bool> nsScriptSecurityManager::sStrictFileOriginPolicy = true;
 
@@ -214,6 +215,11 @@ inline void SetPendingException(JSContext* cx, const char16_t* aMsg) {
 /* static */
 bool nsScriptSecurityManager::SecurityCompareURIs(nsIURI* aSourceURI,
                                                   nsIURI* aTargetURI) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x2000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::SecurityCompareURIs"));
+    return true;
+  }
   return NS_SecurityCompareURIs(aSourceURI, aTargetURI,
                                 sStrictFileOriginPolicy);
 }
@@ -450,6 +456,12 @@ NS_IMPL_ISUPPORTS(nsScriptSecurityManager, nsIScriptSecurityManager)
 
 bool nsScriptSecurityManager::ContentSecurityPolicyPermitsJSAction(
     JSContext* cx, JS::RuntimeCode aKind, JS::Handle<JSString*> aCode) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x4000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::ContentSecurityPolicyPermitsJSAction"));
+    return true;
+  }
+
   MOZ_ASSERT(cx == nsContentUtils::GetCurrentJSContext());
 
   nsCOMPtr<nsIPrincipal> subjectPrincipal = nsContentUtils::SubjectPrincipal();
@@ -564,6 +576,11 @@ bool nsScriptSecurityManager::ContentSecurityPolicyPermitsJSAction(
 // static
 bool nsScriptSecurityManager::JSPrincipalsSubsume(JSPrincipals* first,
                                                   JSPrincipals* second) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x8000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::JSPrincipalsSubsume"));
+    return true;
+  }
   return nsJSPrincipals::get(first)->Subsumes(nsJSPrincipals::get(second));
 }
 
@@ -572,6 +589,11 @@ nsScriptSecurityManager::CheckSameOriginURI(nsIURI* aSourceURI,
                                             nsIURI* aTargetURI,
                                             bool reportError,
                                             bool aFromPrivateWindow) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x20000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CheckSameOriginURI"));
+    return NS_OK;
+  }
   // Please note that aFromPrivateWindow is only 100% accurate if
   // reportError is true.
   if (!SecurityCompareURIs(aSourceURI, aTargetURI)) {
@@ -586,6 +608,11 @@ nsScriptSecurityManager::CheckSameOriginURI(nsIURI* aSourceURI,
 
 NS_IMETHODIMP
 nsScriptSecurityManager::CheckLoadURIFromScript(JSContext* cx, nsIURI* aURI) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x40000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CheckLoadURIFromScript"));
+    return NS_OK;
+  }
   // Get principal of currently executing script.
   MOZ_ASSERT(cx == nsContentUtils::GetCurrentJSContext());
   nsIPrincipal* principal = nsContentUtils::SubjectPrincipal();
@@ -659,6 +686,11 @@ nsScriptSecurityManager::CheckLoadURIWithPrincipal(nsIPrincipal* aPrincipal,
                                                    nsIURI* aTargetURI,
                                                    uint32_t aFlags,
                                                    uint64_t aInnerWindowID) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x80000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CheckLoadURIWithPrincipal"));
+    return NS_OK;
+  }
   MOZ_ASSERT(aPrincipal, "CheckLoadURIWithPrincipal must have a principal");
 
   // If someone passes a flag that we don't understand, we should
@@ -1255,6 +1287,7 @@ NS_IMETHODIMP
 nsScriptSecurityManager::CheckLoadURIWithPrincipalFromJS(
     nsIPrincipal* aPrincipal, nsIURI* aTargetURI, uint32_t aFlags,
     uint64_t aInnerWindowID, JSContext* aCx) {
+
   MOZ_ASSERT(aPrincipal,
              "CheckLoadURIWithPrincipalFromJS must have a principal");
   NS_ENSURE_ARG_POINTER(aPrincipal);
@@ -1295,6 +1328,11 @@ nsScriptSecurityManager::CheckLoadURIStrWithPrincipalFromJS(
 
 NS_IMETHODIMP
 nsScriptSecurityManager::InFileURIAllowlist(nsIURI* aUri, bool* aResult) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x100000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::InFileURIAllowlist"));
+    return NS_OK;
+  }
   MOZ_ASSERT(aUri);
   MOZ_ASSERT(aResult);
 
@@ -1501,6 +1539,11 @@ nsScriptSecurityManager::CanCreateWrapper(JSContext* cx, const nsIID& aIID,
 
 NS_IMETHODIMP
 nsScriptSecurityManager::CanCreateInstance(JSContext* cx, const nsCID& aCID) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x200000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CanCreateInstance"));
+    return NS_OK;
+  }
   if (nsContentUtils::IsCallerChrome()) {
     return NS_OK;
   }
@@ -1516,6 +1559,11 @@ nsScriptSecurityManager::CanCreateInstance(JSContext* cx, const nsCID& aCID) {
 
 NS_IMETHODIMP
 nsScriptSecurityManager::CanGetService(JSContext* cx, const nsCID& aCID) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x400000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CanGetService"));
+    return NS_OK;
+  }
   if (nsContentUtils::IsCallerChrome()) {
     return NS_OK;
   }
diff --git a/caps/tests/gtest/moz.build b/caps/tests/gtest/moz.build
index 10b1a66f3b940..7e11984850403 100644
--- a/caps/tests/gtest/moz.build
+++ b/caps/tests/gtest/moz.build
@@ -16,3 +16,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/chrome/moz.build b/chrome/moz.build
index ddca6edbe4d62..0092e0e16fd9e 100644
--- a/chrome/moz.build
+++ b/chrome/moz.build
@@ -45,3 +45,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Startup and Profile System")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/chrome/test/moz.build b/chrome/test/moz.build
index 3f3720e8eb9bc..343f5269b2890 100644
--- a/chrome/test/moz.build
+++ b/chrome/test/moz.build
@@ -8,3 +8,6 @@ XPCSHELL_TESTS_MANIFESTS += [
     "unit/xpcshell.toml",
     "unit_ipc/xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/fdlibm/moz.build b/config/external/fdlibm/moz.build
index 343645f0ce8f9..97abdf4d25caf 100644
--- a/config/external/fdlibm/moz.build
+++ b/config/external/fdlibm/moz.build
@@ -10,3 +10,6 @@ with Files("**"):
 DIRS += [
     "../../../modules/fdlibm",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/ffi/moz.build b/config/external/ffi/moz.build
index ee0dc884e0115..b615ad31b8582 100644
--- a/config/external/ffi/moz.build
+++ b/config/external/ffi/moz.build
@@ -147,3 +147,6 @@ else:
         inputs=["/js/src/ctypes/libffi/include/ffi.h.in"],
         flags=ffi_h_defines,
     )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/freetype2/moz.build b/config/external/freetype2/moz.build
index 3d025e1ee4c64..64b187a2ddb54 100644
--- a/config/external/freetype2/moz.build
+++ b/config/external/freetype2/moz.build
@@ -12,3 +12,6 @@ if CONFIG["MOZ_TREE_FREETYPE"]:
     ]
 else:
     OS_LIBS += CONFIG["FT2_LIBS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/gkcodecs/moz.build b/config/external/gkcodecs/moz.build
index 040f6809deca6..46b09e1891861 100644
--- a/config/external/gkcodecs/moz.build
+++ b/config/external/gkcodecs/moz.build
@@ -16,3 +16,6 @@ SHARED_LIBRARY_NAME = "gkcodecs"
 SYMBOLS_FILE = "gkcodecs.symbols"
 if CONFIG["MOZ_SYSTEM_LIBVPX"]:
     DEFINES["MOZ_SYSTEM_LIBVPX"] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/icu/common/moz.build b/config/external/icu/common/moz.build
index b670c06222368..731e46e07fe62 100644
--- a/config/external/icu/common/moz.build
+++ b/config/external/icu/common/moz.build
@@ -32,3 +32,6 @@ if (
     SOURCES["/intl/icu/source/common/ubidi.cpp"].flags += [
         "-Wno-error=enum-constexpr-conversion"
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/icu/data/moz.build b/config/external/icu/data/moz.build
index 88926c94fad3d..364b3b9da41b4 100644
--- a/config/external/icu/data/moz.build
+++ b/config/external/icu/data/moz.build
@@ -38,3 +38,6 @@ if CONFIG["TARGET_ENDIANNESS"] == "big":
     GeneratedFile(
         data_file["big"], script="convert_icudata.py", inputs=[data_file["little"]]
     )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/icu/i18n/moz.build b/config/external/icu/i18n/moz.build
index 098aa7843f91e..9d9ccc39d4e2e 100644
--- a/config/external/icu/i18n/moz.build
+++ b/config/external/icu/i18n/moz.build
@@ -22,3 +22,6 @@ if CONFIG["TARGET_ENDIANNESS"] == "big":
     HOST_DEFINES["U_I18N_IMPLEMENTATION"] = True
     HOST_SOURCES += sources
     HOST_SOURCES += other_sources
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/icu/icupkg/moz.build b/config/external/icu/icupkg/moz.build
index 39314fbda7911..1399506b69dfc 100644
--- a/config/external/icu/icupkg/moz.build
+++ b/config/external/icu/icupkg/moz.build
@@ -25,3 +25,6 @@ HOST_USE_LIBS += [
     "host_icutoolutil",
     "host_icuuc",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/icu/moz.build b/config/external/icu/moz.build
index 296d60d521f77..9910f8104378d 100644
--- a/config/external/icu/moz.build
+++ b/config/external/icu/moz.build
@@ -20,3 +20,6 @@ else:
             "icupkg",
         ]
     USE_LIBS += ["icudata"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/icu/toolutil/moz.build b/config/external/icu/toolutil/moz.build
index e8dc827c2bbee..ff88f47c502bd 100644
--- a/config/external/icu/toolutil/moz.build
+++ b/config/external/icu/toolutil/moz.build
@@ -18,3 +18,6 @@ include("../defs.mozbuild")
 include("sources.mozbuild")
 
 HOST_SOURCES += sources
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/lgpllibs/moz.build b/config/external/lgpllibs/moz.build
index 1ef140baeaceb..fbdbe84f44bb8 100644
--- a/config/external/lgpllibs/moz.build
+++ b/config/external/lgpllibs/moz.build
@@ -16,3 +16,6 @@ SHARED_LIBRARY_NAME = "lgpllibs"
 # For some reason, mingw builds export way too many symbols.
 if CONFIG["TARGET_OS"] == "WINNT" and CONFIG["CC_TYPE"] != "clang-cl":
     SYMBOLS_FILE = "lgpllibs.symbols"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/moz.build b/config/external/moz.build
index 2fc8df57992ed..71db9d438cb4c 100644
--- a/config/external/moz.build
+++ b/config/external/moz.build
@@ -73,3 +73,6 @@ external_dirs += [
 ]
 
 DIRS += ["../../" + i for i in external_dirs]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/nspr/ds/moz.build b/config/external/nspr/ds/moz.build
index d2676e20937a7..ff66c69eb1ff4 100644
--- a/config/external/nspr/ds/moz.build
+++ b/config/external/nspr/ds/moz.build
@@ -32,3 +32,6 @@ SOURCES += [
     "/nsprpub/lib/ds/plarena.c",
     "/nsprpub/lib/ds/plhash.c",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/nspr/libc/moz.build b/config/external/nspr/libc/moz.build
index 62bb8814f6579..621ef9344c4ce 100644
--- a/config/external/nspr/libc/moz.build
+++ b/config/external/nspr/libc/moz.build
@@ -43,3 +43,6 @@ SOURCES += [
     "/nsprpub/lib/libc/src/strstr.c",
     "/nsprpub/lib/libc/src/strtok.c",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/nspr/moz.build b/config/external/nspr/moz.build
index f2b3d4e8c1d5c..73ee263654721 100644
--- a/config/external/nspr/moz.build
+++ b/config/external/nspr/moz.build
@@ -26,3 +26,6 @@ if CONFIG["MOZ_BUILD_NSPR"]:
     EXPORTS.nspr += ["prcpucfg.h"]
 else:
     OS_LIBS += CONFIG["NSPR_LIBS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/nspr/pr/moz.build b/config/external/nspr/pr/moz.build
index cf1ebf1cc01f2..b0b1f79ab7f5c 100644
--- a/config/external/nspr/pr/moz.build
+++ b/config/external/nspr/pr/moz.build
@@ -252,3 +252,6 @@ EXPORTS.nspr.private += [
     "/nsprpub/pr/include/private/pprthred.h",
     "/nsprpub/pr/include/private/prpriv.h",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/rlbox/moz.build b/config/external/rlbox/moz.build
index 28b09d3314609..7c81a4f2f402f 100644
--- a/config/external/rlbox/moz.build
+++ b/config/external/rlbox/moz.build
@@ -29,3 +29,6 @@ EXPORTS.mozilla.rlbox += [
 SOURCES += ["rlbox_thread_locals.cpp"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/rlbox_wasm2c_sandbox/moz.build b/config/external/rlbox_wasm2c_sandbox/moz.build
index 4600f12c19cd1..57de89136f3cc 100644
--- a/config/external/rlbox_wasm2c_sandbox/moz.build
+++ b/config/external/rlbox_wasm2c_sandbox/moz.build
@@ -25,3 +25,6 @@ SOURCES += [
 LOCAL_INCLUDES += ["/third_party/wasm2c/wasm2c/"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/sqlite/moz.build b/config/external/sqlite/moz.build
index 6294924c564ae..cf72f873ae488 100644
--- a/config/external/sqlite/moz.build
+++ b/config/external/sqlite/moz.build
@@ -16,3 +16,6 @@ else:
     SHARED_LIBRARY_NAME = "mozsqlite3"
 
     SYMBOLS_FILE = "/third_party/sqlite3/src/sqlite.symbols"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/wasm2c_sandbox_compiler/moz.build b/config/external/wasm2c_sandbox_compiler/moz.build
index 1ec6490a78c3b..ec77da152d498 100644
--- a/config/external/wasm2c_sandbox_compiler/moz.build
+++ b/config/external/wasm2c_sandbox_compiler/moz.build
@@ -80,3 +80,6 @@ HOST_CXXFLAGS += [
 ]
 
 HostProgram("wasm2c")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/external/zlib/moz.build b/config/external/zlib/moz.build
index 755400fa7f86c..2378071c6ce56 100644
--- a/config/external/zlib/moz.build
+++ b/config/external/zlib/moz.build
@@ -19,3 +19,6 @@ else:
     DIRS += [
         "../../../modules/zlib",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/moz.build b/config/moz.build
index 3280aac27e100..9603ec8cbd7c9 100644
--- a/config/moz.build
+++ b/config/moz.build
@@ -114,3 +114,6 @@ if CONFIG["COMPILE_ENVIRONMENT"] and CONFIG["CBINDGEN"]:
         entry_point="generate_metadata",
         inputs=["!/.cargo/config"],
     )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/config/tests/src-simple/moz.build b/config/tests/src-simple/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/config/tests/src-simple/moz.build
+++ b/config/tests/src-simple/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/coverage/coverage.mozbuild b/coverage/coverage.mozbuild
new file mode 100644
index 0000000000000..6202fc9e50238
--- /dev/null
+++ b/coverage/coverage.mozbuild
@@ -0,0 +1,6 @@
+# -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
+# vim: set filetype=python:
+
+CFLAGS += ["-fsanitize-coverage=trace-pc-guard"]
+CXXFLAGS += ["-fsanitize-coverage=trace-pc-guard"]
+RUSTFLAGS += ["-Cpasses=sancov-module", "-Cllvm-args=-sanitizer-coverage-level=3", "-Cllvm-args=-sanitizer-coverage-trace-pc-guard", "-Zinstrument-coverage"]
diff --git a/coverage/moz.build b/coverage/moz.build
new file mode 100644
index 0000000000000..1bf4cf4712f96
--- /dev/null
+++ b/coverage/moz.build
@@ -0,0 +1,17 @@
+# -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
+# vim: set filetype=python:
+
+with Files("**"):
+    BUG_COMPONENT = ("Core", "Coverage")
+
+EXPORTS += [
+    "sanitizer_coverage.h",
+]
+
+UNIFIED_SOURCES += [
+    "sanitizer_coverage.cpp",
+]
+
+FINAL_LIBRARY = "xul"
+
+
diff --git a/coverage/sanitizer_coverage.cpp b/coverage/sanitizer_coverage.cpp
new file mode 100644
index 0000000000000..13f8bd0f5b6b7
--- /dev/null
+++ b/coverage/sanitizer_coverage.cpp
@@ -0,0 +1,125 @@
+#include "sanitizer_coverage.h"
+
+#include <fcntl.h> /* For O_* constants */
+#include <stdint.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <sys/mman.h>
+#include <sys/stat.h> /* For mode constants */
+#include <unistd.h>
+
+#define SHM_SIZE 0x100000
+#define MAX_EDGES ((SHM_SIZE - 4) * 8)
+
+
+
+struct shmem_data* cov_all = nullptr;
+struct shmem_data* cov_browser = nullptr;
+
+static const bool once = [](){
+        activate_coverage_all();
+        return true;
+    } ();
+
+#define NO_SANITIZE __attribute__((no_sanitize("all")))
+
+NO_SANITIZE void __sanitizer_cov_trace_pc_guard_init(uint32_t* start,
+                                                     uint32_t* stop) {
+  edges_start = start;
+  edges_stop = stop;
+  fprintf(stderr, "[COV] __sanitizer_cov_trace_pc_guard_init %ld %p %p\n", stop-start, start, stop);
+}
+
+NO_SANITIZE void __sanitizer_cov_trace_pc_guard(uint32_t* guard) {
+  if (coverage_activated == true && *guard != 0) {
+    uint32_t index = *guard;
+#pragma clang diagnostic push
+#pragma clang diagnostic ignored "-Wunsafe-buffer-usage"
+    cov_all->edges[index / 8] |= 1 << (index % 8);
+    if (browser_coverage_activated) {
+      cov_browser->edges[index / 8] |= 1 << (index % 8);
+    }
+#pragma clang diagnostic pop
+    *guard = 0;
+  }
+}
+
+NO_SANITIZE void map_shmem(const char* id, shmem_data** shmem) {
+    if (!edges_start || !edges_stop) {
+    fprintf(stderr,
+            "[COV] __sanitizer_cov_trace_pc_guard_init was not called!\n");
+    return;
+  }
+
+  if (*shmem) {
+    fprintf(stderr, "[COV] Multiple initialization of shmem\n");
+    _exit(-1);
+  }
+
+  const char* shm_key = getenv(id);
+  fprintf(stderr, "[COV] shm_key: %s\n", shm_key);
+  if (!shm_key) {
+    fprintf(stderr, "[COV] No shared memory bitmap available\n");
+    return;
+  }
+
+  // Create and open shared memory object
+  int fd = shm_open(shm_key,  O_RDWR, 0666); //O_CREAT |
+  if (fd <= -1) {
+    perror("shm_open");
+    fprintf(stderr, "[COV] Failed to open shared memory region\n");
+    _exit(-1);
+  }
+
+  // Set size of shared memory object
+  // if (ftruncate(fd, SHM_SIZE) == -1) {
+  //     perror("ftruncate");
+  //     fprintf(stderr, "[COV] Failed to ftruncate shared memory object\n");
+  //     close(fd);
+  //     _exit(-1);
+  // }
+
+  // Map shared memory object into address space
+  *shmem = (shmem_data*) mmap(nullptr, SHM_SIZE, PROT_READ | PROT_WRITE,
+                                    MAP_SHARED, fd, 0);
+  if (*shmem == MAP_FAILED) {
+    perror("mmap");
+    fprintf(stderr, "[COV] Failed to mmap shared memory region\n");
+    _exit(-1);
+  }
+
+  init_edges(edges_start, edges_stop);
+  (*shmem)->num_edges = static_cast<uint32_t>(edges_stop - edges_start);
+
+  fprintf(stderr,
+          "[COV] edge counters initialized. Shared memory: %s with %u edges\n",
+          shm_key, (*shmem)->num_edges);
+}
+
+NO_SANITIZE void activate_coverage_browser() {
+  map_shmem("COV_BROWSER_SHM_ID", &cov_browser);
+  browser_coverage_activated = true;
+}
+
+NO_SANITIZE void activate_coverage_all() {
+  map_shmem("COV_ALL_SHM_ID", &cov_all);
+  coverage_activated = true;
+}
+
+NO_SANITIZE void init_edges(uint32_t* start, uint32_t* stop) {
+  if (edges_initialized){
+    return;
+  }
+  edges_initialized = true;
+  if (!start || !stop) {
+    return;
+  }
+
+#pragma clang diagnostic push
+#pragma clang diagnostic ignored "-Wunsafe-buffer-usage"
+  uint32_t N = 0;
+  for (uint32_t* x = start; x < stop && N < MAX_EDGES; x++) {
+    *x = ++N;
+  }
+#pragma clang diagnostic pop
+}
\ No newline at end of file
diff --git a/coverage/sanitizer_coverage.h b/coverage/sanitizer_coverage.h
new file mode 100644
index 0000000000000..7881d9b191060
--- /dev/null
+++ b/coverage/sanitizer_coverage.h
@@ -0,0 +1,33 @@
+// sanitizer coverage creates a 
+
+#ifndef COVERAGE_SANITIZER_COVERAGE_H_
+#define COVERAGE_SANITIZER_COVERAGE_H_
+
+#include <stdint.h>
+#include "mozilla/MacroArgs.h"
+#include "mozilla/Types.h"
+
+extern "C" {
+
+  void __sanitizer_cov_trace_pc_guard_init(uint32_t *start, uint32_t *stop);
+  void __sanitizer_cov_trace_pc_guard(uint32_t *guard);
+
+}
+
+struct shmem_data {
+  uint32_t num_edges;
+  unsigned char edges[];
+};
+
+static bool edges_initialized = false;
+static bool coverage_activated = false;
+static bool browser_coverage_activated = false;
+static uint32_t *edges_start = nullptr;
+static uint32_t *edges_stop = nullptr;
+
+void map_shmem(const char* id, shmem_data** shmem);
+void activate_coverage_all();
+void activate_coverage_browser();
+void init_edges(uint32_t *start, uint32_t *stop);
+
+#endif  // COVERAGE_SANITIZER_COVERAGE_H_
\ No newline at end of file
diff --git a/devtools/client/aboutdebugging/moz.build b/devtools/client/aboutdebugging/moz.build
index ba79f9c55d413..f64cea7e9ec48 100644
--- a/devtools/client/aboutdebugging/moz.build
+++ b/devtools/client/aboutdebugging/moz.build
@@ -18,3 +18,6 @@ BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "about:debugging")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/actions/moz.build b/devtools/client/aboutdebugging/src/actions/moz.build
index a750640d064d0..2d5a3d60a67ee 100644
--- a/devtools/client/aboutdebugging/src/actions/moz.build
+++ b/devtools/client/aboutdebugging/src/actions/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "telemetry.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/components/connect/moz.build b/devtools/client/aboutdebugging/src/components/connect/moz.build
index 9228e80125ce4..154b49bc7e81f 100644
--- a/devtools/client/aboutdebugging/src/components/connect/moz.build
+++ b/devtools/client/aboutdebugging/src/components/connect/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "NetworkLocationsForm.js",
     "NetworkLocationsList.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/components/debugtarget/moz.build b/devtools/client/aboutdebugging/src/components/debugtarget/moz.build
index 981e6887a2183..1a1e22b6087c6 100644
--- a/devtools/client/aboutdebugging/src/components/debugtarget/moz.build
+++ b/devtools/client/aboutdebugging/src/components/debugtarget/moz.build
@@ -20,3 +20,6 @@ DevToolsModules(
     "TemporaryExtensionInstallSection.js",
     "WorkerDetail.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/components/moz.build b/devtools/client/aboutdebugging/src/components/moz.build
index c48d384b3dc67..1a292ee4ac885 100644
--- a/devtools/client/aboutdebugging/src/components/moz.build
+++ b/devtools/client/aboutdebugging/src/components/moz.build
@@ -19,3 +19,6 @@ DevToolsModules(
     "RuntimePage.js",
     "ServiceWorkersWarning.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/components/shared/moz.build b/devtools/client/aboutdebugging/src/components/shared/moz.build
index 7e0e89f2a0073..561b887c6e511 100644
--- a/devtools/client/aboutdebugging/src/components/shared/moz.build
+++ b/devtools/client/aboutdebugging/src/components/shared/moz.build
@@ -7,3 +7,6 @@ DevToolsModules(
     "IconLabel.js",
     "Message.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/components/sidebar/moz.build b/devtools/client/aboutdebugging/src/components/sidebar/moz.build
index 081ea2a8482be..5ec7fd8674884 100644
--- a/devtools/client/aboutdebugging/src/components/sidebar/moz.build
+++ b/devtools/client/aboutdebugging/src/components/sidebar/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "SidebarItem.js",
     "SidebarRuntimeItem.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/middleware/moz.build b/devtools/client/aboutdebugging/src/middleware/moz.build
index f50150f56982b..c0e5fc4f31c59 100644
--- a/devtools/client/aboutdebugging/src/middleware/moz.build
+++ b/devtools/client/aboutdebugging/src/middleware/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "tab-component-data.js",
     "worker-component-data.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/modules/moz.build b/devtools/client/aboutdebugging/src/modules/moz.build
index 909e1817143c6..9bf5fde191e32 100644
--- a/devtools/client/aboutdebugging/src/modules/moz.build
+++ b/devtools/client/aboutdebugging/src/modules/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "runtimes-state-helper.js",
     "usb-runtimes.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/moz.build b/devtools/client/aboutdebugging/src/moz.build
index 58e6f92857d95..cddaff48ea0b1 100644
--- a/devtools/client/aboutdebugging/src/moz.build
+++ b/devtools/client/aboutdebugging/src/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
     "constants.js",
     "create-store.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/reducers/moz.build b/devtools/client/aboutdebugging/src/reducers/moz.build
index 24d3382f5b036..d3f08d56b9cf3 100644
--- a/devtools/client/aboutdebugging/src/reducers/moz.build
+++ b/devtools/client/aboutdebugging/src/reducers/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "runtimes-state.js",
     "ui-state.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/aboutdebugging/src/types/moz.build b/devtools/client/aboutdebugging/src/types/moz.build
index a58a6e0e28ad8..c2a8376a9aa33 100644
--- a/devtools/client/aboutdebugging/src/types/moz.build
+++ b/devtools/client/aboutdebugging/src/types/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "runtime.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/accessibility/actions/moz.build b/devtools/client/accessibility/actions/moz.build
index c4571d79985f1..8c4828b06046f 100644
--- a/devtools/client/accessibility/actions/moz.build
+++ b/devtools/client/accessibility/actions/moz.build
@@ -3,3 +3,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DevToolsModules("accessibles.js", "audit.js", "details.js", "simulation.js", "ui.js")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/accessibility/components/moz.build b/devtools/client/accessibility/components/moz.build
index 23e01d42c6b53..2e7d170bd9d36 100644
--- a/devtools/client/accessibility/components/moz.build
+++ b/devtools/client/accessibility/components/moz.build
@@ -31,3 +31,6 @@ DevToolsModules(
     "TextLabelCheck.js",
     "Toolbar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/accessibility/moz.build b/devtools/client/accessibility/moz.build
index 26e265b58cb67..d2d6ce6ee2a2b 100644
--- a/devtools/client/accessibility/moz.build
+++ b/devtools/client/accessibility/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Accessibility Tools")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/accessibility/reducers/moz.build b/devtools/client/accessibility/reducers/moz.build
index 0c7398f3976a2..b582a39a45ac5 100644
--- a/devtools/client/accessibility/reducers/moz.build
+++ b/devtools/client/accessibility/reducers/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "accessibles.js", "audit.js", "details.js", "index.js", "simulation.js", "ui.js"
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/accessibility/utils/moz.build b/devtools/client/accessibility/utils/moz.build
index 8129eea8e567b..9efce19d23471 100644
--- a/devtools/client/accessibility/utils/moz.build
+++ b/devtools/client/accessibility/utils/moz.build
@@ -3,3 +3,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DevToolsModules("audit.js", "l10n.js")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/moz.build b/devtools/client/application/moz.build
index f66b62ae3959c..c11814e39d8cd 100644
--- a/devtools/client/application/moz.build
+++ b/devtools/client/application/moz.build
@@ -11,3 +11,6 @@ DevToolsModules("initializer.js", "panel.js")
 BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
 
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/actions/moz.build b/devtools/client/application/src/actions/moz.build
index f2a41f86740a0..ac555dcdd339c 100644
--- a/devtools/client/application/src/actions/moz.build
+++ b/devtools/client/application/src/actions/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "ui.js",
     "workers.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/components/manifest/moz.build b/devtools/client/application/src/components/manifest/moz.build
index bb799cbfc4de2..7b7486fd0eb1c 100644
--- a/devtools/client/application/src/components/manifest/moz.build
+++ b/devtools/client/application/src/components/manifest/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
     "ManifestSection.js",
     "ManifestUrlItem.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/components/moz.build b/devtools/client/application/src/components/moz.build
index 361ec01204ae1..b326604831185 100644
--- a/devtools/client/application/src/components/moz.build
+++ b/devtools/client/application/src/components/moz.build
@@ -12,3 +12,6 @@ DIRS += [
 DevToolsModules(
     "App.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/components/routing/moz.build b/devtools/client/application/src/components/routing/moz.build
index 7e22985614414..9ba3fd7b0a0e1 100644
--- a/devtools/client/application/src/components/routing/moz.build
+++ b/devtools/client/application/src/components/routing/moz.build
@@ -3,3 +3,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DevToolsModules("PageSwitcher.js", "Sidebar.js", "SidebarItem.js")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/components/service-workers/moz.build b/devtools/client/application/src/components/service-workers/moz.build
index f9704b9df8641..017c97a028529 100644
--- a/devtools/client/application/src/components/service-workers/moz.build
+++ b/devtools/client/application/src/components/service-workers/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "Worker.js",
     "WorkersPage.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/components/ui/moz.build b/devtools/client/application/src/components/ui/moz.build
index f62f66d310428..a0dff5ec0fc6d 100644
--- a/devtools/client/application/src/components/ui/moz.build
+++ b/devtools/client/application/src/components/ui/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "UIButton.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/middleware/moz.build b/devtools/client/application/src/middleware/moz.build
index 5041f3ca13da7..e1ee4f372d185 100644
--- a/devtools/client/application/src/middleware/moz.build
+++ b/devtools/client/application/src/middleware/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "event-telemetry.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/modules/moz.build b/devtools/client/application/src/modules/moz.build
index 778345fb1f96d..84bb28e34b933 100644
--- a/devtools/client/application/src/modules/moz.build
+++ b/devtools/client/application/src/modules/moz.build
@@ -6,3 +6,6 @@ DevToolsModules(
     "application-services.js",
     "l10n.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/moz.build b/devtools/client/application/src/moz.build
index 58e6f92857d95..cddaff48ea0b1 100644
--- a/devtools/client/application/src/moz.build
+++ b/devtools/client/application/src/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
     "constants.js",
     "create-store.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/reducers/moz.build b/devtools/client/application/src/reducers/moz.build
index 752b27a685e8f..b21e083e95900 100644
--- a/devtools/client/application/src/reducers/moz.build
+++ b/devtools/client/application/src/reducers/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "ui-state.js",
     "workers-state.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/application/src/types/moz.build b/devtools/client/application/src/types/moz.build
index c8161f448d92d..932c692a42cb4 100644
--- a/devtools/client/application/src/types/moz.build
+++ b/devtools/client/application/src/types/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "routing.js",
     "service-workers.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/dist/moz.build b/devtools/client/debugger/dist/moz.build
index 0d979d0d78437..d9dcfbe21719a 100644
--- a/devtools/client/debugger/dist/moz.build
+++ b/devtools/client/debugger/dist/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "pretty-print-worker.js",
     "search-worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/moz.build b/devtools/client/debugger/moz.build
index 1804a1d6bc93a..d1480086861ae 100644
--- a/devtools/client/debugger/moz.build
+++ b/devtools/client/debugger/moz.build
@@ -23,3 +23,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Debugger")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/actions/ast/moz.build b/devtools/client/debugger/src/actions/ast/moz.build
index 5b0152d2add84..41095567ceb8e 100644
--- a/devtools/client/debugger/src/actions/ast/moz.build
+++ b/devtools/client/debugger/src/actions/ast/moz.build
@@ -9,3 +9,6 @@ CompiledModules(
     "index.js",
     "setInScopeLines.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/actions/breakpoints/moz.build b/devtools/client/debugger/src/actions/breakpoints/moz.build
index 65910c4ef2c70..ddcb95da37c40 100644
--- a/devtools/client/debugger/src/actions/breakpoints/moz.build
+++ b/devtools/client/debugger/src/actions/breakpoints/moz.build
@@ -11,3 +11,6 @@ CompiledModules(
     "modify.js",
     "syncBreakpoint.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/actions/context-menus/moz.build b/devtools/client/debugger/src/actions/context-menus/moz.build
index 776cb436f9c61..63a3cb2644b0b 100644
--- a/devtools/client/debugger/src/actions/context-menus/moz.build
+++ b/devtools/client/debugger/src/actions/context-menus/moz.build
@@ -14,3 +14,6 @@ CompiledModules(
     "source-tree-item.js",
     "tab.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/actions/moz.build b/devtools/client/debugger/src/actions/moz.build
index 72b1fac04ce0b..f1d23d294f8c1 100644
--- a/devtools/client/debugger/src/actions/moz.build
+++ b/devtools/client/debugger/src/actions/moz.build
@@ -30,3 +30,6 @@ CompiledModules(
     "threads.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/actions/pause/moz.build b/devtools/client/debugger/src/actions/pause/moz.build
index e8f65996ed73a..7c5dc9966d642 100644
--- a/devtools/client/debugger/src/actions/pause/moz.build
+++ b/devtools/client/debugger/src/actions/pause/moz.build
@@ -24,3 +24,6 @@ CompiledModules(
     "selectFrame.js",
     "skipPausing.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/actions/sources/moz.build b/devtools/client/debugger/src/actions/sources/moz.build
index 9972e9f09b973..0b07270cd8632 100644
--- a/devtools/client/debugger/src/actions/sources/moz.build
+++ b/devtools/client/debugger/src/actions/sources/moz.build
@@ -15,3 +15,6 @@ CompiledModules(
     "select.js",
     "symbols.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/actions/utils/middleware/moz.build b/devtools/client/debugger/src/actions/utils/middleware/moz.build
index f46a0bb72538e..9746bface15a3 100644
--- a/devtools/client/debugger/src/actions/utils/middleware/moz.build
+++ b/devtools/client/debugger/src/actions/utils/middleware/moz.build
@@ -13,3 +13,6 @@ CompiledModules(
     "timing.js",
     "wait-service.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/actions/utils/moz.build b/devtools/client/debugger/src/actions/utils/moz.build
index 08a43a218ce57..1952166f9e3c3 100644
--- a/devtools/client/debugger/src/actions/utils/moz.build
+++ b/devtools/client/debugger/src/actions/utils/moz.build
@@ -10,3 +10,6 @@ DIRS += [
 CompiledModules(
     "create-store.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/client/firefox/moz.build b/devtools/client/debugger/src/client/firefox/moz.build
index 9406133e173ef..41b7385b0a2cf 100644
--- a/devtools/client/debugger/src/client/firefox/moz.build
+++ b/devtools/client/debugger/src/client/firefox/moz.build
@@ -9,3 +9,6 @@ CompiledModules(
     "commands.js",
     "create.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/client/moz.build b/devtools/client/debugger/src/client/moz.build
index cbaaa3a2a028e..dee0f10e57b48 100644
--- a/devtools/client/debugger/src/client/moz.build
+++ b/devtools/client/debugger/src/client/moz.build
@@ -10,3 +10,6 @@ DIRS += [
 CompiledModules(
     "firefox.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/Editor/Preview/moz.build b/devtools/client/debugger/src/components/Editor/Preview/moz.build
index 362faadc42ce1..429978b9a311d 100644
--- a/devtools/client/debugger/src/components/Editor/Preview/moz.build
+++ b/devtools/client/debugger/src/components/Editor/Preview/moz.build
@@ -10,3 +10,6 @@ CompiledModules(
     "index.js",
     "Popup.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/Editor/moz.build b/devtools/client/debugger/src/components/Editor/moz.build
index 909e57d4eb267..c4035de19d073 100644
--- a/devtools/client/debugger/src/components/Editor/moz.build
+++ b/devtools/client/debugger/src/components/Editor/moz.build
@@ -29,3 +29,6 @@ CompiledModules(
     "Tab.js",
     "Tabs.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/PrimaryPanes/moz.build b/devtools/client/debugger/src/components/PrimaryPanes/moz.build
index fc73b7bee79d3..3e2752b24fa5b 100644
--- a/devtools/client/debugger/src/components/PrimaryPanes/moz.build
+++ b/devtools/client/debugger/src/components/PrimaryPanes/moz.build
@@ -13,3 +13,6 @@ CompiledModules(
     "SourcesTree.js",
     "SourcesTreeItem.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/SecondaryPanes/Breakpoints/moz.build b/devtools/client/debugger/src/components/SecondaryPanes/Breakpoints/moz.build
index 85716d122cf55..ac7c426a1a5f3 100644
--- a/devtools/client/debugger/src/components/SecondaryPanes/Breakpoints/moz.build
+++ b/devtools/client/debugger/src/components/SecondaryPanes/Breakpoints/moz.build
@@ -11,3 +11,6 @@ CompiledModules(
     "ExceptionOption.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/SecondaryPanes/Frames/moz.build b/devtools/client/debugger/src/components/SecondaryPanes/Frames/moz.build
index 54c188ed9836d..dba9d5c14100c 100644
--- a/devtools/client/debugger/src/components/SecondaryPanes/Frames/moz.build
+++ b/devtools/client/debugger/src/components/SecondaryPanes/Frames/moz.build
@@ -11,3 +11,6 @@ CompiledModules(
     "Group.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/SecondaryPanes/moz.build b/devtools/client/debugger/src/components/SecondaryPanes/moz.build
index 33cfa2e316b35..e4ef930c57572 100644
--- a/devtools/client/debugger/src/components/SecondaryPanes/moz.build
+++ b/devtools/client/debugger/src/components/SecondaryPanes/moz.build
@@ -20,3 +20,6 @@ CompiledModules(
     "WhyPaused.js",
     "XHRBreakpoints.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/moz.build b/devtools/client/debugger/src/components/moz.build
index 6cd81e653bfae..f9f51e9d522c8 100644
--- a/devtools/client/debugger/src/components/moz.build
+++ b/devtools/client/debugger/src/components/moz.build
@@ -16,3 +16,6 @@ CompiledModules(
     "ShortcutsModal.js",
     "WelcomeBox.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/shared/Button/moz.build b/devtools/client/debugger/src/components/shared/Button/moz.build
index c6e652d5dc357..be4bae0dce1da 100644
--- a/devtools/client/debugger/src/components/shared/Button/moz.build
+++ b/devtools/client/debugger/src/components/shared/Button/moz.build
@@ -13,3 +13,6 @@ CompiledModules(
     "index.js",
     "PaneToggleButton.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/shared/Button/styles/moz.build b/devtools/client/debugger/src/components/shared/Button/styles/moz.build
index 7d80140dbedf7..0e4ad8f0eaa86 100644
--- a/devtools/client/debugger/src/components/shared/Button/styles/moz.build
+++ b/devtools/client/debugger/src/components/shared/Button/styles/moz.build
@@ -6,3 +6,6 @@
 DIRS += []
 
 CompiledModules()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/components/shared/moz.build b/devtools/client/debugger/src/components/shared/moz.build
index b30ea0ab4f2ad..33935b0fbf756 100644
--- a/devtools/client/debugger/src/components/shared/moz.build
+++ b/devtools/client/debugger/src/components/shared/moz.build
@@ -21,3 +21,6 @@ CompiledModules(
     "SourceIcon.js",
     "SmartGap.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/context-menu/moz.build b/devtools/client/debugger/src/context-menu/moz.build
index 48089353f1f91..6a091b15a8f50 100644
--- a/devtools/client/debugger/src/context-menu/moz.build
+++ b/devtools/client/debugger/src/context-menu/moz.build
@@ -6,3 +6,6 @@
 CompiledModules(
     "menu.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/moz.build b/devtools/client/debugger/src/moz.build
index 44336626f2c89..18427dc62d224 100644
--- a/devtools/client/debugger/src/moz.build
+++ b/devtools/client/debugger/src/moz.build
@@ -18,3 +18,6 @@ CompiledModules(
     "constants.js",
     "main.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/reducers/moz.build b/devtools/client/debugger/src/reducers/moz.build
index 4e2d2a10450fc..36bace948323d 100644
--- a/devtools/client/debugger/src/reducers/moz.build
+++ b/devtools/client/debugger/src/reducers/moz.build
@@ -24,3 +24,6 @@ CompiledModules(
     "threads.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/selectors/moz.build b/devtools/client/debugger/src/selectors/moz.build
index ac728b1de4b67..da61aff34fb3f 100644
--- a/devtools/client/debugger/src/selectors/moz.build
+++ b/devtools/client/debugger/src/selectors/moz.build
@@ -30,3 +30,6 @@ CompiledModules(
     "visibleColumnBreakpoints.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/utils/breakpoint/moz.build b/devtools/client/debugger/src/utils/breakpoint/moz.build
index 02c5302a6c60d..88c0f56ab2c1c 100644
--- a/devtools/client/debugger/src/utils/breakpoint/moz.build
+++ b/devtools/client/debugger/src/utils/breakpoint/moz.build
@@ -9,3 +9,6 @@ CompiledModules(
     "breakpointPositions.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/utils/editor/moz.build b/devtools/client/debugger/src/utils/editor/moz.build
index 568546897d1f2..2053e75eb50e4 100644
--- a/devtools/client/debugger/src/utils/editor/moz.build
+++ b/devtools/client/debugger/src/utils/editor/moz.build
@@ -13,3 +13,6 @@ CompiledModules(
     "source-search.js",
     "tokens.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/utils/moz.build b/devtools/client/debugger/src/utils/moz.build
index 8deb8e18db261..779e1d8e292ed 100644
--- a/devtools/client/debugger/src/utils/moz.build
+++ b/devtools/client/debugger/src/utils/moz.build
@@ -51,3 +51,6 @@ CompiledModules(
     "wasm.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/utils/pause/frames/moz.build b/devtools/client/debugger/src/utils/pause/frames/moz.build
index 67462d40c3fc3..47aa99b203fcc 100644
--- a/devtools/client/debugger/src/utils/pause/frames/moz.build
+++ b/devtools/client/debugger/src/utils/pause/frames/moz.build
@@ -12,3 +12,6 @@ CompiledModules(
     "getLibraryFromUrl.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/utils/pause/mapScopes/moz.build b/devtools/client/debugger/src/utils/pause/mapScopes/moz.build
index 05f2b7e3d8963..64d9794ee69c2 100644
--- a/devtools/client/debugger/src/utils/pause/mapScopes/moz.build
+++ b/devtools/client/debugger/src/utils/pause/mapScopes/moz.build
@@ -17,3 +17,6 @@ CompiledModules(
     "positionCmp.js",
     "rangeMetadata.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/utils/pause/moz.build b/devtools/client/debugger/src/utils/pause/moz.build
index db8b7332746f5..65932f3dbe4c1 100644
--- a/devtools/client/debugger/src/utils/pause/moz.build
+++ b/devtools/client/debugger/src/utils/pause/moz.build
@@ -13,3 +13,6 @@ CompiledModules(
     "scopes.js",
     "why.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/utils/sources-tree/moz.build b/devtools/client/debugger/src/utils/sources-tree/moz.build
index 400c0f0d1a520..7bd9f498bc424 100644
--- a/devtools/client/debugger/src/utils/sources-tree/moz.build
+++ b/devtools/client/debugger/src/utils/sources-tree/moz.build
@@ -7,3 +7,6 @@ CompiledModules(
     "getURL.js",
     "utils.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/workers/moz.build b/devtools/client/debugger/src/workers/moz.build
index 12327bf177204..e80c29d837bf0 100644
--- a/devtools/client/debugger/src/workers/moz.build
+++ b/devtools/client/debugger/src/workers/moz.build
@@ -10,3 +10,6 @@ DIRS += [
 ]
 
 CompiledModules()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/workers/parser/moz.build b/devtools/client/debugger/src/workers/parser/moz.build
index b7223ac81ae4f..719bd43df80e9 100644
--- a/devtools/client/debugger/src/workers/parser/moz.build
+++ b/devtools/client/debugger/src/workers/parser/moz.build
@@ -8,3 +8,6 @@ DIRS += []
 CompiledModules(
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/workers/pretty-print/moz.build b/devtools/client/debugger/src/workers/pretty-print/moz.build
index b7223ac81ae4f..719bd43df80e9 100644
--- a/devtools/client/debugger/src/workers/pretty-print/moz.build
+++ b/devtools/client/debugger/src/workers/pretty-print/moz.build
@@ -8,3 +8,6 @@ DIRS += []
 CompiledModules(
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/debugger/src/workers/search/moz.build b/devtools/client/debugger/src/workers/search/moz.build
index b7223ac81ae4f..719bd43df80e9 100644
--- a/devtools/client/debugger/src/workers/search/moz.build
+++ b/devtools/client/debugger/src/workers/search/moz.build
@@ -8,3 +8,6 @@ DIRS += []
 CompiledModules(
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/dom/content/actions/moz.build b/devtools/client/dom/content/actions/moz.build
index 8c1c56d39af82..95d5af5aa1b7f 100644
--- a/devtools/client/dom/content/actions/moz.build
+++ b/devtools/client/dom/content/actions/moz.build
@@ -7,3 +7,6 @@ DevToolsModules(
     "filter.js",
     "grips.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/dom/content/components/moz.build b/devtools/client/dom/content/components/moz.build
index 5b669bac24923..1f57522dffefd 100644
--- a/devtools/client/dom/content/components/moz.build
+++ b/devtools/client/dom/content/components/moz.build
@@ -4,3 +4,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DevToolsModules("DomTree.js", "MainFrame.js", "MainToolbar.js")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/dom/content/moz.build b/devtools/client/dom/content/moz.build
index 04e0ac4efca42..22ca29ebd633c 100644
--- a/devtools/client/dom/content/moz.build
+++ b/devtools/client/dom/content/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
     "grip-provider.js",
     "utils.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/dom/content/reducers/moz.build b/devtools/client/dom/content/reducers/moz.build
index 8d98444e345d2..601140a17ed2a 100644
--- a/devtools/client/dom/content/reducers/moz.build
+++ b/devtools/client/dom/content/reducers/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "grips.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/dom/moz.build b/devtools/client/dom/moz.build
index 4f78b9afdd582..8df68ea363681 100644
--- a/devtools/client/dom/moz.build
+++ b/devtools/client/dom/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "DOM")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/framework/actions/moz.build b/devtools/client/framework/actions/moz.build
index e77a7cc2cc08e..3e4fedadd0058 100644
--- a/devtools/client/framework/actions/moz.build
+++ b/devtools/client/framework/actions/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Framework")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/framework/browser-toolbox/moz.build b/devtools/client/framework/browser-toolbox/moz.build
index f04fedb0a435c..8a1be3aa44824 100644
--- a/devtools/client/framework/browser-toolbox/moz.build
+++ b/devtools/client/framework/browser-toolbox/moz.build
@@ -11,3 +11,6 @@ BROWSER_CHROME_MANIFESTS += [
 DevToolsModules(
     "Launcher.sys.mjs",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/framework/components/moz.build b/devtools/client/framework/components/moz.build
index cb29f41ddb6ea..5ba654c9f2228 100644
--- a/devtools/client/framework/components/moz.build
+++ b/devtools/client/framework/components/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
     "ToolboxTabs.js",
     "ToolboxToolbar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/framework/moz.build b/devtools/client/framework/moz.build
index d1fe829b2812a..025ca74fda639 100644
--- a/devtools/client/framework/moz.build
+++ b/devtools/client/framework/moz.build
@@ -48,3 +48,6 @@ with Files("**"):
     BUG_COMPONENT = ("DevTools", "Framework")
 
 SPHINX_TREES["/devtools/tests/memory"] = "test/allocations/docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/framework/reducers/moz.build b/devtools/client/framework/reducers/moz.build
index e77a7cc2cc08e..3e4fedadd0058 100644
--- a/devtools/client/framework/reducers/moz.build
+++ b/devtools/client/framework/reducers/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Framework")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/framework/test/allocations/moz.build b/devtools/client/framework/test/allocations/moz.build
index 5488c8e2fc7a1..f28c613f9b436 100644
--- a/devtools/client/framework/test/allocations/moz.build
+++ b/devtools/client/framework/test/allocations/moz.build
@@ -14,3 +14,6 @@ BROWSER_CHROME_MANIFESTS += [
     "browser_allocations_target.toml",
     "browser_allocations_toolbox.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/fronts/addon/moz.build b/devtools/client/fronts/addon/moz.build
index e382173641537..82df2a3948cce 100644
--- a/devtools/client/fronts/addon/moz.build
+++ b/devtools/client/fronts/addon/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "addons.js",
     "webextension-inspected-window.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/fronts/descriptors/moz.build b/devtools/client/fronts/descriptors/moz.build
index 665a0f252a038..62a96b34a9888 100644
--- a/devtools/client/fronts/descriptors/moz.build
+++ b/devtools/client/fronts/descriptors/moz.build
@@ -12,3 +12,6 @@ DevToolsModules(
     "webextension.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/fronts/inspector/moz.build b/devtools/client/fronts/inspector/moz.build
index de635f5947f2d..481359ef2be01 100644
--- a/devtools/client/fronts/inspector/moz.build
+++ b/devtools/client/fronts/inspector/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "rule-rewriter.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/fronts/moz.build b/devtools/client/fronts/moz.build
index 8b568701048dc..e18d8c56de810 100644
--- a/devtools/client/fronts/moz.build
+++ b/devtools/client/fronts/moz.build
@@ -56,3 +56,6 @@ DevToolsModules(
     "watcher.js",
     "webconsole.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/fronts/targets/moz.build b/devtools/client/fronts/targets/moz.build
index 82b82f24a7eb8..5183e436f15d6 100644
--- a/devtools/client/fronts/targets/moz.build
+++ b/devtools/client/fronts/targets/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "window-global.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/fronts/worker/moz.build b/devtools/client/fronts/worker/moz.build
index dae0e2d60693a..0616efa7845bb 100644
--- a/devtools/client/fronts/worker/moz.build
+++ b/devtools/client/fronts/worker/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "service-worker-registration.js",
     "service-worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/animation/actions/moz.build b/devtools/client/inspector/animation/actions/moz.build
index f43007dd6ea1d..a4d9b23315452 100644
--- a/devtools/client/inspector/animation/actions/moz.build
+++ b/devtools/client/inspector/animation/actions/moz.build
@@ -6,3 +6,6 @@ DevToolsModules(
     "animations.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/animation/components/graph/moz.build b/devtools/client/inspector/animation/components/graph/moz.build
index 866bdd30ce750..87afb1184883f 100644
--- a/devtools/client/inspector/animation/components/graph/moz.build
+++ b/devtools/client/inspector/animation/components/graph/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
     "SummaryGraphPath.js",
     "TimingPath.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/animation/components/keyframes-graph/moz.build b/devtools/client/inspector/animation/components/keyframes-graph/moz.build
index 1ff518e21d296..a44ec79499d55 100644
--- a/devtools/client/inspector/animation/components/keyframes-graph/moz.build
+++ b/devtools/client/inspector/animation/components/keyframes-graph/moz.build
@@ -12,3 +12,6 @@ DevToolsModules(
     "KeyframesGraph.js",
     "KeyframesGraphPath.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/animation/components/moz.build b/devtools/client/inspector/animation/components/moz.build
index cd8ecc05c4e04..a188e91c18356 100644
--- a/devtools/client/inspector/animation/components/moz.build
+++ b/devtools/client/inspector/animation/components/moz.build
@@ -28,3 +28,6 @@ DevToolsModules(
     "TickLabels.js",
     "TickLines.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/animation/moz.build b/devtools/client/inspector/animation/moz.build
index 7620ce28754c5..8dda0e9528177 100644
--- a/devtools/client/inspector/animation/moz.build
+++ b/devtools/client/inspector/animation/moz.build
@@ -10,3 +10,6 @@ DevToolsModules("animation.js", "current-time-timer.js")
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Inspector: Animations")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/animation/reducers/moz.build b/devtools/client/inspector/animation/reducers/moz.build
index 8b20a9f6cd91e..b93893669331f 100644
--- a/devtools/client/inspector/animation/reducers/moz.build
+++ b/devtools/client/inspector/animation/reducers/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "animations.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/animation/utils/moz.build b/devtools/client/inspector/animation/utils/moz.build
index ae73627a29951..368cdcdaa0267 100644
--- a/devtools/client/inspector/animation/utils/moz.build
+++ b/devtools/client/inspector/animation/utils/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "timescale.js",
     "utils.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/boxmodel/actions/moz.build b/devtools/client/inspector/boxmodel/actions/moz.build
index 7ee681b35c25b..e8dbcd8c87391 100644
--- a/devtools/client/inspector/boxmodel/actions/moz.build
+++ b/devtools/client/inspector/boxmodel/actions/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "box-model.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/boxmodel/components/moz.build b/devtools/client/inspector/boxmodel/components/moz.build
index ed57c93eb7e75..6764d6dbc3fa1 100644
--- a/devtools/client/inspector/boxmodel/components/moz.build
+++ b/devtools/client/inspector/boxmodel/components/moz.build
@@ -12,3 +12,6 @@ DevToolsModules(
     "BoxModelProperties.js",
     "ComputedProperty.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/boxmodel/moz.build b/devtools/client/inspector/boxmodel/moz.build
index df8e53009e112..9ea93bf3e8af8 100644
--- a/devtools/client/inspector/boxmodel/moz.build
+++ b/devtools/client/inspector/boxmodel/moz.build
@@ -17,3 +17,6 @@ DevToolsModules(
 )
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/boxmodel/reducers/moz.build b/devtools/client/inspector/boxmodel/reducers/moz.build
index fe216631de59d..b0a97ce8eaec2 100644
--- a/devtools/client/inspector/boxmodel/reducers/moz.build
+++ b/devtools/client/inspector/boxmodel/reducers/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "box-model.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/boxmodel/utils/moz.build b/devtools/client/inspector/boxmodel/utils/moz.build
index 76a5656294878..d27886a089c6c 100644
--- a/devtools/client/inspector/boxmodel/utils/moz.build
+++ b/devtools/client/inspector/boxmodel/utils/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "editing-session.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/changes/actions/moz.build b/devtools/client/inspector/changes/actions/moz.build
index 06c5314a9ecbb..120c1bcc6dedb 100644
--- a/devtools/client/inspector/changes/actions/moz.build
+++ b/devtools/client/inspector/changes/actions/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "changes.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/changes/components/moz.build b/devtools/client/inspector/changes/components/moz.build
index e8fba36fb8c6a..ed4f86035b59f 100644
--- a/devtools/client/inspector/changes/components/moz.build
+++ b/devtools/client/inspector/changes/components/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "ChangesApp.js",
     "CSSDeclaration.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/changes/moz.build b/devtools/client/inspector/changes/moz.build
index 7d504f13f52d8..03675f2ebafb0 100644
--- a/devtools/client/inspector/changes/moz.build
+++ b/devtools/client/inspector/changes/moz.build
@@ -22,3 +22,6 @@ XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Inspector: Changes")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/changes/reducers/moz.build b/devtools/client/inspector/changes/reducers/moz.build
index f3ea9a1bfc32b..e33b02111ee14 100644
--- a/devtools/client/inspector/changes/reducers/moz.build
+++ b/devtools/client/inspector/changes/reducers/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "changes.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/changes/selectors/moz.build b/devtools/client/inspector/changes/selectors/moz.build
index f3ea9a1bfc32b..e33b02111ee14 100644
--- a/devtools/client/inspector/changes/selectors/moz.build
+++ b/devtools/client/inspector/changes/selectors/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "changes.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/changes/utils/moz.build b/devtools/client/inspector/changes/utils/moz.build
index 155752e0d842c..3d02a978fa8aa 100644
--- a/devtools/client/inspector/changes/utils/moz.build
+++ b/devtools/client/inspector/changes/utils/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "changes-utils.js",
     "l10n.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/compatibility/actions/moz.build b/devtools/client/inspector/compatibility/actions/moz.build
index 1b2b96950fead..d5ace01ffe49a 100644
--- a/devtools/client/inspector/compatibility/actions/moz.build
+++ b/devtools/client/inspector/compatibility/actions/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "compatibility.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/compatibility/components/moz.build b/devtools/client/inspector/compatibility/components/moz.build
index b4a1c7cf7c88d..64d9cdf449a23 100644
--- a/devtools/client/inspector/compatibility/components/moz.build
+++ b/devtools/client/inspector/compatibility/components/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
     "UnsupportedBrowserItem.js",
     "UnsupportedBrowserList.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/compatibility/moz.build b/devtools/client/inspector/compatibility/moz.build
index 92b29743cc03c..5f71ddccced5f 100644
--- a/devtools/client/inspector/compatibility/moz.build
+++ b/devtools/client/inspector/compatibility/moz.build
@@ -21,3 +21,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Inspector: Compatibility")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/compatibility/reducers/moz.build b/devtools/client/inspector/compatibility/reducers/moz.build
index b9399195676a6..56758362fd867 100644
--- a/devtools/client/inspector/compatibility/reducers/moz.build
+++ b/devtools/client/inspector/compatibility/reducers/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "compatibility.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/compatibility/utils/moz.build b/devtools/client/inspector/compatibility/utils/moz.build
index 5de4c7b3ed62d..ea7b707e51eba 100644
--- a/devtools/client/inspector/compatibility/utils/moz.build
+++ b/devtools/client/inspector/compatibility/utils/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "cases.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/components/moz.build b/devtools/client/inspector/components/moz.build
index cf6226361ab6c..2b8a9736bea60 100644
--- a/devtools/client/inspector/components/moz.build
+++ b/devtools/client/inspector/components/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "InspectorTabPanel.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/computed/moz.build b/devtools/client/inspector/computed/moz.build
index 4f84b2ebf0ac7..2f7b22ad8441d 100644
--- a/devtools/client/inspector/computed/moz.build
+++ b/devtools/client/inspector/computed/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
 )
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/extensions/actions/moz.build b/devtools/client/inspector/extensions/actions/moz.build
index d101bc2fea496..7e6bb7b87f77c 100644
--- a/devtools/client/inspector/extensions/actions/moz.build
+++ b/devtools/client/inspector/extensions/actions/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "index.js",
     "sidebar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/extensions/components/moz.build b/devtools/client/inspector/extensions/components/moz.build
index 62f3d991c100a..868a9b998ac32 100644
--- a/devtools/client/inspector/extensions/components/moz.build
+++ b/devtools/client/inspector/extensions/components/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "ExtensionSidebar.js",
     "ObjectTreeView.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/extensions/moz.build b/devtools/client/inspector/extensions/moz.build
index 39647c8e5a3dd..36737cec6ff60 100644
--- a/devtools/client/inspector/extensions/moz.build
+++ b/devtools/client/inspector/extensions/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
 )
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/extensions/reducers/moz.build b/devtools/client/inspector/extensions/reducers/moz.build
index 0f8a5757c8bc2..dc17c04142e40 100644
--- a/devtools/client/inspector/extensions/reducers/moz.build
+++ b/devtools/client/inspector/extensions/reducers/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "sidebar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/flexbox/actions/moz.build b/devtools/client/inspector/flexbox/actions/moz.build
index 3e5ab1eda8056..650dc1420d689 100644
--- a/devtools/client/inspector/flexbox/actions/moz.build
+++ b/devtools/client/inspector/flexbox/actions/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "flexbox.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/flexbox/components/moz.build b/devtools/client/inspector/flexbox/components/moz.build
index 3e077a217fc00..2b25108acfb03 100644
--- a/devtools/client/inspector/flexbox/components/moz.build
+++ b/devtools/client/inspector/flexbox/components/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "FlexItemSizingProperties.js",
     "Header.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/flexbox/moz.build b/devtools/client/inspector/flexbox/moz.build
index b38f12db55735..3be2ed07ea750 100644
--- a/devtools/client/inspector/flexbox/moz.build
+++ b/devtools/client/inspector/flexbox/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
 )
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/flexbox/reducers/moz.build b/devtools/client/inspector/flexbox/reducers/moz.build
index 4327940888a35..721fece1786b0 100644
--- a/devtools/client/inspector/flexbox/reducers/moz.build
+++ b/devtools/client/inspector/flexbox/reducers/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "flexbox.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/fonts/actions/moz.build b/devtools/client/inspector/fonts/actions/moz.build
index 31452af5807d9..c0a65ccd77c9d 100644
--- a/devtools/client/inspector/fonts/actions/moz.build
+++ b/devtools/client/inspector/fonts/actions/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "fonts.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/fonts/components/moz.build b/devtools/client/inspector/fonts/components/moz.build
index 8838777f6503e..dce4e2726fc20 100644
--- a/devtools/client/inspector/fonts/components/moz.build
+++ b/devtools/client/inspector/fonts/components/moz.build
@@ -22,3 +22,6 @@ DevToolsModules(
     "LetterSpacing.js",
     "LineHeight.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/fonts/moz.build b/devtools/client/inspector/fonts/moz.build
index 89106c469ceb9..c32cd7f2cb044 100644
--- a/devtools/client/inspector/fonts/moz.build
+++ b/devtools/client/inspector/fonts/moz.build
@@ -17,3 +17,6 @@ DevToolsModules(
 )
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/fonts/reducers/moz.build b/devtools/client/inspector/fonts/reducers/moz.build
index 13d1c7cf34c89..54b7805a0f0b7 100644
--- a/devtools/client/inspector/fonts/reducers/moz.build
+++ b/devtools/client/inspector/fonts/reducers/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "font-options.js",
     "fonts.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/fonts/utils/moz.build b/devtools/client/inspector/fonts/utils/moz.build
index ddd06560a0741..e6ff04a71ff13 100644
--- a/devtools/client/inspector/fonts/utils/moz.build
+++ b/devtools/client/inspector/fonts/utils/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "font-utils.js",
     "l10n.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/grids/actions/moz.build b/devtools/client/inspector/grids/actions/moz.build
index 733ac57ede2f9..da6d7cdfc27c4 100644
--- a/devtools/client/inspector/grids/actions/moz.build
+++ b/devtools/client/inspector/grids/actions/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "highlighter-settings.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/grids/components/moz.build b/devtools/client/inspector/grids/components/moz.build
index e938e51ad1bdd..4caa8e33a33b4 100644
--- a/devtools/client/inspector/grids/components/moz.build
+++ b/devtools/client/inspector/grids/components/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "GridList.js",
     "GridOutline.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/grids/moz.build b/devtools/client/inspector/grids/moz.build
index 11296ddef2497..4979fdd0c9874 100644
--- a/devtools/client/inspector/grids/moz.build
+++ b/devtools/client/inspector/grids/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/grids/reducers/moz.build b/devtools/client/inspector/grids/reducers/moz.build
index 768e29b542e55..c88effc861434 100644
--- a/devtools/client/inspector/grids/reducers/moz.build
+++ b/devtools/client/inspector/grids/reducers/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "grids.js",
     "highlighter-settings.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/grids/utils/moz.build b/devtools/client/inspector/grids/utils/moz.build
index c74e63e61762a..35436c6efbe60 100644
--- a/devtools/client/inspector/grids/utils/moz.build
+++ b/devtools/client/inspector/grids/utils/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "utils.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/layout/components/moz.build b/devtools/client/inspector/layout/components/moz.build
index bb3e2624caf2b..53edba8f6da78 100644
--- a/devtools/client/inspector/layout/components/moz.build
+++ b/devtools/client/inspector/layout/components/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "LayoutApp.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/layout/moz.build b/devtools/client/inspector/layout/moz.build
index 42d0bf4c7bcaf..f2551d365937c 100644
--- a/devtools/client/inspector/layout/moz.build
+++ b/devtools/client/inspector/layout/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Inspector: Layout")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/layout/utils/moz.build b/devtools/client/inspector/layout/utils/moz.build
index ddee85b5f7c26..76404897ec931 100644
--- a/devtools/client/inspector/layout/utils/moz.build
+++ b/devtools/client/inspector/layout/utils/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "l10n.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/markup/components/moz.build b/devtools/client/inspector/markup/components/moz.build
index 13e4ee411dbe6..c8c20e886a48e 100644
--- a/devtools/client/inspector/markup/components/moz.build
+++ b/devtools/client/inspector/markup/components/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "TextNode.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/markup/moz.build b/devtools/client/inspector/markup/moz.build
index 2411139aabf3d..6cf3925374d4f 100644
--- a/devtools/client/inspector/markup/moz.build
+++ b/devtools/client/inspector/markup/moz.build
@@ -17,3 +17,6 @@ DevToolsModules(
 )
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/markup/utils/moz.build b/devtools/client/inspector/markup/utils/moz.build
index ddee85b5f7c26..76404897ec931 100644
--- a/devtools/client/inspector/markup/utils/moz.build
+++ b/devtools/client/inspector/markup/utils/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "l10n.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/markup/views/moz.build b/devtools/client/inspector/markup/views/moz.build
index 9be0f159ee921..43c1533fa9ebd 100644
--- a/devtools/client/inspector/markup/views/moz.build
+++ b/devtools/client/inspector/markup/views/moz.build
@@ -17,3 +17,6 @@ DevToolsModules(
     "text-container.js",
     "text-editor.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/moz.build b/devtools/client/inspector/moz.build
index 75017b4d91e4a..565e6080dc797 100644
--- a/devtools/client/inspector/moz.build
+++ b/devtools/client/inspector/moz.build
@@ -33,3 +33,6 @@ BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Inspector")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/rules/models/moz.build b/devtools/client/inspector/rules/models/moz.build
index 7a5561e2139dc..707ce6cd5420d 100644
--- a/devtools/client/inspector/rules/models/moz.build
+++ b/devtools/client/inspector/rules/models/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "text-property.js",
     "user-properties.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/rules/moz.build b/devtools/client/inspector/rules/moz.build
index 260581d502d1d..aa2d866156baa 100644
--- a/devtools/client/inspector/rules/moz.build
+++ b/devtools/client/inspector/rules/moz.build
@@ -23,3 +23,6 @@ BROWSER_CHROME_MANIFESTS += [
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Inspector: Rules")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/rules/utils/moz.build b/devtools/client/inspector/rules/utils/moz.build
index cc3fa4dfbdb38..975973245785c 100644
--- a/devtools/client/inspector/rules/utils/moz.build
+++ b/devtools/client/inspector/rules/utils/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "l10n.js",
     "utils.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/rules/views/moz.build b/devtools/client/inspector/rules/views/moz.build
index d5058bdbc2cca..810f7eb8f2354 100644
--- a/devtools/client/inspector/rules/views/moz.build
+++ b/devtools/client/inspector/rules/views/moz.build
@@ -7,3 +7,6 @@ DevToolsModules(
     "rule-editor.js",
     "text-property-editor.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/inspector/shared/moz.build b/devtools/client/inspector/shared/moz.build
index 6d7ce0590bc49..58412157ec862 100644
--- a/devtools/client/inspector/shared/moz.build
+++ b/devtools/client/inspector/shared/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
 )
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/jsonview/components/moz.build b/devtools/client/jsonview/components/moz.build
index 8cb9dc8e87cc9..5328aeb18082b 100644
--- a/devtools/client/jsonview/components/moz.build
+++ b/devtools/client/jsonview/components/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
     "TextPanel.js",
     "TextToolbar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/jsonview/components/reps/moz.build b/devtools/client/jsonview/components/reps/moz.build
index ba39d7767be2a..9c5a68697500d 100644
--- a/devtools/client/jsonview/components/reps/moz.build
+++ b/devtools/client/jsonview/components/reps/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "Toolbar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/jsonview/css/moz.build b/devtools/client/jsonview/css/moz.build
index 53ebea91b0c63..e0ee31939c5c4 100644
--- a/devtools/client/jsonview/css/moz.build
+++ b/devtools/client/jsonview/css/moz.build
@@ -13,3 +13,6 @@ DevToolsModules(
     "text-panel.css",
     "toolbar.css",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/jsonview/lib/moz.build b/devtools/client/jsonview/lib/moz.build
index 461ef2e44506c..be678b7baba0a 100644
--- a/devtools/client/jsonview/lib/moz.build
+++ b/devtools/client/jsonview/lib/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DevToolsModules("require.js")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/jsonview/moz.build b/devtools/client/jsonview/moz.build
index 554f3b9339a24..5ea805d089516 100644
--- a/devtools/client/jsonview/moz.build
+++ b/devtools/client/jsonview/moz.build
@@ -22,3 +22,6 @@ BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "JSON Viewer")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/locales/moz.build b/devtools/client/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/devtools/client/locales/moz.build
+++ b/devtools/client/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/memory/actions/moz.build b/devtools/client/memory/actions/moz.build
index 939712ca32b6c..487463870782c 100644
--- a/devtools/client/memory/actions/moz.build
+++ b/devtools/client/memory/actions/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
     "tree-map-display.js",
     "view.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/memory/components/moz.build b/devtools/client/memory/components/moz.build
index 82739bf97f8d5..dd1782deb59e9 100644
--- a/devtools/client/memory/components/moz.build
+++ b/devtools/client/memory/components/moz.build
@@ -23,3 +23,6 @@ DevToolsModules(
     "Toolbar.js",
     "TreeMap.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/memory/components/tree-map/moz.build b/devtools/client/memory/components/tree-map/moz.build
index a9e590033924f..4cac7a9dd2642 100644
--- a/devtools/client/memory/components/tree-map/moz.build
+++ b/devtools/client/memory/components/tree-map/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "draw.js",
     "start.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/memory/moz.build b/devtools/client/memory/moz.build
index e7ce780699fd4..ac7be51f58e01 100644
--- a/devtools/client/memory/moz.build
+++ b/devtools/client/memory/moz.build
@@ -27,3 +27,6 @@ DevToolsModules(
 BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["test/chrome/chrome.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/memory/reducers/moz.build b/devtools/client/memory/reducers/moz.build
index 53677d1d8e031..4043bef6163fd 100644
--- a/devtools/client/memory/reducers/moz.build
+++ b/devtools/client/memory/reducers/moz.build
@@ -17,3 +17,6 @@ DevToolsModules(
     "tree-map-display.js",
     "view.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/moz.build b/devtools/client/moz.build
index 67c63b9295be2..60b2d91f73f69 100644
--- a/devtools/client/moz.build
+++ b/devtools/client/moz.build
@@ -45,3 +45,6 @@ if not CONFIG["MOZILLA_OFFICIAL"]:
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/moz.build b/devtools/client/netmonitor/moz.build
index 08d87272f3be1..3ac0863dd0c0b 100644
--- a/devtools/client/netmonitor/moz.build
+++ b/devtools/client/netmonitor/moz.build
@@ -17,3 +17,6 @@ with Files("**"):
     BUG_COMPONENT = ("DevTools", "Netmonitor")
 
 SPHINX_TREES["/devtools/netmonitor"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/actions/moz.build b/devtools/client/netmonitor/src/actions/moz.build
index fc74e8cc560a0..86495ecece039 100644
--- a/devtools/client/netmonitor/src/actions/moz.build
+++ b/devtools/client/netmonitor/src/actions/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
     "timing-markers.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/messages/moz.build b/devtools/client/netmonitor/src/components/messages/moz.build
index b5b8751d30abb..0c7c0661d8060 100644
--- a/devtools/client/netmonitor/src/components/messages/moz.build
+++ b/devtools/client/netmonitor/src/components/messages/moz.build
@@ -30,3 +30,6 @@ DevToolsModules(
     "StatusBar.js",
     "Toolbar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/messages/parsers/moz.build b/devtools/client/netmonitor/src/components/messages/parsers/moz.build
index 6b1947e4a1896..9879a70c35b3a 100644
--- a/devtools/client/netmonitor/src/components/messages/parsers/moz.build
+++ b/devtools/client/netmonitor/src/components/messages/parsers/moz.build
@@ -9,3 +9,6 @@ DIRS += [
     "signalr",
     "wamp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/messages/parsers/signalr/moz.build b/devtools/client/netmonitor/src/components/messages/parsers/signalr/moz.build
index 48329513f24f4..8c37dfffc0c74 100644
--- a/devtools/client/netmonitor/src/components/messages/parsers/signalr/moz.build
+++ b/devtools/client/netmonitor/src/components/messages/parsers/signalr/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "TextMessageFormat.js",
     "Utils.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/messages/parsers/socket-io/moz.build b/devtools/client/netmonitor/src/components/messages/parsers/socket-io/moz.build
index d38ca19dd6579..8789cbf581c84 100644
--- a/devtools/client/netmonitor/src/components/messages/parsers/socket-io/moz.build
+++ b/devtools/client/netmonitor/src/components/messages/parsers/socket-io/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "index.js",
     "is-buffer.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/messages/parsers/sockjs/moz.build b/devtools/client/netmonitor/src/components/messages/parsers/sockjs/moz.build
index e1ca52aa96dc6..3be0682905172 100644
--- a/devtools/client/netmonitor/src/components/messages/parsers/sockjs/moz.build
+++ b/devtools/client/netmonitor/src/components/messages/parsers/sockjs/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/messages/parsers/stomp/moz.build b/devtools/client/netmonitor/src/components/messages/parsers/stomp/moz.build
index 420c7479db671..d27c961edae31 100644
--- a/devtools/client/netmonitor/src/components/messages/parsers/stomp/moz.build
+++ b/devtools/client/netmonitor/src/components/messages/parsers/stomp/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "index.js",
     "parser.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/messages/parsers/wamp/moz.build b/devtools/client/netmonitor/src/components/messages/parsers/wamp/moz.build
index b6b7c910362f2..29462ce9979dc 100644
--- a/devtools/client/netmonitor/src/components/messages/parsers/wamp/moz.build
+++ b/devtools/client/netmonitor/src/components/messages/parsers/wamp/moz.build
@@ -6,3 +6,6 @@ DevToolsModules(
     "arrayParser.js",
     "serializers.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/moz.build b/devtools/client/netmonitor/src/components/moz.build
index 98d821338f21b..57aa8b652497b 100644
--- a/devtools/client/netmonitor/src/components/moz.build
+++ b/devtools/client/netmonitor/src/components/moz.build
@@ -26,3 +26,6 @@ DevToolsModules(
     "TabboxPanel.js",
     "Toolbar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/new-request/moz.build b/devtools/client/netmonitor/src/components/new-request/moz.build
index 7e47799a220d5..a152b69c92127 100644
--- a/devtools/client/netmonitor/src/components/new-request/moz.build
+++ b/devtools/client/netmonitor/src/components/new-request/moz.build
@@ -6,3 +6,6 @@ DevToolsModules(
     "HTTPCustomRequestPanel.js",
     "InputMap.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/previews/moz.build b/devtools/client/netmonitor/src/components/previews/moz.build
index 0252ec3246b39..bbd935395f1ff 100644
--- a/devtools/client/netmonitor/src/components/previews/moz.build
+++ b/devtools/client/netmonitor/src/components/previews/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "SourcePreview.js",
     "UrlPreview.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/request-blocking/moz.build b/devtools/client/netmonitor/src/components/request-blocking/moz.build
index 7ce0f7ecc6a4e..4294b30e34010 100644
--- a/devtools/client/netmonitor/src/components/request-blocking/moz.build
+++ b/devtools/client/netmonitor/src/components/request-blocking/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "RequestBlockingPanel.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/request-details/moz.build b/devtools/client/netmonitor/src/components/request-details/moz.build
index 09896f2de3fd5..27eada92eb544 100644
--- a/devtools/client/netmonitor/src/components/request-details/moz.build
+++ b/devtools/client/netmonitor/src/components/request-details/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "StackTracePanel.js",
     "TimingsPanel.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/request-list/moz.build b/devtools/client/netmonitor/src/components/request-list/moz.build
index 22f0602b0038d..d1f3a81036bbe 100644
--- a/devtools/client/netmonitor/src/components/request-list/moz.build
+++ b/devtools/client/netmonitor/src/components/request-list/moz.build
@@ -27,3 +27,6 @@ DevToolsModules(
     "RequestListHeader.js",
     "RequestListItem.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/components/search/moz.build b/devtools/client/netmonitor/src/components/search/moz.build
index 7c48392d10e2c..81f91b22df246 100644
--- a/devtools/client/netmonitor/src/components/search/moz.build
+++ b/devtools/client/netmonitor/src/components/search/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "StatusBar.js",
     "Toolbar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/connector/moz.build b/devtools/client/netmonitor/src/connector/moz.build
index 4f65ddea0e62b..f87f02d4eefb8 100644
--- a/devtools/client/netmonitor/src/connector/moz.build
+++ b/devtools/client/netmonitor/src/connector/moz.build
@@ -7,3 +7,6 @@ DevToolsModules(
     "har-metadata-collector.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/har/moz.build b/devtools/client/netmonitor/src/har/moz.build
index 449c4562ac82b..7329b089fa4a0 100644
--- a/devtools/client/netmonitor/src/har/moz.build
+++ b/devtools/client/netmonitor/src/har/moz.build
@@ -17,3 +17,6 @@ BROWSER_CHROME_MANIFESTS += [
     "test/browser-harautomation.toml",
     "test/browser.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/middleware/moz.build b/devtools/client/netmonitor/src/middleware/moz.build
index 4e551c24c8c62..8ec025f88bc4e 100644
--- a/devtools/client/netmonitor/src/middleware/moz.build
+++ b/devtools/client/netmonitor/src/middleware/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "request-blocking.js",
     "throttling.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/moz.build b/devtools/client/netmonitor/src/moz.build
index b3ba8c5060338..d965f2a4e9849 100644
--- a/devtools/client/netmonitor/src/moz.build
+++ b/devtools/client/netmonitor/src/moz.build
@@ -21,3 +21,6 @@ DevToolsModules(
     "constants.js",
     "create-store.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/reducers/moz.build b/devtools/client/netmonitor/src/reducers/moz.build
index bd9d238761252..c44ef26d9a2e9 100644
--- a/devtools/client/netmonitor/src/reducers/moz.build
+++ b/devtools/client/netmonitor/src/reducers/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "timing-markers.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/selectors/moz.build b/devtools/client/netmonitor/src/selectors/moz.build
index dcc4eac91607e..f9328a44a255a 100644
--- a/devtools/client/netmonitor/src/selectors/moz.build
+++ b/devtools/client/netmonitor/src/selectors/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "timing-markers.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/utils/firefox/moz.build b/devtools/client/netmonitor/src/utils/firefox/moz.build
index bb0acafdf7748..18f72049f9072 100644
--- a/devtools/client/netmonitor/src/utils/firefox/moz.build
+++ b/devtools/client/netmonitor/src/utils/firefox/moz.build
@@ -6,3 +6,6 @@
 DevToolsModules(
     "open-request-in-tab.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/utils/moz.build b/devtools/client/netmonitor/src/utils/moz.build
index 2eb6aec69cb3b..7326f9fe30dd0 100644
--- a/devtools/client/netmonitor/src/utils/moz.build
+++ b/devtools/client/netmonitor/src/utils/moz.build
@@ -25,3 +25,6 @@ DevToolsModules(
     "sort-utils.js",
     "tooltips.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/widgets/moz.build b/devtools/client/netmonitor/src/widgets/moz.build
index 106deca935762..cf1f4729b1511 100644
--- a/devtools/client/netmonitor/src/widgets/moz.build
+++ b/devtools/client/netmonitor/src/widgets/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "RequestListHeaderContextMenu.js",
     "WaterfallBackground.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/workers/moz.build b/devtools/client/netmonitor/src/workers/moz.build
index a1384c1e1035f..aa20c82fbd834 100644
--- a/devtools/client/netmonitor/src/workers/moz.build
+++ b/devtools/client/netmonitor/src/workers/moz.build
@@ -6,3 +6,6 @@
 DIRS += [
     "search",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/netmonitor/src/workers/search/moz.build b/devtools/client/netmonitor/src/workers/search/moz.build
index ee5a5dd9507d1..548b36315cd54 100644
--- a/devtools/client/netmonitor/src/workers/search/moz.build
+++ b/devtools/client/netmonitor/src/workers/search/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "search.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/aboutprofiling/moz.build b/devtools/client/performance-new/aboutprofiling/moz.build
index 958a9222362ee..4edba0403496c 100644
--- a/devtools/client/performance-new/aboutprofiling/moz.build
+++ b/devtools/client/performance-new/aboutprofiling/moz.build
@@ -5,3 +5,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Performance Tools (Profiler/Timeline)")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/components/aboutprofiling/moz.build b/devtools/client/performance-new/components/aboutprofiling/moz.build
index 792041682e59a..a642d658c960a 100644
--- a/devtools/client/performance-new/components/aboutprofiling/moz.build
+++ b/devtools/client/performance-new/components/aboutprofiling/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "Range.js",
     "Settings.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/components/moz.build b/devtools/client/performance-new/components/moz.build
index 1f621838fde44..38302d996cbd2 100644
--- a/devtools/client/performance-new/components/moz.build
+++ b/devtools/client/performance-new/components/moz.build
@@ -8,3 +8,6 @@ DIRS += [
     "panel",
     "shared",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/components/panel/moz.build b/devtools/client/performance-new/components/panel/moz.build
index 4063f5d333a47..6cdfe630f4ac2 100644
--- a/devtools/client/performance-new/components/panel/moz.build
+++ b/devtools/client/performance-new/components/panel/moz.build
@@ -12,3 +12,6 @@ DevToolsModules(
     "RecordingButton.js",
     "ToolboxHighlightController.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/components/shared/moz.build b/devtools/client/performance-new/components/shared/moz.build
index 8c7fc05b793c9..b5deaaa3c209c 100644
--- a/devtools/client/performance-new/components/shared/moz.build
+++ b/devtools/client/performance-new/components/shared/moz.build
@@ -6,3 +6,6 @@
 DevToolsModules(
     "ProfilerPreferenceObserver.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/moz.build b/devtools/client/performance-new/moz.build
index 7945bd510fbee..216d3c53c5e55 100644
--- a/devtools/client/performance-new/moz.build
+++ b/devtools/client/performance-new/moz.build
@@ -17,3 +17,6 @@ XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Performance Tools (Profiler/Timeline)")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/panel/moz.build b/devtools/client/performance-new/panel/moz.build
index 298ed5a866f8a..889f5346906a0 100644
--- a/devtools/client/performance-new/panel/moz.build
+++ b/devtools/client/performance-new/panel/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Performance Tools (Profiler/Timeline)")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/popup/moz.build b/devtools/client/performance-new/popup/moz.build
index 4430bba9afb2c..bcde9bf5994cf 100644
--- a/devtools/client/performance-new/popup/moz.build
+++ b/devtools/client/performance-new/popup/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Performance Tools (Profiler/Timeline)")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/shared/moz.build b/devtools/client/performance-new/shared/moz.build
index 0409ad0d88b9d..2c8ce7ece270e 100644
--- a/devtools/client/performance-new/shared/moz.build
+++ b/devtools/client/performance-new/shared/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Performance Tools (Profiler/Timeline)")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/performance-new/store/moz.build b/devtools/client/performance-new/store/moz.build
index 16c3f8c65a216..7e7f3959b6599 100644
--- a/devtools/client/performance-new/store/moz.build
+++ b/devtools/client/performance-new/store/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "reducers.js",
     "selectors.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/preferences/moz.build b/devtools/client/preferences/moz.build
index fa8847b64dbe3..9d63ac9f94a53 100644
--- a/devtools/client/preferences/moz.build
+++ b/devtools/client/preferences/moz.build
@@ -7,3 +7,6 @@
 JS_PREFERENCE_FILES += [
     "debugger.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/responsive/actions/moz.build b/devtools/client/responsive/actions/moz.build
index d4fa0d243fbdc..86d9e8f4f9cc0 100644
--- a/devtools/client/responsive/actions/moz.build
+++ b/devtools/client/responsive/actions/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "ui.js",
     "viewports.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/responsive/components/moz.build b/devtools/client/responsive/components/moz.build
index 04ef642afc500..dfe56116c74e3 100644
--- a/devtools/client/responsive/components/moz.build
+++ b/devtools/client/responsive/components/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
     "UserAgentInput.js",
     "ViewportDimension.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/responsive/moz.build b/devtools/client/responsive/moz.build
index d10333a350a54..52f78fefe212c 100644
--- a/devtools/client/responsive/moz.build
+++ b/devtools/client/responsive/moz.build
@@ -28,3 +28,6 @@ with Files("**"):
     BUG_COMPONENT = ("DevTools", "Responsive Design Mode")
 
 SPHINX_TREES["/devtools/responsive"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/responsive/reducers/moz.build b/devtools/client/responsive/reducers/moz.build
index 9f2fb54e16132..a25fb5fe753a2 100644
--- a/devtools/client/responsive/reducers/moz.build
+++ b/devtools/client/responsive/reducers/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "ui.js",
     "viewports.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/responsive/utils/moz.build b/devtools/client/responsive/utils/moz.build
index 503da8932a45d..1b8201064122d 100644
--- a/devtools/client/responsive/utils/moz.build
+++ b/devtools/client/responsive/utils/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "ua.js",
     "window.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/menu/moz.build b/devtools/client/shared/components/menu/moz.build
index 08046199e5910..36951fc156e48 100644
--- a/devtools/client/shared/components/menu/moz.build
+++ b/devtools/client/shared/components/menu/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "MenuList.js",
     "utils.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/moz.build b/devtools/client/shared/components/moz.build
index 32f55ecaac73a..4b8a267f29fb7 100644
--- a/devtools/client/shared/components/moz.build
+++ b/devtools/client/shared/components/moz.build
@@ -39,3 +39,6 @@ BROWSER_CHROME_MANIFESTS += [
     "test/browser/browser.toml",
     "test/node/stubs/reps/stubs.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/object-inspector/components/moz.build b/devtools/client/shared/components/object-inspector/components/moz.build
index a1744891f24a7..931bc9c5f0cb6 100644
--- a/devtools/client/shared/components/object-inspector/components/moz.build
+++ b/devtools/client/shared/components/object-inspector/components/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "ObjectInspector.js",
     "ObjectInspectorItem.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/object-inspector/moz.build b/devtools/client/shared/components/object-inspector/moz.build
index 14f9c285ba597..91de0a63f710a 100644
--- a/devtools/client/shared/components/object-inspector/moz.build
+++ b/devtools/client/shared/components/object-inspector/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "index.js",
     "reducer.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/object-inspector/utils/moz.build b/devtools/client/shared/components/object-inspector/utils/moz.build
index 1301b2aca6ffa..7809a855edff0 100644
--- a/devtools/client/shared/components/object-inspector/utils/moz.build
+++ b/devtools/client/shared/components/object-inspector/utils/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "node.js",
     "selection.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/reps/moz.build b/devtools/client/shared/components/reps/moz.build
index 058e8046a7b43..3a3c3e2404806 100644
--- a/devtools/client/shared/components/reps/moz.build
+++ b/devtools/client/shared/components/reps/moz.build
@@ -12,3 +12,6 @@ DIRS += [
 DevToolsModules(
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/reps/reps/moz.build b/devtools/client/shared/components/reps/reps/moz.build
index 30b7e72a731cb..ebddc9b09859a 100644
--- a/devtools/client/shared/components/reps/reps/moz.build
+++ b/devtools/client/shared/components/reps/reps/moz.build
@@ -43,3 +43,6 @@ DevToolsModules(
     "undefined.js",
     "window.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/reps/shared/moz.build b/devtools/client/shared/components/reps/shared/moz.build
index 6704491b97617..b8a34c7010c64 100644
--- a/devtools/client/shared/components/reps/shared/moz.build
+++ b/devtools/client/shared/components/reps/shared/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "dom-node-constants.js",
     "grip-length-bubble.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/splitter/moz.build b/devtools/client/shared/components/splitter/moz.build
index 4abe762b34af4..7fa7f621fbc91 100644
--- a/devtools/client/shared/components/splitter/moz.build
+++ b/devtools/client/shared/components/splitter/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "GridElementWidthResizer.js",
     "SplitBox.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/tabs/moz.build b/devtools/client/shared/components/tabs/moz.build
index 15ede75b9db59..bc2771f4f46fe 100644
--- a/devtools/client/shared/components/tabs/moz.build
+++ b/devtools/client/shared/components/tabs/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "TabBar.js",
     "Tabs.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/throttling/moz.build b/devtools/client/shared/components/throttling/moz.build
index 2c178219fcfa3..41ed30ca042be 100644
--- a/devtools/client/shared/components/throttling/moz.build
+++ b/devtools/client/shared/components/throttling/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "reducer.js",
     "types.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/components/tree/moz.build b/devtools/client/shared/components/tree/moz.build
index 0700575f17c30..3db9254aa1a94 100644
--- a/devtools/client/shared/components/tree/moz.build
+++ b/devtools/client/shared/components/tree/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "TreeRow.js",
     "TreeView.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/fluent-l10n/moz.build b/devtools/client/shared/fluent-l10n/moz.build
index 654348ea26697..8eaf3f17b74f5 100644
--- a/devtools/client/shared/fluent-l10n/moz.build
+++ b/devtools/client/shared/fluent-l10n/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "fluent-l10n.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/moz.build b/devtools/client/shared/moz.build
index ca0e3ef124817..54192996cdc37 100644
--- a/devtools/client/shared/moz.build
+++ b/devtools/client/shared/moz.build
@@ -63,3 +63,6 @@ with Files("**"):
 
 with Files("components/**"):
     BUG_COMPONENT = ("DevTools", "Shared Components")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/redux/middleware/moz.build b/devtools/client/shared/redux/middleware/moz.build
index 82de1417e6cdd..51f45b7258259 100644
--- a/devtools/client/shared/redux/middleware/moz.build
+++ b/devtools/client/shared/redux/middleware/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
 )
 
 XPCSHELL_TESTS_MANIFESTS += ["xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/redux/moz.build b/devtools/client/shared/redux/moz.build
index d4c7bc503bf4b..d5be36d41f568 100644
--- a/devtools/client/shared/redux/moz.build
+++ b/devtools/client/shared/redux/moz.build
@@ -13,3 +13,6 @@ DevToolsModules(
     "subscriber.js",
     "visibility-handler-connect.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/remote-debugging/adb/commands/moz.build b/devtools/client/shared/remote-debugging/adb/commands/moz.build
index ecd3428a1bb74..c07b54c95cfd3 100644
--- a/devtools/client/shared/remote-debugging/adb/commands/moz.build
+++ b/devtools/client/shared/remote-debugging/adb/commands/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "shell.js",
     "track-devices.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/remote-debugging/adb/moz.build b/devtools/client/shared/remote-debugging/adb/moz.build
index ddc11068d347c..84f07f2b7dc97 100644
--- a/devtools/client/shared/remote-debugging/adb/moz.build
+++ b/devtools/client/shared/remote-debugging/adb/moz.build
@@ -22,3 +22,6 @@ with Files("**"):
     BUG_COMPONENT = ("DevTools", "about:debugging")
 
 XPCSHELL_TESTS_MANIFESTS += ["xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/remote-debugging/moz.build b/devtools/client/shared/remote-debugging/moz.build
index b38de3744dc87..e39b829008838 100644
--- a/devtools/client/shared/remote-debugging/moz.build
+++ b/devtools/client/shared/remote-debugging/moz.build
@@ -18,3 +18,6 @@ XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "about:debugging")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/source-map-loader/moz.build b/devtools/client/shared/source-map-loader/moz.build
index c9b399c4cbd97..dd276ee639486 100644
--- a/devtools/client/shared/source-map-loader/moz.build
+++ b/devtools/client/shared/source-map-loader/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
 )
 
 BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/source-map-loader/utils/moz.build b/devtools/client/shared/source-map-loader/utils/moz.build
index ffa77d72b7e7c..688fd6a8f848a 100644
--- a/devtools/client/shared/source-map-loader/utils/moz.build
+++ b/devtools/client/shared/source-map-loader/utils/moz.build
@@ -13,3 +13,6 @@ DevToolsModules(
     "sourceMapRequests.js",
     "wasmRemap.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/source-map-loader/wasm-dwarf/moz.build b/devtools/client/shared/source-map-loader/wasm-dwarf/moz.build
index 8bc40676faa0e..a2f2c3b142acb 100644
--- a/devtools/client/shared/source-map-loader/wasm-dwarf/moz.build
+++ b/devtools/client/shared/source-map-loader/wasm-dwarf/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "wasmDwarfExpressions.js",
     "wasmXScopes.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/sourceeditor/moz.build b/devtools/client/shared/sourceeditor/moz.build
index 7ad44c53a386b..71a8e2e7153f2 100644
--- a/devtools/client/shared/sourceeditor/moz.build
+++ b/devtools/client/shared/sourceeditor/moz.build
@@ -16,3 +16,6 @@ BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Source Editor")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/vendor/micromatch/moz.build b/devtools/client/shared/vendor/micromatch/moz.build
index b0b5500e6f3d9..f70f12b580fea 100644
--- a/devtools/client/shared/vendor/micromatch/moz.build
+++ b/devtools/client/shared/vendor/micromatch/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "micromatch.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/vendor/moz.build b/devtools/client/shared/vendor/moz.build
index 40ef0aa964608..39fa1b4198fed 100644
--- a/devtools/client/shared/vendor/moz.build
+++ b/devtools/client/shared/vendor/moz.build
@@ -42,3 +42,6 @@ else:
       'react-prop-types.js',
       'react.js'
     )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/vendor/source-map/lib/moz.build b/devtools/client/shared/vendor/source-map/lib/moz.build
index ccd2457b17f14..550306b067427 100644
--- a/devtools/client/shared/vendor/source-map/lib/moz.build
+++ b/devtools/client/shared/vendor/source-map/lib/moz.build
@@ -19,3 +19,6 @@ DevToolsModules(
     "util.js",
     "wasm.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/vendor/source-map/moz.build b/devtools/client/shared/vendor/source-map/moz.build
index 75f8cd7c1c988..b2ba91c35e837 100644
--- a/devtools/client/shared/vendor/source-map/moz.build
+++ b/devtools/client/shared/vendor/source-map/moz.build
@@ -11,3 +11,6 @@ DIRS += [
 DevToolsModules(
     "source-map.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/widgets/moz.build b/devtools/client/shared/widgets/moz.build
index 22fe366068234..ac1dffcdadbf1 100644
--- a/devtools/client/shared/widgets/moz.build
+++ b/devtools/client/shared/widgets/moz.build
@@ -20,3 +20,6 @@ DevToolsModules(
     "TreeWidget.js",
     "view-helpers.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/shared/widgets/tooltip/moz.build b/devtools/client/shared/widgets/tooltip/moz.build
index 57d873c8b52cd..148f21da59e1b 100644
--- a/devtools/client/shared/widgets/tooltip/moz.build
+++ b/devtools/client/shared/widgets/tooltip/moz.build
@@ -21,3 +21,6 @@ DevToolsModules(
     "TooltipToggle.js",
     "VariableTooltipHelper.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/storage/moz.build b/devtools/client/storage/moz.build
index e0e107ab414fb..220c2fa03d4d9 100644
--- a/devtools/client/storage/moz.build
+++ b/devtools/client/storage/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Storage Inspector")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/storage/utils/moz.build b/devtools/client/storage/utils/moz.build
index b9e1ad7354ba2..696c7772c25a7 100644
--- a/devtools/client/storage/utils/moz.build
+++ b/devtools/client/storage/utils/moz.build
@@ -6,3 +6,6 @@ DevToolsModules(
     "doc-utils.js",
     "l10n.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/styleeditor/moz.build b/devtools/client/styleeditor/moz.build
index 9e4428f91afee..4a86937ac90c0 100644
--- a/devtools/client/styleeditor/moz.build
+++ b/devtools/client/styleeditor/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Style Editor")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/themes/audio/moz.build b/devtools/client/themes/audio/moz.build
index b5c0e9b75448a..58bfdf20d1605 100644
--- a/devtools/client/themes/audio/moz.build
+++ b/devtools/client/themes/audio/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "shutter.wav",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/themes/moz.build b/devtools/client/themes/moz.build
index a8e889cb3d9b0..dffffea4ea9f0 100644
--- a/devtools/client/themes/moz.build
+++ b/devtools/client/themes/moz.build
@@ -7,3 +7,6 @@
 DIRS += [
     "audio",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/actions/moz.build b/devtools/client/webconsole/actions/moz.build
index 5b06311064430..ade25b9add82f 100644
--- a/devtools/client/webconsole/actions/moz.build
+++ b/devtools/client/webconsole/actions/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
     "toolbox.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/components/FilterBar/moz.build b/devtools/client/webconsole/components/FilterBar/moz.build
index 46ef681317b69..60704adb8dd96 100644
--- a/devtools/client/webconsole/components/FilterBar/moz.build
+++ b/devtools/client/webconsole/components/FilterBar/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "FilterButton.js",
     "FilterCheckbox.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/components/Input/moz.build b/devtools/client/webconsole/components/Input/moz.build
index 1feed60d13d55..8f573ede4a42e 100644
--- a/devtools/client/webconsole/components/Input/moz.build
+++ b/devtools/client/webconsole/components/Input/moz.build
@@ -12,3 +12,6 @@ DevToolsModules(
     "JSTerm.js",
     "ReverseSearchInput.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/components/Output/message-types/moz.build b/devtools/client/webconsole/components/Output/message-types/moz.build
index 926eb80abeef0..59db8f80c75da 100644
--- a/devtools/client/webconsole/components/Output/message-types/moz.build
+++ b/devtools/client/webconsole/components/Output/message-types/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
     "SimpleTable.js",
     "WarningGroup.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/components/Output/moz.build b/devtools/client/webconsole/components/Output/moz.build
index 9844c2fdeb040..9d47f1a91c2fc 100644
--- a/devtools/client/webconsole/components/Output/moz.build
+++ b/devtools/client/webconsole/components/Output/moz.build
@@ -19,3 +19,6 @@ DevToolsModules(
     "MessageIndent.js",
     "MessageRepeat.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/components/moz.build b/devtools/client/webconsole/components/moz.build
index 0b9eac77a53b9..32025b121421e 100644
--- a/devtools/client/webconsole/components/moz.build
+++ b/devtools/client/webconsole/components/moz.build
@@ -13,3 +13,6 @@ DevToolsModules(
     "App.js",
     "SideBar.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/enhancers/moz.build b/devtools/client/webconsole/enhancers/moz.build
index 79bb7dd1910e2..755dc27d048ae 100644
--- a/devtools/client/webconsole/enhancers/moz.build
+++ b/devtools/client/webconsole/enhancers/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "css-error-reporting.js",
     "message-cache-clearing.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/middleware/moz.build b/devtools/client/webconsole/middleware/moz.build
index ecb2088ca4717..cfea5b9a9a58b 100644
--- a/devtools/client/webconsole/middleware/moz.build
+++ b/devtools/client/webconsole/middleware/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "history-persistence.js",
     "performance-marker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/moz.build b/devtools/client/webconsole/moz.build
index a3ced413e3a9b..7c572ae23aecd 100644
--- a/devtools/client/webconsole/moz.build
+++ b/devtools/client/webconsole/moz.build
@@ -42,3 +42,6 @@ XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Console")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/reducers/moz.build b/devtools/client/webconsole/reducers/moz.build
index b6380ba3be6ab..7ea737ad34f54 100644
--- a/devtools/client/webconsole/reducers/moz.build
+++ b/devtools/client/webconsole/reducers/moz.build
@@ -13,3 +13,6 @@ DevToolsModules(
     "prefs.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/selectors/moz.build b/devtools/client/webconsole/selectors/moz.build
index 61f0f5243aec5..f24857c2f25b3 100644
--- a/devtools/client/webconsole/selectors/moz.build
+++ b/devtools/client/webconsole/selectors/moz.build
@@ -12,3 +12,6 @@ DevToolsModules(
     "prefs.js",
     "ui.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/client/webconsole/utils/moz.build b/devtools/client/webconsole/utils/moz.build
index 8367b8c195e73..105f42074c71a 100644
--- a/devtools/client/webconsole/utils/moz.build
+++ b/devtools/client/webconsole/utils/moz.build
@@ -12,3 +12,6 @@ DevToolsModules(
     "object-inspector.js",
     "prefs.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/moz.build b/devtools/moz.build
index 5dd3b50a3c1a4..c188fc31e2ce9 100644
--- a/devtools/moz.build
+++ b/devtools/moz.build
@@ -51,3 +51,6 @@ with Files("docs/tools/inspector-panel.md"):
 
 SPHINX_TREES["/devtools"] = "docs/contributor"
 SPHINX_TREES["/devtools-user"] = "docs/user"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/platform/moz.build b/devtools/platform/moz.build
index de8bf749c6283..458c6c20ae1a6 100644
--- a/devtools/platform/moz.build
+++ b/devtools/platform/moz.build
@@ -31,3 +31,6 @@ EXTRA_JS_MODULES += [
 DIST_SUBDIR = ""
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/accessibility/audit/moz.build b/devtools/server/actors/accessibility/audit/moz.build
index 01bd0af849881..bfc53622720d0 100644
--- a/devtools/server/actors/accessibility/audit/moz.build
+++ b/devtools/server/actors/accessibility/audit/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Accessibility Tools")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/accessibility/moz.build b/devtools/server/actors/accessibility/moz.build
index 4da1cd0b244d8..37ee779af85f9 100644
--- a/devtools/server/actors/accessibility/moz.build
+++ b/devtools/server/actors/accessibility/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Accessibility Tools")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/addon/moz.build b/devtools/server/actors/addon/moz.build
index e382173641537..82df2a3948cce 100644
--- a/devtools/server/actors/addon/moz.build
+++ b/devtools/server/actors/addon/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "addons.js",
     "webextension-inspected-window.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/compatibility/lib/moz.build b/devtools/server/actors/compatibility/lib/moz.build
index a2fe36da6d2cc..80221f29f4fe5 100644
--- a/devtools/server/actors/compatibility/lib/moz.build
+++ b/devtools/server/actors/compatibility/lib/moz.build
@@ -9,3 +9,6 @@ XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 DevToolsModules(
     "MDNCompatibility.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/compatibility/moz.build b/devtools/server/actors/compatibility/moz.build
index 010b027d37236..3c9484348eca8 100644
--- a/devtools/server/actors/compatibility/moz.build
+++ b/devtools/server/actors/compatibility/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Inspector: Compatibility")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/descriptors/moz.build b/devtools/server/actors/descriptors/moz.build
index bf297b3dcb1e4..4707be29a4eb0 100644
--- a/devtools/server/actors/descriptors/moz.build
+++ b/devtools/server/actors/descriptors/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "webextension.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/emulation/moz.build b/devtools/server/actors/emulation/moz.build
index cf229e6fe12bf..bf2467c70bdda 100644
--- a/devtools/server/actors/emulation/moz.build
+++ b/devtools/server/actors/emulation/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "responsive.js",
     "touch-simulator.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/highlighters/css/moz.build b/devtools/server/actors/highlighters/css/moz.build
index 6bdf0f9579fd0..5975c5a8fd656 100644
--- a/devtools/server/actors/highlighters/css/moz.build
+++ b/devtools/server/actors/highlighters/css/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "highlighters.css",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/highlighters/moz.build b/devtools/server/actors/highlighters/moz.build
index eeaca8999282d..f8c1e3dff7665 100644
--- a/devtools/server/actors/highlighters/moz.build
+++ b/devtools/server/actors/highlighters/moz.build
@@ -29,3 +29,6 @@ DevToolsModules(
     "tabbing-order.js",
     "viewport-size.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/highlighters/utils/moz.build b/devtools/server/actors/highlighters/utils/moz.build
index ab4f96912d8b4..103b7f2fbdc00 100644
--- a/devtools/server/actors/highlighters/utils/moz.build
+++ b/devtools/server/actors/highlighters/utils/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DevToolsModules("accessibility.js", "canvas.js", "markup.js")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/inspector/moz.build b/devtools/server/actors/inspector/moz.build
index 03c69dc9fec62..19bc536b20faf 100644
--- a/devtools/server/actors/inspector/moz.build
+++ b/devtools/server/actors/inspector/moz.build
@@ -19,3 +19,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Inspector")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/moz.build b/devtools/server/actors/moz.build
index 6da10fbc3d8ac..2d87db683ca08 100644
--- a/devtools/server/actors/moz.build
+++ b/devtools/server/actors/moz.build
@@ -87,3 +87,6 @@ with Files("stylesheets.js"):
 
 with Files("webconsole.js"):
     BUG_COMPONENT = ("DevTools", "Console")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/network-monitor/moz.build b/devtools/server/actors/network-monitor/moz.build
index 717ccc280704d..dd848f8191536 100644
--- a/devtools/server/actors/network-monitor/moz.build
+++ b/devtools/server/actors/network-monitor/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "network-event-actor.js",
     "network-parent.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/object/moz.build b/devtools/server/actors/object/moz.build
index 28fc2307dad45..e8aa5c385aaa2 100644
--- a/devtools/server/actors/object/moz.build
+++ b/devtools/server/actors/object/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "symbol.js",
     "utils.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/resources/moz.build b/devtools/server/actors/resources/moz.build
index c41d722cc3c42..3b8749da008ad 100644
--- a/devtools/server/actors/resources/moz.build
+++ b/devtools/server/actors/resources/moz.build
@@ -41,3 +41,6 @@ DevToolsModules(
 
 with Files("*-messages.js"):
     BUG_COMPONENT = ("DevTools", "Console")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/resources/storage/moz.build b/devtools/server/actors/resources/storage/moz.build
index 1615254759776..30a5638b8cfb4 100644
--- a/devtools/server/actors/resources/storage/moz.build
+++ b/devtools/server/actors/resources/storage/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Storage Inspector")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/resources/utils/moz.build b/devtools/server/actors/resources/utils/moz.build
index 0e6f9d1baa644..b76a08f855e0e 100644
--- a/devtools/server/actors/resources/utils/moz.build
+++ b/devtools/server/actors/resources/utils/moz.build
@@ -12,3 +12,6 @@ DevToolsModules(
 
 with Files("nsi-console-listener-watcher.js"):
     BUG_COMPONENT = ("DevTools", "Console")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/targets/moz.build b/devtools/server/actors/targets/moz.build
index f4d44ae669952..02dc45876db4a 100644
--- a/devtools/server/actors/targets/moz.build
+++ b/devtools/server/actors/targets/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
     "window-global.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/targets/session-data-processors/moz.build b/devtools/server/actors/targets/session-data-processors/moz.build
index ea924d7d793d3..2186f1846f022 100644
--- a/devtools/server/actors/targets/session-data-processors/moz.build
+++ b/devtools/server/actors/targets/session-data-processors/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "thread-configuration.js",
     "xhr-breakpoints.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/utils/moz.build b/devtools/server/actors/utils/moz.build
index 405b25cb4bdfc..9107101600906 100644
--- a/devtools/server/actors/utils/moz.build
+++ b/devtools/server/actors/utils/moz.build
@@ -30,3 +30,6 @@ DevToolsModules(
     "walker-search.js",
     "watchpoint-map.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/watcher/moz.build b/devtools/server/actors/watcher/moz.build
index 46a9d897187e3..af72eec73a625 100644
--- a/devtools/server/actors/watcher/moz.build
+++ b/devtools/server/actors/watcher/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "SessionDataHelpers.jsm",
     "WatcherRegistry.sys.mjs",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/watcher/target-helpers/moz.build b/devtools/server/actors/watcher/target-helpers/moz.build
index b7c89835901a3..68a5fd720fb23 100644
--- a/devtools/server/actors/watcher/target-helpers/moz.build
+++ b/devtools/server/actors/watcher/target-helpers/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "service-worker-jsprocessactor-startup.js",
     "worker-helper.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/webconsole/commands/moz.build b/devtools/server/actors/webconsole/commands/moz.build
index 9e0516b172530..93787486323a7 100644
--- a/devtools/server/actors/webconsole/commands/moz.build
+++ b/devtools/server/actors/webconsole/commands/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "manager.js",
     "parser.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/webconsole/listeners/moz.build b/devtools/server/actors/webconsole/listeners/moz.build
index 089de4a087d1b..c71c959499975 100644
--- a/devtools/server/actors/webconsole/listeners/moz.build
+++ b/devtools/server/actors/webconsole/listeners/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "console-service.js",
     "document-events.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/webconsole/moz.build b/devtools/server/actors/webconsole/moz.build
index 58d8a70211176..f7fedf91cf7e5 100644
--- a/devtools/server/actors/webconsole/moz.build
+++ b/devtools/server/actors/webconsole/moz.build
@@ -18,3 +18,6 @@ DevToolsModules(
     "webidl-unsafe-getters-names.js",
     "worker-listeners.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/actors/worker/moz.build b/devtools/server/actors/worker/moz.build
index 84e606db5871b..33f018deb7b4e 100644
--- a/devtools/server/actors/worker/moz.build
+++ b/devtools/server/actors/worker/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "service-worker.js",
     "worker-descriptor-actor-list.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/connectors/js-window-actor/moz.build b/devtools/server/connectors/js-window-actor/moz.build
index faaaa8dd545af..63158d55b963c 100644
--- a/devtools/server/connectors/js-window-actor/moz.build
+++ b/devtools/server/connectors/js-window-actor/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "DevToolsWorkerParent.sys.mjs",
     "WindowGlobalLogger.sys.mjs",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/connectors/moz.build b/devtools/server/connectors/moz.build
index a8b6fa1feab4d..6bab1f75ffdb9 100644
--- a/devtools/server/connectors/moz.build
+++ b/devtools/server/connectors/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "frame-connector.js",
     "worker-connector.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/connectors/process-actor/moz.build b/devtools/server/connectors/process-actor/moz.build
index 63f768bd3c1d8..ddca503fe2b9a 100644
--- a/devtools/server/connectors/process-actor/moz.build
+++ b/devtools/server/connectors/process-actor/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "DevToolsServiceWorkerChild.sys.mjs",
     "DevToolsServiceWorkerParent.sys.mjs",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/moz.build b/devtools/server/moz.build
index 9f33d9822bda0..6fde7d1c2b155 100644
--- a/devtools/server/moz.build
+++ b/devtools/server/moz.build
@@ -30,3 +30,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/performance/moz.build b/devtools/server/performance/moz.build
index 3524cb62053aa..817d35dc7adfd 100644
--- a/devtools/server/performance/moz.build
+++ b/devtools/server/performance/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Performance Tools (Profiler/Timeline)")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/socket/moz.build b/devtools/server/socket/moz.build
index 1e0b5cf942431..2d309cc7cd799 100644
--- a/devtools/server/socket/moz.build
+++ b/devtools/server/socket/moz.build
@@ -9,3 +9,6 @@ MOCHITEST_CHROME_MANIFESTS += ["tests/chrome/chrome.toml"]
 DevToolsModules(
     "websocket-server.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/socket/websocket-server.js b/devtools/server/socket/websocket-server.js
index 4236ec2921bd5..23d0cb1f06bb8 100644
--- a/devtools/server/socket/websocket-server.js
+++ b/devtools/server/socket/websocket-server.js
@@ -134,13 +134,12 @@ function writeHttpResponse(output, response) {
  * Process the WebSocket handshake headers and return the key to be sent in
  * Sec-WebSocket-Accept response header.
  */
-function processRequest({ requestLine, headers }) {
+function processRequest({ requestLine, headers }, expectedPath) {
   const [method, path] = requestLine.split(" ");
   if (method !== "GET") {
     throw new Error("The handshake request must use GET method");
   }
-
-  if (path !== "/") {
+  if (path !== expectedPath) {
     throw new Error("The handshake request has unknown path");
   }
 
@@ -190,13 +189,13 @@ function computeKey(key) {
 /**
  * Perform the server part of a WebSocket opening handshake on an incoming connection.
  */
-const serverHandshake = async function (input, output) {
+const serverHandshake = async function (input, output, expectedPath) {
   // Read the request
   const request = await readHttpRequest(input);
 
   try {
     // Check and extract info from the request
-    const { acceptKey } = processRequest(request);
+    const { acceptKey } = processRequest(request, expectedPath);
 
     // Send response headers
     await writeHttpResponse(output, [
@@ -218,8 +217,8 @@ const serverHandshake = async function (input, output) {
  * Performs the WebSocket handshake and waits for the WebSocket to open.
  * Returns Promise with a WebSocket ready to send and receive messages.
  */
-const accept = async function (transport, input, output) {
-  await serverHandshake(input, output);
+const accept = async function (transport, input, output, expectedPath) {
+  await serverHandshake(input, output, expectedPath || "/");
 
   const transportProvider = {
     setListener(upgradeListener) {
diff --git a/devtools/server/startup/moz.build b/devtools/server/startup/moz.build
index 4237d88599847..10df2d7195ee4 100644
--- a/devtools/server/startup/moz.build
+++ b/devtools/server/startup/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "frame.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/server/tracer/moz.build b/devtools/server/tracer/moz.build
index 26f7665018846..0ab16ef9c104e 100644
--- a/devtools/server/tracer/moz.build
+++ b/devtools/server/tracer/moz.build
@@ -12,3 +12,6 @@ if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/inspected-window/moz.build b/devtools/shared/commands/inspected-window/moz.build
index 69e72048f8c37..12672f243f635 100644
--- a/devtools/shared/commands/inspected-window/moz.build
+++ b/devtools/shared/commands/inspected-window/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
 
 if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
     BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/inspector/moz.build b/devtools/shared/commands/inspector/moz.build
index 1f92b4d9d04b1..0807eed8cfcce 100644
--- a/devtools/shared/commands/inspector/moz.build
+++ b/devtools/shared/commands/inspector/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
 
 if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
     BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/moz.build b/devtools/shared/commands/moz.build
index 563cef407a8bb..e81bb2dc639e0 100644
--- a/devtools/shared/commands/moz.build
+++ b/devtools/shared/commands/moz.build
@@ -19,3 +19,6 @@ DevToolsModules(
     "commands-factory.js",
     "index.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/network/moz.build b/devtools/shared/commands/network/moz.build
index 9d74abdfa2c7e..e597c5125442d 100644
--- a/devtools/shared/commands/network/moz.build
+++ b/devtools/shared/commands/network/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
 
 if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
     BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/resource/legacy-listeners/moz.build b/devtools/shared/commands/resource/legacy-listeners/moz.build
index 6ffb4698911e2..8aa65b9ab2f56 100644
--- a/devtools/shared/commands/resource/legacy-listeners/moz.build
+++ b/devtools/shared/commands/resource/legacy-listeners/moz.build
@@ -12,3 +12,6 @@ DevToolsModules(
     "source.js",
     "thread-states.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/resource/moz.build b/devtools/shared/commands/resource/moz.build
index 190589df4bba5..8b5747e072638 100644
--- a/devtools/shared/commands/resource/moz.build
+++ b/devtools/shared/commands/resource/moz.build
@@ -13,3 +13,6 @@ DevToolsModules(
 
 if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
     BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/resource/transformers/moz.build b/devtools/shared/commands/resource/transformers/moz.build
index 5b0b94853a03a..4936c65bed340 100644
--- a/devtools/shared/commands/resource/transformers/moz.build
+++ b/devtools/shared/commands/resource/transformers/moz.build
@@ -14,3 +14,6 @@ DevToolsModules(
     "storage-session-storage.js",
     "thread-states.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/root-resource/moz.build b/devtools/shared/commands/root-resource/moz.build
index 2bf7204d1f9d3..1e709e3d03bd0 100644
--- a/devtools/shared/commands/root-resource/moz.build
+++ b/devtools/shared/commands/root-resource/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "root-resource-command.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/script/moz.build b/devtools/shared/commands/script/moz.build
index 70570b2599b8f..bb83b310f84c1 100644
--- a/devtools/shared/commands/script/moz.build
+++ b/devtools/shared/commands/script/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
 
 if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
     BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/target-configuration/moz.build b/devtools/shared/commands/target-configuration/moz.build
index c0929aee7744e..b830937e9575b 100644
--- a/devtools/shared/commands/target-configuration/moz.build
+++ b/devtools/shared/commands/target-configuration/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
 
 if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
     BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/target/actions/moz.build b/devtools/shared/commands/target/actions/moz.build
index e9429c120001b..de028c698baf2 100644
--- a/devtools/shared/commands/target/actions/moz.build
+++ b/devtools/shared/commands/target/actions/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "targets.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/target/legacy-target-watchers/moz.build b/devtools/shared/commands/target/legacy-target-watchers/moz.build
index 60fdd7ec222df..c9104f94694ab 100644
--- a/devtools/shared/commands/target/legacy-target-watchers/moz.build
+++ b/devtools/shared/commands/target/legacy-target-watchers/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "legacy-sharedworkers-watcher.js",
     "legacy-workers-watcher.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/target/moz.build b/devtools/shared/commands/target/moz.build
index 811fc180f06af..74e11f08bb08b 100644
--- a/devtools/shared/commands/target/moz.build
+++ b/devtools/shared/commands/target/moz.build
@@ -15,3 +15,6 @@ DevToolsModules(
 
 if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
     BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/target/reducers/moz.build b/devtools/shared/commands/target/reducers/moz.build
index e9429c120001b..de028c698baf2 100644
--- a/devtools/shared/commands/target/reducers/moz.build
+++ b/devtools/shared/commands/target/reducers/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "targets.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/target/selectors/moz.build b/devtools/shared/commands/target/selectors/moz.build
index e9429c120001b..de028c698baf2 100644
--- a/devtools/shared/commands/target/selectors/moz.build
+++ b/devtools/shared/commands/target/selectors/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "targets.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/thread-configuration/moz.build b/devtools/shared/commands/thread-configuration/moz.build
index 28e8e0ffc40e8..dcb35a8295f08 100644
--- a/devtools/shared/commands/thread-configuration/moz.build
+++ b/devtools/shared/commands/thread-configuration/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "thread-configuration-command.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/commands/tracer/moz.build b/devtools/shared/commands/tracer/moz.build
index 63b3033655914..cb99592ab9840 100644
--- a/devtools/shared/commands/tracer/moz.build
+++ b/devtools/shared/commands/tracer/moz.build
@@ -5,3 +5,6 @@
 DevToolsModules(
     "tracer-command.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/compatibility/dataset/moz.build b/devtools/shared/compatibility/dataset/moz.build
index 6fb6046216da1..8ea84012f2ffe 100644
--- a/devtools/shared/compatibility/dataset/moz.build
+++ b/devtools/shared/compatibility/dataset/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "css-properties.json",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/compatibility/moz.build b/devtools/shared/compatibility/moz.build
index aa37d28738b26..a6731c7c42565 100644
--- a/devtools/shared/compatibility/moz.build
+++ b/devtools/shared/compatibility/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Inspector: Compatibility")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/css/moz.build b/devtools/shared/css/moz.build
index 97231df661013..563b926d9dd3c 100644
--- a/devtools/shared/css/moz.build
+++ b/devtools/shared/css/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "lexer.js",
     "parsing-utils.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/discovery/moz.build b/devtools/shared/discovery/moz.build
index 6e415ff558853..9dabacc9943d8 100644
--- a/devtools/shared/discovery/moz.build
+++ b/devtools/shared/discovery/moz.build
@@ -9,3 +9,6 @@ XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell/xpcshell.toml"]
 DevToolsModules(
     "discovery.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/heapsnapshot/moz.build b/devtools/shared/heapsnapshot/moz.build
index 41bc0fb4aa10c..f272f85b43033 100644
--- a/devtools/shared/heapsnapshot/moz.build
+++ b/devtools/shared/heapsnapshot/moz.build
@@ -57,3 +57,6 @@ DevToolsModules(
     "HeapSnapshotFileUtils.js",
     "shortest-paths.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/heapsnapshot/tests/gtest/moz.build b/devtools/shared/heapsnapshot/tests/gtest/moz.build
index 880d7b334e30c..bd0550218c7f1 100644
--- a/devtools/shared/heapsnapshot/tests/gtest/moz.build
+++ b/devtools/shared/heapsnapshot/tests/gtest/moz.build
@@ -30,3 +30,6 @@ if CONFIG["CC_TYPE"] == "clang":
     CXXFLAGS += ["-Wno-inconsistent-missing-override"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/images/moz.build b/devtools/shared/images/moz.build
index f5fe22d6e5e0b..b672289f24b2f 100644
--- a/devtools/shared/images/moz.build
+++ b/devtools/shared/images/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "resume.svg",
     "stepOver.svg",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/inspector/moz.build b/devtools/shared/inspector/moz.build
index 21a01fae9b5ff..ef316334fd8fb 100644
--- a/devtools/shared/inspector/moz.build
+++ b/devtools/shared/inspector/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DevToolsModules("css-logic.js", "utils.js")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/jsbeautify/moz.build b/devtools/shared/jsbeautify/moz.build
index aa759be322498..bd65a86ef3a37 100644
--- a/devtools/shared/jsbeautify/moz.build
+++ b/devtools/shared/jsbeautify/moz.build
@@ -11,3 +11,6 @@ DIRS += [
 DevToolsModules(
     'beautify.js',
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/jsbeautify/src/moz.build b/devtools/shared/jsbeautify/src/moz.build
index 96a0204808e35..25b42c1c75284 100644
--- a/devtools/shared/jsbeautify/src/moz.build
+++ b/devtools/shared/jsbeautify/src/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     'beautify-html.js',
     'beautify-js.js'
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/layout/moz.build b/devtools/shared/layout/moz.build
index da30931458949..e95a310b0854b 100644
--- a/devtools/shared/layout/moz.build
+++ b/devtools/shared/layout/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DevToolsModules("dom-matrix-2d.js", "utils.js")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/loader/moz.build b/devtools/shared/loader/moz.build
index cda2083625ef9..b1e86d7ba6872 100644
--- a/devtools/shared/loader/moz.build
+++ b/devtools/shared/loader/moz.build
@@ -19,3 +19,6 @@ DevToolsModules(
     "Loader.sys.mjs",
     "worker-loader.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/locales/moz.build b/devtools/shared/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/devtools/shared/locales/moz.build
+++ b/devtools/shared/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/moz.build b/devtools/shared/moz.build
index 302ab58fa4a4b..a7eb8f8edf4d5 100644
--- a/devtools/shared/moz.build
+++ b/devtools/shared/moz.build
@@ -77,3 +77,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/network-observer/moz.build b/devtools/shared/network-observer/moz.build
index 3c782ea9aab37..a3a9809c00ef1 100644
--- a/devtools/shared/network-observer/moz.build
+++ b/devtools/shared/network-observer/moz.build
@@ -19,3 +19,6 @@ DevToolsModules(
     "NetworkUtils.sys.mjs",
     "WildcardToRegexp.sys.mjs",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/node-properties/moz.build b/devtools/shared/node-properties/moz.build
index e58b1fdb69f9a..3b2fec04f0312 100644
--- a/devtools/shared/node-properties/moz.build
+++ b/devtools/shared/node-properties/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     'node-properties.js'
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/performance-new/moz.build b/devtools/shared/performance-new/moz.build
index 1d67ce1cc7c7c..f7169aa80e327 100644
--- a/devtools/shared/performance-new/moz.build
+++ b/devtools/shared/performance-new/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "Performance Tools (Profiler/Timeline)")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/platform/moz.build b/devtools/shared/platform/moz.build
index edbf580c1ca29..07bf090246d50 100644
--- a/devtools/shared/platform/moz.build
+++ b/devtools/shared/platform/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "clipboard.js",
     "stack.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/protocol/Actor/moz.build b/devtools/shared/protocol/Actor/moz.build
index 3e3c46d49bde6..b2eb1b50cf1fe 100644
--- a/devtools/shared/protocol/Actor/moz.build
+++ b/devtools/shared/protocol/Actor/moz.build
@@ -6,3 +6,6 @@
 DevToolsModules(
     "generateActorSpec.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/protocol/Front/moz.build b/devtools/shared/protocol/Front/moz.build
index 75b36c5eab3b5..7157cc733f9fd 100644
--- a/devtools/shared/protocol/Front/moz.build
+++ b/devtools/shared/protocol/Front/moz.build
@@ -6,3 +6,6 @@
 DevToolsModules(
     "FrontClassWithSpec.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/protocol/moz.build b/devtools/shared/protocol/moz.build
index a75a7ae3ae955..1dd3633c1e13e 100644
--- a/devtools/shared/protocol/moz.build
+++ b/devtools/shared/protocol/moz.build
@@ -20,3 +20,6 @@ DevToolsModules(
 )
 
 XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/qrcode/decoder/moz.build b/devtools/shared/qrcode/decoder/moz.build
index 4442a2e906836..aa29f998625ab 100644
--- a/devtools/shared/qrcode/decoder/moz.build
+++ b/devtools/shared/qrcode/decoder/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     'index.js',
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/qrcode/encoder/moz.build b/devtools/shared/qrcode/encoder/moz.build
index 4442a2e906836..aa29f998625ab 100644
--- a/devtools/shared/qrcode/encoder/moz.build
+++ b/devtools/shared/qrcode/encoder/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     'index.js',
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/qrcode/moz.build b/devtools/shared/qrcode/moz.build
index 1c171dd4dde0b..944cf838824cc 100644
--- a/devtools/shared/qrcode/moz.build
+++ b/devtools/shared/qrcode/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
 
 XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell/xpcshell.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["tests/chrome/chrome.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/security/moz.build b/devtools/shared/security/moz.build
index 65a667c8d4551..5225462ded04d 100644
--- a/devtools/shared/security/moz.build
+++ b/devtools/shared/security/moz.build
@@ -13,3 +13,6 @@ DevToolsModules(
     "prompt.js",
     "socket.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/specs/addon/moz.build b/devtools/shared/specs/addon/moz.build
index e382173641537..82df2a3948cce 100644
--- a/devtools/shared/specs/addon/moz.build
+++ b/devtools/shared/specs/addon/moz.build
@@ -8,3 +8,6 @@ DevToolsModules(
     "addons.js",
     "webextension-inspected-window.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/specs/descriptors/moz.build b/devtools/shared/specs/descriptors/moz.build
index bf297b3dcb1e4..4707be29a4eb0 100644
--- a/devtools/shared/specs/descriptors/moz.build
+++ b/devtools/shared/specs/descriptors/moz.build
@@ -10,3 +10,6 @@ DevToolsModules(
     "webextension.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/specs/moz.build b/devtools/shared/specs/moz.build
index dd917465ada20..868d1a99ea6f3 100644
--- a/devtools/shared/specs/moz.build
+++ b/devtools/shared/specs/moz.build
@@ -61,3 +61,6 @@ DevToolsModules(
     "watcher.js",
     "webconsole.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/specs/style/moz.build b/devtools/shared/specs/style/moz.build
index 56883cc51a37b..ea40de519129c 100644
--- a/devtools/shared/specs/style/moz.build
+++ b/devtools/shared/specs/style/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     "style-types.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/specs/targets/moz.build b/devtools/shared/specs/targets/moz.build
index 9c22a1a2412bd..94e1d1830377b 100644
--- a/devtools/shared/specs/targets/moz.build
+++ b/devtools/shared/specs/targets/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "window-global.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/specs/worker/moz.build b/devtools/shared/specs/worker/moz.build
index dae0e2d60693a..0616efa7845bb 100644
--- a/devtools/shared/specs/worker/moz.build
+++ b/devtools/shared/specs/worker/moz.build
@@ -9,3 +9,6 @@ DevToolsModules(
     "service-worker-registration.js",
     "service-worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/sprintfjs/moz.build b/devtools/shared/sprintfjs/moz.build
index 6f4f1f873473a..3457a92cbe197 100644
--- a/devtools/shared/sprintfjs/moz.build
+++ b/devtools/shared/sprintfjs/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     'sprintf.js'
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/storage/moz.build b/devtools/shared/storage/moz.build
index 95cf2857de336..fd8b66abcdf50 100644
--- a/devtools/shared/storage/moz.build
+++ b/devtools/shared/storage/moz.build
@@ -7,3 +7,6 @@
 DIRS += ["vendor"]
 
 DevToolsModules("utils.js")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/storage/vendor/moz.build b/devtools/shared/storage/vendor/moz.build
index 5e8a82199a3cc..2777b0bd7c9d8 100644
--- a/devtools/shared/storage/vendor/moz.build
+++ b/devtools/shared/storage/vendor/moz.build
@@ -10,4 +10,6 @@ DIRS += [
 
 DevToolsModules(
     'json5.js',
-)
\ No newline at end of file
+)
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/storage/vendor/stringvalidator/moz.build b/devtools/shared/storage/vendor/stringvalidator/moz.build
index 416242f722e78..feaaf082d777a 100644
--- a/devtools/shared/storage/vendor/stringvalidator/moz.build
+++ b/devtools/shared/storage/vendor/stringvalidator/moz.build
@@ -13,3 +13,6 @@ XPCSHELL_TESTS_MANIFESTS += ['tests/xpcshell/xpcshell.toml']
 DevToolsModules(
     'validator.js',
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/storage/vendor/stringvalidator/util/moz.build b/devtools/shared/storage/vendor/stringvalidator/util/moz.build
index cc8fbcfab14d3..cbacca2f087c1 100644
--- a/devtools/shared/storage/vendor/stringvalidator/util/moz.build
+++ b/devtools/shared/storage/vendor/stringvalidator/util/moz.build
@@ -7,3 +7,6 @@
 DevToolsModules(
     'assert.js',
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/test-helpers/moz.build b/devtools/shared/test-helpers/moz.build
index 92b1d5212d9f0..93eeee7af0ee2 100644
--- a/devtools/shared/test-helpers/moz.build
+++ b/devtools/shared/test-helpers/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
 
 with Files("**"):
     BUG_COMPONENT = ("DevTools", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/transport/moz.build b/devtools/shared/transport/moz.build
index 8b1527d5ca00c..b527affcfc58e 100644
--- a/devtools/shared/transport/moz.build
+++ b/devtools/shared/transport/moz.build
@@ -16,3 +16,6 @@ DevToolsModules(
     "websocket-transport.js",
     "worker-transport.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/webconsole/moz.build b/devtools/shared/webconsole/moz.build
index a15db593b5daa..2c1bbb2b2db64 100644
--- a/devtools/shared/webconsole/moz.build
+++ b/devtools/shared/webconsole/moz.build
@@ -31,3 +31,6 @@ DevToolsModules(
     "messages.js",
     "parser-helper.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/shared/worker/moz.build b/devtools/shared/worker/moz.build
index 79a71ca5ceefa..279d475a61303 100644
--- a/devtools/shared/worker/moz.build
+++ b/devtools/shared/worker/moz.build
@@ -11,3 +11,6 @@ DevToolsModules(
     "helper.js",
     "worker.js",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/startup/locales/moz.build b/devtools/startup/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/devtools/startup/locales/moz.build
+++ b/devtools/startup/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/devtools/startup/moz.build b/devtools/startup/moz.build
index 22ca205602c64..5cb50d15ca7f8 100644
--- a/devtools/startup/moz.build
+++ b/devtools/startup/moz.build
@@ -26,3 +26,6 @@ XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell/xpcshell.toml"]
 
 if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
     BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/docshell/base/BrowsingContext.cpp b/docshell/base/BrowsingContext.cpp
index 0ef5e02d2ae36..0787518696fc9 100644
--- a/docshell/base/BrowsingContext.cpp
+++ b/docshell/base/BrowsingContext.cpp
@@ -114,6 +114,20 @@ struct ParamTraits<mozilla::dom::PrefersColorSchemeOverride>
           mozilla::dom::PrefersColorSchemeOverride::None,
           mozilla::dom::PrefersColorSchemeOverride::EndGuard_> {};
 
+template <>
+struct ParamTraits<mozilla::dom::PrefersReducedMotionOverride>
+    : public ContiguousEnumSerializer<
+          mozilla::dom::PrefersReducedMotionOverride,
+          mozilla::dom::PrefersReducedMotionOverride::None,
+          mozilla::dom::PrefersReducedMotionOverride::EndGuard_> {};
+
+template <>
+struct ParamTraits<mozilla::dom::ForcedColorsOverride>
+    : public ContiguousEnumSerializer<
+          mozilla::dom::ForcedColorsOverride,
+          mozilla::dom::ForcedColorsOverride::None,
+          mozilla::dom::ForcedColorsOverride::EndGuard_> {};
+
 template <>
 struct ParamTraits<mozilla::dom::ExplicitActiveStatus>
     : public ContiguousEnumSerializer<
@@ -2793,6 +2807,40 @@ void BrowsingContext::DidSet(FieldIndex<IDX_PrefersColorSchemeOverride>,
   PresContextAffectingFieldChanged();
 }
 
+void BrowsingContext::DidSet(FieldIndex<IDX_PrefersReducedMotionOverride>,
+                             dom::PrefersReducedMotionOverride aOldValue) {
+  MOZ_ASSERT(IsTop());
+  if (PrefersReducedMotionOverride() == aOldValue) {
+    return;
+  }
+  PreOrderWalk([&](BrowsingContext* aContext) {
+    if (nsIDocShell* shell = aContext->GetDocShell()) {
+      if (nsPresContext* pc = shell->GetPresContext()) {
+        pc->MediaFeatureValuesChanged(
+            {MediaFeatureChangeReason::SystemMetricsChange},
+            MediaFeatureChangePropagation::JustThisDocument);
+      }
+    }
+  });
+}
+
+void BrowsingContext::DidSet(FieldIndex<IDX_ForcedColorsOverride>,
+                             dom::ForcedColorsOverride aOldValue) {
+  MOZ_ASSERT(IsTop());
+  if (ForcedColorsOverride() == aOldValue) {
+    return;
+  }
+  PreOrderWalk([&](BrowsingContext* aContext) {
+    if (nsIDocShell* shell = aContext->GetDocShell()) {
+      if (nsPresContext* pc = shell->GetPresContext()) {
+        pc->MediaFeatureValuesChanged(
+            {MediaFeatureChangeReason::SystemMetricsChange},
+            MediaFeatureChangePropagation::JustThisDocument);
+      }
+    }
+  });
+}
+
 void BrowsingContext::DidSet(FieldIndex<IDX_MediumOverride>,
                              nsString&& aOldValue) {
   MOZ_ASSERT(IsTop());
diff --git a/docshell/base/BrowsingContext.h b/docshell/base/BrowsingContext.h
index 7554128cf49ce..81ae7ec9523b9 100644
--- a/docshell/base/BrowsingContext.h
+++ b/docshell/base/BrowsingContext.h
@@ -200,10 +200,10 @@ struct EmbedderColorSchemes {
   FIELD(GVInaudibleAutoplayRequestStatus, GVAutoplayRequestStatus)            \
   /* ScreenOrientation-related APIs */                                        \
   FIELD(CurrentOrientationAngle, float)                                       \
-  FIELD(CurrentOrientationType, mozilla::dom::OrientationType)                \
+  FIELD(CurrentOrientationType, dom::OrientationType)                \
   FIELD(OrientationLock, mozilla::hal::ScreenOrientation)                     \
   FIELD(UserAgentOverride, nsString)                                          \
-  FIELD(TouchEventsOverrideInternal, mozilla::dom::TouchEventsOverride)       \
+  FIELD(TouchEventsOverrideInternal, dom::TouchEventsOverride)       \
   FIELD(EmbedderElementType, Maybe<nsString>)                                 \
   FIELD(MessageManagerGroup, nsString)                                        \
   FIELD(MaxTouchPointsOverride, uint8_t)                                      \
@@ -241,6 +241,10 @@ struct EmbedderColorSchemes {
    * <browser> embedder element. */                                           \
   FIELD(EmbedderColorSchemes, EmbedderColorSchemes)                           \
   FIELD(DisplayMode, dom::DisplayMode)                                        \
+  /* playwright addition */                                                   \
+  FIELD(PrefersReducedMotionOverride, dom::PrefersReducedMotionOverride)      \
+  /* playwright addition */                                                   \
+  FIELD(ForcedColorsOverride, dom::ForcedColorsOverride)                      \
   /* The number of entries added to the session history because of this       \
    * browsing context. */                                                     \
   FIELD(HistoryEntryCount, uint32_t)                                          \
@@ -933,6 +937,14 @@ class BrowsingContext : public nsILoadContext, public nsWrapperCache {
     return GetPrefersColorSchemeOverride();
   }
 
+  dom::PrefersReducedMotionOverride PrefersReducedMotionOverride() const {
+    return GetPrefersReducedMotionOverride();
+  }
+
+  dom::ForcedColorsOverride ForcedColorsOverride() const {
+    return GetForcedColorsOverride();
+  }
+
   bool IsInBFCache() const;
 
   bool AllowJavascript() const { return GetAllowJavascript(); }
@@ -1097,6 +1109,23 @@ class BrowsingContext : public nsILoadContext, public nsWrapperCache {
   void WalkPresContexts(Callback&&);
   void PresContextAffectingFieldChanged();
 
+  bool CanSet(FieldIndex<IDX_PrefersReducedMotionOverride>,
+              dom::PrefersReducedMotionOverride, ContentParent*) {
+    return IsTop();
+  }
+
+  void DidSet(FieldIndex<IDX_PrefersReducedMotionOverride>,
+              dom::PrefersReducedMotionOverride aOldValue);
+
+
+  bool CanSet(FieldIndex<IDX_ForcedColorsOverride>,
+              dom::ForcedColorsOverride, ContentParent*) {
+    return IsTop();
+  }
+
+  void DidSet(FieldIndex<IDX_ForcedColorsOverride>,
+              dom::ForcedColorsOverride aOldValue);
+
   void DidSet(FieldIndex<IDX_MediumOverride>, nsString&& aOldValue);
 
   bool CanSet(FieldIndex<IDX_SuspendMediaWhenInactive>, bool, ContentParent*) {
diff --git a/docshell/base/CanonicalBrowsingContext.cpp b/docshell/base/CanonicalBrowsingContext.cpp
index d5f85b1e571a7..5ba7484b1e7f8 100644
--- a/docshell/base/CanonicalBrowsingContext.cpp
+++ b/docshell/base/CanonicalBrowsingContext.cpp
@@ -1466,6 +1466,12 @@ void CanonicalBrowsingContext::LoadURI(nsIURI* aURI,
     return;
   }
 
+  {
+    nsCOMPtr<nsIObserverService> observerService = mozilla::services::GetObserverService();
+    if (observerService) {
+      observerService->NotifyObservers(ToSupports(this), "juggler-navigation-started-browser", NS_ConvertASCIItoUTF16(nsPrintfCString("%" PRIu64, loadState->GetLoadIdentifier())).get());
+    }
+  }
   LoadURI(loadState, true);
 }
 
diff --git a/docshell/base/moz.build b/docshell/base/moz.build
index 3520e9d75a2c2..e9eb3976a8380 100644
--- a/docshell/base/moz.build
+++ b/docshell/base/moz.build
@@ -124,3 +124,6 @@ LOCAL_INCLUDES += [
 EXTRA_JS_MODULES += ["URIFixup.sys.mjs"]
 
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/docshell/base/nsDocShell.cpp b/docshell/base/nsDocShell.cpp
index 0b8212fbf3f81..99d43d662978c 100644
--- a/docshell/base/nsDocShell.cpp
+++ b/docshell/base/nsDocShell.cpp
@@ -15,6 +15,12 @@
 #  include <unistd.h>  // for getpid()
 #endif
 
+#if JS_HAS_INTL_API && !MOZ_SYSTEM_ICU
+#  include "unicode/locid.h"
+#endif /* JS_HAS_INTL_API && !MOZ_SYSTEM_ICU */
+
+#include "js/LocaleSensitive.h"
+
 #include "mozilla/ArrayUtils.h"
 #include "mozilla/Attributes.h"
 #include "mozilla/AutoRestore.h"
@@ -64,6 +70,7 @@
 #include "mozilla/dom/ContentFrameMessageManager.h"
 #include "mozilla/dom/DocGroup.h"
 #include "mozilla/dom/Element.h"
+#include "mozilla/dom/Geolocation.h"
 #include "mozilla/dom/HTMLAnchorElement.h"
 #include "mozilla/dom/HTMLIFrameElement.h"
 #include "mozilla/dom/PerformanceNavigation.h"
@@ -88,6 +95,7 @@
 #include "mozilla/dom/JSWindowActorChild.h"
 #include "mozilla/dom/DocumentBinding.h"
 #include "mozilla/ipc/ProtocolUtils.h"
+#include "mozilla/dom/WorkerCommon.h"
 #include "mozilla/net/DocumentChannel.h"
 #include "mozilla/net/DocumentChannelChild.h"
 #include "mozilla/net/ParentChannelWrapper.h"
@@ -111,6 +119,7 @@
 #include "nsIDocumentViewer.h"
 #include "mozilla/dom/Document.h"
 #include "nsHTMLDocument.h"
+#include "mozilla/dom/Element.h"
 #include "nsIDocumentLoaderFactory.h"
 #include "nsIDOMWindow.h"
 #include "nsIEditingSession.h"
@@ -206,6 +215,7 @@
 #include "nsGlobalWindowInner.h"
 #include "nsGlobalWindowOuter.h"
 #include "nsJSEnvironment.h"
+#include "nsJSUtils.h"
 #include "nsNetCID.h"
 #include "nsNetUtil.h"
 #include "nsObjectLoadingContent.h"
@@ -346,6 +356,13 @@ nsDocShell::nsDocShell(BrowsingContext* aBrowsingContext,
       mAllowDNSPrefetch(true),
       mAllowWindowControl(true),
       mCSSErrorReportingEnabled(false),
+      mFileInputInterceptionEnabled(false),
+      mOverrideHasFocus(false),
+      mBypassCSPEnabled(false),
+      mForceActiveState(false),
+      mDisallowBFCache(false),
+      mReducedMotionOverride(REDUCED_MOTION_OVERRIDE_NONE),
+      mForcedColorsOverride(FORCED_COLORS_OVERRIDE_NO_OVERRIDE),
       mAllowAuth(mItemType == typeContent),
       mAllowKeywordFixup(false),
       mDisableMetaRefreshWhenInactive(false),
@@ -3115,6 +3132,214 @@ nsDocShell::GetMessageManager(ContentFrameMessageManager** aMessageManager) {
   return NS_OK;
 }
 
+// =============== Juggler Begin =======================
+
+nsDocShell* nsDocShell::GetRootDocShell() {
+  nsCOMPtr<nsIDocShellTreeItem> rootAsItem;
+  GetInProcessSameTypeRootTreeItem(getter_AddRefs(rootAsItem));
+  nsCOMPtr<nsIDocShell> rootShell = do_QueryInterface(rootAsItem);
+  return nsDocShell::Cast(rootShell);
+}
+
+NS_IMETHODIMP
+nsDocShell::GetBypassCSPEnabled(bool* aEnabled) {
+  MOZ_ASSERT(aEnabled);
+  *aEnabled = mBypassCSPEnabled;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::SetBypassCSPEnabled(bool aEnabled) {
+  mBypassCSPEnabled = aEnabled;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::GetForceActiveState(bool* aEnabled) {
+  MOZ_ASSERT(aEnabled);
+  *aEnabled = mForceActiveState;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::SetForceActiveState(bool aEnabled) {
+  mForceActiveState = aEnabled;
+  ActivenessMaybeChanged();
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::GetDisallowBFCache(bool* aEnabled) {
+  MOZ_ASSERT(aEnabled);
+  *aEnabled = mDisallowBFCache;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::SetDisallowBFCache(bool aEnabled) {
+  mDisallowBFCache = aEnabled;
+  return NS_OK;
+}
+
+bool nsDocShell::IsBypassCSPEnabled() {
+  return GetRootDocShell()->mBypassCSPEnabled;
+}
+
+NS_IMETHODIMP
+nsDocShell::GetOverrideHasFocus(bool* aEnabled) {
+  MOZ_ASSERT(aEnabled);
+  *aEnabled = mOverrideHasFocus;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::SetOverrideHasFocus(bool aEnabled) {
+  mOverrideHasFocus = aEnabled;
+  return NS_OK;
+}
+
+bool nsDocShell::ShouldOverrideHasFocus() const {
+  return mOverrideHasFocus;
+}
+
+NS_IMETHODIMP
+nsDocShell::GetLanguageOverride(nsAString& aLanguageOverride) {
+  aLanguageOverride = GetRootDocShell()->mLanguageOverride;
+  return NS_OK;
+}
+
+
+static void SetIcuLocale(const nsAString& aLanguageOverride) {
+  icu::Locale locale(NS_LossyConvertUTF16toASCII(aLanguageOverride).get());
+  if (icu::Locale::getDefault() != locale) {
+    UErrorCode error_code = U_ZERO_ERROR;
+    const char* lang = locale.getLanguage();
+    if (lang != nullptr && *lang != '\0') {
+      icu::Locale::setDefault(locale, error_code);
+    } else {
+      fprintf(stderr, "SetIcuLocale Failed to set the ICU default locale to %s\n", NS_LossyConvertUTF16toASCII(aLanguageOverride).get());
+    }
+  }
+
+  AutoJSAPI jsapi;
+  jsapi.Init();
+  JSContext* cx = jsapi.cx();
+  JS_ResetDefaultLocale(JS_GetRuntime(cx));
+
+  ResetDefaultLocaleInAllWorkers();
+}
+
+NS_IMETHODIMP
+nsDocShell::SetLanguageOverride(const nsAString& aLanguageOverride) {
+  mLanguageOverride = aLanguageOverride;
+  SetIcuLocale(aLanguageOverride);
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::OverrideTimezone(const nsAString& aTimezoneOverride,
+                             bool* aSuccess) {
+  NS_ENSURE_ARG(aSuccess);
+  NS_LossyConvertUTF16toASCII timeZoneId(aTimezoneOverride);
+  *aSuccess = nsJSUtils::SetTimeZoneOverride(timeZoneId.get());
+
+  // Set TZ which affects localtime_s().
+  auto setTimeZoneEnv = [](const char* value) {
+#if defined(_WIN32)
+    return _putenv_s("TZ", value) == 0;
+#else
+    return setenv("TZ", value, true) == 0;
+#endif /* _WIN32 */
+  };
+  if (*aSuccess) {
+    *aSuccess = setTimeZoneEnv(timeZoneId.get());
+    if (!*aSuccess) {
+      fprintf(stderr, "Failed to set 'TZ' to '%s'\n", timeZoneId.get());
+    }
+  }
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::GetFileInputInterceptionEnabled(bool* aEnabled) {
+  MOZ_ASSERT(aEnabled);
+  *aEnabled = GetRootDocShell()->mFileInputInterceptionEnabled;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::SetFileInputInterceptionEnabled(bool aEnabled) {
+  mFileInputInterceptionEnabled = aEnabled;
+  return NS_OK;
+}
+
+bool nsDocShell::IsFileInputInterceptionEnabled() {
+  return GetRootDocShell()->mFileInputInterceptionEnabled;
+}
+
+void nsDocShell::FilePickerShown(mozilla::dom::Element* element) {
+  nsCOMPtr<nsIObserverService> observerService =
+      mozilla::services::GetObserverService();
+  observerService->NotifyObservers(
+      ToSupports(element), "juggler-file-picker-shown", nullptr);
+}
+
+RefPtr<nsGeolocationService> nsDocShell::GetGeolocationServiceOverride() {
+  return GetRootDocShell()->mGeolocationServiceOverride;
+}
+
+NS_IMETHODIMP
+nsDocShell::SetGeolocationOverride(nsIDOMGeoPosition* aGeolocationOverride) {
+  if (aGeolocationOverride) {
+    if (!mGeolocationServiceOverride) {
+      mGeolocationServiceOverride = new nsGeolocationService();
+      mGeolocationServiceOverride->Init();
+    }
+    mGeolocationServiceOverride->Update(aGeolocationOverride);
+  } else {
+    mGeolocationServiceOverride = nullptr;
+  }
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::GetReducedMotionOverride(ReducedMotionOverride* aReducedMotionOverride) {
+  *aReducedMotionOverride = GetRootDocShell()->mReducedMotionOverride;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::SetReducedMotionOverride(ReducedMotionOverride aReducedMotionOverride) {
+  mReducedMotionOverride = aReducedMotionOverride;
+  RefPtr<nsPresContext> presContext = GetPresContext();
+  if (presContext) {
+    presContext->MediaFeatureValuesChanged(
+        {MediaFeatureChangeReason::SystemMetricsChange},
+        MediaFeatureChangePropagation::JustThisDocument);
+  }
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::GetForcedColorsOverride(ForcedColorsOverride* aForcedColorsOverride) {
+  *aForcedColorsOverride = GetRootDocShell()->mForcedColorsOverride;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+nsDocShell::SetForcedColorsOverride(ForcedColorsOverride aForcedColorsOverride) {
+  mForcedColorsOverride = aForcedColorsOverride;
+  RefPtr<nsPresContext> presContext = GetPresContext();
+  if (presContext) {
+    presContext->MediaFeatureValuesChanged(
+        {MediaFeatureChangeReason::SystemMetricsChange},
+        MediaFeatureChangePropagation::JustThisDocument);
+  }
+  return NS_OK;
+}
+
+// =============== Juggler End =======================
+
 NS_IMETHODIMP
 nsDocShell::GetIsNavigating(bool* aOut) {
   *aOut = mIsNavigating;
@@ -4803,7 +5028,7 @@ nsDocShell::GetVisibility(bool* aVisibility) {
 }
 
 void nsDocShell::ActivenessMaybeChanged() {
-  const bool isActive = mBrowsingContext->IsActive();
+  const bool isActive = mForceActiveState || mBrowsingContext->IsActive();
   if (RefPtr<PresShell> presShell = GetPresShell()) {
     presShell->ActivenessMaybeChanged();
   }
@@ -6722,6 +6947,10 @@ bool nsDocShell::CanSavePresentation(uint32_t aLoadType,
     return false;  // no entry to save into
   }
 
+  if (mDisallowBFCache) {
+    return false;
+  }
+
   MOZ_ASSERT(!mozilla::SessionHistoryInParent(),
              "mOSHE cannot be non-null with SHIP");
   nsCOMPtr<nsIDocumentViewer> viewer = mOSHE->GetDocumentViewer();
@@ -8454,6 +8683,12 @@ nsresult nsDocShell::PerformRetargeting(nsDocShellLoadState* aLoadState) {
                      true,  // aForceNoOpener
                      getter_AddRefs(newBC));
       MOZ_ASSERT(!newBC);
+      if (rv == NS_OK) {
+        nsCOMPtr<nsIObserverService> observerService = mozilla::services::GetObserverService();
+        if (observerService) {
+          observerService->NotifyObservers(GetAsSupports(this), "juggler-window-open-in-new-context", nullptr);
+        }
+      }
       return rv;
     }
 
@@ -9566,6 +9801,16 @@ nsresult nsDocShell::InternalLoad(nsDocShellLoadState* aLoadState,
                    nsINetworkPredictor::PREDICT_LOAD, attrs, nullptr);
 
   nsCOMPtr<nsIRequest> req;
+
+  // Juggler: report navigation started for non-same-document and non-javascript
+  // navigations.
+  if (!isJavaScript && !sameDocument) {
+    nsCOMPtr<nsIObserverService> observerService =
+        mozilla::services::GetObserverService();
+    if (observerService) {
+      observerService->NotifyObservers(GetAsSupports(this), "juggler-navigation-started-renderer", NS_ConvertASCIItoUTF16(nsPrintfCString("%" PRIu64, aLoadState->GetLoadIdentifier())).get());
+    }
+  }
   rv = DoURILoad(aLoadState, aCacheKey, getter_AddRefs(req));
 
   if (NS_SUCCEEDED(rv)) {
@@ -12714,6 +12959,9 @@ class OnLinkClickEvent : public Runnable {
       mHandler->OnLinkClickSync(mContent, mLoadState, mNoOpenerImplied,
                                 mTriggeringPrincipal);
     }
+    nsCOMPtr<nsIObserverService> observerService = mozilla::services::GetObserverService();
+    observerService->NotifyObservers(ToSupports(mContent), "juggler-link-click-sync", nullptr);
+
     return NS_OK;
   }
 
@@ -12798,6 +13046,8 @@ nsresult nsDocShell::OnLinkClick(
   nsCOMPtr<nsIRunnable> ev =
       new OnLinkClickEvent(this, aContent, loadState, noOpenerImplied,
                            aIsTrusted, aTriggeringPrincipal);
+  nsCOMPtr<nsIObserverService> observerService = mozilla::services::GetObserverService();
+  observerService->NotifyObservers(ToSupports(aContent), "juggler-link-click", nullptr);
   return Dispatch(ev.forget());
 }
 
diff --git a/docshell/base/nsDocShell.h b/docshell/base/nsDocShell.h
index 9f2d9a17dc0d5..8ff6e67fedef0 100644
--- a/docshell/base/nsDocShell.h
+++ b/docshell/base/nsDocShell.h
@@ -15,6 +15,7 @@
 #include "mozilla/UniquePtr.h"
 #include "mozilla/WeakPtr.h"
 #include "mozilla/dom/BrowsingContext.h"
+#include "mozilla/dom/Element.h"
 #include "mozilla/dom/WindowProxyHolder.h"
 #include "nsCOMPtr.h"
 #include "nsCharsetSource.h"
@@ -76,6 +77,7 @@ class nsCommandManager;
 class nsDocShellEditorData;
 class nsDOMNavigationTiming;
 class nsDSURIContentListener;
+class nsGeolocationService;
 class nsGlobalWindowOuter;
 
 class FramingChecker;
@@ -401,6 +403,15 @@ class nsDocShell final : public nsDocLoader,
   void SetWillChangeProcess() { mWillChangeProcess = true; }
   bool WillChangeProcess() { return mWillChangeProcess; }
 
+  bool IsFileInputInterceptionEnabled();
+  void FilePickerShown(mozilla::dom::Element* element);
+
+  bool ShouldOverrideHasFocus() const;
+
+  bool IsBypassCSPEnabled();
+
+  RefPtr<nsGeolocationService> GetGeolocationServiceOverride();
+
   // Create a content viewer within this nsDocShell for the given
   // `WindowGlobalChild` actor.
   nsresult CreateDocumentViewerForActor(
@@ -1003,6 +1014,8 @@ class nsDocShell final : public nsDocLoader,
 
   bool CSSErrorReportingEnabled() const { return mCSSErrorReportingEnabled; }
 
+  nsDocShell* GetRootDocShell();
+
   // Handles retrieval of subframe session history for nsDocShell::LoadURI. If a
   // load is requested in a subframe of the current DocShell, the subframe
   // loadType may need to reflect the loadType of the parent document, or in
@@ -1294,6 +1307,16 @@ class nsDocShell final : public nsDocLoader,
   bool mAllowDNSPrefetch : 1;
   bool mAllowWindowControl : 1;
   bool mCSSErrorReportingEnabled : 1;
+  bool mFileInputInterceptionEnabled: 1;
+  bool mOverrideHasFocus : 1;
+  bool mBypassCSPEnabled : 1;
+  bool mForceActiveState : 1;
+  bool mDisallowBFCache : 1;
+  nsString mLanguageOverride;
+  RefPtr<nsGeolocationService> mGeolocationServiceOverride;
+  ReducedMotionOverride mReducedMotionOverride;
+  ForcedColorsOverride mForcedColorsOverride;
+
   bool mAllowAuth : 1;
   bool mAllowKeywordFixup : 1;
   bool mDisableMetaRefreshWhenInactive : 1;
diff --git a/docshell/base/nsIDocShell.idl b/docshell/base/nsIDocShell.idl
index 9e79b6831a74c..db5cd5586b74e 100644
--- a/docshell/base/nsIDocShell.idl
+++ b/docshell/base/nsIDocShell.idl
@@ -44,6 +44,7 @@ interface nsIURI;
 interface nsIChannel;
 interface nsIContentSecurityPolicy;
 interface nsIDocumentViewer;
+interface nsIDOMGeoPosition;
 interface nsIEditor;
 interface nsIEditingSession;
 interface nsIInputStream;
@@ -767,6 +768,36 @@ interface nsIDocShell : nsIDocShellTreeItem
    */
   void synchronizeLayoutHistoryState();
 
+  attribute boolean fileInputInterceptionEnabled;
+
+  attribute boolean overrideHasFocus;
+
+  attribute boolean bypassCSPEnabled;
+
+  attribute boolean forceActiveState;
+
+  attribute boolean disallowBFCache;
+
+  attribute AString languageOverride;
+
+  boolean overrideTimezone(in AString timezoneId);
+
+  cenum ReducedMotionOverride : 8 {
+    REDUCED_MOTION_OVERRIDE_REDUCE,
+    REDUCED_MOTION_OVERRIDE_NO_PREFERENCE,
+    REDUCED_MOTION_OVERRIDE_NONE, /* This clears the override. */
+  };
+  [infallible] attribute nsIDocShell_ReducedMotionOverride reducedMotionOverride;
+
+  cenum ForcedColorsOverride : 8 {
+    FORCED_COLORS_OVERRIDE_ACTIVE,
+    FORCED_COLORS_OVERRIDE_NONE,
+    FORCED_COLORS_OVERRIDE_NO_OVERRIDE, /* This clears the override. */
+  };
+  [infallible] attribute nsIDocShell_ForcedColorsOverride forcedColorsOverride;
+
+  void setGeolocationOverride(in nsIDOMGeoPosition position);
+
   /**
    * This attempts to save any applicable layout history state (like
    * scroll position) in the nsISHEntry. This is normally done
diff --git a/docshell/build/moz.build b/docshell/build/moz.build
index d9fd81848e668..c366ce66f70b5 100644
--- a/docshell/build/moz.build
+++ b/docshell/build/moz.build
@@ -23,3 +23,6 @@ XPCOM_MANIFESTS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/docshell/moz.build b/docshell/moz.build
index 5a14b9dff8495..b8fcc254158bc 100644
--- a/docshell/moz.build
+++ b/docshell/moz.build
@@ -46,3 +46,6 @@ TEST_HARNESS_FILES.testing.mochitest.tests.docshell.test.chrome += [
     "test/chrome/bug89419.sjs",
     "test/chrome/red.png",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/docshell/shistory/moz.build b/docshell/shistory/moz.build
index f3b86c207bc6a..06d54eb626316 100644
--- a/docshell/shistory/moz.build
+++ b/docshell/shistory/moz.build
@@ -40,3 +40,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/docshell/test/moz.build b/docshell/test/moz.build
index 0cdf1633c19cb..35af10c9bf305 100644
--- a/docshell/test/moz.build
+++ b/docshell/test/moz.build
@@ -132,3 +132,6 @@ with Files("unit/*442584*"):
 
 with Files("unit/*setUsePrivateBrowsing*"):
     BUG_COMPONENT = ("Firefox", "Extension Compatibility")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/abort/moz.build b/dom/abort/moz.build
index eb5b25584a429..31ae60997d611 100644
--- a/dom/abort/moz.build
+++ b/dom/abort/moz.build
@@ -23,3 +23,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/abort/tests/moz.build b/dom/abort/tests/moz.build
index e69f90fccf65b..ea905922e0e61 100644
--- a/dom/abort/tests/moz.build
+++ b/dom/abort/tests/moz.build
@@ -7,3 +7,6 @@
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
 
 XPCSHELL_TESTS_MANIFESTS += ["unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/animation/moz.build b/dom/animation/moz.build
index 6546f4592b46a..cba481ae2f190 100644
--- a/dom/animation/moz.build
+++ b/dom/animation/moz.build
@@ -77,3 +77,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/audiochannel/moz.build b/dom/audiochannel/moz.build
index d006368e7fe31..53f9dd775df27 100644
--- a/dom/audiochannel/moz.build
+++ b/dom/audiochannel/moz.build
@@ -30,3 +30,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/base/Document.cpp b/dom/base/Document.cpp
index 0a2f5be08d0dc..a845203c6aaea 100644
--- a/dom/base/Document.cpp
+++ b/dom/base/Document.cpp
@@ -3705,6 +3705,9 @@ void Document::SendToConsole(nsCOMArray<nsISecurityConsoleMessage>& aMessages) {
 }
 
 void Document::ApplySettingsFromCSP(bool aSpeculative) {
+  if (mDocumentContainer && mDocumentContainer->IsBypassCSPEnabled())
+    return;
+
   nsresult rv = NS_OK;
   if (!aSpeculative) {
     // 1) apply settings from regular CSP
@@ -3762,6 +3765,11 @@ nsresult Document::InitCSP(nsIChannel* aChannel) {
   MOZ_ASSERT(!mScriptGlobalObject,
              "CSP must be initialized before mScriptGlobalObject is set!");
 
+  nsCOMPtr<nsIDocShell> shell(mDocumentContainer);
+  if (shell && nsDocShell::Cast(shell)->IsBypassCSPEnabled()) {
+    return NS_OK;
+  }
+
   // If this is a data document - no need to set CSP.
   if (mLoadedAsData) {
     return NS_OK;
@@ -4557,6 +4565,10 @@ bool Document::HasFocus(ErrorResult& rv) const {
     return false;
   }
 
+  if (IsActive() && mDocumentContainer->ShouldOverrideHasFocus()) {
+    return true;
+  }
+
   if (!fm->IsInActiveWindow(bc)) {
     return false;
   }
@@ -18878,6 +18890,68 @@ ColorScheme Document::PreferredColorScheme(IgnoreRFP aIgnoreRFP) const {
   return PreferenceSheet::PrefsFor(*this).mColorScheme;
 }
 
+bool Document::PrefersReducedMotion() const {
+  auto* docShell = static_cast<nsDocShell*>(GetDocShell());
+  nsIDocShell::ReducedMotionOverride reducedMotion;
+  if (docShell && docShell->GetReducedMotionOverride(&reducedMotion) == NS_OK &&
+      reducedMotion != nsIDocShell::REDUCED_MOTION_OVERRIDE_NONE) {
+    switch (reducedMotion) {
+      case nsIDocShell::REDUCED_MOTION_OVERRIDE_REDUCE:
+        return true;
+      case nsIDocShell::REDUCED_MOTION_OVERRIDE_NO_PREFERENCE:
+        return false;
+      case nsIDocShell::REDUCED_MOTION_OVERRIDE_NONE:
+        break;
+    };
+  }
+
+  if (auto* bc = GetBrowsingContext()) {
+    switch (bc->Top()->PrefersReducedMotionOverride()) {
+      case dom::PrefersReducedMotionOverride::Reduce:
+        return true;
+      case dom::PrefersReducedMotionOverride::No_preference:
+        return false;
+      case dom::PrefersReducedMotionOverride::None:
+      case dom::PrefersReducedMotionOverride::EndGuard_:
+        break;
+    }
+  }
+
+  return LookAndFeel::GetInt(LookAndFeel::IntID::PrefersReducedMotion, 0) == 1;
+}
+
+bool Document::ForcedColors() const {
+  auto* docShell = static_cast<nsDocShell*>(GetDocShell());
+  nsIDocShell::ForcedColorsOverride forcedColors;
+  if (docShell && docShell->GetForcedColorsOverride(&forcedColors) == NS_OK) {
+    switch (forcedColors) {
+      case nsIDocShell::FORCED_COLORS_OVERRIDE_ACTIVE:
+        return true;
+      case nsIDocShell::FORCED_COLORS_OVERRIDE_NONE:
+        return false;
+      case nsIDocShell::FORCED_COLORS_OVERRIDE_NO_OVERRIDE:
+        break;
+    };
+  }
+
+  if (auto* bc = GetBrowsingContext()) {
+    switch (bc->Top()->ForcedColorsOverride()) {
+      case dom::ForcedColorsOverride::Active:
+        return true;
+      case dom::ForcedColorsOverride::None:
+        return false;
+      case dom::ForcedColorsOverride::No_override:
+      case dom::ForcedColorsOverride::EndGuard_:
+        break;
+    }
+  }
+
+  if (mIsBeingUsedAsImage) {
+    return false;
+  }
+  return !PreferenceSheet::PrefsFor(*this).mUseDocumentColors;
+}
+
 bool Document::HasRecentlyStartedForegroundLoads() {
   if (!sLoadingForegroundTopLevelContentDocument) {
     return false;
diff --git a/dom/base/Document.h b/dom/base/Document.h
index 3f8032594868b..5017b42636937 100644
--- a/dom/base/Document.h
+++ b/dom/base/Document.h
@@ -4051,6 +4051,9 @@ class Document : public nsINode,
   // color-scheme meta tag.
   ColorScheme DefaultColorScheme() const;
 
+  bool PrefersReducedMotion() const;
+  bool ForcedColors() const;
+
   static bool HasRecentlyStartedForegroundLoads();
 
   static bool AutomaticStorageAccessPermissionCanBeGranted(
diff --git a/dom/base/MaybeCrossOriginObject.cpp b/dom/base/MaybeCrossOriginObject.cpp
index 5c9eb227c60d0..51ad451da8556 100644
--- a/dom/base/MaybeCrossOriginObject.cpp
+++ b/dom/base/MaybeCrossOriginObject.cpp
@@ -23,6 +23,8 @@
 #include "AccessCheck.h"
 #include "nsContentUtils.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
 #ifdef DEBUG
 static bool IsLocation(JSObject* obj) {
   return strcmp(JS::GetClass(obj)->name, "Location") == 0;
@@ -34,6 +36,11 @@ namespace mozilla::dom {
 /* static */
 bool MaybeCrossOriginObjectMixins::IsPlatformObjectSameOrigin(JSContext* cx,
                                                               JSObject* obj) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x1){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE MaybeCrossOriginObjectMixins::IsPlatformObjectSameOrigin"));
+    return true;
+  }
   MOZ_ASSERT(!js::IsCrossCompartmentWrapper(obj));
   // WindowProxy and Window must always be same-Realm, so we can do
   // our IsPlatformObjectSameOrigin check against either one.  But verify that
diff --git a/dom/base/Navigator.cpp b/dom/base/Navigator.cpp
index d4b04f809228f..39dfddff7404e 100644
--- a/dom/base/Navigator.cpp
+++ b/dom/base/Navigator.cpp
@@ -335,14 +335,18 @@ void Navigator::GetAppName(nsAString& aAppName) const {
  * for more detail.
  */
 /* static */
-void Navigator::GetAcceptLanguages(nsTArray<nsString>& aLanguages) {
+void Navigator::GetAcceptLanguages(const nsString* aLanguageOverride, nsTArray<nsString>& aLanguages) {
   MOZ_ASSERT(NS_IsMainThread());
 
   aLanguages.Clear();
 
   // E.g. "de-de, en-us,en".
   nsAutoString acceptLang;
-  Preferences::GetLocalizedString("intl.accept_languages", acceptLang);
+  if (aLanguageOverride && aLanguageOverride->Length())
+    acceptLang = *aLanguageOverride;
+  else
+    Preferences::GetLocalizedString("intl.accept_languages", acceptLang);
+    
 
   // Split values on commas.
   for (nsDependentSubstring lang :
@@ -394,7 +398,13 @@ void Navigator::GetLanguage(nsAString& aLanguage) {
 }
 
 void Navigator::GetLanguages(nsTArray<nsString>& aLanguages) {
-  GetAcceptLanguages(aLanguages);
+  if (mWindow && mWindow->GetDocShell()) {
+    nsString languageOverride;
+    mWindow->GetDocShell()->GetLanguageOverride(languageOverride);
+    GetAcceptLanguages(&languageOverride, aLanguages);
+  } else {
+    GetAcceptLanguages(nullptr, aLanguages);
+  }
 
   // The returned value is cached by the binding code. The window listens to the
   // accept languages change and will clear the cache when needed. It has to
diff --git a/dom/base/Navigator.h b/dom/base/Navigator.h
index 998328cfc6f36..c73e48d8dfe5a 100644
--- a/dom/base/Navigator.h
+++ b/dom/base/Navigator.h
@@ -216,7 +216,7 @@ class Navigator final : public nsISupports, public nsWrapperCache {
 
   StorageManager* Storage();
 
-  static void GetAcceptLanguages(nsTArray<nsString>& aLanguages);
+  static void GetAcceptLanguages(const nsString* aLanguageOverride, nsTArray<nsString>& aLanguages);
 
   dom::MediaCapabilities* MediaCapabilities();
   dom::MediaSession* MediaSession();
diff --git a/dom/base/fuzztest/moz.build b/dom/base/fuzztest/moz.build
index f2d65a3a8db84..5bdcfd49822bd 100644
--- a/dom/base/fuzztest/moz.build
+++ b/dom/base/fuzztest/moz.build
@@ -21,3 +21,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/base/moz.build b/dom/base/moz.build
index 26fe7e716da84..e95f2273dc54a 100644
--- a/dom/base/moz.build
+++ b/dom/base/moz.build
@@ -634,3 +634,6 @@ GeneratedFile(
         "/servo/components/style/properties/counted_unknown_properties.py",
     ],
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/base/nsContentUtils.cpp b/dom/base/nsContentUtils.cpp
index 6d3a9f8937a7b..61d5c1f505b78 100644
--- a/dom/base/nsContentUtils.cpp
+++ b/dom/base/nsContentUtils.cpp
@@ -402,6 +402,9 @@
 #include "xpcprivate.h"
 #include "xpcpublic.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
+
 #if defined(XP_WIN)
 // Undefine LoadImage to prevent naming conflict with Windows.
 #  undef LoadImage
@@ -2043,6 +2046,12 @@ nsresult nsContentUtils::CheckSameOrigin(const nsINode* aTrustedNode,
   MOZ_ASSERT(aTrustedNode);
   MOZ_ASSERT(unTrustedNode);
 
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x2){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsContentUtils::CheckSameOrigin"));
+    return NS_OK;
+  }
+
   /*
    * Get hold of each node's principal
    */
@@ -6589,6 +6598,12 @@ nsIInterfaceRequestor* nsContentUtils::SameOriginChecker() {
 /* static */
 nsresult nsContentUtils::CheckSameOrigin(nsIChannel* aOldChannel,
                                          nsIChannel* aNewChannel) {
+    // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x4){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsContentUtils::CheckSameOrigin"));
+    return NS_OK;
+  }
+
   if (!nsContentUtils::GetSecurityManager()) return NS_ERROR_NOT_AVAILABLE;
 
   nsCOMPtr<nsIPrincipal> oldPrincipal;
@@ -8697,7 +8712,8 @@ nsresult nsContentUtils::SendMouseEvent(
     bool aIgnoreRootScrollFrame, float aPressure,
     unsigned short aInputSourceArg, uint32_t aIdentifier, bool aToWindow,
     PreventDefaultResult* aPreventDefault, bool aIsDOMEventSynthesized,
-    bool aIsWidgetEventSynthesized) {
+    bool aIsWidgetEventSynthesized,
+    bool convertToPointer, uint32_t aJugglerEventId) {
   nsPoint offset;
   nsCOMPtr<nsIWidget> widget = GetWidget(aPresShell, &offset);
   if (!widget) return NS_ERROR_FAILURE;
@@ -8705,6 +8721,7 @@ nsresult nsContentUtils::SendMouseEvent(
   EventMessage msg;
   Maybe<WidgetMouseEvent::ExitFrom> exitFrom;
   bool contextMenuKey = false;
+  bool isDragEvent = false;
   if (aType.EqualsLiteral("mousedown")) {
     msg = eMouseDown;
   } else if (aType.EqualsLiteral("mouseup")) {
@@ -8729,6 +8746,12 @@ nsresult nsContentUtils::SendMouseEvent(
     msg = eMouseHitTest;
   } else if (aType.EqualsLiteral("MozMouseExploreByTouch")) {
     msg = eMouseExploreByTouch;
+  } else if (aType.EqualsLiteral("dragover")) {
+    msg = eDragOver;
+    isDragEvent = true;
+  } else if (aType.EqualsLiteral("drop")) {
+    msg = eDrop;
+    isDragEvent = true;
   } else {
     return NS_ERROR_FAILURE;
   }
@@ -8737,12 +8760,21 @@ nsresult nsContentUtils::SendMouseEvent(
     aInputSourceArg = MouseEvent_Binding::MOZ_SOURCE_MOUSE;
   }
 
-  WidgetMouseEvent event(true, msg, widget,
+  std::unique_ptr<WidgetMouseEvent> eventOwner;
+  if (isDragEvent) {
+    eventOwner.reset(new WidgetDragEvent(true, msg, widget));
+    eventOwner->mReason = aIsWidgetEventSynthesized
+                             ? WidgetMouseEvent::eSynthesized
+                             : WidgetMouseEvent::eReal;
+  } else {
+    eventOwner.reset(new WidgetMouseEvent(true, msg, widget,
                          aIsWidgetEventSynthesized
                              ? WidgetMouseEvent::eSynthesized
                              : WidgetMouseEvent::eReal,
                          contextMenuKey ? WidgetMouseEvent::eContextMenuKey
-                                        : WidgetMouseEvent::eNormal);
+                                        : WidgetMouseEvent::eNormal));
+  }
+  WidgetMouseEvent& event = *eventOwner.get();
   event.pointerId = aIdentifier;
   event.mModifiers = GetWidgetModifiers(aModifiers);
   event.mButton = aButton;
@@ -8753,8 +8785,10 @@ nsresult nsContentUtils::SendMouseEvent(
   event.mPressure = aPressure;
   event.mInputSource = aInputSourceArg;
   event.mClickCount = aClickCount;
+  event.mJugglerEventId = aJugglerEventId;
   event.mFlags.mIsSynthesizedForTests = aIsDOMEventSynthesized;
   event.mExitFrom = exitFrom;
+  event.convertToPointer = convertToPointer;
 
   nsPresContext* presContext = aPresShell->GetPresContext();
   if (!presContext) return NS_ERROR_FAILURE;
diff --git a/dom/base/nsContentUtils.h b/dom/base/nsContentUtils.h
index db68b67c5a3e6..529b49b2c6c5f 100644
--- a/dom/base/nsContentUtils.h
+++ b/dom/base/nsContentUtils.h
@@ -2958,7 +2958,8 @@ class nsContentUtils {
       int32_t aModifiers, bool aIgnoreRootScrollFrame, float aPressure,
       unsigned short aInputSourceArg, uint32_t aIdentifier, bool aToWindow,
       mozilla::PreventDefaultResult* aPreventDefault,
-      bool aIsDOMEventSynthesized, bool aIsWidgetEventSynthesized);
+      bool aIsDOMEventSynthesized, bool aIsWidgetEventSynthesized,
+      bool convertToPointer = true, uint32_t aJugglerEventId = 0);
 
   static void FirePageShowEventForFrameLoaderSwap(
       nsIDocShellTreeItem* aItem,
diff --git a/dom/base/nsDOMWindowUtils.cpp b/dom/base/nsDOMWindowUtils.cpp
index 6c547a9fd8604..c9aa1951da7af 100644
--- a/dom/base/nsDOMWindowUtils.cpp
+++ b/dom/base/nsDOMWindowUtils.cpp
@@ -685,6 +685,26 @@ nsDOMWindowUtils::GetPresShellId(uint32_t* aPresShellId) {
   return NS_ERROR_FAILURE;
 }
 
+static uint32_t sJugglerEventId = 1000;
+
+NS_IMETHODIMP
+nsDOMWindowUtils::JugglerSendMouseEvent(
+    const nsAString& aType, float aX, float aY, int32_t aButton,
+    int32_t aClickCount, int32_t aModifiers, bool aIgnoreRootScrollFrame,
+    float aPressure, unsigned short aInputSourceArg,
+    bool aIsDOMEventSynthesized, bool aIsWidgetEventSynthesized,
+    int32_t aButtons, uint32_t aIdentifier, bool aDisablePointerEvent,
+    uint32_t* aJugglerEventId) {
+  *aJugglerEventId = ++sJugglerEventId;
+  return SendMouseEventCommon(
+      aType, aX, aY, aButton, aClickCount, aModifiers, aIgnoreRootScrollFrame,
+      aPressure, aInputSourceArg,
+      aIdentifier, false,
+      nullptr, aIsDOMEventSynthesized,
+      aIsWidgetEventSynthesized,
+      aButtons, !aDisablePointerEvent, *aJugglerEventId);
+}
+
 NS_IMETHODIMP
 nsDOMWindowUtils::SendMouseEvent(
     const nsAString& aType, float aX, float aY, int32_t aButton,
@@ -699,7 +719,7 @@ nsDOMWindowUtils::SendMouseEvent(
       aOptionalArgCount >= 7 ? aIdentifier : DEFAULT_MOUSE_POINTER_ID, false,
       aPreventDefault, aOptionalArgCount >= 4 ? aIsDOMEventSynthesized : true,
       aOptionalArgCount >= 5 ? aIsWidgetEventSynthesized : false,
-      aOptionalArgCount >= 6 ? aButtons : MOUSE_BUTTONS_NOT_SPECIFIED);
+      aOptionalArgCount >= 6 ? aButtons : MOUSE_BUTTONS_NOT_SPECIFIED, true, 0);
 }
 
 NS_IMETHODIMP
@@ -717,7 +737,7 @@ nsDOMWindowUtils::SendMouseEventToWindow(
       aOptionalArgCount >= 7 ? aIdentifier : DEFAULT_MOUSE_POINTER_ID, true,
       nullptr, aOptionalArgCount >= 4 ? aIsDOMEventSynthesized : true,
       aOptionalArgCount >= 5 ? aIsWidgetEventSynthesized : false,
-      aOptionalArgCount >= 6 ? aButtons : MOUSE_BUTTONS_NOT_SPECIFIED);
+      aOptionalArgCount >= 6 ? aButtons : MOUSE_BUTTONS_NOT_SPECIFIED, 0);
 }
 
 NS_IMETHODIMP
@@ -726,13 +746,13 @@ nsDOMWindowUtils::SendMouseEventCommon(
     int32_t aClickCount, int32_t aModifiers, bool aIgnoreRootScrollFrame,
     float aPressure, unsigned short aInputSourceArg, uint32_t aPointerId,
     bool aToWindow, bool* aPreventDefault, bool aIsDOMEventSynthesized,
-    bool aIsWidgetEventSynthesized, int32_t aButtons) {
+    bool aIsWidgetEventSynthesized, int32_t aButtons, bool aConvertToPointer, uint32_t aJugglerEventId) {
   RefPtr<PresShell> presShell = GetPresShell();
   PreventDefaultResult preventDefaultResult;
   nsresult rv = nsContentUtils::SendMouseEvent(
       presShell, aType, aX, aY, aButton, aButtons, aClickCount, aModifiers,
       aIgnoreRootScrollFrame, aPressure, aInputSourceArg, aPointerId, aToWindow,
-      &preventDefaultResult, aIsDOMEventSynthesized, aIsWidgetEventSynthesized);
+      &preventDefaultResult, aIsDOMEventSynthesized, aIsWidgetEventSynthesized, aConvertToPointer, aJugglerEventId);
 
   if (aPreventDefault) {
     *aPreventDefault = preventDefaultResult != PreventDefaultResult::No;
diff --git a/dom/base/nsDOMWindowUtils.h b/dom/base/nsDOMWindowUtils.h
index 63968c9b7a4e4..decf3ea3833cc 100644
--- a/dom/base/nsDOMWindowUtils.h
+++ b/dom/base/nsDOMWindowUtils.h
@@ -93,7 +93,7 @@ class nsDOMWindowUtils final : public nsIDOMWindowUtils,
       int32_t aClickCount, int32_t aModifiers, bool aIgnoreRootScrollFrame,
       float aPressure, unsigned short aInputSourceArg, uint32_t aIdentifier,
       bool aToWindow, bool* aPreventDefault, bool aIsDOMEventSynthesized,
-      bool aIsWidgetEventSynthesized, int32_t aButtons);
+      bool aIsWidgetEventSynthesized, int32_t aButtons, bool aConvertToPointer = true, uint32_t aJugglerEventId = 0);
 
   MOZ_CAN_RUN_SCRIPT
   nsresult SendTouchEventCommon(
diff --git a/dom/base/nsFocusManager.cpp b/dom/base/nsFocusManager.cpp
index 60f45157cdfce..964d7cc1b847c 100644
--- a/dom/base/nsFocusManager.cpp
+++ b/dom/base/nsFocusManager.cpp
@@ -1673,6 +1673,10 @@ Maybe<uint64_t> nsFocusManager::SetFocusInner(Element* aNewContent,
         (GetActiveBrowsingContext() == newRootBrowsingContext);
   }
 
+  // In Playwright, we want to send focus events even if the element
+  // isn't actually in the active window.
+  isElementInActiveWindow = true;
+
   // Exit fullscreen if a website focuses another window
   if (StaticPrefs::full_screen_api_exit_on_windowRaise() &&
       !isElementInActiveWindow && (aFlags & FLAG_RAISE)) {
@@ -2946,7 +2950,9 @@ void nsFocusManager::RaiseWindow(nsPIDOMWindowOuter* aWindow,
     }
   }
 
-  if (sTestMode) {
+  // In Playwright, we still want to execte the embedder functions
+  // to actually show / focus windows.
+  if (false && sTestMode) {
     // In test mode, emulate raising the window. WindowRaised takes
     // care of lowering the present active window. This happens in
     // a separate runnable to avoid touching multiple windows in
diff --git a/dom/base/nsGlobalWindowOuter.cpp b/dom/base/nsGlobalWindowOuter.cpp
index a10808b95d5f7..027b9a3c87811 100644
--- a/dom/base/nsGlobalWindowOuter.cpp
+++ b/dom/base/nsGlobalWindowOuter.cpp
@@ -2510,10 +2510,16 @@ nsresult nsGlobalWindowOuter::SetNewDocument(Document* aDocument,
     }();
 
     if (!isContentAboutBlankInChromeDocshell) {
-      newInnerWindow->mHasNotifiedGlobalCreated = true;
-      nsContentUtils::AddScriptRunner(NewRunnableMethod(
-          "nsGlobalWindowOuter::DispatchDOMWindowCreated", this,
-          &nsGlobalWindowOuter::DispatchDOMWindowCreated));
+      if (!newInnerWindow->mHasNotifiedGlobalCreated) {
+        newInnerWindow->mHasNotifiedGlobalCreated = true;
+        nsContentUtils::AddScriptRunner(NewRunnableMethod(
+            "nsGlobalWindowOuter::DispatchDOMWindowCreated", this,
+            &nsGlobalWindowOuter::DispatchDOMWindowCreated));
+      } else if (!reUseInnerWindow) {
+        nsContentUtils::AddScriptRunner(NewRunnableMethod(
+            "nsGlobalWindowOuter::JugglerDispatchDOMWindowReused", this,
+            &nsGlobalWindowOuter::JugglerDispatchDOMWindowReused));
+      }
     }
   }
 
@@ -2633,6 +2639,19 @@ void nsGlobalWindowOuter::DispatchDOMWindowCreated() {
   }
 }
 
+void nsGlobalWindowOuter::JugglerDispatchDOMWindowReused() {
+  nsCOMPtr<nsIObserverService> observerService =
+      mozilla::services::GetObserverService();
+  if (observerService && mDoc) {
+    nsIPrincipal* principal = mDoc->NodePrincipal();
+    if (!principal->IsSystemPrincipal()) {
+      observerService->NotifyObservers(static_cast<nsIDOMWindow*>(this),
+                                      "juggler-dom-window-reused",
+                                      nullptr);
+    }
+  }
+}
+
 void nsGlobalWindowOuter::ClearStatus() { SetStatusOuter(u""_ns); }
 
 void nsGlobalWindowOuter::SetDocShell(nsDocShell* aDocShell) {
diff --git a/dom/base/nsGlobalWindowOuter.h b/dom/base/nsGlobalWindowOuter.h
index 8337a7353fb8e..e7dedd6d26125 100644
--- a/dom/base/nsGlobalWindowOuter.h
+++ b/dom/base/nsGlobalWindowOuter.h
@@ -315,6 +315,7 @@ class nsGlobalWindowOuter final : public mozilla::dom::EventTarget,
 
   // Outer windows only.
   void DispatchDOMWindowCreated();
+  void JugglerDispatchDOMWindowReused();
 
   // Outer windows only.
   virtual void EnsureSizeAndPositionUpToDate() override;
diff --git a/dom/base/nsINode.cpp b/dom/base/nsINode.cpp
index 11ca350f48345..6bb310f6e9623 100644
--- a/dom/base/nsINode.cpp
+++ b/dom/base/nsINode.cpp
@@ -1362,6 +1362,61 @@ void nsINode::GetBoxQuadsFromWindowOrigin(const BoxQuadOptions& aOptions,
   mozilla::GetBoxQuadsFromWindowOrigin(this, aOptions, aResult, aRv);
 }
 
+static nsIFrame* GetFirstFrame(nsINode* aNode) {
+  if (!aNode->IsContent())
+    return nullptr;
+  nsIFrame* frame = aNode->AsContent()->GetPrimaryFrame(FlushType::Frames);
+  if (!frame) {
+    FlattenedChildIterator iter(aNode->AsContent());
+    for (nsIContent* child = iter.GetNextChild(); child; child = iter.GetNextChild()) {
+      frame = child->GetPrimaryFrame(FlushType::Frames);
+      if (frame) {
+        break;
+      }
+    }
+  }
+  return frame;
+}
+
+void nsINode::ScrollRectIntoViewIfNeeded(int32_t x, int32_t y,
+                                         int32_t w, int32_t h,
+                                         ErrorResult& aRv) {
+  aRv = NS_ERROR_UNEXPECTED;
+  nsCOMPtr<Document> document = OwnerDoc();
+  if (!document) {
+    return aRv.ThrowNotFoundError("Node is detached from document");
+  }
+  PresShell* presShell = document->GetPresShell();
+  if (!presShell) {
+    return aRv.ThrowNotFoundError("Node is detached from document");
+  }
+  nsIFrame* primaryFrame = GetFirstFrame(this);
+  if (!primaryFrame) {
+    return aRv.ThrowNotFoundError("Node does not have a layout object");
+  }
+  aRv = NS_OK;
+  nsRect rect;
+  if (x == -1 && y == -1 && w == -1 && h == -1) {
+    rect = primaryFrame->GetRectRelativeToSelf();
+  } else {
+    rect = nsRect(nsPresContext::CSSPixelsToAppUnits(x),
+                  nsPresContext::CSSPixelsToAppUnits(y),
+                  nsPresContext::CSSPixelsToAppUnits(w),
+                  nsPresContext::CSSPixelsToAppUnits(h));
+  }
+  presShell->ScrollFrameIntoView(
+      primaryFrame, Some(rect),
+      ScrollAxis(WhereToScroll::Center, WhenToScroll::IfNotFullyVisible),
+      ScrollAxis(WhereToScroll::Center, WhenToScroll::IfNotFullyVisible),
+      ScrollFlags::ScrollOverflowHidden);
+  // If a _visual_ scroll update is pending, cancel it; otherwise, it will
+  // clobber next scroll (e.g. subsequent window.scrollTo(0, 0) wlll break).
+  if (presShell->GetPendingVisualScrollUpdate()) {
+    presShell->AcknowledgePendingVisualScrollUpdate();
+    presShell->ClearPendingVisualScrollUpdate();
+  }
+}
+
 already_AddRefed<DOMQuad> nsINode::ConvertQuadFromNode(
     DOMQuad& aQuad, const GeometryNode& aFrom,
     const ConvertCoordinateOptions& aOptions, CallerType aCallerType,
diff --git a/dom/base/nsINode.h b/dom/base/nsINode.h
index 0ba44cb08ffff..b698e309e7bf6 100644
--- a/dom/base/nsINode.h
+++ b/dom/base/nsINode.h
@@ -2235,6 +2235,10 @@ class nsINode : public mozilla::dom::EventTarget {
                                    nsTArray<RefPtr<DOMQuad>>& aResult,
                                    ErrorResult& aRv);
 
+  void ScrollRectIntoViewIfNeeded(int32_t x, int32_t y,
+                                  int32_t w, int32_t h,
+                                  ErrorResult& aRv);
+
   already_AddRefed<DOMQuad> ConvertQuadFromNode(
       DOMQuad& aQuad, const TextOrElementOrDocument& aFrom,
       const ConvertCoordinateOptions& aOptions, CallerType aCallerType,
diff --git a/dom/base/nsJSUtils.cpp b/dom/base/nsJSUtils.cpp
index cf8037cd58001..583460796fdef 100644
--- a/dom/base/nsJSUtils.cpp
+++ b/dom/base/nsJSUtils.cpp
@@ -177,6 +177,11 @@ bool nsJSUtils::GetScopeChainForElement(
   return true;
 }
 
+/* static */
+bool nsJSUtils::SetTimeZoneOverride(const char* timezoneId) {
+  return JS::SetTimeZoneOverride(timezoneId);
+}
+
 /* static */
 void nsJSUtils::ResetTimeZone() { JS::ResetTimeZone(); }
 
diff --git a/dom/base/nsJSUtils.h b/dom/base/nsJSUtils.h
index cceb725d393d5..e906a7fb7c3fd 100644
--- a/dom/base/nsJSUtils.h
+++ b/dom/base/nsJSUtils.h
@@ -79,6 +79,7 @@ class nsJSUtils {
       JSContext* aCx, mozilla::dom::Element* aElement,
       JS::MutableHandleVector<JSObject*> aScopeChain);
 
+  static bool SetTimeZoneOverride(const char* timezoneId);
   static void ResetTimeZone();
 
   static bool DumpEnabled();
diff --git a/dom/base/test/fullscreen/moz.build b/dom/base/test/fullscreen/moz.build
index 3ac1d85dffb0c..67ef0d5767dfe 100644
--- a/dom/base/test/fullscreen/moz.build
+++ b/dom/base/test/fullscreen/moz.build
@@ -15,3 +15,6 @@ MOCHITEST_CHROME_MANIFESTS += [
 BROWSER_CHROME_MANIFESTS += [
     "browser.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/base/test/gtest/moz.build b/dom/base/test/gtest/moz.build
index 9a767eb2ff830..fdebc1fcf923f 100644
--- a/dom/base/test/gtest/moz.build
+++ b/dom/base/test/gtest/moz.build
@@ -19,3 +19,6 @@ LOCAL_INCLUDES += ["/dom/base"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/base/test/jsmodules/importmaps/moz.build b/dom/base/test/jsmodules/importmaps/moz.build
index ca4ef002b049a..03eebbf188999 100644
--- a/dom/base/test/jsmodules/importmaps/moz.build
+++ b/dom/base/test/jsmodules/importmaps/moz.build
@@ -7,3 +7,6 @@
 MOCHITEST_CHROME_MANIFESTS += ["chrome.toml"]
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/base/test/jsmodules/moz.build b/dom/base/test/jsmodules/moz.build
index 36ed0467080bf..a914958225d5c 100644
--- a/dom/base/test/jsmodules/moz.build
+++ b/dom/base/test/jsmodules/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 MOCHITEST_CHROME_MANIFESTS += ["chrome.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/base/test/meta_viewport/moz.build b/dom/base/test/meta_viewport/moz.build
index 3ef5d9c8cd146..0b0c803e0add1 100644
--- a/dom/base/test/meta_viewport/moz.build
+++ b/dom/base/test/meta_viewport/moz.build
@@ -7,3 +7,6 @@
 MOCHITEST_MANIFESTS += [
     "mochitest.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/base/test/moz.build b/dom/base/test/moz.build
index 374e735b88fae..9d7c62366b565 100644
--- a/dom/base/test/moz.build
+++ b/dom/base/test/moz.build
@@ -42,3 +42,6 @@ TEST_HARNESS_FILES.testing.mochitest.tests.dom.base.test.chrome += [
     "chrome/nochrome_bug765993.js",
     "chrome/nochrome_bug765993.js^headers^",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/base/test/useractivation/moz.build b/dom/base/test/useractivation/moz.build
index 3ef5d9c8cd146..0b0c803e0add1 100644
--- a/dom/base/test/useractivation/moz.build
+++ b/dom/base/test/useractivation/moz.build
@@ -7,3 +7,6 @@
 MOCHITEST_MANIFESTS += [
     "mochitest.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/battery/moz.build b/dom/battery/moz.build
index 3a90c93c01d5e..566cb8a5003c7 100644
--- a/dom/battery/moz.build
+++ b/dom/battery/moz.build
@@ -21,3 +21,6 @@ FINAL_LIBRARY = "xul"
 
 MOCHITEST_CHROME_MANIFESTS += ["test/chrome.toml"]
 MOCHITEST_MANIFESTS += ["test/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/bindings/Bindings.conf b/dom/bindings/Bindings.conf
index bf736e9ac2213..cc56543028397 100644
--- a/dom/bindings/Bindings.conf
+++ b/dom/bindings/Bindings.conf
@@ -424,6 +424,11 @@ DOMInterfaces = {
     'headerFile': 'DOMIntersectionObserver.h',
 },
 
+'IPCFuzzer': {
+    'nativeType': 'mozilla::dom::IPCFuzzer',
+    'headerFile': 'mozilla/dom/IPCFuzzer.h'
+},
+
 'KeyEvent' : {
     'concrete': False,
 },
diff --git a/dom/bindings/moz.build b/dom/bindings/moz.build
index 344355571865a..934baa7178106 100644
--- a/dom/bindings/moz.build
+++ b/dom/bindings/moz.build
@@ -202,3 +202,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
             "!/layout/style/ServoCSSPropList.py",
         ],
     )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/bindings/test/moz.build b/dom/bindings/test/moz.build
index b5c45301a6aeb..b7538e8ed26fc 100644
--- a/dom/bindings/test/moz.build
+++ b/dom/bindings/test/moz.build
@@ -67,3 +67,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
     CXXFLAGS += ["-Od"]
 else:
     CXXFLAGS += ["-O0"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/broadcastchannel/moz.build b/dom/broadcastchannel/moz.build
index 573686bf30820..c443b6b7bfd2d 100644
--- a/dom/broadcastchannel/moz.build
+++ b/dom/broadcastchannel/moz.build
@@ -28,3 +28,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/browser-element/moz.build b/dom/browser-element/moz.build
index 1f83fbd436dae..bd3d00cf8e246 100644
--- a/dom/browser-element/moz.build
+++ b/dom/browser-element/moz.build
@@ -35,3 +35,6 @@ LOCAL_INCLUDES += [
     "/dom/base",
     "/dom/ipc",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/cache/moz.build b/dom/cache/moz.build
index 5fb5704e526af..7252868b740b6 100644
--- a/dom/cache/moz.build
+++ b/dom/cache/moz.build
@@ -100,3 +100,6 @@ MARIONETTE_MANIFESTS += ["test/marionette/manifest.toml"]
 XPCSHELL_TESTS_MANIFESTS += [
     "test/xpcshell/xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/canvas/gtest/moz.build b/dom/canvas/gtest/moz.build
index 1e593a5f82ae8..45f7e31059dfd 100644
--- a/dom/canvas/gtest/moz.build
+++ b/dom/canvas/gtest/moz.build
@@ -13,3 +13,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/canvas/moz.build b/dom/canvas/moz.build
index 414f925112771..16614b31dcc0e 100644
--- a/dom/canvas/moz.build
+++ b/dom/canvas/moz.build
@@ -220,3 +220,6 @@ if CONFIG["CC_TYPE"] == "gcc":
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/chrome-webidl/BrowsingContext.webidl b/dom/chrome-webidl/BrowsingContext.webidl
index 8600a844634ee..853a4c98b7809 100644
--- a/dom/chrome-webidl/BrowsingContext.webidl
+++ b/dom/chrome-webidl/BrowsingContext.webidl
@@ -53,6 +53,24 @@ enum PrefersColorSchemeOverride {
   "dark",
 };
 
+/**
+ * CSS prefers-reduced-motion values.
+ */
+enum PrefersReducedMotionOverride {
+  "none",
+  "reduce",
+  "no-preference",
+};
+
+/**
+ * CSS forced-colors values.
+ */
+enum ForcedColorsOverride {
+  "none",
+  "active",
+  "no-override",  /* This clears the override. */
+};
+
 /**
  * Allowed overrides of platform/pref default behaviour for touch events.
  */
@@ -205,6 +223,12 @@ interface BrowsingContext {
   // Color-scheme simulation, for DevTools.
   [SetterThrows] attribute PrefersColorSchemeOverride prefersColorSchemeOverride;
 
+  // Reduced-Motion simulation, for DevTools.
+  [SetterThrows] attribute PrefersReducedMotionOverride prefersReducedMotionOverride;
+
+  // Forced-Colors simulation, for DevTools.
+  [SetterThrows] attribute ForcedColorsOverride forcedColorsOverride;
+
   /**
    * A unique identifier for the browser element that is hosting this
    * BrowsingContext tree. Every BrowsingContext in the element's tree will
diff --git a/dom/chrome-webidl/moz.build b/dom/chrome-webidl/moz.build
index 9fb1a07e6ee47..62cf43d5b5c11 100644
--- a/dom/chrome-webidl/moz.build
+++ b/dom/chrome-webidl/moz.build
@@ -133,3 +133,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "windows":
     WEBIDL_FILES += [
         "WindowsJumpListShortcutDescription.webidl",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/clients/api/moz.build b/dom/clients/api/moz.build
index 4e864290fdf41..1580f762ae834 100644
--- a/dom/clients/api/moz.build
+++ b/dom/clients/api/moz.build
@@ -23,3 +23,6 @@ MOCHITEST_MANIFESTS += []
 BROWSER_CHROME_MANIFESTS += []
 
 XPCSHELL_TESTS_MANIFESTS += []
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/clients/manager/moz.build b/dom/clients/manager/moz.build
index 92eca6087cf8b..057bbd5e8c746 100644
--- a/dom/clients/manager/moz.build
+++ b/dom/clients/manager/moz.build
@@ -68,3 +68,6 @@ MOCHITEST_MANIFESTS += []
 BROWSER_CHROME_MANIFESTS += []
 
 XPCSHELL_TESTS_MANIFESTS += []
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/clients/moz.build b/dom/clients/moz.build
index e90f9987f7af7..1eabe5a45cad2 100644
--- a/dom/clients/moz.build
+++ b/dom/clients/moz.build
@@ -8,3 +8,6 @@ DIRS += [
     "api",
     "manager",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/commandhandler/moz.build b/dom/commandhandler/moz.build
index 1aaa78e8af25f..5f94486ca6361 100644
--- a/dom/commandhandler/moz.build
+++ b/dom/commandhandler/moz.build
@@ -36,3 +36,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/console/moz.build b/dom/console/moz.build
index d5be3324ae285..73cfbf8050605 100644
--- a/dom/console/moz.build
+++ b/dom/console/moz.build
@@ -55,3 +55,6 @@ XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell/xpcshell.toml"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/credentialmanagement/identity/moz.build b/dom/credentialmanagement/identity/moz.build
index f7a053d676817..354fc85af638c 100644
--- a/dom/credentialmanagement/identity/moz.build
+++ b/dom/credentialmanagement/identity/moz.build
@@ -26,3 +26,6 @@ FINAL_LIBRARY = "xul"
 
 BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 MOCHITEST_MANIFESTS += ["tests/mochitest/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/credentialmanagement/moz.build b/dom/credentialmanagement/moz.build
index 17f02573d4b0f..025e4b4a6088e 100644
--- a/dom/credentialmanagement/moz.build
+++ b/dom/credentialmanagement/moz.build
@@ -26,3 +26,6 @@ FINAL_LIBRARY = "xul"
 MOCHITEST_MANIFESTS += ["tests/mochitest/mochitest.toml"]
 BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 CRASHTEST_MANIFESTS += ["tests/crashtests/crashtests.list"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/crypto/moz.build b/dom/crypto/moz.build
index 4dd58f773096f..4e11b770827fd 100644
--- a/dom/crypto/moz.build
+++ b/dom/crypto/moz.build
@@ -36,3 +36,6 @@ BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/debugger/moz.build b/dom/debugger/moz.build
index 879c3ec237af5..7a4271856914a 100644
--- a/dom/debugger/moz.build
+++ b/dom/debugger/moz.build
@@ -24,3 +24,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/encoding/moz.build b/dom/encoding/moz.build
index 8b64c9ed03a90..3b81be1bfd3ac 100644
--- a/dom/encoding/moz.build
+++ b/dom/encoding/moz.build
@@ -31,3 +31,6 @@ MOCHITEST_MANIFESTS += [
 ]
 MOCHITEST_CHROME_MANIFESTS += ["test/chrome.toml"]
 XPCSHELL_TESTS_MANIFESTS += ["test/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/events/moz.build b/dom/events/moz.build
index 62e1f7d57bafb..d028aea5ed81e 100644
--- a/dom/events/moz.build
+++ b/dom/events/moz.build
@@ -187,3 +187,6 @@ LOCAL_INCLUDES += [
     "/layout/xul",
     "/layout/xul/tree/",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/events/test/gtest/moz.build b/dom/events/test/gtest/moz.build
index d5c0ac6a9e156..1af70bbfa39bf 100644
--- a/dom/events/test/gtest/moz.build
+++ b/dom/events/test/gtest/moz.build
@@ -16,3 +16,6 @@ LOCAL_INCLUDES += ["/dom/events"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fetch/moz.build b/dom/fetch/moz.build
index 3d3c09574238b..0233eaf41493e 100644
--- a/dom/fetch/moz.build
+++ b/dom/fetch/moz.build
@@ -70,3 +70,6 @@ MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/file/ipc/moz.build b/dom/file/ipc/moz.build
index c34abb0b01084..61c5ecfbe5145 100644
--- a/dom/file/ipc/moz.build
+++ b/dom/file/ipc/moz.build
@@ -67,3 +67,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 
 BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
 MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/file/moz.build b/dom/file/moz.build
index eaf4c49019ab1..d656dbc7e6cfc 100644
--- a/dom/file/moz.build
+++ b/dom/file/moz.build
@@ -60,3 +60,6 @@ XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell.toml"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/file/uri/moz.build b/dom/file/uri/moz.build
index a1c4aed54c4d3..ddcee685f58ad 100644
--- a/dom/file/uri/moz.build
+++ b/dom/file/uri/moz.build
@@ -32,3 +32,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/filesystem/compat/moz.build b/dom/filesystem/compat/moz.build
index 6757a73d9e6e1..d1718095a9d90 100644
--- a/dom/filesystem/compat/moz.build
+++ b/dom/filesystem/compat/moz.build
@@ -28,3 +28,6 @@ UNIFIED_SOURCES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/filesystem/compat/tests/moz.build b/dom/filesystem/compat/tests/moz.build
index 2f4100812868c..f4f8c9e2e7782 100644
--- a/dom/filesystem/compat/tests/moz.build
+++ b/dom/filesystem/compat/tests/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/filesystem/moz.build b/dom/filesystem/moz.build
index 8287f85777037..aff8de00ea2ab 100644
--- a/dom/filesystem/moz.build
+++ b/dom/filesystem/moz.build
@@ -48,3 +48,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 LOCAL_INCLUDES += [
     "/dom/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/filesystem/tests/moz.build b/dom/filesystem/tests/moz.build
index 2f4100812868c..f4f8c9e2e7782 100644
--- a/dom/filesystem/tests/moz.build
+++ b/dom/filesystem/tests/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/flex/moz.build b/dom/flex/moz.build
index 073fa269da1e7..71b43439bfb64 100644
--- a/dom/flex/moz.build
+++ b/dom/flex/moz.build
@@ -26,3 +26,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/api/moz.build b/dom/fs/api/moz.build
index 1b9a64996d565..fac8f3919bd15 100644
--- a/dom/fs/api/moz.build
+++ b/dom/fs/api/moz.build
@@ -36,3 +36,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/child/moz.build b/dom/fs/child/moz.build
index e52cb6b206fd3..56a14fdb6a05f 100644
--- a/dom/fs/child/moz.build
+++ b/dom/fs/child/moz.build
@@ -33,3 +33,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/moz.build b/dom/fs/moz.build
index 1a1ba49ab7046..dfe70fc1a014f 100644
--- a/dom/fs/moz.build
+++ b/dom/fs/moz.build
@@ -12,3 +12,6 @@ DIRS += [
 ]
 
 TEST_DIRS += ["test"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/parent/datamodel/moz.build b/dom/fs/parent/datamodel/moz.build
index 8bb5d35381e3b..3e4d3b17723a5 100644
--- a/dom/fs/parent/datamodel/moz.build
+++ b/dom/fs/parent/datamodel/moz.build
@@ -26,3 +26,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/parent/moz.build b/dom/fs/parent/moz.build
index 95298ad0f2d56..ae17cd90936f1 100644
--- a/dom/fs/parent/moz.build
+++ b/dom/fs/parent/moz.build
@@ -61,3 +61,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
         "!data_encoding_ffi_generated.h",
         "!mime_guess_ffi_generated.h",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/shared/moz.build b/dom/fs/shared/moz.build
index 1aaa2574aea8b..5e52226f248d8 100644
--- a/dom/fs/shared/moz.build
+++ b/dom/fs/shared/moz.build
@@ -32,3 +32,6 @@ IPDL_SOURCES += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/common/moz.build b/dom/fs/test/common/moz.build
index 65d62c9cda384..ec24b97c35b96 100644
--- a/dom/fs/test/common/moz.build
+++ b/dom/fs/test/common/moz.build
@@ -19,3 +19,6 @@ TESTING_JS_MODULES.dom.fs.test.common += [
     "test_syncAccessHandle.js",
     "test_writableFileStream.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/gtest/api/moz.build b/dom/fs/test/gtest/api/moz.build
index eb8416a3ba598..e14892d125c91 100644
--- a/dom/fs/test/gtest/api/moz.build
+++ b/dom/fs/test/gtest/api/moz.build
@@ -19,3 +19,6 @@ LOCAL_INCLUDES += [
     "/dom/fs/include",
     "/dom/fs/test/gtest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/gtest/child/moz.build b/dom/fs/test/gtest/child/moz.build
index c305ab1f2ec87..acac65dc26b18 100644
--- a/dom/fs/test/gtest/child/moz.build
+++ b/dom/fs/test/gtest/child/moz.build
@@ -18,3 +18,6 @@ LOCAL_INCLUDES += [
     "/dom/fs/include",
     "/dom/fs/test/gtest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/gtest/moz.build b/dom/fs/test/gtest/moz.build
index 81be2a3d33462..95ee749db2207 100644
--- a/dom/fs/test/gtest/moz.build
+++ b/dom/fs/test/gtest/moz.build
@@ -23,3 +23,6 @@ FINAL_LIBRARY = "xul-gtest"
 LOCAL_INCLUDES += [
     "/dom/fs/include",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/gtest/parent/datamodel/moz.build b/dom/fs/test/gtest/parent/datamodel/moz.build
index 6369aec649b98..33f5d6df9576d 100644
--- a/dom/fs/test/gtest/parent/datamodel/moz.build
+++ b/dom/fs/test/gtest/parent/datamodel/moz.build
@@ -20,3 +20,6 @@ LOCAL_INCLUDES += [
     "/dom/fs/test/gtest",
     "/dom/fs/test/gtest/parent",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/gtest/parent/moz.build b/dom/fs/test/gtest/parent/moz.build
index 9197c6ade2f76..daf4bcc615060 100644
--- a/dom/fs/test/gtest/parent/moz.build
+++ b/dom/fs/test/gtest/parent/moz.build
@@ -19,3 +19,6 @@ LOCAL_INCLUDES += [
     "/dom/fs/parent",
     "/dom/fs/test/gtest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/gtest/shared/moz.build b/dom/fs/test/gtest/shared/moz.build
index e8feae8c57da4..92e0d59297337 100644
--- a/dom/fs/test/gtest/shared/moz.build
+++ b/dom/fs/test/gtest/shared/moz.build
@@ -14,3 +14,6 @@ LOCAL_INCLUDES += [
     "/dom/fs/shared",
     "/dom/fs/test/gtest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/moz.build b/dom/fs/test/moz.build
index 5f4ac34fca5bc..4f1986f356868 100644
--- a/dom/fs/test/moz.build
+++ b/dom/fs/test/moz.build
@@ -14,3 +14,6 @@ MOCHITEST_MANIFESTS += [
     "mochitest/mochitest.toml",
     "mochitest/worker/mochitest.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/xpcshell/moz.build b/dom/fs/test/xpcshell/moz.build
index f18cc1c466630..8d629516980a3 100644
--- a/dom/fs/test/xpcshell/moz.build
+++ b/dom/fs/test/xpcshell/moz.build
@@ -11,3 +11,6 @@ TEST_DIRS += [
 XPCSHELL_TESTS_MANIFESTS += [
     "xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/fs/test/xpcshell/worker/moz.build b/dom/fs/test/xpcshell/worker/moz.build
index c0230d1927896..a5e7aaa94e4c1 100644
--- a/dom/fs/test/xpcshell/worker/moz.build
+++ b/dom/fs/test/xpcshell/worker/moz.build
@@ -11,3 +11,6 @@ TESTING_JS_MODULES.dom.fs.test.xpcshell.worker += [
     "test_syncAccessHandle_worker.js",
     "test_writableFileStream_worker.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/gamepad/moz.build b/dom/gamepad/moz.build
index db77ef8da68bf..d48dc8ed55ff7 100644
--- a/dom/gamepad/moz.build
+++ b/dom/gamepad/moz.build
@@ -77,3 +77,6 @@ LOCAL_INCLUDES += [
 
 CFLAGS += CONFIG["GLIB_CFLAGS"]
 CXXFLAGS += CONFIG["GLIB_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/geolocation/Geolocation.cpp b/dom/geolocation/Geolocation.cpp
index cb9107deb1acf..5034c066db8e1 100644
--- a/dom/geolocation/Geolocation.cpp
+++ b/dom/geolocation/Geolocation.cpp
@@ -23,6 +23,7 @@
 #include "nsComponentManagerUtils.h"
 #include "nsContentPermissionHelper.h"
 #include "nsContentUtils.h"
+#include "nsDocShell.h"
 #include "nsGlobalWindowInner.h"
 #include "mozilla/dom/Document.h"
 #include "nsINamed.h"
@@ -256,10 +257,8 @@ nsGeolocationRequest::Allow(JS::Handle<JS::Value> aChoices) {
     return NS_OK;
   }
 
-  RefPtr<nsGeolocationService> gs =
-      nsGeolocationService::GetGeolocationService();
-
-  bool canUseCache = false;
+  nsGeolocationService* gs = mLocator->GetGeolocationService();
+  bool canUseCache = gs != nsGeolocationService::sService.get();
   CachedPositionAndAccuracy lastPosition = gs->GetCachedPosition();
   if (lastPosition.position) {
     EpochTimeStamp cachedPositionTime_ms;
@@ -437,8 +436,7 @@ void nsGeolocationRequest::Shutdown() {
   // If there are no other high accuracy requests, the geolocation service will
   // notify the provider to switch to the default accuracy.
   if (mOptions && mOptions->mEnableHighAccuracy) {
-    RefPtr<nsGeolocationService> gs =
-        nsGeolocationService::GetGeolocationService();
+    nsGeolocationService* gs = mLocator ? mLocator->GetGeolocationService() : nullptr;
     if (gs) {
       gs->UpdateAccuracy();
     }
@@ -727,8 +725,14 @@ void nsGeolocationService::StopDevice() {
 StaticRefPtr<nsGeolocationService> nsGeolocationService::sService;
 
 already_AddRefed<nsGeolocationService>
-nsGeolocationService::GetGeolocationService() {
+nsGeolocationService::GetGeolocationService(nsDocShell* docShell) {
   RefPtr<nsGeolocationService> result;
+  if (docShell) {
+    result = docShell->GetGeolocationServiceOverride();
+    if (result)
+      return result.forget();
+  }
+
   if (nsGeolocationService::sService) {
     result = nsGeolocationService::sService;
 
@@ -820,7 +824,9 @@ nsresult Geolocation::Init(nsPIDOMWindowInner* aContentDom) {
   // If no aContentDom was passed into us, we are being used
   // by chrome/c++ and have no mOwner, no mPrincipal, and no need
   // to prompt.
-  mService = nsGeolocationService::GetGeolocationService();
+  nsCOMPtr<Document> doc = aContentDom ? aContentDom->GetDoc() : nullptr;
+  mService = nsGeolocationService::GetGeolocationService(
+      doc ? static_cast<nsDocShell*>(doc->GetDocShell()) : nullptr);
   if (mService) {
     mService->AddLocator(this);
   }
diff --git a/dom/geolocation/Geolocation.h b/dom/geolocation/Geolocation.h
index 7e1af00d05fba..e85af9718d064 100644
--- a/dom/geolocation/Geolocation.h
+++ b/dom/geolocation/Geolocation.h
@@ -31,6 +31,7 @@
 
 #include "nsIGeolocationProvider.h"
 #include "mozilla/Attributes.h"
+#include "nsDocShell.h"
 
 class nsGeolocationService;
 class nsGeolocationRequest;
@@ -48,13 +49,14 @@ struct CachedPositionAndAccuracy {
   bool isHighAccuracy;
 };
 
+
 /**
  * Singleton that manages the geolocation provider
  */
 class nsGeolocationService final : public nsIGeolocationUpdate,
                                    public nsIObserver {
  public:
-  static already_AddRefed<nsGeolocationService> GetGeolocationService();
+  static already_AddRefed<nsGeolocationService> GetGeolocationService(nsDocShell* docShell = nullptr);
   static mozilla::StaticRefPtr<nsGeolocationService> sService;
 
   NS_DECL_THREADSAFE_ISUPPORTS
@@ -179,6 +181,8 @@ class Geolocation final : public nsIGeolocationUpdate, public nsWrapperCache {
   // null.
   static already_AddRefed<Geolocation> NonWindowSingleton();
 
+  nsGeolocationService* GetGeolocationService() { return mService; };
+
  private:
   ~Geolocation();
 
diff --git a/dom/geolocation/moz.build b/dom/geolocation/moz.build
index 2d6b6b5fab92b..1f8053ec127e0 100644
--- a/dom/geolocation/moz.build
+++ b/dom/geolocation/moz.build
@@ -58,3 +58,6 @@ elif CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     if CONFIG["MOZ_ENABLE_DBUS"]:
         LOCAL_INCLUDES += ["/dom/system/linux"]
         CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/grid/moz.build b/dom/grid/moz.build
index d90a421317795..ccad7701c2862 100644
--- a/dom/grid/moz.build
+++ b/dom/grid/moz.build
@@ -34,3 +34,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/html/HTMLInputElement.cpp b/dom/html/HTMLInputElement.cpp
index ae2c4af82c382..92ea48eba6fb5 100644
--- a/dom/html/HTMLInputElement.cpp
+++ b/dom/html/HTMLInputElement.cpp
@@ -58,6 +58,7 @@
 #include "mozilla/dom/Document.h"
 #include "mozilla/dom/HTMLDataListElement.h"
 #include "mozilla/dom/HTMLOptionElement.h"
+#include "nsDocShell.h"
 #include "nsIFormControlFrame.h"
 #include "nsITextControlFrame.h"
 #include "nsIFrame.h"
@@ -784,6 +785,12 @@ nsresult HTMLInputElement::InitFilePicker(FilePickerType aType) {
     return NS_ERROR_FAILURE;
   }
 
+  nsDocShell* docShell = static_cast<nsDocShell*>(win->GetDocShell());
+  if (docShell && docShell->IsFileInputInterceptionEnabled()) {
+    docShell->FilePickerShown(this);
+    return NS_OK;
+  }
+
   if (IsPopupBlocked(doc)) {
     return NS_OK;
   }
diff --git a/dom/html/input/moz.build b/dom/html/input/moz.build
index fa468f11e7c57..a0f17a135a098 100644
--- a/dom/html/input/moz.build
+++ b/dom/html/input/moz.build
@@ -34,3 +34,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/html/moz.build b/dom/html/moz.build
index f3fdd30917110..5fc662afb976a 100644
--- a/dom/html/moz.build
+++ b/dom/html/moz.build
@@ -245,3 +245,6 @@ FINAL_LIBRARY = "xul"
 
 if CONFIG["MOZ_ANDROID_HLS_SUPPORT"]:
     DEFINES["MOZ_ANDROID_HLS_SUPPORT"] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/imptests/moz.build b/dom/imptests/moz.build
index a4a7a817e2a32..faf1eb5c2738d 100644
--- a/dom/imptests/moz.build
+++ b/dom/imptests/moz.build
@@ -14,3 +14,6 @@ TEST_HARNESS_FILES.testing.mochitest.resources += [
     'testharnessreport.js',
     'WebIDLParser.js',
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/indexedDB/moz.build b/dom/indexedDB/moz.build
index 1dbd0aedd9265..aa5b85a6b9886 100644
--- a/dom/indexedDB/moz.build
+++ b/dom/indexedDB/moz.build
@@ -119,3 +119,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_indexeddb"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/indexedDB/test/gtest/moz.build b/dom/indexedDB/test/gtest/moz.build
index 2005a813f3924..001fd6db05dcc 100644
--- a/dom/indexedDB/test/gtest/moz.build
+++ b/dom/indexedDB/test/gtest/moz.build
@@ -21,3 +21,6 @@ FINAL_LIBRARY = "xul-gtest"
 LOCAL_INCLUDES += [
     "/dom/indexedDB",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/base/moz.build b/dom/interfaces/base/moz.build
index d9b9dc0d77c77..f640929ae04f2 100644
--- a/dom/interfaces/base/moz.build
+++ b/dom/interfaces/base/moz.build
@@ -30,3 +30,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_base"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/base/nsIDOMWindowUtils.idl b/dom/interfaces/base/nsIDOMWindowUtils.idl
index 564b24e3f89e0..e4264b251e580 100644
--- a/dom/interfaces/base/nsIDOMWindowUtils.idl
+++ b/dom/interfaces/base/nsIDOMWindowUtils.idl
@@ -373,6 +373,26 @@ interface nsIDOMWindowUtils : nsISupports {
                          [optional] in long aButtons,
                          [optional] in unsigned long aIdentifier);
 
+  /**
+   * Playwright: a separate method to dispatch mouse event with a
+   * specific `jugglerEventId`.
+   */
+  [can_run_script]
+  unsigned long jugglerSendMouseEvent(in AString aType,
+                         in float aX,
+                         in float aY,
+                         in long aButton,
+                         in long aClickCount,
+                         in long aModifiers,
+                         in boolean aIgnoreRootScrollFrame,
+                         in float aPressure,
+                         in unsigned short aInputSourceArg,
+                         in boolean aIsDOMEventSynthesized,
+                         in boolean aIsWidgetEventSynthesized,
+                         in long aButtons,
+                         in unsigned long aIdentifier,
+                         in boolean aDisablePointerEvent);
+
   /** Synthesize a touch event. The event types supported are:
    *    touchstart, touchend, touchmove, and touchcancel
    *
diff --git a/dom/interfaces/events/moz.build b/dom/interfaces/events/moz.build
index 8d0d35b064a81..8143805da27da 100644
--- a/dom/interfaces/events/moz.build
+++ b/dom/interfaces/events/moz.build
@@ -12,3 +12,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_events"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/geolocation/moz.build b/dom/interfaces/geolocation/moz.build
index 22917ef311db6..8095b3f382c70 100644
--- a/dom/interfaces/geolocation/moz.build
+++ b/dom/interfaces/geolocation/moz.build
@@ -15,3 +15,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_geolocation"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/html/moz.build b/dom/interfaces/html/moz.build
index 516bce30e203f..18c31c14f310a 100644
--- a/dom/interfaces/html/moz.build
+++ b/dom/interfaces/html/moz.build
@@ -13,3 +13,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_html"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/notification/moz.build b/dom/interfaces/notification/moz.build
index dba68fb0929ad..ec623642a7393 100644
--- a/dom/interfaces/notification/moz.build
+++ b/dom/interfaces/notification/moz.build
@@ -12,3 +12,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_notification"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/payments/moz.build b/dom/interfaces/payments/moz.build
index f7e1229a82c82..1719614a29d1d 100644
--- a/dom/interfaces/payments/moz.build
+++ b/dom/interfaces/payments/moz.build
@@ -13,3 +13,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_payments"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/push/moz.build b/dom/interfaces/push/moz.build
index 4fbeff1b057df..20abf5ce10d3a 100644
--- a/dom/interfaces/push/moz.build
+++ b/dom/interfaces/push/moz.build
@@ -14,3 +14,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_push"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/security/moz.build b/dom/interfaces/security/moz.build
index e58715b360fdf..acf5289f7cfb7 100644
--- a/dom/interfaces/security/moz.build
+++ b/dom/interfaces/security/moz.build
@@ -14,3 +14,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_security"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/sidebar/moz.build b/dom/interfaces/sidebar/moz.build
index 4bcfea139f579..3ca8d2b512c7f 100644
--- a/dom/interfaces/sidebar/moz.build
+++ b/dom/interfaces/sidebar/moz.build
@@ -12,3 +12,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_sidebar"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/storage/moz.build b/dom/interfaces/storage/moz.build
index be637fadffd0f..32594c6d451f6 100644
--- a/dom/interfaces/storage/moz.build
+++ b/dom/interfaces/storage/moz.build
@@ -13,3 +13,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_storage"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/interfaces/xul/moz.build b/dom/interfaces/xul/moz.build
index 5c7b5d3a9d244..34575abbac3ad 100644
--- a/dom/interfaces/xul/moz.build
+++ b/dom/interfaces/xul/moz.build
@@ -21,3 +21,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/ipc-fuzzer/IPCFuzzer.cpp b/dom/ipc-fuzzer/IPCFuzzer.cpp
new file mode 100644
index 0000000000000..7d622f3dc9992
--- /dev/null
+++ b/dom/ipc-fuzzer/IPCFuzzer.cpp
@@ -0,0 +1,79 @@
+#include "mozilla/dom/IPCFuzzer.h"
+#include "mozilla/dom/IPCFuzzerBinding.h"
+#include "mozilla/ipc/IPCFuzzerCore.h"
+#include <cstdint>
+
+namespace mozilla::dom {
+
+JSObject* IPCFuzzer::WrapObject(JSContext* aCx,
+                                JS::Handle<JSObject*> aGivenProto) {
+  return IPCFuzzer_Binding::Wrap(aCx, this, aGivenProto);
+}
+
+NS_IMPL_CYCLE_COLLECTION_WRAPPERCACHE_0(IPCFuzzer)
+NS_IMPL_CYCLE_COLLECTING_ADDREF(IPCFuzzer)
+NS_IMPL_CYCLE_COLLECTING_RELEASE(IPCFuzzer)
+NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION(IPCFuzzer)
+  NS_WRAPPERCACHE_INTERFACE_MAP_ENTRY
+  NS_INTERFACE_MAP_ENTRY(nsISupports)
+NS_INTERFACE_MAP_END
+
+void IPCFuzzer::Mutate_url(const GlobalObject& aGlobal,
+                           const ::nsAString& url) {
+  NS_ConvertUTF16toUTF8 utf8Str(url);
+  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation(
+      new ::mozilla::ipc::Mutation(mozilla::ipc::Mutation::TARGET::URL,
+                                   mozilla::ipc::Mutation::KIND::REPLACE_WHOLE,
+                                   utf8Str));
+  mozilla::ipc::IPCFuzzerCore::getInstance().enqueue_mutation(
+      std::move(mutation));
+}
+
+void IPCFuzzer::Mutate_origin(const GlobalObject& aGlobal,
+                              const ::nsAString& origin, bool systemPrincipal) {
+  NS_ConvertUTF16toUTF8 utf8Str(origin);
+  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation(
+      new ::mozilla::ipc::Mutation(mozilla::ipc::Mutation::TARGET::ORIGIN,
+                                   mozilla::ipc::Mutation::KIND::REPLACE_WHOLE,
+                                   utf8Str, systemPrincipal));
+  mozilla::ipc::IPCFuzzerCore::getInstance().enqueue_mutation(
+      std::move(mutation));
+}
+
+void IPCFuzzer::Mutate_url_replace_host(const GlobalObject& aGlobal,
+                                        const ::nsAString& host) {
+  NS_ConvertUTF16toUTF8 utf8Str(host);
+  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation(
+      new ::mozilla::ipc::Mutation(mozilla::ipc::Mutation::TARGET::URL,
+                                   mozilla::ipc::Mutation::KIND::REPLACE_HOST,
+                                   utf8Str));
+  mozilla::ipc::IPCFuzzerCore::getInstance().enqueue_mutation(
+      std::move(mutation));
+}
+
+void IPCFuzzer::Mutate_origin_replace_host(const GlobalObject& aGlobal,
+                                           const ::nsAString& host) {
+  NS_ConvertUTF16toUTF8 utf8Str(host);
+  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation(
+      new ::mozilla::ipc::Mutation(mozilla::ipc::Mutation::TARGET::ORIGIN,
+                                   mozilla::ipc::Mutation::KIND::REPLACE_HOST,
+                                   utf8Str));
+  mozilla::ipc::IPCFuzzerCore::getInstance().enqueue_mutation(
+      std::move(mutation));
+}
+
+bool IPCFuzzer::Check_isolation(const GlobalObject& aGlobal,
+                                const ::nsAString& url) {
+  NS_ConvertUTF16toUTF8 utf8Str(url);
+  return mozilla::ipc::IPCFuzzerCore::getInstance().check_isolation(utf8Str);
+}
+
+void IPCFuzzer::Deactivate_renderer_checks(const GlobalObject& aGlobal, uint64_t flag) {
+  mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks(flag);
+}
+
+void IPCFuzzer::Activate_leak_sanitizer(const GlobalObject& aGlobal) {
+  mozilla::ipc::IPCFuzzerCore::getInstance().activate_leak_sanitizer();
+}
+
+}  // namespace mozilla::dom
\ No newline at end of file
diff --git a/dom/ipc-fuzzer/IPCFuzzer.h b/dom/ipc-fuzzer/IPCFuzzer.h
new file mode 100644
index 0000000000000..a0c2257a3cee4
--- /dev/null
+++ b/dom/ipc-fuzzer/IPCFuzzer.h
@@ -0,0 +1,45 @@
+#ifndef mozilla_dom_IPCFuzzer_h
+#define mozilla_dom_IPCFuzzer_h
+
+#include <sys/types.h>
+#include <cstdint>
+#include "nsWrapperCache.h"
+#include "mozilla/ipc/IPCFuzzer.h"
+
+#include "js/TypeDecls.h"
+#include "mozilla/Attributes.h"
+#include "mozilla/dom/BindingDeclarations.h"
+#include "nsCycleCollectionParticipant.h"
+
+namespace mozilla::dom {
+class IPCFuzzer final : public nsISupports, public nsWrapperCache {
+ public:
+  IPCFuzzer() {}
+
+  nsIGlobalObject* GetParentObject() const { return nullptr; }
+
+  JSObject* WrapObject(JSContext* aCx,
+                       JS::Handle<JSObject*> aGivenProto) override;
+
+  NS_DECL_CYCLE_COLLECTING_ISUPPORTS
+  NS_DECL_CYCLE_COLLECTION_WRAPPERCACHE_CLASS(IPCFuzzer)
+
+  // JS API methods to enqueue mutations
+  static void Mutate_url(const GlobalObject& aGlobal, const ::nsAString& url);
+  static void Mutate_origin(const GlobalObject& aGlobal,
+                            const ::nsAString& origin, bool systemPricipal);
+  static void Mutate_url_replace_host(const GlobalObject& aGlobal,
+                                      const ::nsAString& host);
+  static void Mutate_origin_replace_host(const GlobalObject& aGlobal,
+                                         const ::nsAString& host);
+  static bool Check_isolation(const GlobalObject& aGlobal,
+                              const ::nsAString& url);
+  static void Deactivate_renderer_checks(const GlobalObject& aGlobal, uint64_t flag);
+  static void Activate_leak_sanitizer(const GlobalObject& aGlobal);
+
+ protected:
+  ~IPCFuzzer() {}
+};
+}  // namespace mozilla::dom
+
+#endif  // mozilla_dom_IPCFuzzer_h
\ No newline at end of file
diff --git a/dom/ipc-fuzzer/moz.build b/dom/ipc-fuzzer/moz.build
new file mode 100644
index 0000000000000..dd854e0a4ca3f
--- /dev/null
+++ b/dom/ipc-fuzzer/moz.build
@@ -0,0 +1,33 @@
+# -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
+# vim: set filetype=python:
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this
+# file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+with Files("**"):
+    BUG_COMPONENT = ("Core", "IPC Fuzzer")
+
+
+EXPORTS.mozilla.dom += [
+    "IPCFuzzer.h",
+]
+
+UNIFIED_SOURCES += [
+    "IPCFuzzer.cpp",
+]
+
+
+include("/ipc/chromium/chromium-config.mozbuild")
+
+FINAL_LIBRARY = "xul"
+
+
+LOCAL_INCLUDES += [
+    "/dom/base",
+    "/ipc/fuzzer",
+]
+
+
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/ipc/BrowserChild.cpp b/dom/ipc/BrowserChild.cpp
index 830ad8579a39d..b840b68c9b554 100644
--- a/dom/ipc/BrowserChild.cpp
+++ b/dom/ipc/BrowserChild.cpp
@@ -1651,6 +1651,21 @@ void BrowserChild::HandleRealMouseButtonEvent(const WidgetMouseEvent& aEvent,
   if (postLayerization) {
     postLayerization->Register();
   }
+
+  // Playwright: notify content that mouse event has been received and handled.
+  nsCOMPtr<nsIObserverService> observerService =
+      mozilla::services::GetObserverService();
+  if (observerService && aEvent.mJugglerEventId) {
+    if (aEvent.mMessage == eMouseUp) {
+      observerService->NotifyObservers(nullptr, "juggler-mouse-event-hit-renderer", NS_ConvertASCIItoUTF16(nsPrintfCString("mouseup %" PRIu32, aEvent.mJugglerEventId)).get());
+    } else if (aEvent.mMessage == eMouseDown) {
+      observerService->NotifyObservers(nullptr, "juggler-mouse-event-hit-renderer", NS_ConvertASCIItoUTF16(nsPrintfCString("mousedown %" PRIu32, aEvent.mJugglerEventId)).get());
+    } else if (aEvent.mMessage == eMouseMove) {
+      observerService->NotifyObservers(nullptr, "juggler-mouse-event-hit-renderer", NS_ConvertASCIItoUTF16(nsPrintfCString("mousemove %" PRIu32, aEvent.mJugglerEventId)).get());
+    } else if (aEvent.mMessage == eContextMenu) {
+      observerService->NotifyObservers(nullptr, "juggler-mouse-event-hit-renderer", NS_ConvertASCIItoUTF16(nsPrintfCString("contextmenu %" PRIu32, aEvent.mJugglerEventId)).get());
+    }
+  }
 }
 
 mozilla::ipc::IPCResult BrowserChild::RecvNormalPriorityRealMouseButtonEvent(
diff --git a/dom/ipc/CoalescedMouseData.cpp b/dom/ipc/CoalescedMouseData.cpp
index 5aa445d2e0a61..671f71979b407 100644
--- a/dom/ipc/CoalescedMouseData.cpp
+++ b/dom/ipc/CoalescedMouseData.cpp
@@ -67,6 +67,9 @@ bool CoalescedMouseData::CanCoalesce(const WidgetMouseEvent& aEvent,
           mCoalescedInputEvent->pointerId == aEvent.pointerId &&
           mCoalescedInputEvent->mButton == aEvent.mButton &&
           mCoalescedInputEvent->mButtons == aEvent.mButtons && mGuid == aGuid &&
+          // `mJugglerEventId` is 0 for non-juggler events and a unique number for
+          // juggler-emitted events.
+          mCoalescedInputEvent->mJugglerEventId == aEvent.mJugglerEventId &&
           mInputBlockId == aInputBlockId);
 }
 
diff --git a/dom/ipc/WindowGlobalChild.cpp b/dom/ipc/WindowGlobalChild.cpp
index 62dffe7549a39..0328fc3069aeb 100644
--- a/dom/ipc/WindowGlobalChild.cpp
+++ b/dom/ipc/WindowGlobalChild.cpp
@@ -44,6 +44,8 @@
 #include "nsIURIMutator.h"
 #include "nsURLHelper.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
 using namespace mozilla::ipc;
 using namespace mozilla::dom::ipc;
 
@@ -681,6 +683,11 @@ void WindowGlobalChild::ActorDestroy(ActorDestroyReason aWhy) {
 
 bool WindowGlobalChild::IsSameOriginWith(
     const dom::WindowContext* aOther) const {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x8){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE WindowGlobalChild::IsSameOriginWith"));
+    return true;
+  }
   if (aOther == WindowContext()) {
     return true;
   }
@@ -707,6 +714,11 @@ bool WindowGlobalChild::SameOriginWithTop() {
 // Bug 1810619: Crash at null in nsDocShell::ValidateOrigin
 bool WindowGlobalChild::CanNavigate(dom::BrowsingContext* aTarget,
                                     bool aConsiderOpener) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x10){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE WindowGlobalChild::CanNavigate"));
+    return true;
+  }
   MOZ_DIAGNOSTIC_ASSERT(WindowContext()->Group() == aTarget->Group(),
                         "A WindowGlobalChild should never try to navigate a "
                         "BrowsingContext from another group");
diff --git a/dom/ipc/gtest/moz.build b/dom/ipc/gtest/moz.build
index c064a751ef798..b61feab089e42 100644
--- a/dom/ipc/gtest/moz.build
+++ b/dom/ipc/gtest/moz.build
@@ -11,3 +11,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/ipc/jsactor/moz.build b/dom/ipc/jsactor/moz.build
index 6bc66df923a8b..7b32c4504fad9 100644
--- a/dom/ipc/jsactor/moz.build
+++ b/dom/ipc/jsactor/moz.build
@@ -40,3 +40,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/ipc/moz.build b/dom/ipc/moz.build
index 68f82f5a38358..53c30bc711991 100644
--- a/dom/ipc/moz.build
+++ b/dom/ipc/moz.build
@@ -274,3 +274,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/jsurl/moz.build b/dom/jsurl/moz.build
index 188d097326f77..0ee759014c551 100644
--- a/dom/jsurl/moz.build
+++ b/dom/jsurl/moz.build
@@ -25,3 +25,6 @@ FINAL_LIBRARY = "xul"
 include("/ipc/chromium/chromium-config.mozbuild")
 
 MOCHITEST_MANIFESTS += ["test/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/l10n/moz.build b/dom/l10n/moz.build
index 83f75faf0b6da..8cf8a611fee42 100644
--- a/dom/l10n/moz.build
+++ b/dom/l10n/moz.build
@@ -34,3 +34,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/mochitest/browser.toml"]
 
 if CONFIG["ENABLE_TESTS"]:
     DIRS += ["tests/gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/l10n/tests/gtest/moz.build b/dom/l10n/tests/gtest/moz.build
index 0e1e2173a6160..9c95cb244d10d 100644
--- a/dom/l10n/tests/gtest/moz.build
+++ b/dom/l10n/tests/gtest/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/locales/moz.build b/dom/locales/moz.build
index bf89d214f3984..74cfbe43eedc8 100644
--- a/dom/locales/moz.build
+++ b/dom/locales/moz.build
@@ -60,3 +60,6 @@ RESOURCE_FILES.locale.layout += [
 RESOURCE_FILES.locale.dom += [
     "en-US/chrome/dom/dom.properties",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/localstorage/moz.build b/dom/localstorage/moz.build
index ef6e4494947fb..b32fecf65e6d4 100644
--- a/dom/localstorage/moz.build
+++ b/dom/localstorage/moz.build
@@ -73,3 +73,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/dom/file/ipc",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/localstorage/test/gtest/moz.build b/dom/localstorage/test/gtest/moz.build
index f9d3c7bb0b2dc..576c2ddfca795 100644
--- a/dom/localstorage/test/gtest/moz.build
+++ b/dom/localstorage/test/gtest/moz.build
@@ -15,3 +15,6 @@ FINAL_LIBRARY = "xul-gtest"
 LOCAL_INCLUDES += [
     "/dom/localstorage",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/locks/moz.build b/dom/locks/moz.build
index f6302e99e201c..ddc4295be63d5 100644
--- a/dom/locks/moz.build
+++ b/dom/locks/moz.build
@@ -39,3 +39,6 @@ IPDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/manifest/moz.build b/dom/manifest/moz.build
index 9f25d2273d98d..6652d45b78dba 100644
--- a/dom/manifest/moz.build
+++ b/dom/manifest/moz.build
@@ -19,3 +19,6 @@ EXTRA_JS_MODULES += [
 
 MOCHITEST_MANIFESTS += ["test/mochitest.toml"]
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/mathml/moz.build b/dom/mathml/moz.build
index e8b9fd61bb8a2..e0b5ddd5667ac 100644
--- a/dom/mathml/moz.build
+++ b/dom/mathml/moz.build
@@ -24,3 +24,6 @@ LOCAL_INCLUDES += [
 ]
 
 MOCHITEST_MANIFESTS += ["tests/mochitest/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/autoplay/moz.build b/dom/media/autoplay/moz.build
index 46412217b220a..8f3eb2a85d7b8 100644
--- a/dom/media/autoplay/moz.build
+++ b/dom/media/autoplay/moz.build
@@ -30,3 +30,6 @@ BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/bridge/moz.build b/dom/media/bridge/moz.build
index 969953ef2f1d5..9e7d4e175293e 100644
--- a/dom/media/bridge/moz.build
+++ b/dom/media/bridge/moz.build
@@ -34,3 +34,6 @@ if CONFIG["MOZ_WEBRTC"]:
     ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/doctor/moz.build b/dom/media/doctor/moz.build
index 5eeaa62409faf..25002a3fe98fd 100644
--- a/dom/media/doctor/moz.build
+++ b/dom/media/doctor/moz.build
@@ -38,3 +38,6 @@ UNIFIED_SOURCES += [
 BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/doctor/test/gtest/moz.build b/dom/media/doctor/test/gtest/moz.build
index 7ae9eae13056f..e289c3b0d6ceb 100644
--- a/dom/media/doctor/test/gtest/moz.build
+++ b/dom/media/doctor/test/gtest/moz.build
@@ -17,3 +17,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/driftcontrol/gtest/moz.build b/dom/media/driftcontrol/gtest/moz.build
index d64576084132f..12f3fda700a78 100644
--- a/dom/media/driftcontrol/gtest/moz.build
+++ b/dom/media/driftcontrol/gtest/moz.build
@@ -19,3 +19,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/driftcontrol/moz.build b/dom/media/driftcontrol/moz.build
index f7e8e19f2be53..d3581e26a1030 100644
--- a/dom/media/driftcontrol/moz.build
+++ b/dom/media/driftcontrol/moz.build
@@ -28,3 +28,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/eme/clearkey/gtest/moz.build b/dom/media/eme/clearkey/gtest/moz.build
index 5771c4724cbb1..cc705e0593e83 100644
--- a/dom/media/eme/clearkey/gtest/moz.build
+++ b/dom/media/eme/clearkey/gtest/moz.build
@@ -13,3 +13,6 @@ FINAL_LIBRARY = "xul-gtest"
 LOCAL_INCLUDES += [
     "..",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/eme/clearkey/moz.build b/dom/media/eme/clearkey/moz.build
index 57160624ea59e..838f317a3f62d 100644
--- a/dom/media/eme/clearkey/moz.build
+++ b/dom/media/eme/clearkey/moz.build
@@ -35,3 +35,6 @@ USE_LIBS += [
 ]
 
 Library("gecko-clearkey")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/eme/mediadrm/moz.build b/dom/media/eme/mediadrm/moz.build
index c8f433f25f60f..b70299646f5bf 100644
--- a/dom/media/eme/mediadrm/moz.build
+++ b/dom/media/eme/mediadrm/moz.build
@@ -17,3 +17,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/eme/mediafoundation/moz.build b/dom/media/eme/mediafoundation/moz.build
index 8c54b381ff097..e53abcccc7a79 100644
--- a/dom/media/eme/mediafoundation/moz.build
+++ b/dom/media/eme/mediafoundation/moz.build
@@ -19,3 +19,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/eme/moz.build b/dom/media/eme/moz.build
index 9965e85ae450b..f4d94386dd576 100644
--- a/dom/media/eme/moz.build
+++ b/dom/media/eme/moz.build
@@ -54,3 +54,6 @@ DIRS += ["clearkey"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/encoder/moz.build b/dom/media/encoder/moz.build
index f995ecdc1cd1e..ecd3a1b2187aa 100644
--- a/dom/media/encoder/moz.build
+++ b/dom/media/encoder/moz.build
@@ -40,3 +40,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 #    defined, which complains about an important MOZ_EXPORT for android::AString
 if CONFIG["CC_TYPE"] in ("clang", "gcc"):
     CXXFLAGS += ["-Wno-error=attributes"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/fake-cdm/moz.build b/dom/media/fake-cdm/moz.build
index 6c7aafd9b4bbd..ce830ef4cf4de 100644
--- a/dom/media/fake-cdm/moz.build
+++ b/dom/media/fake-cdm/moz.build
@@ -31,3 +31,6 @@ NoVisibilityFlags()
 # Don't use STL wrappers; this isn't Gecko code
 DisableStlWrapping()
 NO_PGO = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/flac/moz.build b/dom/media/flac/moz.build
index 0e3c8eae61720..70b791af9b518 100644
--- a/dom/media/flac/moz.build
+++ b/dom/media/flac/moz.build
@@ -22,3 +22,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/fuzz/moz.build b/dom/media/fuzz/moz.build
index f672bbf93cf81..3435152dfa1e8 100644
--- a/dom/media/fuzz/moz.build
+++ b/dom/media/fuzz/moz.build
@@ -27,3 +27,6 @@ FINAL_LIBRARY = "xul-gtest"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/gmp-plugin-openh264/moz.build b/dom/media/gmp-plugin-openh264/moz.build
index e85a50673e445..5cb64b874505c 100644
--- a/dom/media/gmp-plugin-openh264/moz.build
+++ b/dom/media/gmp-plugin-openh264/moz.build
@@ -23,3 +23,6 @@ NoVisibilityFlags()
 # Don't use STL wrappers; this isn't Gecko code
 DisableStlWrapping()
 NO_PGO = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/gmp/moz.build b/dom/media/gmp/moz.build
index a2b1be5ed8928..173b7b178528c 100644
--- a/dom/media/gmp/moz.build
+++ b/dom/media/gmp/moz.build
@@ -147,3 +147,6 @@ LOCAL_INCLUDES += [
     "/xpcom/build",
     "/xpcom/threads",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/gmp/rlz/moz.build b/dom/media/gmp/rlz/moz.build
index 8e2d9ea5d1cf9..b52aad059dd94 100644
--- a/dom/media/gmp/rlz/moz.build
+++ b/dom/media/gmp/rlz/moz.build
@@ -32,3 +32,6 @@ if CONFIG['OS_TARGET'] == 'Darwin':
 LOCAL_INCLUDES += [
     '..',
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/gmp/widevine-adapter/moz.build b/dom/media/gmp/widevine-adapter/moz.build
index b1b75824076dc..5674bf0b4ad1a 100644
--- a/dom/media/gmp/widevine-adapter/moz.build
+++ b/dom/media/gmp/widevine-adapter/moz.build
@@ -19,3 +19,6 @@ LOCAL_INCLUDES += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/gtest/moz.build b/dom/media/gtest/moz.build
index 581be004ef189..db157cd791154 100644
--- a/dom/media/gtest/moz.build
+++ b/dom/media/gtest/moz.build
@@ -146,3 +146,6 @@ if CONFIG["CC_TYPE"] in ("clang", "clang-cl"):
         "-Wno-inconsistent-missing-override",
         "-Wno-unused-private-field",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/gtest/mp4_demuxer/moz.build b/dom/media/gtest/mp4_demuxer/moz.build
index dc0946b7a0161..6031d6d12119e 100644
--- a/dom/media/gtest/mp4_demuxer/moz.build
+++ b/dom/media/gtest/mp4_demuxer/moz.build
@@ -64,3 +64,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/hls/moz.build b/dom/media/hls/moz.build
index 8a6c176974c02..92ae08a5f404b 100644
--- a/dom/media/hls/moz.build
+++ b/dom/media/hls/moz.build
@@ -22,3 +22,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/imagecapture/moz.build b/dom/media/imagecapture/moz.build
index fdbc73430df06..206c085457c9a 100644
--- a/dom/media/imagecapture/moz.build
+++ b/dom/media/imagecapture/moz.build
@@ -14,3 +14,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/ipc/moz.build b/dom/media/ipc/moz.build
index a9440780ce6f8..53b1f86c3adf2 100644
--- a/dom/media/ipc/moz.build
+++ b/dom/media/ipc/moz.build
@@ -105,3 +105,6 @@ include("/tools/fuzzing/libfuzzer-config.mozbuild")
 
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/mediacapabilities/moz.build b/dom/media/mediacapabilities/moz.build
index bafd3de59c14b..ecd38be1d7569 100644
--- a/dom/media/mediacapabilities/moz.build
+++ b/dom/media/mediacapabilities/moz.build
@@ -30,3 +30,6 @@ IPDL_SOURCES += ["PBenchmarkStorage.ipdl"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/mediacontrol/moz.build b/dom/media/mediacontrol/moz.build
index 54b3c40a36f9c..9202e9db76e46 100644
--- a/dom/media/mediacontrol/moz.build
+++ b/dom/media/mediacontrol/moz.build
@@ -41,3 +41,6 @@ if CONFIG["ENABLE_TESTS"]:
     DIRS += ["tests/gtest"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/mediacontrol/tests/gtest/moz.build b/dom/media/mediacontrol/tests/gtest/moz.build
index 7043bfcd5e03a..cdb706c65258f 100644
--- a/dom/media/mediacontrol/tests/gtest/moz.build
+++ b/dom/media/mediacontrol/tests/gtest/moz.build
@@ -21,3 +21,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/mediasession/moz.build b/dom/media/mediasession/moz.build
index 805bf67971f7a..2e0e7b82f1290 100644
--- a/dom/media/mediasession/moz.build
+++ b/dom/media/mediasession/moz.build
@@ -22,3 +22,6 @@ CRASHTEST_MANIFESTS += ["test/crashtests/crashtests.list"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/mediasink/moz.build b/dom/media/mediasink/moz.build
index e04bf24a25c5e..ebb9c4b5d6d7d 100644
--- a/dom/media/mediasink/moz.build
+++ b/dom/media/mediasink/moz.build
@@ -24,3 +24,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/mediasource/gtest/moz.build b/dom/media/mediasource/gtest/moz.build
index 42ef6beb9b980..3dfcc0681a372 100644
--- a/dom/media/mediasource/gtest/moz.build
+++ b/dom/media/mediasource/gtest/moz.build
@@ -20,3 +20,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/mediasource/moz.build b/dom/media/mediasource/moz.build
index 1ab10c55d7ca6..595999616f710 100644
--- a/dom/media/mediasource/moz.build
+++ b/dom/media/mediasource/moz.build
@@ -43,3 +43,6 @@ TEST_DIRS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/moz.build b/dom/media/moz.build
index c78b794591181..22a197c3f6674 100644
--- a/dom/media/moz.build
+++ b/dom/media/moz.build
@@ -413,3 +413,6 @@ if CONFIG["CC_TYPE"] in ("clang", "gcc"):
 CXXFLAGS += ["-Werror=switch"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/mp3/moz.build b/dom/media/mp3/moz.build
index 70031cc2b4269..d70d5b240067a 100644
--- a/dom/media/mp3/moz.build
+++ b/dom/media/mp3/moz.build
@@ -20,3 +20,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/mp4/moz.build b/dom/media/mp4/moz.build
index 48fce2a040cb1..6934d316beb1e 100644
--- a/dom/media/mp4/moz.build
+++ b/dom/media/mp4/moz.build
@@ -43,3 +43,6 @@ CXXFLAGS += [
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/ogg/moz.build b/dom/media/ogg/moz.build
index 863686686a6c2..8a4e0305f589e 100644
--- a/dom/media/ogg/moz.build
+++ b/dom/media/ogg/moz.build
@@ -30,3 +30,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/agnostic/bytestreams/gtest/moz.build b/dom/media/platforms/agnostic/bytestreams/gtest/moz.build
index 5351becdaf531..5ed19c9ff518b 100644
--- a/dom/media/platforms/agnostic/bytestreams/gtest/moz.build
+++ b/dom/media/platforms/agnostic/bytestreams/gtest/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/agnostic/bytestreams/moz.build b/dom/media/platforms/agnostic/bytestreams/moz.build
index 0244a62d410dc..d67fac716c1db 100644
--- a/dom/media/platforms/agnostic/bytestreams/moz.build
+++ b/dom/media/platforms/agnostic/bytestreams/moz.build
@@ -36,3 +36,6 @@ FINAL_LIBRARY = "xul"
 CXXFLAGS += [
     "-Wno-sign-compare",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/agnostic/eme/moz.build b/dom/media/platforms/agnostic/eme/moz.build
index 34f0007b3bcc3..e9353f6ed4ac7 100644
--- a/dom/media/platforms/agnostic/eme/moz.build
+++ b/dom/media/platforms/agnostic/eme/moz.build
@@ -20,3 +20,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/agnostic/gmp/moz.build b/dom/media/platforms/agnostic/gmp/moz.build
index 8e49f4a0e8947..b1475338c7338 100644
--- a/dom/media/platforms/agnostic/gmp/moz.build
+++ b/dom/media/platforms/agnostic/gmp/moz.build
@@ -22,3 +22,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/ffmpeg/ffmpeg57/moz.build b/dom/media/platforms/ffmpeg/ffmpeg57/moz.build
index f26edcdc7f935..75de804855b75 100644
--- a/dom/media/platforms/ffmpeg/ffmpeg57/moz.build
+++ b/dom/media/platforms/ffmpeg/ffmpeg57/moz.build
@@ -35,3 +35,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/ffmpeg/ffmpeg58/moz.build b/dom/media/platforms/ffmpeg/ffmpeg58/moz.build
index a22bf98abda18..9bf41922b11e2 100644
--- a/dom/media/platforms/ffmpeg/ffmpeg58/moz.build
+++ b/dom/media/platforms/ffmpeg/ffmpeg58/moz.build
@@ -43,3 +43,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/ffmpeg/ffmpeg59/moz.build b/dom/media/platforms/ffmpeg/ffmpeg59/moz.build
index e0c6c10ecdcd1..11fddd9e052ea 100644
--- a/dom/media/platforms/ffmpeg/ffmpeg59/moz.build
+++ b/dom/media/platforms/ffmpeg/ffmpeg59/moz.build
@@ -43,3 +43,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/ffmpeg/ffmpeg60/moz.build b/dom/media/platforms/ffmpeg/ffmpeg60/moz.build
index e0c6c10ecdcd1..11fddd9e052ea 100644
--- a/dom/media/platforms/ffmpeg/ffmpeg60/moz.build
+++ b/dom/media/platforms/ffmpeg/ffmpeg60/moz.build
@@ -43,3 +43,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/ffmpeg/ffvpx/moz.build b/dom/media/platforms/ffmpeg/ffvpx/moz.build
index 97a224b08bcd9..8cbf5e61a44b9 100644
--- a/dom/media/platforms/ffmpeg/ffvpx/moz.build
+++ b/dom/media/platforms/ffmpeg/ffvpx/moz.build
@@ -54,3 +54,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/ffmpeg/libav53/moz.build b/dom/media/platforms/ffmpeg/libav53/moz.build
index 06b226e1f1014..14570e6972abe 100644
--- a/dom/media/platforms/ffmpeg/libav53/moz.build
+++ b/dom/media/platforms/ffmpeg/libav53/moz.build
@@ -27,3 +27,6 @@ if CONFIG['CC_TYPE'] == 'clang':
 LOCAL_INCLUDES += [
   "/media/libyuv/libyuv/include",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/ffmpeg/libav54/moz.build b/dom/media/platforms/ffmpeg/libav54/moz.build
index 06b226e1f1014..14570e6972abe 100644
--- a/dom/media/platforms/ffmpeg/libav54/moz.build
+++ b/dom/media/platforms/ffmpeg/libav54/moz.build
@@ -27,3 +27,6 @@ if CONFIG['CC_TYPE'] == 'clang':
 LOCAL_INCLUDES += [
   "/media/libyuv/libyuv/include",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/ffmpeg/libav55/moz.build b/dom/media/platforms/ffmpeg/libav55/moz.build
index af2d4f18319d8..867e5491ec719 100644
--- a/dom/media/platforms/ffmpeg/libav55/moz.build
+++ b/dom/media/platforms/ffmpeg/libav55/moz.build
@@ -33,3 +33,6 @@ FINAL_LIBRARY = 'xul'
 LOCAL_INCLUDES += [
   "/media/libyuv/libyuv/include",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/ffmpeg/moz.build b/dom/media/platforms/ffmpeg/moz.build
index f519b30cec45a..4f3a0c02c7569 100644
--- a/dom/media/platforms/ffmpeg/moz.build
+++ b/dom/media/platforms/ffmpeg/moz.build
@@ -30,3 +30,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/moz.build b/dom/media/platforms/moz.build
index 34acf4e8d15ef..ef3f182508c5d 100644
--- a/dom/media/platforms/moz.build
+++ b/dom/media/platforms/moz.build
@@ -134,3 +134,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/omx/moz.build b/dom/media/platforms/omx/moz.build
index c8a79cabb497a..b9c7eb2e716e1 100644
--- a/dom/media/platforms/omx/moz.build
+++ b/dom/media/platforms/omx/moz.build
@@ -34,3 +34,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/wmf/gtest/moz.build b/dom/media/platforms/wmf/gtest/moz.build
index ccd056ecf1cc1..1c36719c4b9cd 100644
--- a/dom/media/platforms/wmf/gtest/moz.build
+++ b/dom/media/platforms/wmf/gtest/moz.build
@@ -13,3 +13,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/platforms/wmf/moz.build b/dom/media/platforms/wmf/moz.build
index 9e0f3aa94a5d7..37de025d279f7 100644
--- a/dom/media/platforms/wmf/moz.build
+++ b/dom/media/platforms/wmf/moz.build
@@ -83,3 +83,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/systemservices/moz.build b/dom/media/systemservices/moz.build
index fa6566cf6b0db..8cd0ea65a9216 100644
--- a/dom/media/systemservices/moz.build
+++ b/dom/media/systemservices/moz.build
@@ -112,3 +112,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("android_video_capture/**"):
     SCHEDULES.exclusive = ["android"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/systemservices/video_engine/desktop_capture_impl.cc b/dom/media/systemservices/video_engine/desktop_capture_impl.cc
index a966ff06d4a52..eb6bb16413df4 100644
--- a/dom/media/systemservices/video_engine/desktop_capture_impl.cc
+++ b/dom/media/systemservices/video_engine/desktop_capture_impl.cc
@@ -135,11 +135,12 @@ int32_t ScreenDeviceInfoImpl::GetOrientation(const char* aDeviceUniqueIdUTF8,
   return 0;
 }
 
-VideoCaptureModule* DesktopCaptureImpl::Create(const int32_t aModuleId,
+VideoCaptureModuleEx* DesktopCaptureImpl::Create(const int32_t aModuleId,
                                                const char* aUniqueId,
-                                               const CaptureDeviceType aType) {
+                                               const CaptureDeviceType aType,
+                                               bool aCaptureCursor) {
   return new rtc::RefCountedObject<DesktopCaptureImpl>(aModuleId, aUniqueId,
-                                                       aType);
+                                                       aType, aCaptureCursor);
 }
 
 int32_t WindowDeviceInfoImpl::Init() {
@@ -412,7 +413,7 @@ static bool UsePipewire() {
 
 static std::unique_ptr<DesktopCapturer> CreateDesktopCapturerAndThread(
     CaptureDeviceType aDeviceType, DesktopCapturer::SourceId aSourceId,
-    nsIThread** aOutThread) {
+    nsIThread** aOutThread, bool aCaptureCursor) {
   DesktopCaptureOptions options = CreateDesktopCaptureOptions();
   std::unique_ptr<DesktopCapturer> capturer;
 
@@ -462,8 +463,10 @@ static std::unique_ptr<DesktopCapturer> CreateDesktopCapturerAndThread(
 
     capturer->SelectSource(aSourceId);
 
-    capturer = std::make_unique<DesktopAndCursorComposer>(std::move(capturer),
-                                                          options);
+    if (aCaptureCursor) {
+      capturer = std::make_unique<DesktopAndCursorComposer>(
+          std::move(capturer), options);
+    }
   } else if (aDeviceType == CaptureDeviceType::Browser) {
     // XXX We don't capture cursors, so avoid the extra indirection layer. We
     // could also pass null for the pMouseCursorMonitor.
@@ -480,7 +483,8 @@ static std::unique_ptr<DesktopCapturer> CreateDesktopCapturerAndThread(
 }
 
 DesktopCaptureImpl::DesktopCaptureImpl(const int32_t aId, const char* aUniqueId,
-                                       const CaptureDeviceType aType)
+                                       const CaptureDeviceType aType,
+                                       bool aCaptureCursor)
     : mModuleId(aId),
       mTrackingId(mozilla::TrackingId(CaptureEngineToTrackingSourceStr([&] {
                                         switch (aType) {
@@ -497,6 +501,7 @@ DesktopCaptureImpl::DesktopCaptureImpl(const int32_t aId, const char* aUniqueId,
                                       aId)),
       mDeviceUniqueId(aUniqueId),
       mDeviceType(aType),
+      capture_cursor_(aCaptureCursor),
       mControlThread(mozilla::GetCurrentSerialEventTarget()),
       mNextFrameMinimumTime(Timestamp::Zero()),
       mCallbacks("DesktopCaptureImpl::mCallbacks") {}
@@ -521,6 +526,19 @@ void DesktopCaptureImpl::DeRegisterCaptureDataCallback(
   }
 }
 
+void DesktopCaptureImpl::RegisterRawFrameCallback(RawFrameCallback* rawFrameCallback) {
+  rtc::CritScope lock(&mApiCs);
+  _rawFrameCallbacks.insert(rawFrameCallback);
+}
+
+void DesktopCaptureImpl::DeRegisterRawFrameCallback(RawFrameCallback* rawFrameCallback) {
+  rtc::CritScope lock(&mApiCs);
+  auto it = _rawFrameCallbacks.find(rawFrameCallback);
+  if (it != _rawFrameCallbacks.end()) {
+    _rawFrameCallbacks.erase(it);
+  }
+}
+
 int32_t DesktopCaptureImpl::StopCaptureIfAllClientsClose() {
   {
     auto callbacks = mCallbacks.Lock();
@@ -553,7 +571,7 @@ int32_t DesktopCaptureImpl::StartCapture(
 
   DesktopCapturer::SourceId sourceId = std::stoi(mDeviceUniqueId);
   std::unique_ptr capturer = CreateDesktopCapturerAndThread(
-      mDeviceType, sourceId, getter_AddRefs(mCaptureThread));
+      mDeviceType, sourceId, getter_AddRefs(mCaptureThread), capture_cursor_);
 
   MOZ_ASSERT(!capturer == !mCaptureThread);
   if (!capturer) {
@@ -654,6 +672,15 @@ void DesktopCaptureImpl::OnCaptureResult(DesktopCapturer::Result aResult,
   frameInfo.height = aFrame->size().height();
   frameInfo.videoType = VideoType::kARGB;
 
+  size_t videoFrameStride =
+      frameInfo.width * DesktopFrame::kBytesPerPixel;
+  {
+    rtc::CritScope cs(&mApiCs);
+    for (auto rawFrameCallback : _rawFrameCallbacks) {
+      rawFrameCallback->OnRawFrame(videoFrame, videoFrameStride, frameInfo);
+    }
+  }
+
   size_t videoFrameLength =
       frameInfo.width * frameInfo.height * DesktopFrame::kBytesPerPixel;
 
diff --git a/dom/media/systemservices/video_engine/desktop_capture_impl.h b/dom/media/systemservices/video_engine/desktop_capture_impl.h
index 7292f6c8a7029..7a50fee0d2fca 100644
--- a/dom/media/systemservices/video_engine/desktop_capture_impl.h
+++ b/dom/media/systemservices/video_engine/desktop_capture_impl.h
@@ -24,6 +24,7 @@
 #include "api/video/video_sink_interface.h"
 #include "modules/desktop_capture/desktop_capturer.h"
 #include "modules/video_capture/video_capture.h"
+#include "rtc_base/deprecated/recursive_critical_section.h"
 
 #include "desktop_device_info.h"
 #include "mozilla/DataMutex.h"
@@ -43,6 +44,21 @@ namespace webrtc {
 
 class VideoCaptureEncodeInterface;
 
+class RawFrameCallback {
+ public:
+  virtual ~RawFrameCallback() {}
+
+  virtual void OnRawFrame(uint8_t* videoFrame, size_t videoFrameLength, const VideoCaptureCapability& frameInfo) = 0;
+};
+
+class VideoCaptureModuleEx : public VideoCaptureModule {
+ public:
+  virtual ~VideoCaptureModuleEx() {}
+
+  virtual void RegisterRawFrameCallback(RawFrameCallback* rawFrameCallback) = 0;
+  virtual void DeRegisterRawFrameCallback(RawFrameCallback* rawFrameCallback) = 0;
+};
+
 // simulate deviceInfo interface for video engine, bridge screen/application and
 // real screen/application device info
 
@@ -158,13 +174,13 @@ class BrowserDeviceInfoImpl : public VideoCaptureModule::DeviceInfo {
 // As with video, DesktopCaptureImpl is a proxy for screen sharing
 // and follows the video pipeline design
 class DesktopCaptureImpl : public DesktopCapturer::Callback,
-                           public VideoCaptureModule {
+                           public VideoCaptureModuleEx {
  public:
   /* Create a screen capture modules object
    */
-  static VideoCaptureModule* Create(
+  static VideoCaptureModuleEx* Create(
       const int32_t aModuleId, const char* aUniqueId,
-      const mozilla::camera::CaptureDeviceType aType);
+      const mozilla::camera::CaptureDeviceType aType, bool aCaptureCursor = true);
 
   [[nodiscard]] static std::shared_ptr<VideoCaptureModule::DeviceInfo>
   CreateDeviceInfo(const int32_t aId,
@@ -178,6 +194,8 @@ class DesktopCaptureImpl : public DesktopCapturer::Callback,
   void DeRegisterCaptureDataCallback(
       rtc::VideoSinkInterface<VideoFrame>* aCallback) override;
   int32_t StopCaptureIfAllClientsClose() override;
+  void RegisterRawFrameCallback(RawFrameCallback* rawFrameCallback) override;
+  void DeRegisterRawFrameCallback(RawFrameCallback* rawFrameCallback) override;
 
   int32_t SetCaptureRotation(VideoRotation aRotation) override;
   bool SetApplyRotation(bool aEnable) override;
@@ -200,7 +218,8 @@ class DesktopCaptureImpl : public DesktopCapturer::Callback,
 
  protected:
   DesktopCaptureImpl(const int32_t aId, const char* aUniqueId,
-                     const mozilla::camera::CaptureDeviceType aType);
+                     const mozilla::camera::CaptureDeviceType aType,
+                     bool aCaptureCusor);
   virtual ~DesktopCaptureImpl();
 
  private:
@@ -208,6 +227,9 @@ class DesktopCaptureImpl : public DesktopCapturer::Callback,
   static constexpr uint32_t kMaxDesktopCaptureCpuUsage = 50;
   void InitOnThread(std::unique_ptr<DesktopCapturer> aCapturer, int aFramerate);
   void ShutdownOnThread();
+
+  rtc::RecursiveCriticalSection mApiCs;
+  std::set<RawFrameCallback*> _rawFrameCallbacks;
   // DesktopCapturer::Callback interface.
   void OnCaptureResult(DesktopCapturer::Result aResult,
                        std::unique_ptr<DesktopFrame> aFrame) override;
@@ -215,6 +237,8 @@ class DesktopCaptureImpl : public DesktopCapturer::Callback,
   // Notifies all mCallbacks of OnFrame(). mCaptureThread only.
   void NotifyOnFrame(const VideoFrame& aFrame);
 
+  bool capture_cursor_ = true;
+
   // Control thread on which the public API is called.
   const nsCOMPtr<nsISerialEventTarget> mControlThread;
   // Set in StartCapture.
diff --git a/dom/media/test/rdd_process_xpcom/moz.build b/dom/media/test/rdd_process_xpcom/moz.build
index 87dbb39bc17c2..efa546b0f6b08 100644
--- a/dom/media/test/rdd_process_xpcom/moz.build
+++ b/dom/media/test/rdd_process_xpcom/moz.build
@@ -19,3 +19,6 @@ XPIDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/utils/gtest/moz.build b/dom/media/utils/gtest/moz.build
index b046869f401a3..4f0019b152255 100644
--- a/dom/media/utils/gtest/moz.build
+++ b/dom/media/utils/gtest/moz.build
@@ -13,3 +13,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/utils/moz.build b/dom/media/utils/moz.build
index e503c29949141..ce68ecbe4a171 100644
--- a/dom/media/utils/moz.build
+++ b/dom/media/utils/moz.build
@@ -24,3 +24,6 @@ if CONFIG["ENABLE_TESTS"]:
     DIRS += ["gtest"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/wave/moz.build b/dom/media/wave/moz.build
index 04eeba1b774d4..c3cb33eb10411 100644
--- a/dom/media/wave/moz.build
+++ b/dom/media/wave/moz.build
@@ -18,3 +18,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webaudio/blink/moz.build b/dom/media/webaudio/blink/moz.build
index 5f00d01ed38ca..7711a52d8da45 100644
--- a/dom/media/webaudio/blink/moz.build
+++ b/dom/media/webaudio/blink/moz.build
@@ -34,3 +34,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/dom/media/webaudio",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webaudio/moz.build b/dom/media/webaudio/moz.build
index 2e82d3daa8b51..b24eae1cc6805 100644
--- a/dom/media/webaudio/moz.build
+++ b/dom/media/webaudio/moz.build
@@ -151,3 +151,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [".."]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webcodecs/moz.build b/dom/media/webcodecs/moz.build
index 58a9c1afcaec5..98f001aeadbb7 100644
--- a/dom/media/webcodecs/moz.build
+++ b/dom/media/webcodecs/moz.build
@@ -52,3 +52,6 @@ if CONFIG["MOZ_WAYLAND"]:
     CFLAGS += CONFIG["MOZ_WAYLAND_CFLAGS"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webm/moz.build b/dom/media/webm/moz.build
index f65fe5bc6b35e..7e61537616038 100644
--- a/dom/media/webm/moz.build
+++ b/dom/media/webm/moz.build
@@ -26,3 +26,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/common/moz.build b/dom/media/webrtc/common/moz.build
index 7605d27835ad2..3816bb42f9ae6 100644
--- a/dom/media/webrtc/common/moz.build
+++ b/dom/media/webrtc/common/moz.build
@@ -21,3 +21,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/jsapi/moz.build b/dom/media/webrtc/jsapi/moz.build
index 78a6241cd65e0..7340de6dc3a22 100644
--- a/dom/media/webrtc/jsapi/moz.build
+++ b/dom/media/webrtc/jsapi/moz.build
@@ -60,3 +60,6 @@ EXPORTS.mozilla.dom += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/jsep/moz.build b/dom/media/webrtc/jsep/moz.build
index 750ac76a30784..dc7ab80bf58ec 100644
--- a/dom/media/webrtc/jsep/moz.build
+++ b/dom/media/webrtc/jsep/moz.build
@@ -16,3 +16,6 @@ LOCAL_INCLUDES += [
 UNIFIED_SOURCES += ["JsepSessionImpl.cpp", "JsepTrack.cpp", "SsrcGenerator.cpp"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/libwebrtcglue/moz.build b/dom/media/webrtc/libwebrtcglue/moz.build
index 6f650e8da9ffd..a96f88f8a6489 100644
--- a/dom/media/webrtc/libwebrtcglue/moz.build
+++ b/dom/media/webrtc/libwebrtcglue/moz.build
@@ -35,3 +35,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/moz.build b/dom/media/webrtc/moz.build
index cb8e363faa0a2..b33651afbfc0e 100644
--- a/dom/media/webrtc/moz.build
+++ b/dom/media/webrtc/moz.build
@@ -130,3 +130,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/sdp/moz.build b/dom/media/webrtc/sdp/moz.build
index 675009acd07a1..fb3d2ca0e33cc 100644
--- a/dom/media/webrtc/sdp/moz.build
+++ b/dom/media/webrtc/sdp/moz.build
@@ -46,3 +46,6 @@ SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/tests/fuzztests/moz.build b/dom/media/webrtc/tests/fuzztests/moz.build
index fef388e6c90fe..a18ee224976b1 100644
--- a/dom/media/webrtc/tests/fuzztests/moz.build
+++ b/dom/media/webrtc/tests/fuzztests/moz.build
@@ -20,3 +20,6 @@ SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/transport/build/moz.build b/dom/media/webrtc/transport/build/moz.build
index 7349ee5d71b4a..11ca7ca067623 100644
--- a/dom/media/webrtc/transport/build/moz.build
+++ b/dom/media/webrtc/transport/build/moz.build
@@ -42,3 +42,6 @@ include("/tools/fuzzing/libfuzzer-config.mozbuild")
 SOURCES += transport_cppsrcs
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/transport/fuzztest/moz.build b/dom/media/webrtc/transport/fuzztest/moz.build
index f22a5a702bed2..5db3582b8e2fd 100644
--- a/dom/media/webrtc/transport/fuzztest/moz.build
+++ b/dom/media/webrtc/transport/fuzztest/moz.build
@@ -29,3 +29,6 @@ SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/transport/ipc/moz.build b/dom/media/webrtc/transport/ipc/moz.build
index a2a72bb624601..ed272edc7d2b1 100644
--- a/dom/media/webrtc/transport/ipc/moz.build
+++ b/dom/media/webrtc/transport/ipc/moz.build
@@ -52,3 +52,6 @@ LOCAL_INCLUDES += [
     "/netwerk/base",
     "/netwerk/protocol/http",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/transport/moz.build b/dom/media/webrtc/transport/moz.build
index fcf265e22f608..dfcb5c732cd0f 100644
--- a/dom/media/webrtc/transport/moz.build
+++ b/dom/media/webrtc/transport/moz.build
@@ -21,3 +21,6 @@ include("/tools/fuzzing/libfuzzer-config.mozbuild")
 
 if CONFIG["FUZZING_INTERFACES"]:
     TEST_DIRS += ["fuzztest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/transport/srtp/moz.build b/dom/media/webrtc/transport/srtp/moz.build
index d3d4971a6dab5..ebe318cc76813 100644
--- a/dom/media/webrtc/transport/srtp/moz.build
+++ b/dom/media/webrtc/transport/srtp/moz.build
@@ -6,3 +6,6 @@
 
 if CONFIG["MOZ_SRTP"]:
     DIRS += ["/third_party/libsrtp/src"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/transport/test/moz.build b/dom/media/webrtc/transport/test/moz.build
index a2b0bc2bc21af..67c039adbee54 100644
--- a/dom/media/webrtc/transport/test/moz.build
+++ b/dom/media/webrtc/transport/test/moz.build
@@ -101,3 +101,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/transport/third_party/moz.build b/dom/media/webrtc/transport/third_party/moz.build
index 852ce4ac4bb84..85d60d42fa533 100644
--- a/dom/media/webrtc/transport/third_party/moz.build
+++ b/dom/media/webrtc/transport/third_party/moz.build
@@ -37,3 +37,6 @@ if CONFIG["CC_TYPE"] == "gcc":
     if int(CONFIG["CC_VERSION"].split(".")[0]) >= 8:
         GYP_DIRS['nICEr'].sandbox_vars['CFLAGS'] += ['-Wno-stringop-truncation']
         GYP_DIRS['nrappkit'].sandbox_vars['CFLAGS'] += ['-Wno-stringop-truncation']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webrtc/transportbridge/moz.build b/dom/media/webrtc/transportbridge/moz.build
index 290dd26a0ae1a..95bddf1a898f8 100644
--- a/dom/media/webrtc/transportbridge/moz.build
+++ b/dom/media/webrtc/transportbridge/moz.build
@@ -25,3 +25,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webspeech/moz.build b/dom/media/webspeech/moz.build
index 26856a059881e..90a52b561821d 100644
--- a/dom/media/webspeech/moz.build
+++ b/dom/media/webspeech/moz.build
@@ -10,3 +10,6 @@ if CONFIG["MOZ_WEBSPEECH"]:
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "Web Speech")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webspeech/recognition/moz.build b/dom/media/webspeech/recognition/moz.build
index 89de4fcbbe0aa..efa8003d7ac38 100644
--- a/dom/media/webspeech/recognition/moz.build
+++ b/dom/media/webspeech/recognition/moz.build
@@ -62,3 +62,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webspeech/synth/android/moz.build b/dom/media/webspeech/synth/android/moz.build
index 348c157f3c479..a5448e3d5ffe5 100644
--- a/dom/media/webspeech/synth/android/moz.build
+++ b/dom/media/webspeech/synth/android/moz.build
@@ -17,3 +17,6 @@ XPCOM_MANIFESTS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webspeech/synth/cocoa/moz.build b/dom/media/webspeech/synth/cocoa/moz.build
index 4d59f7a389d3e..d59d2d94e557d 100644
--- a/dom/media/webspeech/synth/cocoa/moz.build
+++ b/dom/media/webspeech/synth/cocoa/moz.build
@@ -13,3 +13,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webspeech/synth/moz.build b/dom/media/webspeech/synth/moz.build
index 2cf19982b2c63..e929327be6e79 100644
--- a/dom/media/webspeech/synth/moz.build
+++ b/dom/media/webspeech/synth/moz.build
@@ -63,3 +63,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "ipc",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webspeech/synth/speechd/moz.build b/dom/media/webspeech/synth/speechd/moz.build
index 0d9632a488877..66d4178e132c2 100644
--- a/dom/media/webspeech/synth/speechd/moz.build
+++ b/dom/media/webspeech/synth/speechd/moz.build
@@ -13,3 +13,6 @@ XPCOM_MANIFESTS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webspeech/synth/windows/moz.build b/dom/media/webspeech/synth/windows/moz.build
index 90bafe9ca770b..564627f9456d0 100644
--- a/dom/media/webspeech/synth/windows/moz.build
+++ b/dom/media/webspeech/synth/windows/moz.build
@@ -15,3 +15,6 @@ XPCOM_MANIFESTS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/media/webvtt/moz.build b/dom/media/webvtt/moz.build
index c44f394c5f22c..35f39e3eb1a0d 100644
--- a/dom/media/webvtt/moz.build
+++ b/dom/media/webvtt/moz.build
@@ -50,3 +50,6 @@ REFTEST_MANIFESTS += ["test/reftest/reftest.list"]
 CRASHTEST_MANIFESTS += ["test/crashtests/crashtests.list"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/messagechannel/moz.build b/dom/messagechannel/moz.build
index d2726be851959..c6070e1955dc0 100644
--- a/dom/messagechannel/moz.build
+++ b/dom/messagechannel/moz.build
@@ -36,3 +36,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/messagechannel/tests/moz.build b/dom/messagechannel/tests/moz.build
index 5c3978f0753af..c17ee5ea6f770 100644
--- a/dom/messagechannel/tests/moz.build
+++ b/dom/messagechannel/tests/moz.build
@@ -8,3 +8,6 @@ MOCHITEST_MANIFESTS += ["mochitest.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["chrome.toml"]
 
 XPCSHELL_TESTS_MANIFESTS += ["unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/midi/midir_impl/moz.build b/dom/midi/midir_impl/moz.build
index f079022906f8f..ea9e66d8b4efb 100644
--- a/dom/midi/midir_impl/moz.build
+++ b/dom/midi/midir_impl/moz.build
@@ -15,3 +15,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     EXPORTS.mozilla.dom.midi += [
         "!midir_impl_ffi_generated.h",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/midi/moz.build b/dom/midi/moz.build
index 80ec11b68c5f5..c096e8b05fd5a 100644
--- a/dom/midi/moz.build
+++ b/dom/midi/moz.build
@@ -74,3 +74,6 @@ LOCAL_INCLUDES += [
 
 MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/moz.build b/dom/moz.build
index 5a3b2d26d3477..bf81eba314a79 100644
--- a/dom/moz.build
+++ b/dom/moz.build
@@ -106,6 +106,7 @@ DIRS += [
     "l10n",
     "origin-trials",
     "webscheduling",
+    "ipc-fuzzer",
 ]
 
 
@@ -118,3 +119,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] in ("gtk", "cocoa", "windows"):
     TEST_DIRS += ["plugins/test"]
 
 SPHINX_TREES["/dom"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/network/interfaces/moz.build b/dom/network/interfaces/moz.build
index 362ad4c2281a0..f3b9e9795eca7 100644
--- a/dom/network/interfaces/moz.build
+++ b/dom/network/interfaces/moz.build
@@ -10,3 +10,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_network"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/network/moz.build b/dom/network/moz.build
index 7b7e174a6d576..8f47f7d058256 100644
--- a/dom/network/moz.build
+++ b/dom/network/moz.build
@@ -53,3 +53,6 @@ IPDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/notification/moz.build b/dom/notification/moz.build
index b42e7a13ab3a7..955dbce2c3988 100644
--- a/dom/notification/moz.build
+++ b/dom/notification/moz.build
@@ -46,3 +46,6 @@ else:
     EXTRA_JS_MODULES += [
         "old/NotificationDB.sys.mjs",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/origin-trials/moz.build b/dom/origin-trials/moz.build
index 693fd62281582..02f77ceb8ba1c 100644
--- a/dom/origin-trials/moz.build
+++ b/dom/origin-trials/moz.build
@@ -38,3 +38,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/payments/ipc/moz.build b/dom/payments/ipc/moz.build
index 83c5afd577079..f9763ddc3e6f0 100644
--- a/dom/payments/ipc/moz.build
+++ b/dom/payments/ipc/moz.build
@@ -24,3 +24,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/payments/moz.build b/dom/payments/moz.build
index fc533ad229adb..e11b49fe19db4 100644
--- a/dom/payments/moz.build
+++ b/dom/payments/moz.build
@@ -51,3 +51,6 @@ with Files("**"):
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
 MOCHITEST_MANIFESTS += ["test/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/performance/moz.build b/dom/performance/moz.build
index 842393224771c..296480f228a5f 100644
--- a/dom/performance/moz.build
+++ b/dom/performance/moz.build
@@ -63,3 +63,6 @@ MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/permission/moz.build b/dom/permission/moz.build
index 6781dfd318225..933123832ac02 100644
--- a/dom/permission/moz.build
+++ b/dom/permission/moz.build
@@ -28,3 +28,6 @@ MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/plugins/base/moz.build b/dom/plugins/base/moz.build
index 46bfd5b330f05..d834478e26fc4 100644
--- a/dom/plugins/base/moz.build
+++ b/dom/plugins/base/moz.build
@@ -42,3 +42,6 @@ FINAL_LIBRARY = "xul"
 
 if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/plugins/test/moz.build b/dom/plugins/test/moz.build
index c6c94004507d6..58a32dd74f3a3 100644
--- a/dom/plugins/test/moz.build
+++ b/dom/plugins/test/moz.build
@@ -7,3 +7,6 @@
 if CONFIG["MOZ_WIDGET_TOOLKIT"] in ("gtk", "cocoa", "windows"):
     MOCHITEST_MANIFESTS += ["mochitest/mochitest.toml"]
     BROWSER_CHROME_MANIFESTS += ["mochitest/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/power/moz.build b/dom/power/moz.build
index 5f04a3247dc3c..e6c5e3c20ba62 100644
--- a/dom/power/moz.build
+++ b/dom/power/moz.build
@@ -37,3 +37,6 @@ MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/promise/gtest/moz.build b/dom/promise/gtest/moz.build
index a2208228349ea..0dc79c860e167 100644
--- a/dom/promise/gtest/moz.build
+++ b/dom/promise/gtest/moz.build
@@ -12,3 +12,6 @@ UNIFIED_SOURCES += [
 LOCAL_INCLUDES += ["/dom/promise"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/promise/moz.build b/dom/promise/moz.build
index 843eb93d83231..0085b37ced532 100644
--- a/dom/promise/moz.build
+++ b/dom/promise/moz.build
@@ -40,3 +40,6 @@ MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["tests/chrome.toml"]
 
 XPCSHELL_TESTS_MANIFESTS += ["tests/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/prototype/moz.build b/dom/prototype/moz.build
index becc0b5b1e980..daa1968437efc 100644
--- a/dom/prototype/moz.build
+++ b/dom/prototype/moz.build
@@ -23,3 +23,6 @@ LOCAL_INCLUDES += [
 MOCHITEST_CHROME_MANIFESTS += ["tests/chrome/chrome.toml"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/push/moz.build b/dom/push/moz.build
index 0065fd21f651e..cba5516a4c3ec 100644
--- a/dom/push/moz.build
+++ b/dom/push/moz.build
@@ -65,3 +65,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/push/test/xpcshell/moz.build b/dom/push/test/xpcshell/moz.build
index fc154ce0d0519..3da0f850b541d 100644
--- a/dom/push/test/xpcshell/moz.build
+++ b/dom/push/test/xpcshell/moz.build
@@ -1,3 +1,6 @@
 TESTING_JS_MODULES += [
     "broadcast_handler.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/quota/moz.build b/dom/quota/moz.build
index 04fefa12127aa..f1d0811c3b623 100644
--- a/dom/quota/moz.build
+++ b/dom/quota/moz.build
@@ -137,3 +137,6 @@ LOCAL_INCLUDES += [
     "/caps",
     "/dom/fs/include",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/quota/test/gtest/moz.build b/dom/quota/test/gtest/moz.build
index bf364ca38d359..1c77a9f922b2b 100644
--- a/dom/quota/test/gtest/moz.build
+++ b/dom/quota/test/gtest/moz.build
@@ -47,3 +47,6 @@ FINAL_LIBRARY = "xul-gtest"
 LOCAL_INCLUDES += [
     "/dom/quota",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/quota/test/moz.build b/dom/quota/test/moz.build
index c01a46c55205a..795533a75e7e7 100644
--- a/dom/quota/test/moz.build
+++ b/dom/quota/test/moz.build
@@ -84,3 +84,6 @@ TESTING_JS_MODULES.dom.quota.test.modules.worker += [
     "modules/system/worker/Utils.js",
     "modules/system/worker/UtilsChild.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/reporting/moz.build b/dom/reporting/moz.build
index 73a091dc72e3a..fb211dd739acc 100644
--- a/dom/reporting/moz.build
+++ b/dom/reporting/moz.build
@@ -49,3 +49,6 @@ MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
 
 TEST_DIRS += ["tests/gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/reporting/tests/gtest/moz.build b/dom/reporting/tests/gtest/moz.build
index 860ef48d1ed46..86797cc5f25f1 100644
--- a/dom/reporting/tests/gtest/moz.build
+++ b/dom/reporting/tests/gtest/moz.build
@@ -11,3 +11,6 @@ UNIFIED_SOURCES = [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/script/ScriptSettings.cpp b/dom/script/ScriptSettings.cpp
index 3b39538e51840..c7bf4f2d53b58 100644
--- a/dom/script/ScriptSettings.cpp
+++ b/dom/script/ScriptSettings.cpp
@@ -150,6 +150,30 @@ ScriptSettingsStackEntry::~ScriptSettingsStackEntry() {
   MOZ_ASSERT_IF(mGlobalObject, mGlobalObject->HasJSGlobal());
 }
 
+static nsIGlobalObject* UnwrapSandboxGlobal(nsIGlobalObject* global) {
+  if (!global)
+    return global;
+  JSObject* globalObject = global->GetGlobalJSObject();
+  if (!globalObject)
+    return global;
+  JSContext* cx = nsContentUtils::GetCurrentJSContext();
+  if (!cx)
+    return global;
+  JS::Rooted<JSObject*> proto(cx);
+  JS::RootedObject rootedGlobal(cx, globalObject);
+  if (!JS_GetPrototype(cx, rootedGlobal, &proto))
+    return global;
+  if (!proto || !xpc::IsSandboxPrototypeProxy(proto))
+    return global;
+  // If this is a sandbox associated with a DOMWindow via a
+  // sandboxPrototype, use that DOMWindow. This supports GreaseMonkey
+  // and JetPack content scripts.
+  proto = js::CheckedUnwrapDynamic(proto, cx, /* stopAtWindowProxy = */ false);
+  if (!proto)
+    return global;
+  return xpc::WindowGlobalOrNull(proto);
+}
+
 // If the entry or incumbent global ends up being something that the subject
 // principal doesn't subsume, we don't want to use it. This never happens on
 // the web, but can happen with asymmetric privilege relationships (i.e.
@@ -177,7 +201,7 @@ static nsIGlobalObject* ClampToSubject(nsIGlobalObject* aGlobalOrNull) {
   NS_ENSURE_TRUE(globalPrin, GetCurrentGlobal());
   if (!nsContentUtils::SubjectPrincipalOrSystemIfNativeCaller()
            ->SubsumesConsideringDomain(globalPrin)) {
-    return GetCurrentGlobal();
+    return UnwrapSandboxGlobal(GetCurrentGlobal());
   }
 
   return aGlobalOrNull;
diff --git a/dom/script/moz.build b/dom/script/moz.build
index 17fa695342987..5ccb73db09e08 100644
--- a/dom/script/moz.build
+++ b/dom/script/moz.build
@@ -52,3 +52,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/security/featurepolicy/fuzztest/moz.build b/dom/security/featurepolicy/fuzztest/moz.build
index ea577e83390dc..0cc032f44727a 100644
--- a/dom/security/featurepolicy/fuzztest/moz.build
+++ b/dom/security/featurepolicy/fuzztest/moz.build
@@ -16,3 +16,6 @@ include("/tools/fuzzing/libfuzzer-config.mozbuild")
 SOURCES += ["fp_fuzzer.cpp"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/security/featurepolicy/moz.build b/dom/security/featurepolicy/moz.build
index b39cdd9c7f366..247b35b40aa2d 100644
--- a/dom/security/featurepolicy/moz.build
+++ b/dom/security/featurepolicy/moz.build
@@ -34,3 +34,6 @@ FINAL_LIBRARY = "xul"
 
 if CONFIG["FUZZING_INTERFACES"]:
     TEST_DIRS += ["fuzztest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/security/featurepolicy/test/gtest/moz.build b/dom/security/featurepolicy/test/gtest/moz.build
index e307810ff241f..88059c89de448 100644
--- a/dom/security/featurepolicy/test/gtest/moz.build
+++ b/dom/security/featurepolicy/test/gtest/moz.build
@@ -11,3 +11,6 @@ UNIFIED_SOURCES = [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/security/fuzztest/moz.build b/dom/security/fuzztest/moz.build
index 3a1f3f4396e39..40b1f66189b24 100644
--- a/dom/security/fuzztest/moz.build
+++ b/dom/security/fuzztest/moz.build
@@ -16,3 +16,6 @@ include("/tools/fuzzing/libfuzzer-config.mozbuild")
 SOURCES += ["csp_fuzzer.cpp"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/security/moz.build b/dom/security/moz.build
index 0f2aed6a1fd56..8d8139217d3cc 100644
--- a/dom/security/moz.build
+++ b/dom/security/moz.build
@@ -80,3 +80,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "dom_security"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/security/nsCSPUtils.cpp b/dom/security/nsCSPUtils.cpp
index 50730b691b064..e5ae4f31b8f93 100644
--- a/dom/security/nsCSPUtils.cpp
+++ b/dom/security/nsCSPUtils.cpp
@@ -22,6 +22,7 @@
 #include "nsSandboxFlags.h"
 #include "nsServiceManagerUtils.h"
 #include "nsWhitespaceTokenizer.h"
+#include "nsDocShell.h"
 
 #include "mozilla/Components.h"
 #include "mozilla/dom/CSPDictionariesBinding.h"
@@ -132,6 +133,11 @@ void CSP_ApplyMetaCSPToDoc(mozilla::dom::Document& aDoc,
     return;
   }
 
+  if (aDoc.GetDocShell() &&
+      nsDocShell::Cast(aDoc.GetDocShell())->IsBypassCSPEnabled()) {
+    return;
+  }
+
   nsAutoString policyStr(
       nsContentUtils::TrimWhitespace<nsContentUtils::IsHTMLWhitespace>(
           aPolicyStr));
diff --git a/dom/security/sanitizer/moz.build b/dom/security/sanitizer/moz.build
index 6d2f0e0c19b17..9d980d966e0bd 100644
--- a/dom/security/sanitizer/moz.build
+++ b/dom/security/sanitizer/moz.build
@@ -35,3 +35,6 @@ FINAL_LIBRARY = "xul"
 #    TEST_DIRS += [
 #            'fuzztest'
 #    ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/security/test/gtest/moz.build b/dom/security/test/gtest/moz.build
index c9ab4dcece85c..645b4971ee8b1 100644
--- a/dom/security/test/gtest/moz.build
+++ b/dom/security/test/gtest/moz.build
@@ -23,3 +23,6 @@ LOCAL_INCLUDES += [
     "/toolkit/components/telemetry/",
     "/toolkit/components/telemetry/tests/gtest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/security/test/moz.build b/dom/security/test/moz.build
index d1b6cdf317307..8ca3b0b6456e5 100644
--- a/dom/security/test/moz.build
+++ b/dom/security/test/moz.build
@@ -41,3 +41,6 @@ BROWSER_CHROME_MANIFESTS += [
     "referrer-policy/browser.toml",
     "sec-fetch/browser.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/serializers/moz.build b/dom/serializers/moz.build
index b0a0a35b6f2c2..a0ced940a9800 100644
--- a/dom/serializers/moz.build
+++ b/dom/serializers/moz.build
@@ -34,3 +34,6 @@ UNIFIED_SOURCES += [
 FINAL_LIBRARY = "xul"
 
 CRASHTEST_MANIFESTS += ["crashtests/crashtests.list"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/serviceworkers/moz.build b/dom/serviceworkers/moz.build
index b42f765fc0d06..e1a19d582b737 100644
--- a/dom/serviceworkers/moz.build
+++ b/dom/serviceworkers/moz.build
@@ -129,3 +129,6 @@ BROWSER_CHROME_MANIFESTS += [
 ]
 
 TEST_DIRS += ["test/gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/serviceworkers/test/gtest/moz.build b/dom/serviceworkers/test/gtest/moz.build
index 99e29453326c0..14d741fee125e 100644
--- a/dom/serviceworkers/test/gtest/moz.build
+++ b/dom/serviceworkers/test/gtest/moz.build
@@ -11,3 +11,6 @@ UNIFIED_SOURCES = [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/simpledb/moz.build b/dom/simpledb/moz.build
index 54b4568f697f0..dac3f6c13c498 100644
--- a/dom/simpledb/moz.build
+++ b/dom/simpledb/moz.build
@@ -38,3 +38,6 @@ IPDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/smil/moz.build b/dom/smil/moz.build
index 2280cd7aa3c8f..eb5de9cde2209 100644
--- a/dom/smil/moz.build
+++ b/dom/smil/moz.build
@@ -72,3 +72,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/storage/moz.build b/dom/storage/moz.build
index 963067ced4c11..a79fb8f528f88 100644
--- a/dom/storage/moz.build
+++ b/dom/storage/moz.build
@@ -72,3 +72,6 @@ LOCAL_INCLUDES += [
 
 if CONFIG["ENABLE_TESTS"]:
     DEFINES["DOM_STORAGE_TESTS"] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/streams/moz.build b/dom/streams/moz.build
index 454a32b78980c..9cfe899b4f71c 100644
--- a/dom/streams/moz.build
+++ b/dom/streams/moz.build
@@ -70,3 +70,6 @@ LOCAL_INCLUDES += [
 # ROWSER_CHROME_MANIFESTS += ["tests/browser/browser.ini"]
 
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/svg/moz.build b/dom/svg/moz.build
index 68e6d9af69e37..c60726a7f8e1f 100644
--- a/dom/svg/moz.build
+++ b/dom/svg/moz.build
@@ -270,3 +270,6 @@ LOCAL_INCLUDES += [
     "/layout/svg",
     "/layout/xul",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/system/android/moz.build b/dom/system/android/moz.build
index 04dffba024832..dff193d3234c2 100644
--- a/dom/system/android/moz.build
+++ b/dom/system/android/moz.build
@@ -15,3 +15,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/dom/geolocation",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/system/linux/moz.build b/dom/system/linux/moz.build
index 9e7d6ef31d0f1..5d6c4fcb11059 100644
--- a/dom/system/linux/moz.build
+++ b/dom/system/linux/moz.build
@@ -21,3 +21,6 @@ if CONFIG["MOZ_ENABLE_DBUS"]:
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/system/mac/moz.build b/dom/system/mac/moz.build
index 6a10090793291..3b277d51234c2 100644
--- a/dom/system/mac/moz.build
+++ b/dom/system/mac/moz.build
@@ -19,3 +19,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/dom/geolocation",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/system/moz.build b/dom/system/moz.build
index e702d441837f8..9891c08543ada 100644
--- a/dom/system/moz.build
+++ b/dom/system/moz.build
@@ -111,3 +111,6 @@ LOCAL_INCLUDES += [
 
 MOCHITEST_CHROME_MANIFESTS += ["tests/chrome.toml", "tests/ioutils/chrome.toml"]
 MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/system/windows/location/moz.build b/dom/system/windows/location/moz.build
index 8fafb99fb1ec0..7ffa118ef66fa 100644
--- a/dom/system/windows/location/moz.build
+++ b/dom/system/windows/location/moz.build
@@ -27,3 +27,6 @@ LOCAL_INCLUDES += ["/dom/geolocation"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/system/windows/moz.build b/dom/system/windows/moz.build
index 0ee12d4ccec39..8571399c68abb 100644
--- a/dom/system/windows/moz.build
+++ b/dom/system/windows/moz.build
@@ -22,3 +22,6 @@ DIRS += ["location"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/tests/moz.build b/dom/tests/moz.build
index 49ac92ef9a82a..4d9eeb0be1e52 100644
--- a/dom/tests/moz.build
+++ b/dom/tests/moz.build
@@ -232,3 +232,6 @@ TEST_HARNESS_FILES.testing.mochitest.tests.dom.tests.mochitest.ajax.mochikit.tes
     "mochitest/ajax/mochikit/tests/SimpleTest/test.css",
     "mochitest/ajax/mochikit/tests/SimpleTest/TestRunner.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/url/moz.build b/dom/url/moz.build
index 6e714a737449e..b3b8c533e7557 100644
--- a/dom/url/moz.build
+++ b/dom/url/moz.build
@@ -33,3 +33,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/vr/moz.build b/dom/vr/moz.build
index 85437d0754d3e..42303281ac616 100644
--- a/dom/vr/moz.build
+++ b/dom/vr/moz.build
@@ -65,3 +65,6 @@ LOCAL_INCLUDES += ["/dom/base"]
 
 MOCHITEST_MANIFESTS += ["test/mochitest/mochitest.toml"]
 REFTEST_MANIFESTS += ["test/reftest/reftest.list"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webauthn/moz.build b/dom/webauthn/moz.build
index 5d84dc06e7941..55d98f33c4ee4 100644
--- a/dom/webauthn/moz.build
+++ b/dom/webauthn/moz.build
@@ -95,3 +95,6 @@ MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 BROWSER_CHROME_MANIFESTS += [
     "tests/browser/browser.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webbrowserpersist/moz.build b/dom/webbrowserpersist/moz.build
index 2c3e6a4d0fcd0..78506ccc34602 100644
--- a/dom/webbrowserpersist/moz.build
+++ b/dom/webbrowserpersist/moz.build
@@ -47,3 +47,6 @@ LOCAL_INCLUDES += [
     "/dom/base",
     "/dom/html",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webgpu/moz.build b/dom/webgpu/moz.build
index 60cce71cf374d..9b90d78cb3185 100644
--- a/dom/webgpu/moz.build
+++ b/dom/webgpu/moz.build
@@ -86,3 +86,6 @@ if CONFIG["CC_TYPE"] in ("clang", "clang-cl"):
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webidl/GeometryUtils.webidl b/dom/webidl/GeometryUtils.webidl
index 2f71b284ee5f7..2640bd57123c2 100644
--- a/dom/webidl/GeometryUtils.webidl
+++ b/dom/webidl/GeometryUtils.webidl
@@ -16,6 +16,8 @@ dictionary BoxQuadOptions {
   GeometryNode relativeTo;
   [ChromeOnly]
   boolean createFramesForSuppressedWhitespace = true;
+  [ChromeOnly]
+  boolean recurseWhenNoFrame = false;
 };
 
 dictionary ConvertCoordinateOptions {
@@ -27,6 +29,9 @@ interface mixin GeometryUtils {
   [Throws, Func="nsINode::HasBoxQuadsSupport", NeedsCallerType]
   sequence<DOMQuad> getBoxQuads(optional BoxQuadOptions options = {});
 
+  [ChromeOnly, Throws, Func="nsINode::HasBoxQuadsSupport"]
+  undefined scrollRectIntoViewIfNeeded(long x, long y, long w, long h);
+
   /* getBoxQuadsFromWindowOrigin is similar to getBoxQuads, but the
    * returned quads are further translated relative to the window
    * origin -- which is not the layout origin. Further translation
diff --git a/dom/webidl/IPCFuzzer.webidl b/dom/webidl/IPCFuzzer.webidl
new file mode 100644
index 0000000000000..6fcd5db75eb95
--- /dev/null
+++ b/dom/webidl/IPCFuzzer.webidl
@@ -0,0 +1,10 @@
+[Exposed=Window]
+interface IPCFuzzer {
+    static undefined mutate_url(DOMString url);
+    static undefined mutate_url_replace_host(DOMString host);
+    static undefined mutate_origin(DOMString url, optional boolean systemPrincipal = false);
+    static undefined mutate_origin_replace_host(DOMString host);
+    static boolean check_isolation(DOMString url);
+    static undefined deactivate_renderer_checks(unsigned long long flag);
+    static undefined activate_leak_sanitizer();
+};
\ No newline at end of file
diff --git a/dom/webidl/Window.webidl b/dom/webidl/Window.webidl
index 009ec26198601..feb6e1aa88c99 100644
--- a/dom/webidl/Window.webidl
+++ b/dom/webidl/Window.webidl
@@ -264,6 +264,7 @@ interface nsIPrintSettings;
   undefined postMessage(any message, optional WindowPostMessageOptions options = {});
 
   // also has obsolete members
+  // readonly attribute IPCFuzzer IPCFuzzer;
 };
 Window includes GlobalEventHandlers;
 Window includes WindowEventHandlers;
diff --git a/dom/webidl/moz.build b/dom/webidl/moz.build
index 68b42a9c54ef9..669f6e5d88136 100644
--- a/dom/webidl/moz.build
+++ b/dom/webidl/moz.build
@@ -388,6 +388,9 @@ with Files("Extension*"):
 with Files("WebTransport*"):
     BUG_COMPONENT = ("Core", "Networking")
 
+with Files("IPCFuzzer.webidl"):
+    BUG_COMPONENT = ("Core", "IPC Fuzzer")
+
 GENERATED_WEBIDL_FILES = [
     "CSS2Properties.webidl",
 ]
@@ -688,6 +691,7 @@ WEBIDL_FILES = [
     "IntlUtils.webidl",
     "InvokeEvent.webidl",
     "InvokerElement.webidl",
+    "IPCFuzzer.webidl",
     "IterableIterator.webidl",
     "KeyAlgorithm.webidl",
     "KeyboardEvent.webidl",
@@ -1203,3 +1207,6 @@ if CONFIG["ACCESSIBILITY"]:
     WEBIDL_FILES += [
         "AccessibleNode.webidl",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webscheduling/moz.build b/dom/webscheduling/moz.build
index b30b87972c025..01a076c788df4 100644
--- a/dom/webscheduling/moz.build
+++ b/dom/webscheduling/moz.build
@@ -25,3 +25,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webshare/moz.build b/dom/webshare/moz.build
index 30c0a3b96142b..189f1fc5a01ab 100644
--- a/dom/webshare/moz.build
+++ b/dom/webshare/moz.build
@@ -8,3 +8,6 @@ with Files("**"):
     BUG_COMPONENT = ("Core", "DOM: Core & HTML")
 
 MOCHITEST_MANIFESTS += ["test/mochitest/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/websocket/moz.build b/dom/websocket/moz.build
index 036dd8447e749..b138da003b984 100644
--- a/dom/websocket/moz.build
+++ b/dom/websocket/moz.build
@@ -32,3 +32,6 @@ MOCHITEST_MANIFESTS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webtransport/api/moz.build b/dom/webtransport/api/moz.build
index 7a20c9b5015df..8698ec45bd13b 100644
--- a/dom/webtransport/api/moz.build
+++ b/dom/webtransport/api/moz.build
@@ -27,3 +27,6 @@ UNIFIED_SOURCES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webtransport/child/moz.build b/dom/webtransport/child/moz.build
index 21df93c138ef1..67c60d3fa6bfd 100644
--- a/dom/webtransport/child/moz.build
+++ b/dom/webtransport/child/moz.build
@@ -15,3 +15,6 @@ UNIFIED_SOURCES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webtransport/moz.build b/dom/webtransport/moz.build
index 0c825bca6255a..aa418a0a6bc17 100644
--- a/dom/webtransport/moz.build
+++ b/dom/webtransport/moz.build
@@ -14,3 +14,6 @@ DIRS += [
     "shared",
     "test",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webtransport/parent/moz.build b/dom/webtransport/parent/moz.build
index f3486cc8c78a6..26c86a7e66e98 100644
--- a/dom/webtransport/parent/moz.build
+++ b/dom/webtransport/parent/moz.build
@@ -20,3 +20,6 @@ LOCAL_INCLUDES += [
     "/netwerk/base",
     "/netwerk/protocol/http",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webtransport/shared/moz.build b/dom/webtransport/shared/moz.build
index 2992b7dbeb261..8ee5fdf711428 100644
--- a/dom/webtransport/shared/moz.build
+++ b/dom/webtransport/shared/moz.build
@@ -19,3 +19,6 @@ IPDL_SOURCES += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webtransport/test/moz.build b/dom/webtransport/test/moz.build
index ddf7e1f9a9154..68ccd7d30ade7 100644
--- a/dom/webtransport/test/moz.build
+++ b/dom/webtransport/test/moz.build
@@ -7,3 +7,6 @@
 TEST_DIRS += [
     "xpcshell",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/webtransport/test/xpcshell/moz.build b/dom/webtransport/test/xpcshell/moz.build
index 0eb0836320774..80c8cd5a3581b 100644
--- a/dom/webtransport/test/xpcshell/moz.build
+++ b/dom/webtransport/test/xpcshell/moz.build
@@ -7,3 +7,6 @@
 XPCSHELL_TESTS_MANIFESTS += [
     "xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/workers/RuntimeService.cpp b/dom/workers/RuntimeService.cpp
index bcfbe33925afb..47bc46f34a939 100644
--- a/dom/workers/RuntimeService.cpp
+++ b/dom/workers/RuntimeService.cpp
@@ -985,7 +985,7 @@ void PrefLanguagesChanged(const char* /* aPrefName */, void* /* aClosure */) {
   AssertIsOnMainThread();
 
   nsTArray<nsString> languages;
-  Navigator::GetAcceptLanguages(languages);
+  Navigator::GetAcceptLanguages(nullptr, languages);
 
   RuntimeService* runtime = RuntimeService::GetService();
   if (runtime) {
@@ -1172,8 +1172,7 @@ bool RuntimeService::RegisterWorker(WorkerPrivate& aWorkerPrivate) {
       }
 
       // The navigator overridden properties should have already been read.
-
-      Navigator::GetAcceptLanguages(mNavigatorProperties.mLanguages);
+      Navigator::GetAcceptLanguages(nullptr, mNavigatorProperties.mLanguages);
       mNavigatorPropertiesLoaded = true;
     }
 
@@ -1772,6 +1771,13 @@ void RuntimeService::PropagateStorageAccessPermissionGranted(
   }
 }
 
+void RuntimeService::ResetDefaultLocaleInAllWorkers() {
+  AssertIsOnMainThread();
+  BroadcastAllWorkers([](auto& worker) {
+    worker.ResetDefaultLocale();
+  });
+}
+
 template <typename Func>
 void RuntimeService::BroadcastAllWorkers(const Func& aFunc) {
   AssertIsOnMainThread();
@@ -2287,6 +2293,14 @@ void PropagateStorageAccessPermissionGrantedToWorkers(
   }
 }
 
+void ResetDefaultLocaleInAllWorkers() {
+  AssertIsOnMainThread();
+  RuntimeService* runtime = RuntimeService::GetService();
+  if (runtime) {
+    runtime->ResetDefaultLocaleInAllWorkers();
+  }
+}
+
 WorkerPrivate* GetWorkerPrivateFromContext(JSContext* aCx) {
   MOZ_ASSERT(!NS_IsMainThread());
   MOZ_ASSERT(aCx);
diff --git a/dom/workers/RuntimeService.h b/dom/workers/RuntimeService.h
index e6deb81f35704..ff16582af9fbf 100644
--- a/dom/workers/RuntimeService.h
+++ b/dom/workers/RuntimeService.h
@@ -108,6 +108,8 @@ class RuntimeService final : public nsIObserver {
   void PropagateStorageAccessPermissionGranted(
       const nsPIDOMWindowInner& aWindow);
 
+  void ResetDefaultLocaleInAllWorkers();
+
   const NavigatorProperties& GetNavigatorProperties() const {
     return mNavigatorProperties;
   }
diff --git a/dom/workers/WorkerCommon.h b/dom/workers/WorkerCommon.h
index d10dabb5c5ff8..53c4070c5fde4 100644
--- a/dom/workers/WorkerCommon.h
+++ b/dom/workers/WorkerCommon.h
@@ -44,6 +44,8 @@ void ResumeWorkersForWindow(const nsPIDOMWindowInner& aWindow);
 void PropagateStorageAccessPermissionGrantedToWorkers(
     const nsPIDOMWindowInner& aWindow);
 
+void ResetDefaultLocaleInAllWorkers();
+
 // All of these are implemented in WorkerScope.cpp
 
 bool IsWorkerGlobal(JSObject* global);
diff --git a/dom/workers/WorkerPrivate.cpp b/dom/workers/WorkerPrivate.cpp
index acef06ba3abb0..940210c603d90 100644
--- a/dom/workers/WorkerPrivate.cpp
+++ b/dom/workers/WorkerPrivate.cpp
@@ -679,6 +679,18 @@ class UpdateContextOptionsRunnable final : public WorkerControlRunnable {
   }
 };
 
+class ResetDefaultLocaleRunnable final : public WorkerControlRunnable {
+ public:
+  explicit ResetDefaultLocaleRunnable(WorkerPrivate* aWorkerPrivate)
+      : WorkerControlRunnable(aWorkerPrivate, WorkerThread) {}
+
+  virtual bool WorkerRun(JSContext* aCx,
+                         WorkerPrivate* aWorkerPrivate) override {
+    aWorkerPrivate->ResetDefaultLocaleInternal(aCx);
+    return true;
+  }
+};
+
 class UpdateLanguagesRunnable final : public WorkerRunnable {
   nsTArray<nsString> mLanguages;
 
@@ -1977,6 +1989,16 @@ void WorkerPrivate::UpdateContextOptions(
   }
 }
 
+void WorkerPrivate::ResetDefaultLocale() {
+  AssertIsOnParentThread();
+
+  RefPtr<ResetDefaultLocaleRunnable> runnable =
+      new ResetDefaultLocaleRunnable(this);
+  if (!runnable->Dispatch()) {
+    NS_WARNING("Failed to reset default locale in worker!");
+  }
+}
+
 void WorkerPrivate::UpdateLanguages(const nsTArray<nsString>& aLanguages) {
   AssertIsOnParentThread();
 
@@ -5480,6 +5502,15 @@ void WorkerPrivate::UpdateContextOptionsInternal(
   }
 }
 
+void WorkerPrivate::ResetDefaultLocaleInternal(JSContext* aCx) {
+  JS_ResetDefaultLocale(JS_GetRuntime(aCx));
+  auto data = mWorkerThreadAccessible.Access();
+
+  for (uint32_t index = 0; index < data->mChildWorkers.Length(); index++) {
+    data->mChildWorkers[index]->ResetDefaultLocale();
+  }
+}
+
 void WorkerPrivate::UpdateLanguagesInternal(
     const nsTArray<nsString>& aLanguages) {
   WorkerGlobalScope* globalScope = GlobalScope();
diff --git a/dom/workers/WorkerPrivate.h b/dom/workers/WorkerPrivate.h
index a670d009759d1..ac87b7f27dfcc 100644
--- a/dom/workers/WorkerPrivate.h
+++ b/dom/workers/WorkerPrivate.h
@@ -417,6 +417,8 @@ class WorkerPrivate final
   void UpdateContextOptionsInternal(JSContext* aCx,
                                     const JS::ContextOptions& aContextOptions);
 
+  void ResetDefaultLocaleInternal(JSContext* aCx);
+
   void UpdateLanguagesInternal(const nsTArray<nsString>& aLanguages);
 
   void UpdateJSWorkerMemoryParameterInternal(JSContext* aCx, JSGCParamKey key,
@@ -1036,6 +1038,8 @@ class WorkerPrivate final
 
   void UpdateContextOptions(const JS::ContextOptions& aContextOptions);
 
+  void ResetDefaultLocale();
+
   void UpdateLanguages(const nsTArray<nsString>& aLanguages);
 
   void UpdateJSWorkerMemoryParameter(JSGCParamKey key, Maybe<uint32_t> value);
diff --git a/dom/workers/loader/moz.build b/dom/workers/loader/moz.build
index d39a6acb24fdb..094323e92f6f9 100644
--- a/dom/workers/loader/moz.build
+++ b/dom/workers/loader/moz.build
@@ -32,3 +32,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/workers/moz.build b/dom/workers/moz.build
index c7818826d1860..2bb21b0d0758e 100644
--- a/dom/workers/moz.build
+++ b/dom/workers/moz.build
@@ -112,3 +112,6 @@ MARIONETTE_MANIFESTS += ["test/marionette/manifest.toml"]
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/workers/remoteworkers/moz.build b/dom/workers/remoteworkers/moz.build
index 9983b7dd1015c..b76a97e8fab7b 100644
--- a/dom/workers/remoteworkers/moz.build
+++ b/dom/workers/remoteworkers/moz.build
@@ -43,3 +43,6 @@ IPDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/workers/sharedworkers/moz.build b/dom/workers/sharedworkers/moz.build
index 2b83bc9525a8c..c43da9757e97c 100644
--- a/dom/workers/sharedworkers/moz.build
+++ b/dom/workers/sharedworkers/moz.build
@@ -26,3 +26,6 @@ IPDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/worklet/loader/moz.build b/dom/worklet/loader/moz.build
index 38707a81ccc19..41ebe19e3d236 100644
--- a/dom/worklet/loader/moz.build
+++ b/dom/worklet/loader/moz.build
@@ -18,3 +18,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/worklet/moz.build b/dom/worklet/moz.build
index 487527c48838a..d9d84b0ba18e1 100644
--- a/dom/worklet/moz.build
+++ b/dom/worklet/moz.build
@@ -34,3 +34,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/xhr/moz.build b/dom/xhr/moz.build
index abbdff65cacd4..0c754b7cf5099 100644
--- a/dom/xhr/moz.build
+++ b/dom/xhr/moz.build
@@ -37,3 +37,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/xml/moz.build b/dom/xml/moz.build
index c79eedb00f6d8..9fa375fede184 100644
--- a/dom/xml/moz.build
+++ b/dom/xml/moz.build
@@ -49,3 +49,6 @@ LOCAL_INCLUDES += [
 RESOURCE_FILES.dtd += [
     "htmlmathml-f.ent",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/xml/resources/moz.build b/dom/xml/resources/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/dom/xml/resources/moz.build
+++ b/dom/xml/resources/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/xslt/base/moz.build b/dom/xslt/base/moz.build
index 1b22391983e81..2b4c3a515b379 100644
--- a/dom/xslt/base/moz.build
+++ b/dom/xslt/base/moz.build
@@ -21,3 +21,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/xslt/moz.build b/dom/xslt/moz.build
index 1e94d7034733c..c9d7fe47f4798 100644
--- a/dom/xslt/moz.build
+++ b/dom/xslt/moz.build
@@ -21,3 +21,6 @@ DIRS += [
 if CONFIG["ENABLE_TESTS"]:
     MOCHITEST_MANIFESTS += ["tests/mochitest/mochitest.toml"]
     BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/xslt/xml/moz.build b/dom/xslt/xml/moz.build
index a8f33bd35038e..94ad036a0c6da 100644
--- a/dom/xslt/xml/moz.build
+++ b/dom/xslt/xml/moz.build
@@ -17,3 +17,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/xslt/xpath/moz.build b/dom/xslt/xpath/moz.build
index 9cf562c0afc3c..875f8be733e95 100644
--- a/dom/xslt/xpath/moz.build
+++ b/dom/xslt/xpath/moz.build
@@ -56,3 +56,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/xslt/xslt/moz.build b/dom/xslt/xslt/moz.build
index ab0e6e4aa393c..8e42a0e5986b0 100644
--- a/dom/xslt/xslt/moz.build
+++ b/dom/xslt/xslt/moz.build
@@ -64,3 +64,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/dom/xul/moz.build b/dom/xul/moz.build
index cbcf964a2ba71..0a106a3af8be4 100644
--- a/dom/xul/moz.build
+++ b/dom/xul/moz.build
@@ -92,3 +92,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/editor/composer/moz.build b/editor/composer/moz.build
index 13925a3312245..73ade40cfb80f 100644
--- a/editor/composer/moz.build
+++ b/editor/composer/moz.build
@@ -58,3 +58,6 @@ RESOURCE_FILES += [
     "res/table-remove-row-hover.gif",
     "res/table-remove-row.gif",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/editor/libeditor/moz.build b/editor/libeditor/moz.build
index a28c2c71004ae..99bfed613ef96 100644
--- a/editor/libeditor/moz.build
+++ b/editor/libeditor/moz.build
@@ -96,3 +96,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("tests/*1151186*"):
     BUG_COMPONENT = ("Core", "DOM: UI Events & Focus Handling")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/editor/moz.build b/editor/moz.build
index 5b526d4f1d935..b7a2d3392cc15 100644
--- a/editor/moz.build
+++ b/editor/moz.build
@@ -39,3 +39,6 @@ with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
 
 CXXFLAGS += CONFIG["MOZ_TRIVIAL_AUTO_VAR_INIT"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/editor/spellchecker/moz.build b/editor/spellchecker/moz.build
index cd3d58df7e9f0..cfdb334f2be52 100644
--- a/editor/spellchecker/moz.build
+++ b/editor/spellchecker/moz.build
@@ -32,3 +32,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/editor/txmgr/moz.build b/editor/txmgr/moz.build
index f4310ab298ecc..32c774e2def04 100644
--- a/editor/txmgr/moz.build
+++ b/editor/txmgr/moz.build
@@ -29,3 +29,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/editor/txmgr/tests/moz.build b/editor/txmgr/tests/moz.build
index 9a8985dbc4aaa..849ad8b35c10e 100644
--- a/editor/txmgr/tests/moz.build
+++ b/editor/txmgr/tests/moz.build
@@ -8,3 +8,6 @@ SOURCES += [
     "TestTXMgr.cpp",
 ]
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/auth/moz.build b/extensions/auth/moz.build
index ac2a23fcf01b8..dbe10a4df4805 100644
--- a/extensions/auth/moz.build
+++ b/extensions/auth/moz.build
@@ -37,3 +37,6 @@ with Files("**"):
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/permissions/moz.build b/extensions/permissions/moz.build
index 6cdac60926443..ce48ca2328706 100644
--- a/extensions/permissions/moz.build
+++ b/extensions/permissions/moz.build
@@ -37,3 +37,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "Permission Manager")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/permissions/test/gtest/moz.build b/extensions/permissions/test/gtest/moz.build
index 132c384597abb..8d770c4af5cb6 100644
--- a/extensions/permissions/test/gtest/moz.build
+++ b/extensions/permissions/test/gtest/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/permissions/test/moz.build b/extensions/permissions/test/moz.build
index 38768cef3075d..8fb4c371616b7 100644
--- a/extensions/permissions/test/moz.build
+++ b/extensions/permissions/test/moz.build
@@ -13,3 +13,6 @@ XPCSHELL_TESTS_MANIFESTS += [
 ]
 
 BROWSER_CHROME_MANIFESTS += ["browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/pref/autoconfig/moz.build b/extensions/pref/autoconfig/moz.build
index 06b400924ebae..06f749a6a10ea 100644
--- a/extensions/pref/autoconfig/moz.build
+++ b/extensions/pref/autoconfig/moz.build
@@ -9,3 +9,6 @@ DIRS += ["src"]
 XPCSHELL_TESTS_MANIFESTS += ["test/unit/xpcshell.toml", "test/unit/xpcshell_snap.toml"]
 
 MARIONETTE_MANIFESTS += ["test/marionette/manifest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/pref/autoconfig/src/moz.build b/extensions/pref/autoconfig/src/moz.build
index 12722cf6d7a24..ae60927e76253 100644
--- a/extensions/pref/autoconfig/src/moz.build
+++ b/extensions/pref/autoconfig/src/moz.build
@@ -19,3 +19,6 @@ FINAL_LIBRARY = "xul"
 FINAL_TARGET_FILES.defaults.autoconfig += [
     "prefcalls.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/pref/moz.build b/extensions/pref/moz.build
index b0b3670440a01..0b9abff0e0755 100644
--- a/extensions/pref/moz.build
+++ b/extensions/pref/moz.build
@@ -9,3 +9,6 @@ DIRS += ["autoconfig"]
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "AutoConfig (Mission Control Desktop)")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/spellcheck/hunspell/glue/moz.build b/extensions/spellcheck/hunspell/glue/moz.build
index da6585b66eb62..b6a2a2f35c505 100644
--- a/extensions/spellcheck/hunspell/glue/moz.build
+++ b/extensions/spellcheck/hunspell/glue/moz.build
@@ -29,3 +29,6 @@ HunspellIncludes()
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/spellcheck/hunspell/moz.build b/extensions/spellcheck/hunspell/moz.build
index 784b49339c72d..3462d9f1d4de0 100644
--- a/extensions/spellcheck/hunspell/moz.build
+++ b/extensions/spellcheck/hunspell/moz.build
@@ -11,3 +11,6 @@ if not CONFIG["MOZ_WASM_SANDBOXING_HUNSPELL"]:
 
 if CONFIG["ENABLE_TESTS"]:
     XPCSHELL_TESTS_MANIFESTS += ["tests/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/spellcheck/hunspell/src/moz.build b/extensions/spellcheck/hunspell/src/moz.build
index c6f7930262b85..4ced3fa6325d5 100644
--- a/extensions/spellcheck/hunspell/src/moz.build
+++ b/extensions/spellcheck/hunspell/src/moz.build
@@ -28,3 +28,6 @@ if CONFIG['CC_TYPE'] in ('clang', 'clang-cl'):
     CXXFLAGS += [
         '-Wno-implicit-fallthrough',
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/spellcheck/idl/moz.build b/extensions/spellcheck/idl/moz.build
index caed8a2d58de8..3cc48b783036d 100644
--- a/extensions/spellcheck/idl/moz.build
+++ b/extensions/spellcheck/idl/moz.build
@@ -10,3 +10,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "spellchecker"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/spellcheck/ipc/moz.build b/extensions/spellcheck/ipc/moz.build
index 0e424dc72e745..64011557e48fd 100644
--- a/extensions/spellcheck/ipc/moz.build
+++ b/extensions/spellcheck/ipc/moz.build
@@ -21,3 +21,6 @@ EXPORTS.mozilla += [
     "RemoteSpellCheckEngineChild.h",
     "RemoteSpellCheckEngineParent.h",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/spellcheck/locales/moz.build b/extensions/spellcheck/locales/moz.build
index aae8e8ca67554..3edae4bc91fe6 100644
--- a/extensions/spellcheck/locales/moz.build
+++ b/extensions/spellcheck/locales/moz.build
@@ -8,3 +8,6 @@ LOCALIZED_FILES.dictionaries += [
     "en-US/hunspell/*.aff",
     "en-US/hunspell/*.dic",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/spellcheck/moz.build b/extensions/spellcheck/moz.build
index 50537d44aec50..c2ec7c2b55f45 100644
--- a/extensions/spellcheck/moz.build
+++ b/extensions/spellcheck/moz.build
@@ -17,3 +17,6 @@ SPHINX_TREES["/extensions/spellcheck"] = "docs"
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "Spelling checker")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/spellcheck/src/moz.build b/extensions/spellcheck/src/moz.build
index c4ce09efca345..f2b6deb16d0c1 100644
--- a/extensions/spellcheck/src/moz.build
+++ b/extensions/spellcheck/src/moz.build
@@ -26,3 +26,6 @@ EXPORTS.mozilla += [
     "mozInlineSpellChecker.h",
     "mozSpellChecker.h",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/universalchardet/moz.build b/extensions/universalchardet/moz.build
index 2d4b7badfc203..bfab191e7f44e 100644
--- a/extensions/universalchardet/moz.build
+++ b/extensions/universalchardet/moz.build
@@ -8,3 +8,6 @@ TEST_DIRS += ["tests"]
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "Internationalization")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/extensions/universalchardet/tests/moz.build b/extensions/universalchardet/tests/moz.build
index 36ed0467080bf..a914958225d5c 100644
--- a/extensions/universalchardet/tests/moz.build
+++ b/extensions/universalchardet/tests/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 MOCHITEST_CHROME_MANIFESTS += ["chrome.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/2d/moz.build b/gfx/2d/moz.build
index c04530c72b9f2..5013f67ff9c93 100644
--- a/gfx/2d/moz.build
+++ b/gfx/2d/moz.build
@@ -225,3 +225,6 @@ LOCAL_INCLUDES += CONFIG["SKIA_INCLUDES"]
 LOCAL_INCLUDES += [
     "/gfx/cairo/cairo/src",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/angle/moz.build b/gfx/angle/moz.build
index ea4be831bd1e9..99c182465e9ed 100644
--- a/gfx/angle/moz.build
+++ b/gfx/angle/moz.build
@@ -9,3 +9,6 @@ DIRS += ["targets/translator"]
 # Only build libEGL/libGLESv2 on Windows
 if CONFIG["MOZ_WIDGET_TOOLKIT"] == "windows":
     DIRS += ["targets/libEGL", "targets/libGLESv2"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/angle/targets/angle_common/moz.build b/gfx/angle/targets/angle_common/moz.build
index 873a095e3f373..76a19bb4f19d2 100644
--- a/gfx/angle/targets/angle_common/moz.build
+++ b/gfx/angle/targets/angle_common/moz.build
@@ -201,3 +201,6 @@ if CONFIG["OS_ARCH"] not in ("Darwin", "WINNT"):
 # ]
 
 Library("angle_common")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/angle/targets/angle_gpu_info_util/moz.build b/gfx/angle/targets/angle_gpu_info_util/moz.build
index f2fe1dd3d431d..4547d344f40a8 100644
--- a/gfx/angle/targets/angle_gpu_info_util/moz.build
+++ b/gfx/angle/targets/angle_gpu_info_util/moz.build
@@ -197,3 +197,6 @@ OS_LIBS += [
 # ]
 
 Library("angle_gpu_info_util")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/angle/targets/angle_image_util/moz.build b/gfx/angle/targets/angle_image_util/moz.build
index 8a17982e17636..196a542d89bef 100644
--- a/gfx/angle/targets/angle_image_util/moz.build
+++ b/gfx/angle/targets/angle_image_util/moz.build
@@ -171,3 +171,6 @@ DIRS += [
 # ]
 
 Library("angle_image_util")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/angle/targets/compression_utils_portable/moz.build b/gfx/angle/targets/compression_utils_portable/moz.build
index dca408de3e0fd..2367c920ba214 100644
--- a/gfx/angle/targets/compression_utils_portable/moz.build
+++ b/gfx/angle/targets/compression_utils_portable/moz.build
@@ -132,3 +132,6 @@ USE_LIBS += [
 # ]
 
 Library("compression_utils_portable")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/angle/targets/libEGL/moz.build b/gfx/angle/targets/libEGL/moz.build
index 9327db4c234b6..7f1f2754341c2 100644
--- a/gfx/angle/targets/libEGL/moz.build
+++ b/gfx/angle/targets/libEGL/moz.build
@@ -212,3 +212,6 @@ OS_LIBS += [
 DEFFILE = "../../checkout/src/libEGL/libEGL_autogen.def"
 RCFILE = "../../checkout/src/libEGL/libEGL.rc"
 GeckoSharedLibrary("libEGL", linkage=None)
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/angle/targets/libGLESv2/moz.build b/gfx/angle/targets/libGLESv2/moz.build
index dfcf0df719755..9a10e737f80d7 100644
--- a/gfx/angle/targets/libGLESv2/moz.build
+++ b/gfx/angle/targets/libGLESv2/moz.build
@@ -428,3 +428,6 @@ OS_LIBS += [
 DEFFILE = "../../checkout/src/libGLESv2/libGLESv2_autogen.def"
 RCFILE = "../../checkout/src/libGLESv2/libGLESv2.rc"
 GeckoSharedLibrary("libGLESv2", linkage=None)
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/angle/targets/preprocessor/moz.build b/gfx/angle/targets/preprocessor/moz.build
index 3fbce2e0c40e3..65b11bdaf0ee1 100644
--- a/gfx/angle/targets/preprocessor/moz.build
+++ b/gfx/angle/targets/preprocessor/moz.build
@@ -177,3 +177,6 @@ DIRS += [
 # ]
 
 Library("preprocessor")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/angle/targets/translator/moz.build b/gfx/angle/targets/translator/moz.build
index 38dbb74f7933b..d31642d3efdb1 100644
--- a/gfx/angle/targets/translator/moz.build
+++ b/gfx/angle/targets/translator/moz.build
@@ -319,3 +319,6 @@ DIRS += [
 # ]
 
 Library("translator")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/cairo/cairo/src/moz.build b/gfx/cairo/cairo/src/moz.build
index 7017c2e83f2cb..b320fece6e893 100755
--- a/gfx/cairo/cairo/src/moz.build
+++ b/gfx/cairo/cairo/src/moz.build
@@ -282,3 +282,6 @@ if CONFIG['MOZ_X11']:
 if CONFIG['MOZ_ENABLE_CAIRO_FT']:
     CFLAGS += CONFIG['CAIRO_FT_CFLAGS']
     CXXFLAGS += CONFIG['CAIRO_FT_CFLAGS']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/cairo/libpixman/src/moz.build b/gfx/cairo/libpixman/src/moz.build
index 6d5cee9c8de4e..363b460be6308 100644
--- a/gfx/cairo/libpixman/src/moz.build
+++ b/gfx/cairo/libpixman/src/moz.build
@@ -130,3 +130,6 @@ if CONFIG['CC_TYPE'] == 'clang-cl':
 # See bug 386897.
 if CONFIG['OS_TARGET'] == 'Android' and CONFIG['MOZ_OPTIMIZE']:
     CFLAGS += ['-O2']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/cairo/moz.build b/gfx/cairo/moz.build
index 1774847539bdf..1f639400d9f6c 100644
--- a/gfx/cairo/moz.build
+++ b/gfx/cairo/moz.build
@@ -9,3 +9,6 @@ DIRS += ['cairo/src']
 if CONFIG['MOZ_TREE_PIXMAN']:
     DIRS += ['libpixman/src']
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/config/moz.build b/gfx/config/moz.build
index a19b39a592330..b8aa8a90ee19f 100644
--- a/gfx/config/moz.build
+++ b/gfx/config/moz.build
@@ -26,3 +26,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/gl/gtest/moz.build b/gfx/gl/gtest/moz.build
index 5b57e3ded1fd6..2707519bc60ca 100644
--- a/gfx/gl/gtest/moz.build
+++ b/gfx/gl/gtest/moz.build
@@ -13,3 +13,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/gl/moz.build b/gfx/gl/moz.build
index f45e85b8f4777..4f9f3ddf3ee9a 100644
--- a/gfx/gl/moz.build
+++ b/gfx/gl/moz.build
@@ -161,3 +161,6 @@ LOCAL_INCLUDES += CONFIG["SKIA_INCLUDES"]
 LOCAL_INCLUDES += [
     "/gfx/cairo/cairo/src",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/graphite2/src/moz.build b/gfx/graphite2/src/moz.build
index 02fb5c3b0739c..f5d4ff1173c4d 100755
--- a/gfx/graphite2/src/moz.build
+++ b/gfx/graphite2/src/moz.build
@@ -33,3 +33,6 @@ for k, v in graphite_defines:
 AllowCompilerWarnings()
 
 FINAL_LIBRARY = 'gkmedias'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/harfbuzz/src/moz.build b/gfx/harfbuzz/src/moz.build
index 7944026c271a6..fbfcbb8187eeb 100644
--- a/gfx/harfbuzz/src/moz.build
+++ b/gfx/harfbuzz/src/moz.build
@@ -123,3 +123,6 @@ if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'android':
 
 if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'windows':
     DEFINES['UNICODE'] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/ipc/moz.build b/gfx/ipc/moz.build
index b8a52079e417d..3fa63abac8564 100644
--- a/gfx/ipc/moz.build
+++ b/gfx/ipc/moz.build
@@ -90,3 +90,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 CXXFLAGS += ["-Werror=switch"]
 
 LOCAL_INCLUDES += CONFIG["SKIA_INCLUDES"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/layers/apz/test/gtest/moz.build b/gfx/layers/apz/test/gtest/moz.build
index 5c9231fd21cd9..baaaa1ae40df1 100644
--- a/gfx/layers/apz/test/gtest/moz.build
+++ b/gfx/layers/apz/test/gtest/moz.build
@@ -38,3 +38,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/layers/apz/test/gtest/mvm/moz.build b/gfx/layers/apz/test/gtest/mvm/moz.build
index 0fa985307ba16..c17bdba15ab7e 100644
--- a/gfx/layers/apz/test/gtest/mvm/moz.build
+++ b/gfx/layers/apz/test/gtest/mvm/moz.build
@@ -11,3 +11,6 @@ UNIFIED_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/layers/moz.build b/gfx/layers/moz.build
index 1bf2e83804b48..56976a297b93e 100644
--- a/gfx/layers/moz.build
+++ b/gfx/layers/moz.build
@@ -530,3 +530,6 @@ UNIFIED_SOURCES += []
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/moz.build b/gfx/moz.build
index 56ea317bedfc6..9d2bcc8f8fc91 100644
--- a/gfx/moz.build
+++ b/gfx/moz.build
@@ -43,3 +43,6 @@ SPHINX_TREES["/gfx"] = "docs"
 
 with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/ots/src/moz.build b/gfx/ots/src/moz.build
index 03b046a6bcea9..007cf83e08c30 100644
--- a/gfx/ots/src/moz.build
+++ b/gfx/ots/src/moz.build
@@ -82,3 +82,6 @@ LOCAL_INCLUDES += [
     '!/security/rlbox',
     '/modules/woff2/src',
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/qcms/moz.build b/gfx/qcms/moz.build
index 1e899c7a46bc6..76f403b736c96 100644
--- a/gfx/qcms/moz.build
+++ b/gfx/qcms/moz.build
@@ -8,3 +8,6 @@ EXPORTS += [
     'qcms.h',
     'qcmstypes.h',
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/skia/moz.build b/gfx/skia/moz.build
index 83aa2957a938e..03dbf35eddea5 100644
--- a/gfx/skia/moz.build
+++ b/gfx/skia/moz.build
@@ -618,3 +618,6 @@ if CONFIG['TARGET_CPU'] in ('mips32', 'mips64'):
 # Work around bug 1841199.
 if CONFIG['TARGET_CPU'] in ('mips32', 'mips64', 'ppc64'):
     DEFINES['musttail'] = 'nomusttail'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/src/moz.build b/gfx/src/moz.build
index dcfc670704091..7985bbd42b801 100644
--- a/gfx/src/moz.build
+++ b/gfx/src/moz.build
@@ -94,3 +94,6 @@ FINAL_LIBRARY = "xul"
 if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
     CXXFLAGS += CONFIG["MOZ_PANGO_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/tests/fuzz/moz.build b/gfx/tests/fuzz/moz.build
index d7b581d056d3c..6d129d1574eaf 100644
--- a/gfx/tests/fuzz/moz.build
+++ b/gfx/tests/fuzz/moz.build
@@ -11,3 +11,6 @@ UNIFIED_SOURCES += [
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/tests/gtest/moz.build b/gfx/tests/gtest/moz.build
index 7c79a84163a40..d31fbeb572661 100644
--- a/gfx/tests/gtest/moz.build
+++ b/gfx/tests/gtest/moz.build
@@ -73,3 +73,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/tests/moz.build b/gfx/tests/moz.build
index 5c5cd362dfdc5..a9d23433b4c30 100644
--- a/gfx/tests/moz.build
+++ b/gfx/tests/moz.build
@@ -7,3 +7,6 @@
 MOCHITEST_MANIFESTS += ["mochitest/mochitest.toml"]
 BROWSER_CHROME_MANIFESTS += ["browser/browser.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["chrome/chrome.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/thebes/moz.build b/gfx/thebes/moz.build
index a7eca33ab1415..d88f8a19c0b98 100644
--- a/gfx/thebes/moz.build
+++ b/gfx/thebes/moz.build
@@ -298,3 +298,6 @@ DEFINES["GRAPHITE2_STATIC"] = True
 CXXFLAGS += ["-Werror=switch"]
 
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/vr/moz.build b/gfx/vr/moz.build
index ec56fc56341d8..543da9e217188 100644
--- a/gfx/vr/moz.build
+++ b/gfx/vr/moz.build
@@ -101,3 +101,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "WebVR")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/vr/service/moz.build b/gfx/vr/service/moz.build
index 5a90ad71bd9ef..eaa1d29d5c76e 100644
--- a/gfx/vr/service/moz.build
+++ b/gfx/vr/service/moz.build
@@ -49,3 +49,6 @@ if CONFIG["TARGET_OS"] in ("WINNT", "OSX") or CONFIG["OS_TARGET"] == "Linux":
     ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/vr/service/openvr/moz.build b/gfx/vr/service/openvr/moz.build
index 5ad6d0b9b457b..cf39cd8e7537e 100644
--- a/gfx/vr/service/openvr/moz.build
+++ b/gfx/vr/service/openvr/moz.build
@@ -60,3 +60,6 @@ if CONFIG['CC_TYPE'] in ('clang', 'gcc'):
         '-Wno-error=parentheses',
         '-Wno-error=unused-variable',
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/webrender_bindings/moz.build b/gfx/webrender_bindings/moz.build
index f17c77e4cb1b3..0160d1e177c11 100644
--- a/gfx/webrender_bindings/moz.build
+++ b/gfx/webrender_bindings/moz.build
@@ -135,3 +135,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
 
 CXXFLAGS += ["-Werror=switch"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/wgpu_bindings/moz.build b/gfx/wgpu_bindings/moz.build
index dacf117377e07..c74f576827f2b 100644
--- a/gfx/wgpu_bindings/moz.build
+++ b/gfx/wgpu_bindings/moz.build
@@ -32,3 +32,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/gfx/ycbcr/moz.build b/gfx/ycbcr/moz.build
index 3c1a96409c29c..2bd3e212dc08c 100644
--- a/gfx/ycbcr/moz.build
+++ b/gfx/ycbcr/moz.build
@@ -64,3 +64,6 @@ if CONFIG['TARGET_CPU'] == 'arm' and CONFIG['HAVE_ARM_NEON']:
 LOCAL_INCLUDES += ['/media/libyuv/libyuv/include']
 
 FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/hal/moz.build b/hal/moz.build
index 912a157372eaa..cd7397444a89b 100644
--- a/hal/moz.build
+++ b/hal/moz.build
@@ -137,3 +137,6 @@ CFLAGS += CONFIG["GLIB_CFLAGS"]
 CFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
 CXXFLAGS += CONFIG["GLIB_CFLAGS"]
 CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/build/moz.build b/image/build/moz.build
index 7ba10e42b9bab..345a7a0992871 100644
--- a/image/build/moz.build
+++ b/image/build/moz.build
@@ -24,3 +24,6 @@ LOCAL_INCLUDES += [
     "/image/encoders/jpeg",
     "/image/encoders/png",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/decoders/icon/android/moz.build b/image/decoders/icon/android/moz.build
index a99ae228d4981..5225d07f8886a 100644
--- a/image/decoders/icon/android/moz.build
+++ b/image/decoders/icon/android/moz.build
@@ -11,3 +11,6 @@ SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/decoders/icon/gtk/moz.build b/image/decoders/icon/gtk/moz.build
index 3eac86b6baa64..5dd901d853d91 100644
--- a/image/decoders/icon/gtk/moz.build
+++ b/image/decoders/icon/gtk/moz.build
@@ -18,3 +18,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/decoders/icon/mac/moz.build b/image/decoders/icon/mac/moz.build
index 3467659a8fd91..1ae30781c89d9 100644
--- a/image/decoders/icon/mac/moz.build
+++ b/image/decoders/icon/mac/moz.build
@@ -11,3 +11,6 @@ SOURCES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/decoders/icon/moz.build b/image/decoders/icon/moz.build
index 96cf951b3bc2e..a1116277624e2 100644
--- a/image/decoders/icon/moz.build
+++ b/image/decoders/icon/moz.build
@@ -37,3 +37,6 @@ if CONFIG["OS_TARGET"] == "Android":
 
 if platform:
     LOCAL_INCLUDES += [platform]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/decoders/icon/win/moz.build b/image/decoders/icon/win/moz.build
index c4472f89acb65..97b81de610e88 100644
--- a/image/decoders/icon/win/moz.build
+++ b/image/decoders/icon/win/moz.build
@@ -19,3 +19,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/decoders/moz.build b/image/decoders/moz.build
index d7e062f843baa..5c1982aff622f 100644
--- a/image/decoders/moz.build
+++ b/image/decoders/moz.build
@@ -60,3 +60,6 @@ CXXFLAGS += ["-Werror=switch"]
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/encoders/bmp/moz.build b/image/encoders/bmp/moz.build
index 783fd37005119..6fdcea701ec4d 100644
--- a/image/encoders/bmp/moz.build
+++ b/image/encoders/bmp/moz.build
@@ -13,3 +13,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/encoders/ico/moz.build b/image/encoders/ico/moz.build
index 27e41489fd89d..73cf7328f9a36 100644
--- a/image/encoders/ico/moz.build
+++ b/image/encoders/ico/moz.build
@@ -18,3 +18,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/encoders/jpeg/moz.build b/image/encoders/jpeg/moz.build
index 6952fc1b9ff03..c0167a316269e 100644
--- a/image/encoders/jpeg/moz.build
+++ b/image/encoders/jpeg/moz.build
@@ -9,3 +9,6 @@ SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/encoders/moz.build b/image/encoders/moz.build
index ecb2aa44e00c3..088f00f99a77d 100644
--- a/image/encoders/moz.build
+++ b/image/encoders/moz.build
@@ -11,3 +11,6 @@ DIRS += [
     "bmp",
     "webp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/encoders/png/moz.build b/image/encoders/png/moz.build
index fe26a2368e4c7..62b2ad8086895 100644
--- a/image/encoders/png/moz.build
+++ b/image/encoders/png/moz.build
@@ -15,3 +15,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/encoders/webp/moz.build b/image/encoders/webp/moz.build
index 4363caa79f495..f65cd4bccb857 100644
--- a/image/encoders/webp/moz.build
+++ b/image/encoders/webp/moz.build
@@ -13,3 +13,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/moz.build b/image/moz.build
index 002507132721f..0eeb87bf73818 100644
--- a/image/moz.build
+++ b/image/moz.build
@@ -137,3 +137,6 @@ LOCAL_INCLUDES += CONFIG["SKIA_INCLUDES"]
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/test/fuzzing/moz.build b/image/test/fuzzing/moz.build
index 24af56396f766..a76a09c182308 100644
--- a/image/test/fuzzing/moz.build
+++ b/image/test/fuzzing/moz.build
@@ -22,3 +22,6 @@ LOCAL_INCLUDES += [
 ]
 
 LOCAL_INCLUDES += CONFIG["SKIA_INCLUDES"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/image/test/gtest/moz.build b/image/test/gtest/moz.build
index 60987b37068e7..83534c04eee59 100644
--- a/image/test/gtest/moz.build
+++ b/image/test/gtest/moz.build
@@ -154,3 +154,6 @@ LOCAL_INCLUDES += [
 LOCAL_INCLUDES += CONFIG["SKIA_INCLUDES"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/build/moz.build b/intl/build/moz.build
index 8c5dcfc2297ba..1142ef443055f 100644
--- a/intl/build/moz.build
+++ b/intl/build/moz.build
@@ -16,3 +16,6 @@ LOCAL_INCLUDES += [
     "../uconv",
     "../unicharutil",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/components/gtest/moz.build b/intl/components/gtest/moz.build
index c9ccc4cda3d91..2996f7ad32044 100644
--- a/intl/components/gtest/moz.build
+++ b/intl/components/gtest/moz.build
@@ -28,3 +28,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/components/moz.build b/intl/components/moz.build
index a5e6e197178e0..7496093e89dc0 100644
--- a/intl/components/moz.build
+++ b/intl/components/moz.build
@@ -91,3 +91,6 @@ if CONFIG["MOZ_ICU4X"]:
 DEFINES["MOZ_HAS_MOZGLUE"] = True
 
 Library("intlcomponents")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/components/src/TimeZone.cpp b/intl/components/src/TimeZone.cpp
index 7a069ef0c5989..5b09dfdcc5323 100644
--- a/intl/components/src/TimeZone.cpp
+++ b/intl/components/src/TimeZone.cpp
@@ -16,6 +16,7 @@
 
 namespace mozilla::intl {
 
+
 /* static */
 Result<UniquePtr<TimeZone>, ICUError> TimeZone::TryCreate(
     Maybe<Span<const char16_t>> aTimeZoneOverride) {
@@ -318,6 +319,13 @@ static ICUResult SetDefaultTimeZone(TimeZoneIdentifierVector& timeZone) {
 }
 #endif
 
+bool TimeZone::IsValidTimeZoneId(const char* timeZoneId) {
+  // Validate timezone id.
+  mozilla::UniquePtr<icu::TimeZone> timeZone(icu::TimeZone::createTimeZone(
+      icu::UnicodeString(timeZoneId, -1, US_INV)));
+  return timeZone && *timeZone != icu::TimeZone::getUnknown();
+}
+
 Result<bool, ICUError> TimeZone::SetDefaultTimeZone(
     Span<const char> aTimeZone) {
 #if MOZ_INTL_USE_ICU_CPP_TIMEZONE
diff --git a/intl/components/src/TimeZone.h b/intl/components/src/TimeZone.h
index 9d0423ef13958..f0c4ba7c528d2 100644
--- a/intl/components/src/TimeZone.h
+++ b/intl/components/src/TimeZone.h
@@ -190,6 +190,8 @@ class TimeZone final {
     return FillBufferWithICUCall(aBuffer, ucal_getHostTimeZone);
   }
 
+  static bool IsValidTimeZoneId(const char* timeZoneId);
+
   /**
    * Set the default time zone.
    */
diff --git a/intl/gtest/moz.build b/intl/gtest/moz.build
index c8e31a34b779d..f1c15faf15b41 100644
--- a/intl/gtest/moz.build
+++ b/intl/gtest/moz.build
@@ -11,3 +11,6 @@ if not (CONFIG["OS_TARGET"] == "WINNT" and CONFIG["TARGET_CPU"] == "aarch64"):
     UNIFIED_SOURCES += ["TestEncoding.cpp"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/hyphenation/glue/moz.build b/intl/hyphenation/glue/moz.build
index 306edca2ebc0d..01b578e49de00 100644
--- a/intl/hyphenation/glue/moz.build
+++ b/intl/hyphenation/glue/moz.build
@@ -20,3 +20,6 @@ FINAL_LIBRARY = "xul"
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     CbindgenHeader("mapped_hyph.h", inputs=["/third_party/rust/mapped_hyph"])
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/l10n/moz.build b/intl/l10n/moz.build
index 6dfc7a4b83c17..aef54ba7477cd 100644
--- a/intl/l10n/moz.build
+++ b/intl/l10n/moz.build
@@ -55,3 +55,6 @@ MOCHITEST_CHROME_MANIFESTS += ["test/mochitest/chrome.toml"]
 SPHINX_TREES["/l10n"] = "docs"
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/l10n/rust/gtest/moz.build b/intl/l10n/rust/gtest/moz.build
index 7c73e04fc8d0f..b3c58161c88fb 100644
--- a/intl/l10n/rust/gtest/moz.build
+++ b/intl/l10n/rust/gtest/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/l10n/test/gtest/moz.build b/intl/l10n/test/gtest/moz.build
index 6d04077a50bc7..ec25d4718ce97 100644
--- a/intl/l10n/test/gtest/moz.build
+++ b/intl/l10n/test/gtest/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/locale/android/moz.build b/intl/locale/android/moz.build
index b0cb0cc6a5227..4e8437203052a 100644
--- a/intl/locale/android/moz.build
+++ b/intl/locale/android/moz.build
@@ -11,3 +11,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "..",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/locale/gtk/moz.build b/intl/locale/gtk/moz.build
index 3b977a97200cc..01e9ac3b61005 100644
--- a/intl/locale/gtk/moz.build
+++ b/intl/locale/gtk/moz.build
@@ -13,3 +13,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "..",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/locale/mac/moz.build b/intl/locale/mac/moz.build
index 68eb6d8d35208..16e9299ddf4d8 100644
--- a/intl/locale/mac/moz.build
+++ b/intl/locale/mac/moz.build
@@ -10,3 +10,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "..",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/locale/moz.build b/intl/locale/moz.build
index 8099d1a6955af..308cb7fd32677 100644
--- a/intl/locale/moz.build
+++ b/intl/locale/moz.build
@@ -95,3 +95,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
         "!oxilangtag_ffi_generated.h",
         "!unic_langid_ffi_generated.h",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/locale/tests/gtest/moz.build b/intl/locale/tests/gtest/moz.build
index bd2a2b8f86e68..03b65c0e39b03 100644
--- a/intl/locale/tests/gtest/moz.build
+++ b/intl/locale/tests/gtest/moz.build
@@ -12,3 +12,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/locale/windows/moz.build b/intl/locale/windows/moz.build
index 9ac234b35491b..fa2c1bdd482f4 100644
--- a/intl/locale/windows/moz.build
+++ b/intl/locale/windows/moz.build
@@ -11,3 +11,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "..",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/locales/moz.build b/intl/locales/moz.build
index 8d8e4037c7fd7..4bc978082caf8 100644
--- a/intl/locales/moz.build
+++ b/intl/locales/moz.build
@@ -63,3 +63,6 @@ filename = "{locale}/hyphenation/hyph_{locale}" + hyphenation_ext
 FINAL_TARGET_FILES.hyphenation += [filename.format(locale=locale) for locale in locales]
 # en-US is a special case: the dic file is named like en_US.
 FINAL_TARGET_FILES.hyphenation += ["en-US/hyphenation/hyph_en_US" + hyphenation_ext]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/lwbrk/gtest/moz.build b/intl/lwbrk/gtest/moz.build
index 092a0f0a86890..3d70e7210b14a 100644
--- a/intl/lwbrk/gtest/moz.build
+++ b/intl/lwbrk/gtest/moz.build
@@ -11,3 +11,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/lwbrk/moz.build b/intl/lwbrk/moz.build
index 359efe8f5b67e..5165fb2a98570 100644
--- a/intl/lwbrk/moz.build
+++ b/intl/lwbrk/moz.build
@@ -53,3 +53,6 @@ if CONFIG["JS_HAS_INTL_API"] and CONFIG["MOZ_ICU4X"]:
     ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/moz.build b/intl/moz.build
index b7043ad47741a..498287bfc193d 100644
--- a/intl/moz.build
+++ b/intl/moz.build
@@ -58,3 +58,6 @@ with Files("icu_sources_data.py"):
     BUG_COMPONENT = ("Firefox Build System", "General")
 
 SPHINX_TREES["/intl"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/strres/moz.build b/intl/strres/moz.build
index fc933fd816b92..a3c19513b9366 100644
--- a/intl/strres/moz.build
+++ b/intl/strres/moz.build
@@ -27,3 +27,6 @@ EXPORTS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/uconv/moz.build b/intl/uconv/moz.build
index f21e4055f94a3..2f71d905b93b6 100644
--- a/intl/uconv/moz.build
+++ b/intl/uconv/moz.build
@@ -30,3 +30,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/uconv/tests/gtest/moz.build b/intl/uconv/tests/gtest/moz.build
index 969fb52c7e792..266c5d9ce1c0c 100644
--- a/intl/uconv/tests/gtest/moz.build
+++ b/intl/uconv/tests/gtest/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/uconv/tests/moz.build b/intl/uconv/tests/moz.build
index b9cad75ed7f62..f34e1c3bf19c0 100644
--- a/intl/uconv/tests/moz.build
+++ b/intl/uconv/tests/moz.build
@@ -11,3 +11,6 @@ TEST_DIRS += [
 XPCSHELL_TESTS_MANIFESTS += ["unit/xpcshell.toml"]
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/unicharutil/moz.build b/intl/unicharutil/moz.build
index ec7b335f9d318..e58fbbdb93343 100644
--- a/intl/unicharutil/moz.build
+++ b/intl/unicharutil/moz.build
@@ -11,3 +11,6 @@ EXPORTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/intl/unicharutil/util/moz.build b/intl/unicharutil/util/moz.build
index 2bbd00415cae9..292151530ceea 100644
--- a/intl/unicharutil/util/moz.build
+++ b/intl/unicharutil/util/moz.build
@@ -35,3 +35,6 @@ GeneratedFile(
 GeneratedFile("IsCombiningDiacritic.h", script="is_combining_diacritic.py", force=True)
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/app/moz.build b/ipc/app/moz.build
index afe1df122b273..84952f76829d9 100644
--- a/ipc/app/moz.build
+++ b/ipc/app/moz.build
@@ -88,3 +88,6 @@ if CONFIG["CC_TYPE"] in ("clang", "gcc"):
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "DOM: Content Processes")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/chromium/gtest/moz.build b/ipc/chromium/gtest/moz.build
index afa175c6385a9..aad5706dfde2a 100644
--- a/ipc/chromium/gtest/moz.build
+++ b/ipc/chromium/gtest/moz.build
@@ -14,3 +14,6 @@ SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/chromium/moz.build b/ipc/chromium/moz.build
index 56f24c24bbecb..29342ad871609 100644
--- a/ipc/chromium/moz.build
+++ b/ipc/chromium/moz.build
@@ -134,3 +134,6 @@ TEST_DIRS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/chromium/src/chrome/common/ipc_message.cc b/ipc/chromium/src/chrome/common/ipc_message.cc
index 472c0fb4e15ba..2bfe5cb16adf4 100644
--- a/ipc/chromium/src/chrome/common/ipc_message.cc
+++ b/ipc/chromium/src/chrome/common/ipc_message.cc
@@ -7,14 +7,19 @@
 #include "chrome/common/ipc_message.h"
 
 #include "base/logging.h"
+#include "ipc_message.h"
 #include "mojo/core/ports/event.h"
 
+#include <cstddef>
 #include <utility>
+#include <cstring>
 
 #include "nsISupportsImpl.h"
 
 namespace IPC {
 
+void (*leakSanitizerCallback)(const char* data, size_t data_len) = nullptr;
+
 //------------------------------------------------------------------------------
 
 const mojo::core::ports::UserMessage::TypeInfo Message::kUserMessageTypeInfo{};
@@ -43,6 +48,9 @@ Message::Message(const char* data, int data_len)
     : UserMessage(&kUserMessageTypeInfo),
       Pickle(sizeof(Header), data, data_len) {
   MOZ_COUNT_CTOR(IPC::Message);
+  if (leakSanitizerCallback != nullptr) {
+    (*leakSanitizerCallback)(data, data_len);
+  }
 }
 
 /*static*/ mozilla::UniquePtr<Message> Message::IPDLMessage(
diff --git a/ipc/chromium/src/chrome/common/ipc_message.h b/ipc/chromium/src/chrome/common/ipc_message.h
index 733ae9e49394f..b27eef37f8a7e 100644
--- a/ipc/chromium/src/chrome/common/ipc_message.h
+++ b/ipc/chromium/src/chrome/common/ipc_message.h
@@ -18,6 +18,7 @@
 #include "mozilla/UniquePtrExtensions.h"
 #include "mozilla/ipc/ScopedPort.h"
 #include "nsTArray.h"
+#include "mozilla/Logging.h"
 
 namespace mozilla {
 
@@ -34,6 +35,8 @@ class MiniTransceiver;
 
 namespace IPC {
 
+extern void (*leakSanitizerCallback)(const char*, size_t);
+
 //------------------------------------------------------------------------------
 
 // Generated by IPDL compiler
diff --git a/ipc/chromium/src/third_party/moz.build b/ipc/chromium/src/third_party/moz.build
index 6572d01aa9a3c..47ef4f34efd81 100644
--- a/ipc/chromium/src/third_party/moz.build
+++ b/ipc/chromium/src/third_party/moz.build
@@ -68,3 +68,6 @@ AllowCompilerWarnings()
 Library('libevent')
 
 FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/fuzzer/IPCFuzzer.cpp b/ipc/fuzzer/IPCFuzzer.cpp
new file mode 100644
index 0000000000000..1cd7961977e36
--- /dev/null
+++ b/ipc/fuzzer/IPCFuzzer.cpp
@@ -0,0 +1,314 @@
+#include "mozilla/ipc/IPCFuzzer.h"
+
+#include "Mutation.h"
+#include "nsNetUtil.h"
+#include "IPCFuzzerCore.h"
+#include "nsIURIMutator.h"
+#include "mozilla/Logging.h"
+#include "mozilla/OriginAttributes.h"
+
+using mozilla::LogLevel;
+static mozilla::LazyLogModule mylogger("my_ipc_logger");
+
+namespace mozilla::ipc {
+
+void IPCFuzzer::mutate_url(::nsString& url_str) {
+  nsCString cStr = NS_ConvertUTF16toUTF8(url_str);
+  return mutate_url(cStr);
+}
+void IPCFuzzer::mutate_origin(::nsString& origin_str) {
+  nsCString cStr = NS_ConvertUTF16toUTF8(origin_str);
+  return mutate_origin(cStr);
+}
+void IPCFuzzer::mutate_host(::nsString& host_str) {
+  nsCString cStr = NS_ConvertUTF16toUTF8(host_str);
+  return mutate_origin(cStr);
+}
+
+void IPCFuzzer::mutate_url(::nsCString& url_str) {
+  MOZ_LOG(mylogger, LogLevel::Debug,
+          ("IPCFuzzer intercept url: %s", url_str.get()));
+
+  // get mutation from queue
+  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation =
+      IPCFuzzerCore::getInstance().dequeue_url_mutation();
+  if (mutation == nullptr) {
+    // no mutation enqueued
+    MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer no url mutation"));
+    return;
+  }
+
+  switch (mutation->kind()) {
+    case Mutation::KIND::REPLACE_WHOLE:
+      // write url from mutation to url string variable
+      mutation->url()->GetSpec(url_str);
+      MOZ_LOG(mylogger, LogLevel::Debug,
+              ("IPCFuzzer replaced url: %s", url_str.get()));
+
+      return;
+    case Mutation::KIND::REPLACE_HOST: {
+      if (!hasHost(mutation->url())) {
+        // replace whole
+        mutation->url()->GetSpec(url_str);
+        MOZ_LOG(
+            mylogger, LogLevel::Debug,
+            ("IPCFuzzer mutation no host, replaced url: %s", url_str.get()));
+
+        return;
+      }  // get mutation from queue
+      ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation =
+          IPCFuzzerCore::getInstance().dequeue_origin_mutation();
+      if (mutation == nullptr) {  // no mutation enqueued
+        return;
+      }
+
+      // parse url string
+      nsresult rv;
+      nsCOMPtr<nsIURI> parsed_url;
+      rv = NS_NewURI(getter_AddRefs(parsed_url), url_str);
+      if (NS_FAILED(rv)) {
+        MOZ_LOG(mylogger, LogLevel::Error, ("IPCFuzzer parsing url failed"));
+        return;  // parsing failed
+      }
+
+      if (!hasHost(parsed_url)) {
+        // replace whole
+        mutation->url()->GetSpec(url_str);
+        MOZ_LOG(mylogger, LogLevel::Debug,
+                ("IPCFuzzer url no host, replaced url: %s", url_str.get()));
+        return;
+      }
+
+      // read replacements from mutation
+      nsAutoCString host;
+      int32_t port;
+      mutation->url()->GetHost(host);
+      mutation->url()->GetPort(&port);
+
+      rv = NS_MutateURI(parsed_url)
+               .SetHost(host)
+               .SetPort(port)
+               .Finalize(parsed_url);
+      if (NS_FAILED(rv)) {
+        MOZ_LOG(mylogger, LogLevel::Error, ("IPCFuzzer mutating url failed"));
+
+        return;
+      }
+
+      // write mutated url to url string variable
+      parsed_url->GetSpec(url_str);
+      MOZ_LOG(mylogger, LogLevel::Debug,
+              ("IPCFuzzer replaced host: %s", url_str.get()));
+    } break;
+  }
+}
+
+void IPCFuzzer::mutate_origin(::nsCString& origin_str) {
+  MOZ_LOG(mylogger, LogLevel::Debug,
+          ("IPCFuzzer intercept origin: %s", origin_str.get()));
+
+  // get mutation from queue
+  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation =
+      IPCFuzzerCore::getInstance().dequeue_origin_mutation();
+
+  if (mutation == nullptr) {
+    // no mutation enqueued
+    MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer no origin mutation"));
+    return;
+  }
+
+  switch (mutation->kind()) {
+    case Mutation::KIND::REPLACE_WHOLE:
+      // write origin from mutation to origin string variable
+      origin_str = getOrigin(mutation->url());
+      MOZ_LOG(mylogger, LogLevel::Debug,
+              ("IPCFuzzer replaced origin: %s", origin_str.get()));
+      return;
+    case Mutation::KIND::REPLACE_HOST: {
+      if (!hasHost(mutation->url())) {
+        // replace whole
+        origin_str = getOrigin(mutation->url());
+        MOZ_LOG(mylogger, LogLevel::Debug,
+                ("IPCFuzzer mutation no host, replaced origin: %s",
+                 origin_str.get()));
+        return;
+      }
+
+      // parse origin string
+      nsresult rv;
+      nsCOMPtr<nsIURI> parsed_origin;
+      rv = NS_NewURI(getter_AddRefs(parsed_origin), origin_str);
+      if (NS_FAILED(rv)) {
+        MOZ_LOG(mylogger, LogLevel::Error, ("IPCFuzzer parsing origin failed"));
+        return;  // parsing failed
+      }
+
+      if (!hasHost(parsed_origin)) {
+        // replace whole
+        origin_str = getOrigin(mutation->url());
+        MOZ_LOG(mylogger, LogLevel::Debug,
+                ("IPCFuzzer origin no host, replaced origin: %s",
+                 origin_str.get()));
+        return;
+      }
+
+      // read replacements from mutation
+      nsAutoCString host;
+      int32_t port;
+      mutation->url()->GetHost(host);
+      mutation->url()->GetPort(&port);
+
+      rv = NS_MutateURI(parsed_origin)
+               .SetHost(host)
+               .SetPort(port)
+               .Finalize(parsed_origin);
+      if (NS_FAILED(rv)) {
+        MOZ_LOG(mylogger, LogLevel::Error,
+                ("IPCFuzzer mutating origin failed"));
+        return;
+      }
+
+      // write mutated origin to origin string variable
+      origin_str = getOrigin(parsed_origin);
+      MOZ_LOG(mylogger, LogLevel::Debug,
+              ("IPCFuzzer replaced host: %s", origin_str.get()));
+    } break;
+  }
+}
+
+void IPCFuzzer::mutate_host(nsCString& host_str) {
+  MOZ_LOG(mylogger, LogLevel::Debug,
+          ("IPCFuzzer intercept host: %s", host_str.get()));
+
+  // get mutation from queue
+  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation =
+      IPCFuzzerCore::getInstance().dequeue_origin_mutation();
+
+  if (mutation == nullptr) {
+    // no mutation enqueued
+    MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer no origin mutation"));
+    return;
+  }
+
+  if (!hasHost(mutation->url())) {
+    MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer mutation no host"));
+    return;
+  }
+
+  mutation->url()->GetHost(host_str);
+  MOZ_LOG(mylogger, LogLevel::Debug,
+          ("IPCFuzzer replaced host: %s", host_str.get()));
+}
+
+mozilla::UniquePtr<::mozilla::ipc::PrincipalInfo>
+IPCFuzzer::replacePrincipalInfo() {
+  ::mozilla::UniquePtr<::mozilla::ipc::Mutation> mutation =
+      IPCFuzzerCore::getInstance().dequeue_origin_mutation();
+  if (mutation == nullptr) {
+    return nullptr;
+  }
+
+  if (mutation->isSystemPrincipal()) {
+    const ::mozilla::ipc::SystemPrincipalInfo spi =
+        ::mozilla::ipc::SystemPrincipalInfo();
+    ::mozilla::UniquePtr<::mozilla::ipc::PrincipalInfo> pi(
+        new ::mozilla::ipc::PrincipalInfo(spi));
+    return pi;
+  }
+
+  ::mozilla::OriginAttributes oa = ::mozilla::OriginAttributes();
+  nsCString host, spec;
+  mutation->url()->GetHost(host);
+  mutation->url()->GetSpec(spec);
+
+  nsCString origin = getOrigin(mutation->url());
+
+  const ::mozilla::ipc::ContentPrincipalInfo cpi =
+      ::mozilla::ipc::ContentPrincipalInfo(oa, origin, spec, mozilla::Nothing(),
+                                           host);
+  ::mozilla::UniquePtr<::mozilla::ipc::PrincipalInfo> pi(
+      new ::mozilla::ipc::PrincipalInfo(cpi));
+  return pi;
+}
+
+bool IPCFuzzer::isJSUrl(nsCOMPtr<nsIURI> url) {
+  return url->SchemeIs("javascript");
+}
+bool IPCFuzzer::isBlobUrl(nsCOMPtr<nsIURI> url) {
+  return url->SchemeIs("blob");
+}
+bool IPCFuzzer::isDataUrl(nsCOMPtr<nsIURI> url) {
+  return url->SchemeIs("data");
+}
+
+nsCString IPCFuzzer::getOrigin(const nsCOMPtr<nsIURI>& url) {
+  nsCString scheme, host, hostPort;
+  url->GetScheme(scheme);
+  url->GetHostPort(hostPort);
+  return scheme + "://"_ns + hostPort;
+}
+
+bool IPCFuzzer::hasHost(nsCOMPtr<nsIURI> url) {
+  nsAutoCString host;
+  url->GetHost(host);
+  return !host.IsEmpty();
+}
+
+// void IPCFuzzer::log(const char* component) {
+//   //   MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer: %s", component));
+// }
+
+// void IPCFuzzer::log(const nsACString& str, const char* component) {
+//   //   nsCString truncatedStr(str);
+//   //   MOZ_LOG(mylogger, LogLevel::Debug,
+//   //           ("IPCFuzzer: %s %s", component, truncatedStr.Data()));
+// }
+
+// void IPCFuzzer::log(const ::mozilla::dom::IPCClientInfo& clientInfo,
+//                     const char* component) {
+//   //   PrincipalInfo principalInfo = clientInfo.principalInfo();
+
+//   //   switch (principalInfo.type()) {
+//   //     case PrincipalInfo::TContentPrincipalInfo:
+//   //       MOZ_LOG(mylogger, LogLevel::Debug,
+//   //               ("IPCFuzzer: %s %s", component,
+//   //                principalInfo.get_ContentPrincipalInfo().spec().get()));
+//   //       break;
+//   //     case PrincipalInfo::TNullPrincipalInfo:
+//   //       MOZ_LOG(mylogger, LogLevel::Debug,
+//   //               ("IPCFuzzer: %s %s", component, "NullPrincipalInfo"));
+//   //       break;
+//   //     case PrincipalInfo::TExpandedPrincipalInfo:
+//   //       MOZ_LOG(mylogger, LogLevel::Debug,
+//   //               ("IPCFuzzer: %s %s", component, "ExpandedPrincipalInfo"));
+//   //       break;
+//   //     case PrincipalInfo::TSystemPrincipalInfo:
+//   //       MOZ_LOG(mylogger, LogLevel::Debug,
+//   //               ("IPCFuzzer: %s %s", component, "SystemPrincipalInfo"));
+//   //       break;
+//   //     default:
+//   //       MOZ_LOG(mylogger, LogLevel::Debug,
+//   //               ("IPCFuzzer: %s %s", component, "Default"));
+//   //       break;
+//   //   }
+
+//   //   MOZ_LOG(mylogger, LogLevel::Debug,
+//   //   ("IPCFuzzer: %s %s", component, clientInfo.url().get()));
+// }
+
+// void IPCFuzzer::log(const ::mozilla::ipc::PrincipalInfo& principalInfo,
+//                     const char* component) {
+//   //   MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer: %s", component));
+// }
+
+// void IPCFuzzer::log_param(const ::nsString& str, const char* name) {
+//   // ::nsCString cstr(str.get(), str.Length());
+//   // log_param(cstr, name);
+//   // MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer %s: %s", name, str.get()));
+// }
+
+// void IPCFuzzer::log_param(const ::nsCString& str, const char* name) {
+//   // MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer %s: %s", name, str.get()));
+// }
+
+}  // namespace mozilla::ipc
\ No newline at end of file
diff --git a/ipc/fuzzer/IPCFuzzer.h b/ipc/fuzzer/IPCFuzzer.h
new file mode 100644
index 0000000000000..ba9410b15e495
--- /dev/null
+++ b/ipc/fuzzer/IPCFuzzer.h
@@ -0,0 +1,50 @@
+#ifndef mozilla_ipc_IPCFuzzer_h
+#define mozilla_ipc_IPCFuzzer_h
+
+// #include "mozilla/ipc/ProtocolUtils.h"
+#include "mozilla/ipc/PBackgroundSharedTypes.h"
+// #include "mozilla/dom/ClientIPCTypes.h"
+
+#include "nsIURI.h"
+#include "mozilla/UniquePtr.h"
+
+#include "mozilla/dom/ClientIPCTypes.h"
+#include "mozilla/ipc/PBackgroundSharedTypes.h"
+
+namespace mozilla::ipc {
+
+class IPCFuzzer {
+ public:
+  // static void log(const char* component);
+  // static void log(const nsACString& str, const char* component);
+  // static void log(const ::mozilla::dom::IPCClientInfo& clientInfo,
+  //                 const char* component);
+  // static void log(const ::mozilla::ipc::PrincipalInfo& principalInfo,
+  //                 const char* component);
+  // static void log_param(const ::nsString& str, const char* name);
+  // static void log_param(const ::nsCString& str, const char* name);
+
+  static void mutate_url(::nsString& url);
+  static void mutate_origin(::nsString& origin);
+  static void mutate_host(::nsString& host);
+
+  static void mutate_url(::nsCString& url);
+  static void mutate_origin(::nsCString& origin);
+  static void mutate_host(::nsCString& host);
+
+  static mozilla::UniquePtr<::mozilla::ipc::PrincipalInfo> replacePrincipalInfo();
+
+ private:
+  IPCFuzzer() = delete;
+  ~IPCFuzzer() = delete;
+
+  static bool isJSUrl(nsCOMPtr<nsIURI> url);
+  static bool isBlobUrl(nsCOMPtr<nsIURI> url);
+  static bool isDataUrl(nsCOMPtr<nsIURI> url);
+  static bool hasHost(nsCOMPtr<nsIURI> url);
+  static nsCString getOrigin(const nsCOMPtr<nsIURI>& url);
+};
+
+}  // namespace mozilla::ipc
+
+#endif  // mozilla_ipc_IPCFuzzer_h
\ No newline at end of file
diff --git a/ipc/fuzzer/IPCFuzzerCore.cpp b/ipc/fuzzer/IPCFuzzerCore.cpp
new file mode 100644
index 0000000000000..b9bb2c43ab61d
--- /dev/null
+++ b/ipc/fuzzer/IPCFuzzerCore.cpp
@@ -0,0 +1,159 @@
+#include "mozilla/ipc/IPCFuzzerCore.h"
+#include <sys/types.h>
+#include <cstdint>
+#include "mozilla/Logging.h"
+
+namespace mozilla::ipc {
+
+char magicString[MAGIC_LENGTH+1] = "8bf18cb9455f4a8e8fa93d14ab5ebb5d";
+
+bool containsMagicString(const char *data, size_t data_len){
+  // search for utf-8 magic string
+  if (data_len < MAGIC_LENGTH) {
+    return false;
+  }
+  for (size_t i = 0; i < data_len - MAGIC_LENGTH; i++) {
+    bool found = true;
+    for (size_t j = 0; j < MAGIC_LENGTH; j++) {
+      if (data[i + j] != magicString[j]) {
+        found = false;
+        break;
+      }
+    }
+    if (found) {
+      return true;
+    }
+  }
+  return false;
+}
+
+// Basic function to append a character to a buffer, expanding it if necessary
+void appendChar(char *&str, int &len, int &cap, char c) {
+    if (len + 1 >= cap) {
+        cap *= 2;  // Double the capacity
+        char *newStr = new char[cap];  // Allocate new buffer
+        for (int i = 0; i < len; ++i) {
+            newStr[i] = str[i];  // Copy old content
+        }
+        delete[] str;  // Free old buffer
+        str = newStr;
+    }
+    str[len++] = c;  // Append the character
+    str[len] = '\0';  // Null-terminate the string
+}
+
+// Function to append a hexadecimal representation of a byte to a string
+void appendHex(char *&str, int &len, int &cap, unsigned char byte) {
+    const char *hexDigits = "0123456789ABCDEF";
+    appendChar(str, len, cap, hexDigits[byte >> 4]);
+    appendChar(str, len, cap, hexDigits[byte & 0x0F]);
+}
+
+// Main hexDump function that returns a dynamically allocated string
+char* hexDump(const char* data, size_t len) {
+    int capacity = 256;  // Initial capacity of the string
+    char *result = new char[capacity];
+    int resultLen = 0;
+    result[resultLen] = '\0';  // Start with an empty string
+
+    for (size_t i = 0; i < len; ++i) {
+        unsigned char byte = data[i];
+        if (byte >= 0x20 && byte < 0x7E) {  // Printable ASCII range
+            appendChar(result, resultLen, capacity, byte);
+        } else {
+            appendChar(result, resultLen, capacity, '\\');
+            appendChar(result, resultLen, capacity, 'x');
+            appendHex(result, resultLen, capacity, byte);
+        }
+    }
+
+    return result;
+}
+
+void leakSanitizer(const char* data, size_t data_len) {
+  if (data != nullptr && data_len > 0 && containsMagicString(data, data_len)) {
+    char* output = hexDump(data, data_len);
+    MOZ_LOG(UXSSLogger, LogLevel::Debug, ("[UXSS] leak in IPC message: %s [/UXSS]", output));
+    delete[] output;
+  }
+}
+
+// void log_leak(const char* data, unsigned int data_len) {
+//   char* output = hexDump(data, data_len);
+//   MOZ_LOG(UXSSLogger, LogLevel::Debug, ("[UXSS] leak in IPC message: %s", output));
+//   delete[] output;
+// }
+
+::mozilla::StaticMutex IPCFuzzerCore::singletonMutex;
+
+void IPCFuzzerCore::activate_leak_sanitizer() {
+  IPC::leakSanitizerCallback = &leakSanitizer;
+}
+
+void IPCFuzzerCore::deactivate_renderer_checks(uint64_t flag) {
+  checks_deactivated = true;
+  deactivate_renderer_checks_flag = flag;
+}
+
+::mozilla::UniquePtr<Mutation> IPCFuzzerCore::dequeue_url_mutation() {
+  urlMutationsMutex.Lock();
+  if (urlMutations.GetSize() == 0) {
+    urlMutationsMutex.Unlock();
+    return nullptr;
+  }
+  ::mozilla::UniquePtr<Mutation> mutation(urlMutations.PopFront());
+  urlMutationsMutex.Unlock();
+  return mutation;
+}
+
+::mozilla::UniquePtr<Mutation> IPCFuzzerCore::dequeue_origin_mutation() {
+  originMutationsMutex.Lock();
+  if (originMutations.GetSize() == 0) {
+    originMutationsMutex.Unlock();
+    return nullptr;
+  }
+  ::mozilla::UniquePtr<Mutation> mutation(originMutations.PopFront());
+  originMutationsMutex.Unlock();
+  return mutation;
+}
+
+void IPCFuzzerCore::enqueue_mutation(
+    ::mozilla::UniquePtr<::mozilla::ipc::Mutation> mutation) {
+  switch (mutation->target()) {
+    case Mutation::TARGET::URL: {
+      urlMutationsMutex.Lock();
+      urlMutations.Push(mutation.release());
+      urlMutationsMutex.Unlock();
+    } break;
+    case Mutation::TARGET::ORIGIN: {
+      originMutationsMutex.Lock();
+      originMutations.Push(mutation.release());
+      originMutationsMutex.Unlock();
+    } break;
+  }
+}
+
+bool IPCFuzzerCore::check_isolation(const ::nsACString& url) {
+  // parse url
+  nsCOMPtr<nsIURI> uri;
+  nsresult rv = NS_NewURI(getter_AddRefs(uri), url);
+  if (NS_FAILED(rv)) {
+    return false;
+  }
+
+  processLockMutex.Lock();
+  if (!processLock) {
+    processLock = std::move(uri);
+    processLockMutex.Unlock();
+    return false;
+  }
+
+  bool equal = true;
+  rv = processLock->Equals(uri, &equal);
+  processLockMutex.Unlock();
+  if (NS_FAILED(rv)) {
+    return false;
+  }
+  return !equal;
+}
+}  // namespace mozilla::ipc
\ No newline at end of file
diff --git a/ipc/fuzzer/IPCFuzzerCore.h b/ipc/fuzzer/IPCFuzzerCore.h
new file mode 100644
index 0000000000000..c4a230990078b
--- /dev/null
+++ b/ipc/fuzzer/IPCFuzzerCore.h
@@ -0,0 +1,75 @@
+#ifndef mozilla_ipc_IPCFuzzerCore_h
+#define mozilla_ipc_IPCFuzzerCore_h
+
+#include <sys/types.h>
+#include <cstdint>
+#include "nsDeque.h"
+#include "Mutation.h"
+#include "mozilla/Mutex.h"
+#include "mozilla/StaticMutex.h"
+#include "mozilla/UniquePtr.h"
+#include "mozilla/Logging.h"
+#include "chrome/common/ipc_message.h"
+
+
+namespace mozilla::ipc {
+  using mozilla::LogLevel;
+  static mozilla::LazyLogModule IPCLogger("ipc_logger");
+  static mozilla::LazyLogModule UXSSLogger("uxss_logger");
+
+
+  #define MAGIC_LENGTH 32
+  extern char magicString[MAGIC_LENGTH+1];
+
+  extern void leak_sanitizer(const char* data, size_t data_len);
+  bool containsMagicString(const char* data, size_t data_len);
+  char* hexDump(const char* data, size_t len);
+  void appendHex(char *&str, int &len, int &cap, unsigned char byte);
+  void appendChar(char *&str, int &len, int &cap, char c);
+
+class IPCFuzzerCore {
+  // Singleton class to keep process-global state
+  // https://stackoverflow.com/questions/1008019/how-do-you-implement-the-singleton-design-pattern
+
+ public:
+  // Singleton implementation
+  static IPCFuzzerCore& getInstance() {
+    singletonMutex.Lock();
+    static IPCFuzzerCore instance;
+    singletonMutex.Unlock();
+    return instance;
+  }
+  IPCFuzzerCore(IPCFuzzerCore const&) = delete;
+  void operator=(IPCFuzzerCore const&) = delete;
+
+  void enqueue_mutation(::mozilla::UniquePtr<::mozilla::ipc::Mutation> mutation);
+  bool check_isolation(const ::nsACString& url);
+
+  void deactivate_renderer_checks(uint64_t flag);
+  bool renderer_checks_deactivated() { return checks_deactivated; }
+  void activate_leak_sanitizer();
+
+  uint64_t deactivate_renderer_checks_flag = 0;
+
+  ::mozilla::UniquePtr<Mutation> dequeue_url_mutation();
+  ::mozilla::UniquePtr<Mutation> dequeue_origin_mutation();
+
+ private:
+  IPCFuzzerCore() {}
+
+  static mozilla::StaticMutex singletonMutex;
+
+  bool checks_deactivated = false;
+
+  nsDeque<Mutation> urlMutations;
+  mozilla::Mutex urlMutationsMutex{"IPCFuzzerCore::urlMutationsMutex"};
+
+  nsDeque<Mutation> originMutations;
+  mozilla::Mutex originMutationsMutex{"IPCFuzzerCore::originMutationsMutex"};
+
+  nsCOMPtr<nsIURI> processLock = nullptr;
+  mozilla::Mutex processLockMutex{"IPCFuzzerCore::processLockMutex"};
+};
+}  // namespace mozilla::ipc
+
+#endif  // mozilla_ipc_IPCFuzzerCore_h
\ No newline at end of file
diff --git a/ipc/fuzzer/Mutation.cpp b/ipc/fuzzer/Mutation.cpp
new file mode 100644
index 0000000000000..79cff82802a5f
--- /dev/null
+++ b/ipc/fuzzer/Mutation.cpp
@@ -0,0 +1,24 @@
+#include "mozilla/ipc/Mutation.h"
+
+#include "Mutation.h"
+#include "nsNetCID.h"
+#include "nsIURI.h"
+#include "nsCOMPtr.h"
+#include "nsNetUtil.h"
+
+namespace mozilla::ipc {
+Mutation::Mutation(TARGET target, KIND kind, const nsACString& uri, bool systemPrincipal)
+    : mTarget(target), mKind(kind), systemPrincipal(systemPrincipal) {
+  // nsCOMPtr<nsIURI> mURI;
+  nsresult rv = NS_NewURI(getter_AddRefs(mURI), uri);
+
+  if (NS_FAILED(rv)) {
+    // TODO(JN): add log
+    NS_NewURI(getter_AddRefs(mURI), "");
+  }
+
+}
+
+
+
+}  // namespace mozilla::ipc
diff --git a/ipc/fuzzer/Mutation.h b/ipc/fuzzer/Mutation.h
new file mode 100644
index 0000000000000..99634f5a81e86
--- /dev/null
+++ b/ipc/fuzzer/Mutation.h
@@ -0,0 +1,36 @@
+#ifndef mozilla_ipc_Mutation_h
+#define mozilla_ipc_Mutation_h
+
+#include "nsNetCID.h"
+#include "nsIURI.h"
+#include "nsCOMPtr.h"
+
+namespace mozilla::ipc {
+class Mutation {
+ public:
+  enum class TARGET { URL, ORIGIN };
+  enum class KIND { REPLACE_HOST, REPLACE_WHOLE };
+
+  Mutation(TARGET target, KIND kind, nsCOMPtr<nsIURI> uri, bool systemPrincipal = false)
+      : mTarget(target),
+        mKind(kind),
+        mURI(std::move(uri)),
+        systemPrincipal(systemPrincipal) {}
+
+  Mutation(TARGET target, KIND kind, const nsACString& uri,
+           bool systemPrincipal = false);
+
+  const TARGET& target() const { return mTarget; }
+  const KIND& kind() const { return mKind; }
+  nsCOMPtr<nsIURI> url() const { return mURI; }
+  bool isSystemPrincipal() const { return systemPrincipal; }
+
+ private:
+  TARGET mTarget;
+  KIND mKind;
+  nsCOMPtr<nsIURI> mURI;
+  bool systemPrincipal;
+};
+}  // namespace mozilla::ipc
+
+#endif  // mozilla_ipc_Mutation_h
\ No newline at end of file
diff --git a/ipc/fuzzer/moz.build b/ipc/fuzzer/moz.build
new file mode 100644
index 0000000000000..1b6e015c28675
--- /dev/null
+++ b/ipc/fuzzer/moz.build
@@ -0,0 +1,39 @@
+# -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
+# vim: set filetype=python:
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this
+# file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+#with Files("**"):
+#    BUG_COMPONENT = ("Core", "Content Processes")
+
+
+EXPORTS.mozilla.ipc += [
+    "IPCFuzzer.h",
+    "IPCFuzzerCore.h",
+    "Mutation.h",
+]
+
+UNIFIED_SOURCES += [
+    "IPCFuzzer.cpp",
+    "IPCFuzzerCore.cpp",
+    "Mutation.cpp",
+]
+
+FINAL_LIBRARY = "xul"
+
+IPDL_SOURCES += [
+#    "PFileSystemParams.ipdlh",
+#    "PFileSystemRequest.ipdl",
+]
+
+include("/ipc/chromium/chromium-config.mozbuild")
+
+LOCAL_INCLUDES += [
+    "/accessible/xpcom",
+    "/dom/base",
+    "/netwerk/base",
+]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/glue/moz.build b/ipc/glue/moz.build
index bb23b29a453c2..f5cb740cabf8e 100644
--- a/ipc/glue/moz.build
+++ b/ipc/glue/moz.build
@@ -311,3 +311,6 @@ if CONFIG["ENABLE_TESTS"]:
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/glue/test/browser/moz.build b/ipc/glue/test/browser/moz.build
index 671bdea5de0d1..113d387d92278 100644
--- a/ipc/glue/test/browser/moz.build
+++ b/ipc/glue/test/browser/moz.build
@@ -13,3 +13,6 @@ BROWSER_CHROME_MANIFESTS += [
     "browser_child_hang.toml",
 ]
 MOCHITEST_MANIFESTS += ["mochitest_audio_off.toml", "mochitest_audio_on.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/glue/test/gtest/moz.build b/ipc/glue/test/gtest/moz.build
index b0af6d80cd7b9..9454ded6855dc 100644
--- a/ipc/glue/test/gtest/moz.build
+++ b/ipc/glue/test/gtest/moz.build
@@ -20,3 +20,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/glue/test/utility_process_xpcom/moz.build b/ipc/glue/test/utility_process_xpcom/moz.build
index f04b436cbe1ce..b2d1cebd3d246 100644
--- a/ipc/glue/test/utility_process_xpcom/moz.build
+++ b/ipc/glue/test/utility_process_xpcom/moz.build
@@ -19,3 +19,6 @@ XPIDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/gtest/moz.build b/ipc/gtest/moz.build
index e56b0754ec8d0..63f057e698936 100644
--- a/ipc/gtest/moz.build
+++ b/ipc/gtest/moz.build
@@ -18,3 +18,6 @@ SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/ipdl/ipdl/ast.py b/ipc/ipdl/ipdl/ast.py
index ff083cf628580..f7721d49902ff 100644
--- a/ipc/ipdl/ipdl/ast.py
+++ b/ipc/ipdl/ipdl/ast.py
@@ -2,6 +2,7 @@
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
+from typing import Any
 from .util import hash_str
 
 
@@ -344,6 +345,12 @@ class StructDecl(NamespacedNode):
         # for e.g. C++ constructors when new fields are added.
         self.packed_field_ordering = []
 
+    def __str__(self):
+        return f"StructDecl(name={self.name}, fields={self.fields}, attributes={self.attributes})"
+
+    def __repr__(self):
+        return str(self)
+
 
 class UnionDecl(NamespacedNode):
     def __init__(self, loc, name, components, attributes):
@@ -475,3 +482,9 @@ class Decl(Node):
         self.type = None
         self.scope = None
         self.attributes = {}
+
+    def __str__(self) -> str:
+        return f"{self.progname} {self.type.fullname()}"
+
+    def __repr__(self) -> str:
+        return str(self)
diff --git a/ipc/ipdl/ipdl/cxx/ast.py b/ipc/ipdl/ipdl/cxx/ast.py
index a4aba985717bb..767a0e477cd21 100644
--- a/ipc/ipdl/ipdl/cxx/ast.py
+++ b/ipc/ipdl/ipdl/cxx/ast.py
@@ -741,6 +741,12 @@ class ExprVar(Node):
         Node.__init__(self)
         self.name = name
 
+    def __str__(self) -> str:
+        return f"Exprvar {self.name}"
+
+    def __repr__(self) -> str:
+        return str(self)
+
 
 ExprVar.THIS = ExprVar("this")
 
@@ -777,6 +783,12 @@ class ExprPrefixUnop(Node):
         self.expr = expr
         self.op = op
 
+    def __str__(self) -> str:
+        return f"ExprPrefixUnop {self.expr} {self.op}"
+
+    def __repr__(self) -> str:
+        return str(self)
+
 
 class ExprNot(ExprPrefixUnop):
     def __init__(self, expr):
@@ -835,6 +847,12 @@ class ExprSelect(Node):
         else:
             self.field = field
 
+    def __str__(self) -> str:
+        return f"ExprSelect {self.obj} {self.op} {self.field}"
+
+    def __repr__(self) -> str:
+        return str(self)
+
 
 class ExprAssn(Node):
     def __init__(self, lhs, rhs, op="="):
@@ -855,6 +873,12 @@ class ExprCall(Node):
         self.func = func
         self.args = args
 
+    def __str__(self) -> str:
+        return f"Exprcall {self.func}"
+
+    def __repr__(self) -> str:
+        return str(self)
+
 
 class ExprMove(ExprCall):
     def __init__(self, arg):
diff --git a/ipc/ipdl/ipdl/lower.py b/ipc/ipdl/ipdl/lower.py
index 414df4fe60590..6f36d5e6ddd22 100644
--- a/ipc/ipdl/ipdl/lower.py
+++ b/ipc/ipdl/ipdl/lower.py
@@ -9,9 +9,11 @@ import itertools
 
 import ipdl.ast
 import ipdl.builtin
+import ipdl.type
+import ipdl.cxx.ast
 from ipdl.cxx.ast import *
 from ipdl.cxx.code import *
-from ipdl.type import ActorType, UnionType, TypeVisitor, builtinHeaderIncludes
+from ipdl.type import ActorType, UnionType, TypeVisitor, builtinHeaderIncludes, ImportedCxxType
 from ipdl.util import hash_str
 
 
@@ -917,6 +919,12 @@ class _StructField(_CompoundTypeComponent):
     def memberVar(self):
         return ExprVar(self.name + "_")
 
+    def __str__(self):
+        return f"_StructField(name={self.name}, type={self.ipdltype})"
+
+    def __repr__(self):
+        return str(self)
+
 
 class UnionDecl(ipdl.ast.UnionDecl, HasFQName):
     def callType(self, var=None):
@@ -1589,6 +1597,10 @@ class _GenerateProtocolCode(ipdl.ast.Visitor):
             )
         )
 
+        # PATCH(JN)
+        cf.addthings([Whitespace.NL, CppDirective('include', '"mozilla/ipc/IPCFuzzer.h"'), Whitespace.NL])
+
+
         if self.protocol:
             # construct the namespace into which we'll stick all our defns
             ns = Namespace(self.protocol.name)
@@ -1970,16 +1982,102 @@ class _ParamTraits:
             var = ExprMove(var)
         return ExprCall(ExprVar("IPC::WriteParam"), args=[writervar, var])
 
+    @classmethod
+    def filter_keywords(cls, word):
+        url_keywords = ["uri", "spec", "url"]
+        origin_keywords = ["origin", "site", "principal"]
+        host_keywords = ["host", "domain"]
+
+        if any([keyword in word.lower() for keyword in url_keywords]):
+            return "url"
+        if any([keyword in word.lower() for keyword in origin_keywords]):
+            return "origin"
+        if any([keyword in word.lower() for keyword in host_keywords]):
+            return "host"
+        return None
+
     @classmethod
     def checkedWrite(cls, ipdltype, var, writervar, sentinelKey):
         assert sentinelKey
         block = Block()
 
-        block.addstmts(
-            [
-                StmtExpr(cls.write(var, writervar, ipdltype)),
-            ]
-        )
+        # TODO(JN) inject fuzzer hooks here
+        # print(f"checkedWrite: {ipdltype} {type(ipdltype)} {var} {writervar}")
+        insert_hook = False
+        if isinstance(ipdltype, ipdl.type.ImportedCxxType):
+            param_type = ipdltype.fullname()
+            if param_type in ["::nsCString", "::nsString" ]:
+                if isinstance(var, ipdl.cxx.ast.ExprVar):
+                    param_name = var.name
+                    keyword_match = cls.filter_keywords(param_name)
+                    if keyword_match is not None:
+                        insert_hook = True
+                        var_copy = ipdl.cxx.ast.ExprVar(f"{param_name}_copy")
+                        block.addstmts([
+                            StmtCode("// INTERCEPTED VAR"),
+                            StmtCode(f"{param_type} {param_name}_copy({param_name});"),
+                            # StmtCode(f'::mozilla::ipc::IPCFuzzer::log_param({param_name}_copy, "{param_name}");')
+                            ])
+
+                        if keyword_match == "url":
+                            block.addstmts([
+                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_url({param_name}_copy);'),
+                                StmtExpr(cls.write(var_copy, writervar, ipdltype)),
+                                ])
+                        elif keyword_match == "origin":
+                            block.addstmts([
+                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_origin({param_name}_copy);'),
+                                StmtExpr(cls.write(var_copy, writervar, ipdltype)),
+                                ])
+                        elif keyword_match == "host":
+                            block.addstmts([
+                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_host({param_name}_copy);'),
+                                StmtExpr(cls.write(var_copy, writervar, ipdltype)),
+                                ])
+                        else:
+                            raise Exception(f"Unknown keyword match {keyword_match}")
+
+
+                elif isinstance(var, ipdl.cxx.ast.ExprCall) and isinstance(var.func, ipdl.cxx.ast.ExprSelect):
+                    param_name = var.func.field.name
+                    keyword_match = cls.filter_keywords(param_name)
+                    if keyword_match is not None:
+                        insert_hook = True
+                        var_copy = ipdl.cxx.ast.ExprVar(f"{param_name}_copy")
+                        param_access = f"{var.func.obj.name}{var.func.op}{param_name}()"
+                        block.addstmts([
+                            StmtCode("// INTERCEPTED MEMBER"),
+                            StmtCode(f"{param_type} {param_name}_copy({param_access});"),
+                            # StmtCode(f'::mozilla::ipc::IPCFuzzer::log_param({param_name}_copy, "{param_name}");')
+                            ])
+
+                        if keyword_match == "url":
+                            block.addstmts([
+                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_url({param_name}_copy);'),
+                                StmtExpr(cls.write(var_copy, writervar, None)),
+                                ])
+                        elif keyword_match == "origin":
+                            block.addstmts([
+                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_origin({param_name}_copy);'),
+                                StmtExpr(cls.write(var_copy, writervar, None)),
+                                ])
+                        elif keyword_match == "host":
+                            block.addstmts([
+                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_host({param_name}_copy);'),
+                                StmtExpr(cls.write(var_copy, writervar, None)),
+                                ])
+                        else:
+                            raise Exception(f"Unknown keyword match {keyword_match}")
+                else:
+                    print(f"CHECK {var}")
+
+        if not insert_hook:
+            block.addstmts(
+                [
+                    StmtExpr(cls.write(var, writervar, ipdltype)),
+                ]
+            )
+
         block.addstmts(cls.writeSentinel(writervar, sentinelKey))
         return block
 
@@ -2218,6 +2316,8 @@ class _ParamTraits:
         write = []
         read = []
 
+        # print(f"STRUCT {sd}")
+
         # First serialize/deserialize all non-pod data in IPDL order. These need
         # to be read/written first because they'll be used to invoke the IPDL
         # struct's constructor.
@@ -2283,6 +2383,7 @@ class _ParamTraits:
             cxxtype, write, read, needsmove=_cxxTypeNeedsMoveForSend(structtype)
         )
 
+
     @classmethod
     def unionPickling(cls, uniontype):
         # NOTE: Not using _cxxBareType here as we don't have a side
@@ -2293,12 +2394,63 @@ class _ParamTraits:
         alias = "union__"
         typevar = ExprVar("type")
 
+        # TODO(JN) intercept PrincipalInfo here
+        fuzzedWrite = []
+        fuzzedUnionTypes = ["PrincipalInfo"]
+        if uniontype.name() in fuzzedUnionTypes:
+            var_replaced = ExprVar("var_replaced")
+            typevar_replaced = ExprVar("type_replaced")
+
+            writeswitch_replaced = StmtSwitch(typevar_replaced)
+            for c in ud.components:
+                caselabel = CaseLabel(alias + "::" + c.enum())
+                origenum = c.enum()
+
+                writecase = StmtBlock()
+                wstmt = cls.checkedWrite(
+                    c.ipdltype,
+                    ExprCall(ExprSelect(var_replaced, "->", c.getTypeName())),
+                    cls.writervar,
+                    sentinelKey=c.enum(),
+                )
+                writecase.addstmts([wstmt, StmtReturn()])
+                writeswitch_replaced.addcase(caselabel, writecase)
+
+            # Add the error default case
+            writeswitch_replaced.addcase(
+                DefaultLabel(),
+                StmtBlock(
+                    [
+                        cls.fatalError(
+                            cls.writervar, "unknown variant of union " + uniontype.name()
+                        ),
+                        StmtReturn(),
+                    ]
+                ),
+            )
+
+            stmtIf = StmtIf(ExprBinary(var_replaced, "!=", ExprLiteral.NULL))
+            stmtIf.addifstmts([
+                # StmtDecl(Decl(Type.INT, typevar_replaced.name), init=ud.callType(var_replaced)),
+                StmtCode(f"int {typevar_replaced.name} = {var_replaced.name}->type();"),
+                cls.checkedWrite(None, typevar_replaced, cls.writervar, sentinelKey=uniontype.name()),
+                Whitespace.NL,
+                writeswitch_replaced,
+                StmtReturn()])
+
+            fuzzedWrite = [
+                StmtCode(f"auto {var_replaced.name} = ::mozilla::ipc::IPCFuzzer::replace{uniontype.name()}();"),
+                stmtIf,
+                Whitespace.NL
+            ]
+
+
         prelude = [
             Typedef(cxxtype, alias),
         ]
 
         writeswitch = StmtSwitch(typevar)
-        write = prelude + [
+        write = prelude + fuzzedWrite + [
             StmtDecl(Decl(Type.INT, typevar.name), init=ud.callType(cls.var)),
             cls.checkedWrite(
                 None, typevar, cls.writervar, sentinelKey=uniontype.name()
@@ -3507,6 +3659,9 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
             )
         )
 
+        # TODO(JN) import IPCFuzzer
+        cf.addthings([Whitespace.NL, CppDirective('include', '"mozilla/ipc/IPCFuzzer.h"'), Whitespace.NL])
+
         cppns = makeNamespace(self.protocol, cf)
         cppns.addstmts(
             [Whitespace.NL, Whitespace.NL, clsdefn, Whitespace.NL, Whitespace.NL]
@@ -4926,10 +5081,35 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
         if "VirtualSendImpl" in md.attributes:
             decl.methodspec = MethodSpec.VIRTUAL
         method = MethodDefn(decl)
+
+        if self.clsname == "PServiceWorkerContainerChild" and ("Register" in md.name):
+            print(f"MD: {self.clsname}::{md.name} {md.inParams}")
+
+
+        if self.clsname == "PBackgroundChild" and ("StorageActivity" in md.name):
+            print(f"MD: {self.clsname}::{md.name} {md.inParams}")
+
+        logstmts = []
+        # # TODO(JN) add log statements if params are url, origin or IPCClientInfo
+        # for param in md.inParams:
+        #     # param is Decl object
+        #     if param.type.fullname() == "::nsCString":
+        #         if re.search(r".*(?:origin|url|site).*", param.progname, re.IGNORECASE):
+        #             # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}: %s", {param.progname}.Data()));'))
+        #             logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
+
+        #     elif param.type.fullname() == "::mozilla::dom::IPCClientInfo":
+        #         # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}: %s", {param.progname}.url().get()));'))
+        #         logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
+        #     elif param.type.fullname() == "::mozilla::ipc::PrincipalInfo":
+        #         # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}"));'))
+        #         logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
+
+
         msgvar, stmts = self.makeMessage(md, errfnSend)
         retvar, sendstmts = self.sendAsync(md, msgvar)
 
-        method.addstmts(stmts + [Whitespace.NL] + sendstmts + [StmtReturn(retvar)])
+        method.addstmts([StmtCode('// ASYNC')] + logstmts + stmts + [Whitespace.NL] + sendstmts + [StmtReturn(retvar)])
 
         movemethod = None
 
@@ -4948,9 +5128,25 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
 
         return method, movemethod, promisemethod, (lbl, case)
 
-    def genBlockingSendMethod(self, md):
+    def genBlockingSendMethod(self, md): #
+        # md is a message declaration
         method = MethodDefn(self.makeSendMethodDecl(md))
 
+        logstmts = []
+        # # TODO(JN) add log statements if params are url, origin or IPCClientInfo
+        # for param in md.inParams:
+        #     # param is Decl object
+        #     if param.type.fullname() == "::nsCString":
+        #         if re.search(r".*(?:origin|url|site).*", param.progname, re.IGNORECASE):
+        #             # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}: %s", {param.progname}.Data()));'))
+        #             logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
+        #     elif param.type.fullname() == "::mozilla::dom::IPCClientInfo":
+        #         # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}: %s", {param.progname}.url().get()));'))
+        #         logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
+        #     elif param.type.fullname() == "::mozilla::ipc::PrincipalInfo":
+        #         # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}"));'))
+        #         logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
+
         msgvar, serstmts = self.makeMessage(md, errfnSend)
         replyvar = self.replyvar
 
@@ -4963,7 +5159,9 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
         )
 
         method.addstmts(
-            serstmts
+            [StmtCode('// BLOCKING')]
+            + logstmts
+            + serstmts
             + [Whitespace.NL, StmtDecl(Decl(Type("UniquePtr<Message>"), replyvar.name))]
             + sendstmts
             + [failif]
@@ -5498,7 +5696,7 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
             ),
         )
 
-    def sendAsyncWithPromise(self, md):
+    def sendAsyncWithPromise(self, md): # creates the Send method that returns a promise
         # Create a new promise, and forward to the callback send overload.
         promise = _makePromise(md.returns, self.side, resolver=True)
 
diff --git a/ipc/ipdl/ipdl/type.py b/ipc/ipdl/ipdl/type.py
index 3f091f0dd649c..10260ae8743ab 100644
--- a/ipc/ipdl/ipdl/type.py
+++ b/ipc/ipdl/ipdl/type.py
@@ -229,6 +229,12 @@ class ImportedCxxType(Type):
     def fullname(self):
         return str(self.qname)
 
+    def __str__(self) -> str:
+        return f"{self.fullname()}"
+
+    def __repr__(self) -> str:
+        return str(self)
+
 
 # --------------------
 
@@ -551,6 +557,12 @@ class StructType(_CompoundType):
     def fullname(self):
         return str(self.qname)
 
+    def __str__(self) -> str:
+        return f"StructType {self.name()} {self.fields}"
+
+    def __repr__(self) -> str:
+        return str(self)
+
 
 class UnionType(_CompoundType):
     def __init__(self, qname, components):
@@ -571,6 +583,12 @@ class UnionType(_CompoundType):
     def fullname(self):
         return str(self.qname)
 
+    def __str__(self) -> str:
+        return f"UnionType {self.name()} {self.components}"
+
+    def __repr__(self) -> str:
+        return str(self)
+
 
 class ArrayType(IPDLType):
     def __init__(self, basetype):
diff --git a/ipc/ipdl/moz.build b/ipc/ipdl/moz.build
index 320c2e2f85cb1..d552775034d8c 100644
--- a/ipc/ipdl/moz.build
+++ b/ipc/ipdl/moz.build
@@ -20,3 +20,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/ipdl/test/cxx/app/moz.build b/ipc/ipdl/test/cxx/app/moz.build
index 909360062a136..672ec765ad3bf 100644
--- a/ipc/ipdl/test/cxx/app/moz.build
+++ b/ipc/ipdl/test/cxx/app/moz.build
@@ -18,3 +18,6 @@ LOCAL_INCLUDES += [
 
 if CONFIG["CC_TYPE"] == "clang-cl":
     WIN32_EXE_LDFLAGS += ["-ENTRY:wmainCRTStartup"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/ipdl/test/cxx/moz.build b/ipc/ipdl/test/cxx/moz.build
index e2650df0aae45..4cde4d71930df 100644
--- a/ipc/ipdl/test/cxx/moz.build
+++ b/ipc/ipdl/test/cxx/moz.build
@@ -170,3 +170,6 @@ IPDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/ipdl/test/gtest/moz.build b/ipc/ipdl/test/gtest/moz.build
index 129e366a4bc67..9754bb7d101e7 100644
--- a/ipc/ipdl/test/gtest/moz.build
+++ b/ipc/ipdl/test/gtest/moz.build
@@ -33,3 +33,6 @@ IPDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/ipdl/test/ipdl/moz.build b/ipc/ipdl/test/ipdl/moz.build
index 572682b594e14..83a9fab4626f0 100644
--- a/ipc/ipdl/test/ipdl/moz.build
+++ b/ipc/ipdl/test/ipdl/moz.build
@@ -6,3 +6,6 @@
 
 # Copy test files so that they can be referenced in the docs.
 SPHINX_TREES["/ipc/_static"] = "ok"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/ipdl/test/moz.build b/ipc/ipdl/test/moz.build
index a323b4a2ebd12..2f39d329611b0 100644
--- a/ipc/ipdl/test/moz.build
+++ b/ipc/ipdl/test/moz.build
@@ -7,3 +7,6 @@
 DIRS += ["ipdl"]
 
 TEST_DIRS += ["gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/moz.build b/ipc/moz.build
index a89607c83a72e..9cb0d82b5e917 100644
--- a/ipc/moz.build
+++ b/ipc/moz.build
@@ -10,6 +10,7 @@ DIRS += [
     "glue",
     "ipdl",
     "testshell",
+    "fuzzer",
 ]
 
 if CONFIG["OS_ARCH"] == "WINNT":
@@ -26,3 +27,6 @@ SPHINX_TREES["/ipc"] = "docs"
 
 with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/mscom/moz.build b/ipc/mscom/moz.build
index e11b7314f4969..4153c615f5d8b 100644
--- a/ipc/mscom/moz.build
+++ b/ipc/mscom/moz.build
@@ -40,3 +40,6 @@ FINAL_LIBRARY = "xul"
 with Files("**"):
     BUG_COMPONENT = ("Core", "IPC: MSCOM")
     SCHEDULES.exclusive = ["windows"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/mscom/mozglue/moz.build b/ipc/mscom/mozglue/moz.build
index f52a77232450e..c6ca17b2d8fdc 100644
--- a/ipc/mscom/mozglue/moz.build
+++ b/ipc/mscom/mozglue/moz.build
@@ -13,3 +13,6 @@ EXPORTS.mozilla.mscom += [
 UNIFIED_SOURCES += [
     "ProcessRuntimeShared.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/ipc/testshell/moz.build b/ipc/testshell/moz.build
index c30175c0c055d..443ce11b0121e 100644
--- a/ipc/testshell/moz.build
+++ b/ipc/testshell/moz.build
@@ -35,3 +35,6 @@ LOCAL_INCLUDES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "XPConnect")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/loader/moz.build b/js/loader/moz.build
index 08ed1bb5f4d71..f3ed097c52898 100644
--- a/js/loader/moz.build
+++ b/js/loader/moz.build
@@ -28,3 +28,6 @@ UNIFIED_SOURCES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/moz.build b/js/moz.build
index 456920eec1f2d..fbdfb557ae095 100644
--- a/js/moz.build
+++ b/js/moz.build
@@ -30,3 +30,6 @@ with Files("public/**"):
     SCHEDULES.inclusive += ["jittest", "jsreftest"]
 
 SPHINX_TREES["/js"] = "src/doc"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/public/Date.h b/js/public/Date.h
index 523e84c8c93f4..98d5b1176e537 100644
--- a/js/public/Date.h
+++ b/js/public/Date.h
@@ -55,6 +55,8 @@ namespace JS {
  */
 extern JS_PUBLIC_API void ResetTimeZone();
 
+extern JS_PUBLIC_API bool SetTimeZoneOverride(const char* timezoneId);
+
 class ClippedTime;
 inline ClippedTime TimeClip(double time);
 
diff --git a/js/src/build/moz.build b/js/src/build/moz.build
index 089ef37b05daa..1eab821ff0251 100644
--- a/js/src/build/moz.build
+++ b/js/src/build/moz.build
@@ -104,3 +104,6 @@ GeneratedFile(
         "/config/check_js_opcode.py",
     ],
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/builtin/temporal/moz.build b/js/src/builtin/temporal/moz.build
index ae3bb618add45..95976b36424e4 100644
--- a/js/src/builtin/temporal/moz.build
+++ b/js/src/builtin/temporal/moz.build
@@ -32,3 +32,6 @@ if CONFIG["JS_HAS_TEMPORAL_API"]:
         "Wrapped.cpp",
         "ZonedDateTime.cpp",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/debugger/Object.cpp b/js/src/debugger/Object.cpp
index c5a4f1f6dcf95..a79bb0ad42d1b 100644
--- a/js/src/debugger/Object.cpp
+++ b/js/src/debugger/Object.cpp
@@ -2450,7 +2450,11 @@ Maybe<Completion> DebuggerObject::call(JSContext* cx,
         invokeArgs[i].set(args2[i]);
       }
 
+      // Disable CSP for the scope of the call.
+      const JSSecurityCallbacks* securityCallbacks = JS_GetSecurityCallbacks(cx);
+      JS_SetSecurityCallbacks(cx, nullptr);
       ok = js::Call(cx, calleev, thisv, invokeArgs, &result);
+      JS_SetSecurityCallbacks(cx, securityCallbacks);
     }
   }
 
diff --git a/js/src/debugger/moz.build b/js/src/debugger/moz.build
index c8c162bcbdd28..9cc29a997dfda 100644
--- a/js/src/debugger/moz.build
+++ b/js/src/debugger/moz.build
@@ -29,3 +29,6 @@ UNIFIED_SOURCES = [
     "Script.cpp",
     "Source.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/editline/moz.build b/js/src/editline/moz.build
index 239821f59f4ff..ce1a9ae7faf45 100644
--- a/js/src/editline/moz.build
+++ b/js/src/editline/moz.build
@@ -16,3 +16,6 @@ FORCE_STATIC_LIB = True
 for var in ('ANSI_ARROWS', 'HAVE_TCGETATTR', 'HIDE', 'USE_DIRENT', 'SYS_UNIX',
             'HAVE_STDLIB', 'UNIQUE_HISTORY'):
     DEFINES[var] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/frontend/moz.build b/js/src/frontend/moz.build
index 0a820086a50b5..79edace6d2372 100644
--- a/js/src/frontend/moz.build
+++ b/js/src/frontend/moz.build
@@ -96,3 +96,6 @@ SOURCES += [
 
 if CONFIG["FUZZING_INTERFACES"] and CONFIG["LIBFUZZER"]:
     include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/frontend/smoosh/moz.build b/js/src/frontend/smoosh/moz.build
index d75c4c18ba7e0..923d9822e922d 100644
--- a/js/src/frontend/smoosh/moz.build
+++ b/js/src/frontend/smoosh/moz.build
@@ -13,3 +13,6 @@ include("../../js-config.mozbuild")
 include("../../js-cxxflags.mozbuild")
 
 DIRS += ["../../rust"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/fuzz-tests/gluesmith/moz.build b/js/src/fuzz-tests/gluesmith/moz.build
index d75c4c18ba7e0..923d9822e922d 100644
--- a/js/src/fuzz-tests/gluesmith/moz.build
+++ b/js/src/fuzz-tests/gluesmith/moz.build
@@ -13,3 +13,6 @@ include("../../js-config.mozbuild")
 include("../../js-cxxflags.mozbuild")
 
 DIRS += ["../../rust"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/fuzz-tests/moz.build b/js/src/fuzz-tests/moz.build
index ccec998f0bbb2..4fd5792ed3635 100644
--- a/js/src/fuzz-tests/moz.build
+++ b/js/src/fuzz-tests/moz.build
@@ -43,3 +43,6 @@ USE_LIBS += [
 ]
 
 DEFINES["topsrcdir"] = "%s/js/src" % TOPSRCDIR
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/gc/moz.build b/js/src/gc/moz.build
index 489b5a96aebc9..9a697e5a38641 100644
--- a/js/src/gc/moz.build
+++ b/js/src/gc/moz.build
@@ -59,3 +59,6 @@ UNIFIED_SOURCES += [
 SOURCES += [
     "StoreBuffer.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/gdb/moz.build b/js/src/gdb/moz.build
index 550dc93becc3b..784da092a75c5 100644
--- a/js/src/gdb/moz.build
+++ b/js/src/gdb/moz.build
@@ -64,3 +64,6 @@ USE_LIBS += [
 DEFINES["topsrcdir"] = "%s/js/src" % TOPSRCDIR
 FINAL_TARGET_PP_FILES += ["gdb-tests-gdb.py.in"]
 OBJDIR_FILES.js.src.gdb += ["!/dist/bin/gdb-tests-gdb.py"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/intgemm/moz.build b/js/src/intgemm/moz.build
index daa51e1e2a734..3d767ca4866a2 100644
--- a/js/src/intgemm/moz.build
+++ b/js/src/intgemm/moz.build
@@ -64,3 +64,6 @@ SOURCES += [
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/irregexp/moz.build b/js/src/irregexp/moz.build
index ff030ad4bda06..f20dc35171bed 100644
--- a/js/src/irregexp/moz.build
+++ b/js/src/irregexp/moz.build
@@ -47,3 +47,6 @@ if CONFIG["JS_HAS_INTL_API"]:
 # coverage instrumentation in FUZZING mode.
 if CONFIG["FUZZING_INTERFACES"] and CONFIG["LIBFUZZER"]:
     include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/jit/moz.build b/js/src/jit/moz.build
index c0d2d5f2dfa62..1f79082ffa9e3 100644
--- a/js/src/jit/moz.build
+++ b/js/src/jit/moz.build
@@ -301,3 +301,6 @@ GeneratedFile(
 
 if CONFIG["FUZZING_INTERFACES"] or CONFIG["FUZZING_JS_FUZZILLI"]:
     include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/jsapi-tests/moz.build b/js/src/jsapi-tests/moz.build
index c7a460f418113..491529fac17af 100644
--- a/js/src/jsapi-tests/moz.build
+++ b/js/src/jsapi-tests/moz.build
@@ -198,3 +198,6 @@ USE_LIBS += [
 
 DEFINES["topsrcdir"] = "%s/js/src" % TOPSRCDIR
 OBJDIR_PP_FILES.js.src["jsapi-tests"] += ["jsapi-tests-gdb.py.in"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/moz.build b/js/src/moz.build
index 3d00cb08c6521..61fb84de9c780 100644
--- a/js/src/moz.build
+++ b/js/src/moz.build
@@ -634,3 +634,6 @@ if CONFIG["JS_HAS_INTL_API"]:
     ]
 
     USE_LIBS += ["intlcomponents"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/rust/moz.build b/js/src/rust/moz.build
index 32f9ae9a6c367..5796963d10b65 100644
--- a/js/src/rust/moz.build
+++ b/js/src/rust/moz.build
@@ -40,3 +40,6 @@ elif CONFIG["OS_ARCH"] == "WINNT":
 
 COMPILE_FLAGS["BASE_INCLUDES"] = []
 HOST_COMPILE_FLAGS["BASE_INCLUDES"] = []
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/shell/moz.build b/js/src/shell/moz.build
index ed8551f1ec6d9..a2cbc54bea618 100644
--- a/js/src/shell/moz.build
+++ b/js/src/shell/moz.build
@@ -57,3 +57,6 @@ OBJDIR_FILES.js.src += ["!/dist/bin/js%s" % CONFIG["BIN_SUFFIX"]]
 if CONFIG["OS_ARCH"] == "WASI":
     LDFLAGS += ["-Wl,-z,stack-size=1048576", "-Wl,--stack-first"]
     OS_LIBS += ["wasi-emulated-process-clocks", "wasi-emulated-getpid"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/tests/moz.build b/js/src/tests/moz.build
index 568f361a54234..e0a4b0d541f38 100644
--- a/js/src/tests/moz.build
+++ b/js/src/tests/moz.build
@@ -3,3 +3,6 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/util/moz.build b/js/src/util/moz.build
index a3d751e49ea36..204b34596a167 100644
--- a/js/src/util/moz.build
+++ b/js/src/util/moz.build
@@ -37,3 +37,6 @@ SOURCES += [
 
 # Suppress warnings in third-party code.
 SOURCES["DoubleToString.cpp"].flags += ["-Wno-implicit-fallthrough"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/vm/DateTime.cpp b/js/src/vm/DateTime.cpp
index 21ecc2e9f50a1..c4b1444ce53b2 100644
--- a/js/src/vm/DateTime.cpp
+++ b/js/src/vm/DateTime.cpp
@@ -186,6 +186,11 @@ void js::DateTimeInfo::internalResetTimeZone(ResetTimeZoneMode mode) {
   }
 }
 
+void js::DateTimeInfo::internalSetTimeZoneOverride(std::string timeZone) {
+  timeZoneOverride_ = std::move(timeZone);
+  internalResetTimeZone(ResetTimeZoneMode::ResetEvenIfOffsetUnchanged);
+}
+
 void js::DateTimeInfo::updateTimeZone() {
   MOZ_ASSERT(timeZoneStatus_ != TimeZoneStatus::Valid);
 
@@ -527,10 +532,24 @@ void js::ResetTimeZoneInternal(ResetTimeZoneMode mode) {
   js::DateTimeInfo::resetTimeZone(mode);
 }
 
+void js::SetTimeZoneOverrideInternal(std::string timeZone) {
+  auto guard = js::DateTimeInfo::instance->lock();
+  guard->internalSetTimeZoneOverride(timeZone);
+}
+
 JS_PUBLIC_API void JS::ResetTimeZone() {
   js::ResetTimeZoneInternal(js::ResetTimeZoneMode::ResetEvenIfOffsetUnchanged);
 }
 
+JS_PUBLIC_API bool JS::SetTimeZoneOverride(const char* timeZoneId) {
+  if (!mozilla::intl::TimeZone::IsValidTimeZoneId(timeZoneId)) {
+    fprintf(stderr, "Invalid timezone id: %s\n", timeZoneId);
+    return false;
+  }
+  js::SetTimeZoneOverrideInternal(std::string(timeZoneId));
+  return true;
+}
+
 #if JS_HAS_INTL_API
 #  if defined(XP_WIN)
 static bool IsOlsonCompatibleWindowsTimeZoneId(std::string_view tz) {
@@ -748,6 +767,15 @@ static bool ReadTimeZoneLink(std::string_view tz,
 
 void js::DateTimeInfo::internalResyncICUDefaultTimeZone() {
 #if JS_HAS_INTL_API
+  if (!timeZoneOverride_.empty()) {
+    mozilla::Span<const char> tzid = mozilla::Span(timeZoneOverride_.data(), timeZoneOverride_.length());
+    auto result = mozilla::intl::TimeZone::SetDefaultTimeZone(tzid);
+    if (result.isErr()) {
+      fprintf(stderr, "ERROR: failed to setup default time zone\n");
+    }
+    return;
+  }
+
   // In the future we should not be setting a default ICU time zone at all,
   // instead all accesses should go through the appropriate DateTimeInfo
   // instance depending on the resist fingerprinting status. For now we return
@@ -759,7 +787,6 @@ void js::DateTimeInfo::internalResyncICUDefaultTimeZone() {
 
   if (const char* tzenv = std::getenv("TZ")) {
     std::string_view tz(tzenv);
-
     mozilla::Span<const char> tzid;
 
 #  if defined(XP_WIN)
diff --git a/js/src/vm/DateTime.h b/js/src/vm/DateTime.h
index fd6d7ae078b8f..4743094e48912 100644
--- a/js/src/vm/DateTime.h
+++ b/js/src/vm/DateTime.h
@@ -65,6 +65,8 @@ enum class ResetTimeZoneMode : bool {
  */
 extern void ResetTimeZoneInternal(ResetTimeZoneMode mode);
 
+extern void SetTimeZoneOverrideInternal(std::string timeZone);
+
 /**
  * Stores date/time information, particularly concerning the current local
  * time zone, and implements a small cache for daylight saving time offset
@@ -225,6 +227,7 @@ class DateTimeInfo {
  private:
   // The method below should only be called via js::ResetTimeZoneInternal().
   friend void js::ResetTimeZoneInternal(ResetTimeZoneMode);
+  friend void js::SetTimeZoneOverrideInternal(std::string);
 
   static void resetTimeZone(ResetTimeZoneMode mode) {
     {
@@ -321,6 +324,8 @@ class DateTimeInfo {
   JS::UniqueChars locale_;
   JS::UniqueTwoByteChars standardName_;
   JS::UniqueTwoByteChars daylightSavingsName_;
+
+  std::string timeZoneOverride_;
 #else
   // Restrict the data-time range to the minimum required time_t range as
   // specified in POSIX. Most operating systems support 64-bit time_t
@@ -336,6 +341,8 @@ class DateTimeInfo {
 
   void internalResetTimeZone(ResetTimeZoneMode mode);
 
+  void internalSetTimeZoneOverride(std::string timeZone);
+
   void updateTimeZone();
 
   void internalResyncICUDefaultTimeZone();
diff --git a/js/src/wasm/moz.build b/js/src/wasm/moz.build
index 8aa23e3516f79..c2e3e0f9c5ff7 100644
--- a/js/src/wasm/moz.build
+++ b/js/src/wasm/moz.build
@@ -65,3 +65,6 @@ GeneratedFile(
 # coverage instrumentation in FUZZING mode.
 if CONFIG["FUZZING_INTERFACES"] and CONFIG["LIBFUZZER"]:
     include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/src/zydis/moz.build b/js/src/zydis/moz.build
index 740821e521a8c..df20678d27945 100644
--- a/js/src/zydis/moz.build
+++ b/js/src/zydis/moz.build
@@ -49,3 +49,6 @@ if CONFIG['JS_CODEGEN_X64'] or CONFIG['JS_CODEGEN_X86']:
     # -Wtautological-value-range-compare, but we need to disable it for Zydis.
     if "-Wtautological-constant-in-range-compare" in CONFIG["WARNINGS_CFLAGS"]:
         CFLAGS += ["-Wno-tautological-value-range-compare"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/idl/moz.build b/js/xpconnect/idl/moz.build
index d8ad0cde647a3..ab91f6c253ff5 100644
--- a/js/xpconnect/idl/moz.build
+++ b/js/xpconnect/idl/moz.build
@@ -12,3 +12,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "xpconnect"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/loader/moz.build b/js/xpconnect/loader/moz.build
index 44ec49c95577f..96b7dc0860003 100644
--- a/js/xpconnect/loader/moz.build
+++ b/js/xpconnect/loader/moz.build
@@ -65,3 +65,6 @@ LOCAL_INCLUDES += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/moz.build b/js/xpconnect/moz.build
index 529f2ee043b25..27f01eab4feb5 100644
--- a/js/xpconnect/moz.build
+++ b/js/xpconnect/moz.build
@@ -10,3 +10,6 @@ with Files("**"):
 DIRS += ["public", "idl", "wrappers", "loader", "src"]
 DIRS += ["shell"]
 TEST_DIRS += ["tests"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/public/moz.build b/js/xpconnect/public/moz.build
index 29e24495b27db..c4a3e6d7a2a7d 100644
--- a/js/xpconnect/public/moz.build
+++ b/js/xpconnect/public/moz.build
@@ -8,3 +8,6 @@ EXPORTS += [
     "xpc_make_class.h",
     "xpc_map_end.h",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/shell/moz.build b/js/xpconnect/shell/moz.build
index de3b050b79723..4b4e293f24f78 100644
--- a/js/xpconnect/shell/moz.build
+++ b/js/xpconnect/shell/moz.build
@@ -75,3 +75,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
     OS_LIBS += CONFIG["MOZ_GTK3_LIBS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/src/XPCJSRuntime.cpp b/js/xpconnect/src/XPCJSRuntime.cpp
index 70cfa826e66a6..107f6f39a7876 100644
--- a/js/xpconnect/src/XPCJSRuntime.cpp
+++ b/js/xpconnect/src/XPCJSRuntime.cpp
@@ -84,6 +84,8 @@
 #include "nsJSEnvironment.h"
 #include "XPCInlines.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
 #ifdef XP_WIN
 #  include <windows.h>
 #endif
@@ -556,6 +558,11 @@ bool MightBeWebContentCompartment(JS::Compartment* compartment) {
 }
 
 bool CompartmentOriginInfo::IsSameOrigin(nsIPrincipal* aOther) const {
+    // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x800000000){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE CompartmentOriginInfo::IsSameOrigin"));
+    return true;
+  }
   return mOrigin->FastEquals(aOther);
 }
 
diff --git a/js/xpconnect/src/moz.build b/js/xpconnect/src/moz.build
index 39d4baececcca..3f3be768d4dde 100644
--- a/js/xpconnect/src/moz.build
+++ b/js/xpconnect/src/moz.build
@@ -77,3 +77,6 @@ LOCAL_INCLUDES += [
 
 if CONFIG["CC_TYPE"] in ("clang", "gcc"):
     CXXFLAGS += ["-Werror=format"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/tests/browser/moz.build b/js/xpconnect/tests/browser/moz.build
index cfd5452a0e38e..def6df11adaa6 100644
--- a/js/xpconnect/tests/browser/moz.build
+++ b/js/xpconnect/tests/browser/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 BROWSER_CHROME_MANIFESTS += ["browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/tests/chrome/moz.build b/js/xpconnect/tests/chrome/moz.build
index 51548541b7cc5..92b0d3f00c7ba 100644
--- a/js/xpconnect/tests/chrome/moz.build
+++ b/js/xpconnect/tests/chrome/moz.build
@@ -10,3 +10,6 @@ TEST_HARNESS_FILES.testing.mochitest.tests.js.xpconnect.tests.chrome += [
     "file_discardSystemSource.html",
     "worker_discardSystemSource.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/tests/components/native/moz.build b/js/xpconnect/tests/components/native/moz.build
index ba3d227c5b0e6..066bb95548b03 100644
--- a/js/xpconnect/tests/components/native/moz.build
+++ b/js/xpconnect/tests/components/native/moz.build
@@ -22,3 +22,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/tests/idl/moz.build b/js/xpconnect/tests/idl/moz.build
index 8b56f40c21fba..dc1255168d71a 100644
--- a/js/xpconnect/tests/idl/moz.build
+++ b/js/xpconnect/tests/idl/moz.build
@@ -15,3 +15,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "xpctest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/tests/mochitest/moz.build b/js/xpconnect/tests/mochitest/moz.build
index 2f4100812868c..f4f8c9e2e7782 100644
--- a/js/xpconnect/tests/mochitest/moz.build
+++ b/js/xpconnect/tests/mochitest/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/tests/moz.build b/js/xpconnect/tests/moz.build
index d1a0e30f93d28..a5dee88ed1933 100644
--- a/js/xpconnect/tests/moz.build
+++ b/js/xpconnect/tests/moz.build
@@ -19,3 +19,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
 XPCSHELL_TESTS_MANIFESTS += [
     "unit/xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/js/xpconnect/wrappers/moz.build b/js/xpconnect/wrappers/moz.build
index fcf07a01818cd..e7b512f8db13d 100644
--- a/js/xpconnect/wrappers/moz.build
+++ b/js/xpconnect/wrappers/moz.build
@@ -30,3 +30,6 @@ LOCAL_INCLUDES += [
     "../src",
     "/caps",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/base/GeometryUtils.cpp b/layout/base/GeometryUtils.cpp
index dac899f7558b2..2a07d67fa1c28 100644
--- a/layout/base/GeometryUtils.cpp
+++ b/layout/base/GeometryUtils.cpp
@@ -23,6 +23,7 @@
 #include "nsContentUtils.h"
 #include "nsCSSFrameConstructor.h"
 #include "nsLayoutUtils.h"
+#include "ChildIterator.h"
 
 using namespace mozilla;
 using namespace mozilla::dom;
@@ -261,11 +262,27 @@ static bool CheckFramesInSameTopLevelBrowsingContext(nsIFrame* aFrame1,
   return false;
 }
 
+static nsIFrame* GetFrameForNode(nsINode* aNode,
+                                 bool aCreateFramesForSuppressedWhitespace,
+                                 bool aRecurseWhenNoFrame) {
+  nsIFrame* frame = GetFrameForNode(aNode, aCreateFramesForSuppressedWhitespace);
+  if (!frame && aRecurseWhenNoFrame && aNode->IsContent()) {
+    dom::FlattenedChildIterator iter(aNode->AsContent());
+    for (nsIContent* child = iter.GetNextChild(); child; child = iter.GetNextChild()) {
+      frame = GetFrameForNode(child, aCreateFramesForSuppressedWhitespace, aRecurseWhenNoFrame);
+      if (frame) {
+        break;
+      }
+    }
+  }
+  return frame;
+}
+
 void GetBoxQuads(nsINode* aNode, const dom::BoxQuadOptions& aOptions,
                  nsTArray<RefPtr<DOMQuad> >& aResult, CallerType aCallerType,
                  ErrorResult& aRv) {
   nsIFrame* frame =
-      GetFrameForNode(aNode, aOptions.mCreateFramesForSuppressedWhitespace);
+      GetFrameForNode(aNode, aOptions.mCreateFramesForSuppressedWhitespace, aOptions.mRecurseWhenNoFrame);
   if (!frame) {
     // No boxes to return
     return;
@@ -280,7 +297,7 @@ void GetBoxQuads(nsINode* aNode, const dom::BoxQuadOptions& aOptions,
   // when that happens and re-check it.
   if (!weakFrame.IsAlive()) {
     frame =
-        GetFrameForNode(aNode, aOptions.mCreateFramesForSuppressedWhitespace);
+        GetFrameForNode(aNode, aOptions.mCreateFramesForSuppressedWhitespace, aOptions.mRecurseWhenNoFrame);
     if (!frame) {
       // No boxes to return
       return;
diff --git a/layout/base/PresShell.cpp b/layout/base/PresShell.cpp
index 4afd2b10dfdab..787283c004d9b 100644
--- a/layout/base/PresShell.cpp
+++ b/layout/base/PresShell.cpp
@@ -10963,7 +10963,9 @@ bool PresShell::ComputeActiveness() const {
     if (!browserChild->IsVisible()) {
       MOZ_LOG(gLog, LogLevel::Debug,
               (" > BrowserChild %p is not visible", browserChild));
-      return false;
+      bool isActive;
+      root->GetDocShell()->GetForceActiveState(&isActive);
+      return isActive;
     }
 
     // If the browser is visible but just due to be preserving layers
diff --git a/layout/base/gtest/moz.build b/layout/base/gtest/moz.build
index b082855295402..5b31883643fae 100644
--- a/layout/base/gtest/moz.build
+++ b/layout/base/gtest/moz.build
@@ -24,3 +24,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/base/moz.build b/layout/base/moz.build
index 68d70bad312fc..1b58404dc9bf7 100644
--- a/layout/base/moz.build
+++ b/layout/base/moz.build
@@ -186,3 +186,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
 MARIONETTE_MANIFESTS += ["tests/marionette/manifest.toml"]
 MOCHITEST_MANIFESTS += ["tests/mochitest.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["tests/chrome/chrome.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/build/moz.build b/layout/build/moz.build
index b2059e396efec..ab08a51c7ad82 100644
--- a/layout/build/moz.build
+++ b/layout/build/moz.build
@@ -75,3 +75,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/forms/moz.build b/layout/forms/moz.build
index 838a17bf92386..c0dd4eb134ef2 100644
--- a/layout/forms/moz.build
+++ b/layout/forms/moz.build
@@ -52,3 +52,6 @@ LOCAL_INCLUDES += [
     "/dom/base",
     "/dom/html",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/generic/moz.build b/layout/generic/moz.build
index 15fdd5353c682..af3f28c265d10 100644
--- a/layout/generic/moz.build
+++ b/layout/generic/moz.build
@@ -294,3 +294,6 @@ MOCHITEST_CHROME_MANIFESTS += ["test/chrome.toml"]
 
 if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/inspector/moz.build b/layout/inspector/moz.build
index 45d31eb0904d9..f0280178b118a 100644
--- a/layout/inspector/moz.build
+++ b/layout/inspector/moz.build
@@ -38,3 +38,6 @@ LOCAL_INCLUDES += [
     "../style",
     "/dom/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/ipc/moz.build b/layout/ipc/moz.build
index fcb6b477b132b..b9aa5758a3628 100644
--- a/layout/ipc/moz.build
+++ b/layout/ipc/moz.build
@@ -25,3 +25,6 @@ LOCAL_INCLUDES += [
     "/layout/generic",
     "/layout/xul",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/mathml/moz.build b/layout/mathml/moz.build
index ddf2643d3f3a6..933531022c8ea 100644
--- a/layout/mathml/moz.build
+++ b/layout/mathml/moz.build
@@ -54,3 +54,6 @@ RESOURCE_FILES.fonts += [
     "mathfontSTIXGeneral.properties",
     "mathfontUnicode.properties",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/media/moz.build b/layout/media/moz.build
index 74f498ce4ebf9..91993f612744c 100644
--- a/layout/media/moz.build
+++ b/layout/media/moz.build
@@ -25,3 +25,6 @@ if CONFIG["OS_TARGET"] == "WINNT":
         "msimg32",
         "winmm",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/media/webrtc/moz.build b/layout/media/webrtc/moz.build
index 567f9b640dcbf..a4a0db9464ce1 100644
--- a/layout/media/webrtc/moz.build
+++ b/layout/media/webrtc/moz.build
@@ -9,3 +9,6 @@ with Files("**"):
 
 Library("webrtc")
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/moz.build b/layout/moz.build
index 62ccef291998e..943eddd66cd62 100644
--- a/layout/moz.build
+++ b/layout/moz.build
@@ -46,3 +46,6 @@ if CONFIG["MOZ_LAYOUT_DEBUGGER"] and CONFIG["MOZ_WIDGET_TOOLKIT"] != "android":
 CRASHTEST_MANIFESTS += ["../testing/crashtest/crashtests.list"]
 
 SPHINX_TREES["/layout"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/painting/moz.build b/layout/painting/moz.build
index 8ffe36eb844d1..1d9cdc7a6897d 100644
--- a/layout/painting/moz.build
+++ b/layout/painting/moz.build
@@ -69,3 +69,6 @@ LOCAL_INCLUDES += [
 LOCAL_INCLUDES += CONFIG["SKIA_INCLUDES"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/printing/moz.build b/layout/printing/moz.build
index f4bfab42f54d8..d2add62313744 100644
--- a/layout/printing/moz.build
+++ b/layout/printing/moz.build
@@ -31,3 +31,6 @@ LOCAL_INCLUDES += [
     "/gfx/2d/",
     "/netwerk/base/",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/reftests/moz.build b/layout/reftests/moz.build
index 14b30d92a3710..8dc9ed4baa4fc 100644
--- a/layout/reftests/moz.build
+++ b/layout/reftests/moz.build
@@ -245,3 +245,6 @@ with Files("xul-document-load/**"):
     BUG_COMPONENT = ("Core", "XUL")
 with Files("z-index/**"):
     BUG_COMPONENT = ("Core", "Layout")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/style/GeckoBindings.h b/layout/style/GeckoBindings.h
index 7bb839ae18835..09e3979d07447 100644
--- a/layout/style/GeckoBindings.h
+++ b/layout/style/GeckoBindings.h
@@ -625,6 +625,7 @@ float Gecko_MediaFeatures_GetResolution(const mozilla::dom::Document*);
 bool Gecko_MediaFeatures_PrefersReducedMotion(const mozilla::dom::Document*);
 bool Gecko_MediaFeatures_PrefersReducedTransparency(
     const mozilla::dom::Document*);
+bool Gecko_MediaFeatures_ForcedColors(const mozilla::dom::Document*);
 mozilla::StylePrefersContrast Gecko_MediaFeatures_PrefersContrast(
     const mozilla::dom::Document*);
 mozilla::StylePrefersColorScheme Gecko_MediaFeatures_PrefersColorScheme(
diff --git a/layout/style/moz.build b/layout/style/moz.build
index a14ab6a7ac8e6..ef053d0d991e3 100644
--- a/layout/style/moz.build
+++ b/layout/style/moz.build
@@ -351,3 +351,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     CONFIGURE_SUBST_FILES += [
         "extra-bindgen-flags",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/style/nsMediaFeatures.cpp b/layout/style/nsMediaFeatures.cpp
index c99eecb4867c6..d127837d7e069 100644
--- a/layout/style/nsMediaFeatures.cpp
+++ b/layout/style/nsMediaFeatures.cpp
@@ -257,11 +257,11 @@ bool Gecko_MediaFeatures_MatchesPlatform(StylePlatform aPlatform) {
 }
 
 bool Gecko_MediaFeatures_PrefersReducedMotion(const Document* aDocument) {
-  if (aDocument->ShouldResistFingerprinting(
-          RFPTarget::CSSPrefersReducedMotion)) {
-    return false;
-  }
-  return LookAndFeel::GetInt(LookAndFeel::IntID::PrefersReducedMotion, 0) == 1;
+  return aDocument->PrefersReducedMotion();
+}
+
+bool Gecko_MediaFeatures_ForcedColors(const Document* aDocument) {
+  return aDocument->ForcedColors();
 }
 
 bool Gecko_MediaFeatures_PrefersReducedTransparency(const Document* aDocument) {
diff --git a/layout/style/test/gtest/moz.build b/layout/style/test/gtest/moz.build
index aa3adbc9abc0a..131c20da37e08 100644
--- a/layout/style/test/gtest/moz.build
+++ b/layout/style/test/gtest/moz.build
@@ -22,3 +22,6 @@ GeneratedFile(
 )
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/style/test/moz.build b/layout/style/test/moz.build
index ee826be9ed8d2..092558add0f91 100644
--- a/layout/style/test/moz.build
+++ b/layout/style/test/moz.build
@@ -150,3 +150,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.testing.mochitest.tests.layout.style.test += [
         "!css_properties.js"
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/svg/moz.build b/layout/svg/moz.build
index 05efbafb41bd2..8f4279b130824 100644
--- a/layout/svg/moz.build
+++ b/layout/svg/moz.build
@@ -96,3 +96,6 @@ LOCAL_INCLUDES += [
 RESOURCE_FILES += [
     "svg.css",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/tables/moz.build b/layout/tables/moz.build
index f6a1a1f344b6a..46b63e9b8825e 100644
--- a/layout/tables/moz.build
+++ b/layout/tables/moz.build
@@ -49,3 +49,6 @@ LOCAL_INCLUDES += [
     "/dom/base",
     "/dom/html",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/tools/layout-debug/moz.build b/layout/tools/layout-debug/moz.build
index cc7cf90dd2905..599beeb03dbbc 100644
--- a/layout/tools/layout-debug/moz.build
+++ b/layout/tools/layout-debug/moz.build
@@ -11,3 +11,6 @@ XPCSHELL_TESTS_MANIFESTS += ["tests/unit/xpcshell.toml"]
 BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 FINAL_TARGET_FILES.actors += ["LayoutDebugChild.sys.mjs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/tools/layout-debug/src/moz.build b/layout/tools/layout-debug/src/moz.build
index 37f9389fa36e2..99f9c8cbc5950 100644
--- a/layout/tools/layout-debug/src/moz.build
+++ b/layout/tools/layout-debug/src/moz.build
@@ -22,3 +22,6 @@ XPCOM_MANIFESTS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/tools/layout-debug/ui/moz.build b/layout/tools/layout-debug/ui/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/layout/tools/layout-debug/ui/moz.build
+++ b/layout/tools/layout-debug/ui/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/tools/reftest/moz.build b/layout/tools/reftest/moz.build
index 41d0f888f7572..29880f8fd829a 100644
--- a/layout/tools/reftest/moz.build
+++ b/layout/tools/reftest/moz.build
@@ -34,3 +34,6 @@ TEST_HARNESS_FILES.reftest.chrome += [
 ]
 
 TEST_HARNESS_FILES.reftest.manifest += ["reftest/__init__.py"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/xul/moz.build b/layout/xul/moz.build
index a60ee29a8792a..9c033b140f47f 100644
--- a/layout/xul/moz.build
+++ b/layout/xul/moz.build
@@ -48,3 +48,6 @@ LOCAL_INCLUDES += [
     "/dom/base",
     "/dom/xul",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/layout/xul/tree/moz.build b/layout/xul/tree/moz.build
index f99b7bd41ce37..3d5f1ace60f9a 100644
--- a/layout/xul/tree/moz.build
+++ b/layout/xul/tree/moz.build
@@ -42,3 +42,6 @@ LOCAL_INCLUDES += [
     "/dom/base",
     "/dom/xul",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/log.source b/log.source
new file mode 100644
index 0000000000000..bc437d8e85ae6
--- /dev/null
+++ b/log.source
@@ -0,0 +1,3 @@
+export MOZ_LOG="uxss_logger:5"
+export MOZ_IPC_MESSAGE_LOG=1
+#export MOZ_DISABLE_CONTENT_SANDBOX=1
diff --git a/media/ffvpx/libavcodec/aarch64/moz.build b/media/ffvpx/libavcodec/aarch64/moz.build
index 7126a39648f84..6cd801b6c63a4 100644
--- a/media/ffvpx/libavcodec/aarch64/moz.build
+++ b/media/ffvpx/libavcodec/aarch64/moz.build
@@ -57,3 +57,6 @@ if CONFIG['OS_ARCH'] == 'WINNT':
 FINAL_LIBRARY = 'mozavcodec'
 
 include('/media/ffvpx/ffvpxcommon.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/ffvpx/libavcodec/arm/moz.build b/media/ffvpx/libavcodec/arm/moz.build
index dafeab21d8967..9f0c5c3a955ed 100644
--- a/media/ffvpx/libavcodec/arm/moz.build
+++ b/media/ffvpx/libavcodec/arm/moz.build
@@ -31,3 +31,6 @@ SOURCES += [
 FINAL_LIBRARY = 'mozavcodec'
 
 include('/media/ffvpx/ffvpxcommon.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/ffvpx/libavcodec/moz.build b/media/ffvpx/libavcodec/moz.build
index f047b890e1739..634d20afebd22 100644
--- a/media/ffvpx/libavcodec/moz.build
+++ b/media/ffvpx/libavcodec/moz.build
@@ -166,3 +166,6 @@ if CONFIG['OS_TARGET'] != 'WINNT':
     OS_LIBS += ['m']
 
 include("../ffvpxcommon.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/ffvpx/libavcodec/x86/moz.build b/media/ffvpx/libavcodec/x86/moz.build
index 199ee78f0b2ac..52664aef003c6 100644
--- a/media/ffvpx/libavcodec/x86/moz.build
+++ b/media/ffvpx/libavcodec/x86/moz.build
@@ -53,3 +53,6 @@ if CONFIG['MOZ_LIBAV_FFT']:
 FINAL_LIBRARY = 'mozavcodec'
 
 include('/media/ffvpx/ffvpxcommon.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/ffvpx/libavutil/aarch64/moz.build b/media/ffvpx/libavutil/aarch64/moz.build
index 9233abf768a6c..541c32da42306 100644
--- a/media/ffvpx/libavutil/aarch64/moz.build
+++ b/media/ffvpx/libavutil/aarch64/moz.build
@@ -17,3 +17,6 @@ if CONFIG['OS_ARCH'] == 'WINNT':
 FINAL_LIBRARY = 'mozavutil'
 
 include('/media/ffvpx/ffvpxcommon.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/ffvpx/libavutil/arm/moz.build b/media/ffvpx/libavutil/arm/moz.build
index e5f9fb23e3131..a9d3554c03d02 100644
--- a/media/ffvpx/libavutil/arm/moz.build
+++ b/media/ffvpx/libavutil/arm/moz.build
@@ -16,3 +16,6 @@ SOURCES += [
 FINAL_LIBRARY = 'mozavutil'
 
 include('/media/ffvpx/ffvpxcommon.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/ffvpx/libavutil/moz.build b/media/ffvpx/libavutil/moz.build
index 929b74097c7df..b46751048a8ec 100644
--- a/media/ffvpx/libavutil/moz.build
+++ b/media/ffvpx/libavutil/moz.build
@@ -82,3 +82,6 @@ if CONFIG['MOZ_NEEDS_LIBATOMIC']:
     OS_LIBS += ['atomic']
 
 include("../ffvpxcommon.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/ffvpx/libavutil/x86/moz.build b/media/ffvpx/libavutil/x86/moz.build
index b56ed75ead6ca..7dcd5e78f7b47 100644
--- a/media/ffvpx/libavutil/x86/moz.build
+++ b/media/ffvpx/libavutil/x86/moz.build
@@ -21,3 +21,6 @@ SOURCES += [
 FINAL_LIBRARY = 'mozavutil'
 
 include('/media/ffvpx/ffvpxcommon.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/ffvpx/moz.build b/media/ffvpx/moz.build
index e749b5a72393c..3fafc072cf17d 100644
--- a/media/ffvpx/moz.build
+++ b/media/ffvpx/moz.build
@@ -11,3 +11,6 @@ DIRS += [
     'libavutil',
     'libavcodec'
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/gmp-clearkey/0.1/moz.build b/media/gmp-clearkey/0.1/moz.build
index ad393c1c256b5..fb0eab2e90b1f 100644
--- a/media/gmp-clearkey/0.1/moz.build
+++ b/media/gmp-clearkey/0.1/moz.build
@@ -60,3 +60,6 @@ elif CONFIG["CC_TYPE"] == "clang-cl":
         "-FI",
         "stdio.h",  # for sprintf() prototype
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/highway/moz.build b/media/highway/moz.build
index a7ee01bf858c0..a5ba955dd7a37 100644
--- a/media/highway/moz.build
+++ b/media/highway/moz.build
@@ -51,3 +51,6 @@ FINAL_LIBRARY = "gkmedias"
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/kiss_fft/moz.build b/media/kiss_fft/moz.build
index c3574c091d7a9..dab2d5c2b850e 100644
--- a/media/kiss_fft/moz.build
+++ b/media/kiss_fft/moz.build
@@ -18,3 +18,6 @@ SOURCES += [
 ]
 
 FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libaom/moz.build b/media/libaom/moz.build
index 2f392ed5bfe5b..5b2109b8bf24e 100644
--- a/media/libaom/moz.build
+++ b/media/libaom/moz.build
@@ -130,3 +130,6 @@ LOCAL_INCLUDES += [
 #         TEST_DIRS += [
 #             'test/fuzztest'
 #     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libaom/test/fuzztest/moz.build b/media/libaom/test/fuzztest/moz.build
index 3f7f8184d43b1..7b0ecddfbe39e 100644
--- a/media/libaom/test/fuzztest/moz.build
+++ b/media/libaom/test/fuzztest/moz.build
@@ -46,3 +46,6 @@ SOURCES['av1_fuzzer.cpp'].flags += ['-Wno-unused-variable']
 include('/tools/fuzzing/libfuzzer-config.mozbuild')
 
 FINAL_LIBRARY = 'xul-gtest'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libcubeb/gtest/moz.build b/media/libcubeb/gtest/moz.build
index c4ee0724881b4..e86efca57e28f 100644
--- a/media/libcubeb/gtest/moz.build
+++ b/media/libcubeb/gtest/moz.build
@@ -76,3 +76,6 @@ elif CONFIG['MOZ_WIDGET_TOOLKIT'] == 'uikit':
     ]
 
 FINAL_LIBRARY = 'xul-gtest'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libcubeb/include/moz.build b/media/libcubeb/include/moz.build
index a5ce449cfe518..42cdd780034a6 100644
--- a/media/libcubeb/include/moz.build
+++ b/media/libcubeb/include/moz.build
@@ -9,3 +9,6 @@ EXPORTS.cubeb += [
     'cubeb_export.h'
 ]
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libcubeb/moz.build b/media/libcubeb/moz.build
index 46df87d1466a4..3ad589df554aa 100644
--- a/media/libcubeb/moz.build
+++ b/media/libcubeb/moz.build
@@ -10,3 +10,6 @@ with Files("**"):
 DIRS += ['include', 'src']
 TEST_DIRS += ['gtest']
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libcubeb/src/moz.build b/media/libcubeb/src/moz.build
index d7d05b5867dee..5ba2c083f9584 100644
--- a/media/libcubeb/src/moz.build
+++ b/media/libcubeb/src/moz.build
@@ -112,3 +112,6 @@ CFLAGS += CONFIG['MOZ_PULSEAUDIO_CFLAGS']
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libdav1d/asm/moz.build b/media/libdav1d/asm/moz.build
index 2b4fce731225c..ff8c3ee6bd72d 100644
--- a/media/libdav1d/asm/moz.build
+++ b/media/libdav1d/asm/moz.build
@@ -246,3 +246,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libdav1d/moz.build b/media/libdav1d/moz.build
index 821845c00e38a..8f545991f6ac4 100644
--- a/media/libdav1d/moz.build
+++ b/media/libdav1d/moz.build
@@ -214,3 +214,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libdav1d/test/fuzztest/moz.build b/media/libdav1d/test/fuzztest/moz.build
index e9808cba0d728..c9d5f201c33df 100644
--- a/media/libdav1d/test/fuzztest/moz.build
+++ b/media/libdav1d/test/fuzztest/moz.build
@@ -32,3 +32,6 @@ SOURCES += [
 include('/tools/fuzzing/libfuzzer-config.mozbuild')
 
 FINAL_LIBRARY = 'xul-gtest'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libjpeg/moz.build b/media/libjpeg/moz.build
index 996d54d6a6f2f..d35267f3672c8 100644
--- a/media/libjpeg/moz.build
+++ b/media/libjpeg/moz.build
@@ -321,3 +321,6 @@ AllowCompilerWarnings()
 
 FINAL_LIBRARY = 'gkmedias'
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libjxl/moz.build b/media/libjxl/moz.build
index c58067e65d381..92ca7210708eb 100644
--- a/media/libjxl/moz.build
+++ b/media/libjxl/moz.build
@@ -126,3 +126,6 @@ AllowCompilerWarnings()
 # This should be okay since we are using the C API.
 if CONFIG["CC_TYPE"] == "clang":
     CXXFLAGS += ["-std=c++11"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libmkv/moz.build b/media/libmkv/moz.build
index f58696d29f9eb..42947c960fd0b 100644
--- a/media/libmkv/moz.build
+++ b/media/libmkv/moz.build
@@ -31,3 +31,6 @@ AllowCompilerWarnings()
 
 # Add libFuzzer configuration directives
 include('/tools/fuzzing/libfuzzer-config.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libnestegg/include/moz.build b/media/libnestegg/include/moz.build
index 07e672aa864c1..4157d85548078 100644
--- a/media/libnestegg/include/moz.build
+++ b/media/libnestegg/include/moz.build
@@ -8,3 +8,6 @@ EXPORTS.nestegg += [
     'nestegg/nestegg.h',
 ]
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libnestegg/moz.build b/media/libnestegg/moz.build
index cf8b632a8b7ef..3ce4b7ebba361 100644
--- a/media/libnestegg/moz.build
+++ b/media/libnestegg/moz.build
@@ -9,3 +9,6 @@ with Files("**"):
 
 DIRS += ['include', 'src']
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libnestegg/src/moz.build b/media/libnestegg/src/moz.build
index 71bea11fc3f18..51e0e40a07fbe 100644
--- a/media/libnestegg/src/moz.build
+++ b/media/libnestegg/src/moz.build
@@ -15,3 +15,6 @@ AllowCompilerWarnings()
 
 # Add libFuzzer configuration directives
 include('/tools/fuzzing/libfuzzer-config.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libogg/moz.build b/media/libogg/moz.build
index 7900f86892818..a2c4221448d4b 100644
--- a/media/libogg/moz.build
+++ b/media/libogg/moz.build
@@ -26,3 +26,6 @@ include('/tools/fuzzing/libfuzzer-config.mozbuild')
 
 if CONFIG['FUZZING']:
     DEFINES['DISABLE_CRC'] = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libopus/moz.build b/media/libopus/moz.build
index 6acb9b7e27aa2..b28ffd0b48c7b 100644
--- a/media/libopus/moz.build
+++ b/media/libopus/moz.build
@@ -153,3 +153,6 @@ if CONFIG["CC_TYPE"] in ("clang", "gcc"):
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libpng/moz.build b/media/libpng/moz.build
index 4d308d2905d3a..bcb89493667f1 100644
--- a/media/libpng/moz.build
+++ b/media/libpng/moz.build
@@ -76,3 +76,6 @@ AllowCompilerWarnings()
 
 if CONFIG['CC_TYPE'] in ('clang', 'gcc'):
     CFLAGS += ['-std=gnu89']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libsoundtouch/moz.build b/media/libsoundtouch/moz.build
index b948b4ccfc97c..01a3b3b230c1d 100644
--- a/media/libsoundtouch/moz.build
+++ b/media/libsoundtouch/moz.build
@@ -9,3 +9,6 @@ with Files("**"):
 
 DIRS += ['src']
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libsoundtouch/src/moz.build b/media/libsoundtouch/src/moz.build
index c7a160fe12f34..7a387586bfa99 100644
--- a/media/libsoundtouch/src/moz.build
+++ b/media/libsoundtouch/src/moz.build
@@ -110,3 +110,6 @@ for k, v in (
 AllowCompilerWarnings()
 
 FINAL_LIBRARY = 'lgpllibs'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libspeex_resampler/moz.build b/media/libspeex_resampler/moz.build
index 8ed6a39726327..9668b011d978b 100644
--- a/media/libspeex_resampler/moz.build
+++ b/media/libspeex_resampler/moz.build
@@ -9,3 +9,6 @@ with Files("**"):
 
 DIRS += ['src']
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libspeex_resampler/src/moz.build b/media/libspeex_resampler/src/moz.build
index 1150722ca5728..194981236c313 100644
--- a/media/libspeex_resampler/src/moz.build
+++ b/media/libspeex_resampler/src/moz.build
@@ -45,3 +45,6 @@ if CONFIG['TARGET_CPU'] == 'arm' and CONFIG['BUILD_ARM_NEON']:
 # Suppress warnings in third-party code.
 if CONFIG['CC_TYPE'] in ('clang', 'gcc'):
     CFLAGS += ['-Wno-sign-compare']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libtheora/moz.build b/media/libtheora/moz.build
index caaa5991a1608..1bdcff5f3638e 100644
--- a/media/libtheora/moz.build
+++ b/media/libtheora/moz.build
@@ -104,3 +104,6 @@ if CONFIG['GNU_AS']:
             '-march=armv7-a',
         ]
         ASFLAGS += CONFIG['NEON_FLAGS']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libvorbis/moz.build b/media/libvorbis/moz.build
index af1ca189b4ec5..eae4ca411a8c1 100644
--- a/media/libvorbis/moz.build
+++ b/media/libvorbis/moz.build
@@ -65,3 +65,6 @@ if CONFIG['CC_TYPE'] in ('clang', 'gcc'):
 
 # Add libFuzzer configuration directives
 #include('/tools/fuzzing/libfuzzer-config.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libvpx/moz.build b/media/libvpx/moz.build
index 582bc6fd5db78..b5e3a48cc2f32 100644
--- a/media/libvpx/moz.build
+++ b/media/libvpx/moz.build
@@ -153,3 +153,6 @@ if CONFIG['OS_TARGET'] == 'Android':
     ASFLAGS += [
         '-D__ANDROID__'
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libwebp/moz.build b/media/libwebp/moz.build
index e10c6588a3268..f87136984acae 100644
--- a/media/libwebp/moz.build
+++ b/media/libwebp/moz.build
@@ -30,3 +30,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libwebp/sharpyuv/moz.build b/media/libwebp/sharpyuv/moz.build
index 3b498f0bf1937..4be9cffa22652 100644
--- a/media/libwebp/sharpyuv/moz.build
+++ b/media/libwebp/sharpyuv/moz.build
@@ -47,3 +47,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libwebp/src/dec/moz.build b/media/libwebp/src/dec/moz.build
index 95b30150add08..c40b46c75bd53 100644
--- a/media/libwebp/src/dec/moz.build
+++ b/media/libwebp/src/dec/moz.build
@@ -28,3 +28,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libwebp/src/demux/moz.build b/media/libwebp/src/demux/moz.build
index ee1a76c4b4bce..eca3311030588 100644
--- a/media/libwebp/src/demux/moz.build
+++ b/media/libwebp/src/demux/moz.build
@@ -19,3 +19,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libwebp/src/dsp/moz.build b/media/libwebp/src/dsp/moz.build
index a45db44c35c6d..656162600a871 100644
--- a/media/libwebp/src/dsp/moz.build
+++ b/media/libwebp/src/dsp/moz.build
@@ -115,3 +115,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libwebp/src/enc/moz.build b/media/libwebp/src/enc/moz.build
index d10abfb032428..479e242098847 100644
--- a/media/libwebp/src/enc/moz.build
+++ b/media/libwebp/src/enc/moz.build
@@ -41,3 +41,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libwebp/src/moz/moz.build b/media/libwebp/src/moz/moz.build
index 0dfea37ed33f5..74ac784aa4a87 100644
--- a/media/libwebp/src/moz/moz.build
+++ b/media/libwebp/src/moz/moz.build
@@ -19,3 +19,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libwebp/src/utils/moz.build b/media/libwebp/src/utils/moz.build
index b4a01a8ada010..c02bb021a7dc4 100644
--- a/media/libwebp/src/utils/moz.build
+++ b/media/libwebp/src/utils/moz.build
@@ -30,3 +30,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 # We allow warnings for third-party code that can be updated from upstream.
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/libyuv/moz.build b/media/libyuv/moz.build
index a7ad7436731ce..e504b728858ce 100644
--- a/media/libyuv/moz.build
+++ b/media/libyuv/moz.build
@@ -37,3 +37,6 @@ GYP_DIRS['libyuv'].non_unified_sources += libyuv_non_unified_sources
 
 # We allow warnings for third-party code that can be updated from upstream.
 GYP_DIRS['libyuv'].sandbox_vars['COMPILE_FLAGS'] = {'WARNINGS_AS_ERRORS': []}
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/moz.build b/media/moz.build
index 3cf556da0a3f1..2fe36b09ea857 100644
--- a/media/moz.build
+++ b/media/moz.build
@@ -18,3 +18,6 @@ with Files("openmax_il/**"):
 
 with Files("gmp-clearkey/**"):
     BUG_COMPONENT = ("Core", "Audio/Video: GMP")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/mozva/moz.build b/media/mozva/moz.build
index c0ca1ab8be7ca..582433d8037ca 100644
--- a/media/mozva/moz.build
+++ b/media/mozva/moz.build
@@ -9,3 +9,6 @@ SOURCES += [
 ]
 
 Library("mozva")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/mp4parse-rust/moz.build b/media/mp4parse-rust/moz.build
index 24f6b69d78773..d938de222887e 100644
--- a/media/mp4parse-rust/moz.build
+++ b/media/mp4parse-rust/moz.build
@@ -17,3 +17,6 @@ if CONFIG['COMPILE_ENVIRONMENT']:
     ]
 
 FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/openmax_dl/dl/moz.build b/media/openmax_dl/dl/moz.build
index 9a091c69edae2..e8dd8eb69d3b8 100644
--- a/media/openmax_dl/dl/moz.build
+++ b/media/openmax_dl/dl/moz.build
@@ -47,3 +47,6 @@ if CONFIG['TARGET_CPU'] == 'arm' and CONFIG['BUILD_ARM_NEON']:
     DEFINES['BIG_FFT_TABLE'] = True
 
     FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/psshparser/gtest/moz.build b/media/psshparser/gtest/moz.build
index a7f5ef0f8ea3d..fbfdf04e9473d 100644
--- a/media/psshparser/gtest/moz.build
+++ b/media/psshparser/gtest/moz.build
@@ -11,3 +11,6 @@ UNIFIED_SOURCES += [
 USE_LIBS += ["psshparser"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/psshparser/moz.build b/media/psshparser/moz.build
index f907f472b5a82..0eeda7dca5e0f 100644
--- a/media/psshparser/moz.build
+++ b/media/psshparser/moz.build
@@ -23,3 +23,6 @@ DEFINES["MOZ_NO_MOZALLOC"] = True
 TEST_DIRS += [
     "gtest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/webrtc/moz.build b/media/webrtc/moz.build
index 4c828f0b4ef98..b8e7edfa9cfd8 100644
--- a/media/webrtc/moz.build
+++ b/media/webrtc/moz.build
@@ -14,3 +14,6 @@ if CONFIG["MOZ_WEBRTC_SIGNALING"]:
         TEST_DIRS += [
             "signaling/gtest",
         ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/webrtc/signaling/gtest/moz.build b/media/webrtc/signaling/gtest/moz.build
index d975e8142247c..390e4d50e38d7 100644
--- a/media/webrtc/signaling/gtest/moz.build
+++ b/media/webrtc/signaling/gtest/moz.build
@@ -52,3 +52,6 @@ if (
     ]
 
     FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/media/wmf-clearkey/moz.build b/media/wmf-clearkey/moz.build
index 74680a50e0dc6..26afc5921ef50 100644
--- a/media/wmf-clearkey/moz.build
+++ b/media/wmf-clearkey/moz.build
@@ -41,3 +41,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
     ]
 
 GeckoSharedLibrary("wmfclearkey", linkage=None)
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/build/moz.build b/memory/build/moz.build
index da679773308be..493f7e39a31be 100644
--- a/memory/build/moz.build
+++ b/memory/build/moz.build
@@ -66,3 +66,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
     AllowCompilerWarnings()  # workaround for bug 1090497
 
 TEST_DIRS += ["test"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/build/test/gtest/moz.build b/memory/build/test/gtest/moz.build
index 82ccaaf9c6894..24c08e0e07cc9 100644
--- a/memory/build/test/gtest/moz.build
+++ b/memory/build/test/gtest/moz.build
@@ -13,3 +13,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/build/test/moz.build b/memory/build/test/moz.build
index d93cc48c6545a..a531785e5199a 100644
--- a/memory/build/test/moz.build
+++ b/memory/build/test/moz.build
@@ -19,3 +19,6 @@ CppUnitTests(
 # jemalloc.
 if CONFIG["MOZ_PHC"]:
     TEST_DIRS += ["gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/gtest/moz.build b/memory/gtest/moz.build
index 973d0b4dda7a8..b094ad3f3e5ef 100644
--- a/memory/gtest/moz.build
+++ b/memory/gtest/moz.build
@@ -20,3 +20,6 @@ FINAL_LIBRARY = "xul-gtest"
 LOCAL_INCLUDES += [
     "../build",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/moz.build b/memory/moz.build
index e1da146a3c2a7..ee4c2813d345c 100644
--- a/memory/moz.build
+++ b/memory/moz.build
@@ -29,3 +29,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"]:
 
 if CONFIG["MOZ_REPLACE_MALLOC"]:
     DIRS += ["replace"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/mozalloc/moz.build b/memory/mozalloc/moz.build
index c5cd78460792a..873d6325fb7df 100644
--- a/memory/mozalloc/moz.build
+++ b/memory/mozalloc/moz.build
@@ -57,3 +57,6 @@ LOCAL_INCLUDES += [
 ]
 
 DIST_INSTALL = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/mozjemalloc_info/moz.build b/memory/mozjemalloc_info/moz.build
index 76dd3c5001c30..e2837abd81e03 100644
--- a/memory/mozjemalloc_info/moz.build
+++ b/memory/mozjemalloc_info/moz.build
@@ -37,3 +37,6 @@ UNIFIED_SOURCES += [
 DisableStlWrapping()
 
 include("/mozglue/build/replace_malloc.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/replace/dmd/moz.build b/memory/replace/dmd/moz.build
index 6f3121df48d4e..4c81d8f0015b9 100644
--- a/memory/replace/dmd/moz.build
+++ b/memory/replace/dmd/moz.build
@@ -35,3 +35,6 @@ if CONFIG["MOZ_OPTIMIZE"]:
 DisableStlWrapping()
 
 TEST_DIRS += ["test"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/replace/dmd/test/moz.build b/memory/replace/dmd/test/moz.build
index 77e4fa12a08f4..1c69ec14258d9 100644
--- a/memory/replace/dmd/test/moz.build
+++ b/memory/replace/dmd/test/moz.build
@@ -24,3 +24,6 @@ DisableStlWrapping()
 XPCSHELL_TESTS_MANIFESTS += [
     "xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/replace/logalloc/moz.build b/memory/replace/logalloc/moz.build
index e0588cfb1610d..2a4705b2b427b 100644
--- a/memory/replace/logalloc/moz.build
+++ b/memory/replace/logalloc/moz.build
@@ -34,3 +34,6 @@ if CONFIG["OS_TARGET"] == "Android" and FORCE_SHARED_LIB:
 DIRS += [
     "replay",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/replace/logalloc/replay/moz.build b/memory/replace/logalloc/replay/moz.build
index 4ebf48f842001..f5a1b8c9d424f 100644
--- a/memory/replace/logalloc/replay/moz.build
+++ b/memory/replace/logalloc/replay/moz.build
@@ -85,3 +85,6 @@ if CONFIG["MOZ_NEEDS_LIBATOMIC"]:
 DisableStlWrapping()
 
 include("/mozglue/build/replace_malloc.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/replace/moz.build b/memory/replace/moz.build
index 7385faceb520d..aaa7a47514e37 100644
--- a/memory/replace/moz.build
+++ b/memory/replace/moz.build
@@ -20,3 +20,6 @@ DIRS += [
 
 if CONFIG["MOZ_DMD"]:
     DIRS += ["dmd"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/replace/phc/moz.build b/memory/replace/phc/moz.build
index e2d233642cf92..9f8fd7352db95 100644
--- a/memory/replace/phc/moz.build
+++ b/memory/replace/phc/moz.build
@@ -48,3 +48,6 @@ if not CONFIG["MOZ_REPLACE_MALLOC_STATIC"]:
 TEST_DIRS += ["test"]
 
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/replace/phc/test/moz.build b/memory/replace/phc/test/moz.build
index 8208ae849d5f8..4e2bbf994c432 100644
--- a/memory/replace/phc/test/moz.build
+++ b/memory/replace/phc/test/moz.build
@@ -7,3 +7,6 @@
 # The gtests won't work in a SpiderMonkey-only build.
 if CONFIG["MOZ_WIDGET_TOOLKIT"]:
     TEST_DIRS += ["gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/volatile/moz.build b/memory/volatile/moz.build
index 9cfe43e5d02b7..2c7a55f71b84c 100644
--- a/memory/volatile/moz.build
+++ b/memory/volatile/moz.build
@@ -29,3 +29,6 @@ else:
 FINAL_LIBRARY = "xul"
 
 TEST_DIRS += ["tests"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/memory/volatile/tests/moz.build b/memory/volatile/tests/moz.build
index 31201db9d41fd..b82483748aab6 100644
--- a/memory/volatile/tests/moz.build
+++ b/memory/volatile/tests/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES = [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mfbt/moz.build b/mfbt/moz.build
index 1571473bfd12e..8620671cded70 100644
--- a/mfbt/moz.build
+++ b/mfbt/moz.build
@@ -213,3 +213,6 @@ DEFINES["LZ4LIB_VISIBILITY"] = ""
 # but pure_virtual requires mfbt to build and some projects
 # don't use mfbt.
 DIRS += ["../build/pure_virtual"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mfbt/tests/gtest/moz.build b/mfbt/tests/gtest/moz.build
index 0af8d1ea75fc7..ef4c61814f6c6 100644
--- a/mfbt/tests/gtest/moz.build
+++ b/mfbt/tests/gtest/moz.build
@@ -30,3 +30,6 @@ if not CONFIG["MOZILLA_OFFICIAL"]:
 # ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mfbt/tests/moz.build b/mfbt/tests/moz.build
index 231bec84a3388..b478fdf1a5ba1 100644
--- a/mfbt/tests/moz.build
+++ b/mfbt/tests/moz.build
@@ -115,3 +115,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
 USE_LIBS += [
     "mozglue",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/actors/moz.build b/mobile/android/actors/moz.build
index 739405e56cc14..24cafe50c3f4b 100644
--- a/mobile/android/actors/moz.build
+++ b/mobile/android/actors/moz.build
@@ -37,3 +37,6 @@ FINAL_TARGET_FILES.actors += [
 ]
 
 MOCHITEST_MANIFESTS += ["tests/mochitests/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/app/moz.build b/mobile/android/app/moz.build
index 631f18939af05..3d05751775864 100644
--- a/mobile/android/app/moz.build
+++ b/mobile/android/app/moz.build
@@ -34,3 +34,6 @@ if CONFIG["MOZ_ANDROID_GOOGLE_VR"]:
     FINAL_TARGET_FILES += [
         "/" + CONFIG["MOZ_ANDROID_GOOGLE_VR_LIBS"] + "libgvr.so",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/beta/content/moz.build b/mobile/android/branding/beta/content/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/branding/beta/content/moz.build
+++ b/mobile/android/branding/beta/content/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/beta/locales/moz.build b/mobile/android/branding/beta/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/branding/beta/locales/moz.build
+++ b/mobile/android/branding/beta/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/beta/moz.build b/mobile/android/branding/beta/moz.build
index 4b641bad320e1..73c8ad67dd7c6 100644
--- a/mobile/android/branding/beta/moz.build
+++ b/mobile/android/branding/beta/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["content", "locales"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/nightly/content/moz.build b/mobile/android/branding/nightly/content/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/branding/nightly/content/moz.build
+++ b/mobile/android/branding/nightly/content/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/nightly/locales/moz.build b/mobile/android/branding/nightly/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/branding/nightly/locales/moz.build
+++ b/mobile/android/branding/nightly/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/nightly/moz.build b/mobile/android/branding/nightly/moz.build
index 4b641bad320e1..73c8ad67dd7c6 100644
--- a/mobile/android/branding/nightly/moz.build
+++ b/mobile/android/branding/nightly/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["content", "locales"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/official/content/moz.build b/mobile/android/branding/official/content/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/branding/official/content/moz.build
+++ b/mobile/android/branding/official/content/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/official/locales/moz.build b/mobile/android/branding/official/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/branding/official/locales/moz.build
+++ b/mobile/android/branding/official/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/official/moz.build b/mobile/android/branding/official/moz.build
index 4b641bad320e1..73c8ad67dd7c6 100644
--- a/mobile/android/branding/official/moz.build
+++ b/mobile/android/branding/official/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["content", "locales"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/unofficial/content/moz.build b/mobile/android/branding/unofficial/content/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/branding/unofficial/content/moz.build
+++ b/mobile/android/branding/unofficial/content/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/unofficial/locales/moz.build b/mobile/android/branding/unofficial/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/branding/unofficial/locales/moz.build
+++ b/mobile/android/branding/unofficial/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/branding/unofficial/moz.build b/mobile/android/branding/unofficial/moz.build
index 4b641bad320e1..73c8ad67dd7c6 100644
--- a/mobile/android/branding/unofficial/moz.build
+++ b/mobile/android/branding/unofficial/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["content", "locales"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/chrome/geckoview/moz.build b/mobile/android/chrome/geckoview/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/chrome/geckoview/moz.build
+++ b/mobile/android/chrome/geckoview/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/chrome/moz.build b/mobile/android/chrome/moz.build
index bb28efc488f8f..c4dc4ae12de55 100644
--- a/mobile/android/chrome/moz.build
+++ b/mobile/android/chrome/moz.build
@@ -15,3 +15,6 @@ DEFINES["PACKAGE"] = "browser"
 DEFINES["MOZ_APP_VERSION"] = CONFIG["MOZ_APP_VERSION"]
 DEFINES["MOZ_APP_VERSION_DISPLAY"] = CONFIG["MOZ_APP_VERSION_DISPLAY"]
 DEFINES["ANDROID_PACKAGE_NAME"] = CONFIG["ANDROID_PACKAGE_NAME"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/components/extensions/moz.build b/mobile/android/components/extensions/moz.build
index 131ae528598c6..b60a571c8a26e 100644
--- a/mobile/android/components/extensions/moz.build
+++ b/mobile/android/components/extensions/moz.build
@@ -19,3 +19,6 @@ DIRS += ["schemas"]
 MOCHITEST_MANIFESTS += ["test/mochitest/mochitest.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["test/mochitest/chrome.toml"]
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/components/extensions/schemas/moz.build b/mobile/android/components/extensions/schemas/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/components/extensions/schemas/moz.build
+++ b/mobile/android/components/extensions/schemas/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/components/geckoview/moz.build b/mobile/android/components/geckoview/moz.build
index 7b115ed03b529..f0d234298cd58 100644
--- a/mobile/android/components/geckoview/moz.build
+++ b/mobile/android/components/geckoview/moz.build
@@ -53,3 +53,6 @@ EXTRA_JS_MODULES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/components/moz.build b/mobile/android/components/moz.build
index a6300de34958c..c09820267b077 100644
--- a/mobile/android/components/moz.build
+++ b/mobile/android/components/moz.build
@@ -14,3 +14,6 @@ DIRS += [
     "extensions",
     "geckoview",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/fonts/moz.build b/mobile/android/fonts/moz.build
index b0a20cf188c6e..3e2d0265f3b7b 100644
--- a/mobile/android/fonts/moz.build
+++ b/mobile/android/fonts/moz.build
@@ -14,3 +14,6 @@ if not CONFIG["MOZ_ANDROID_EXCLUDE_FONTS"]:
         "CharisSILCompact-I.ttf",
         "CharisSILCompact-R.ttf",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/geckoview/src/androidTest/assets/moz.build b/mobile/android/geckoview/src/androidTest/assets/moz.build
index 12d6550f1c633..c91a5c81c40d3 100644
--- a/mobile/android/geckoview/src/androidTest/assets/moz.build
+++ b/mobile/android/geckoview/src/androidTest/assets/moz.build
@@ -76,3 +76,6 @@ for addon, files in addons.items():
     )
 
     TEST_HARNESS_FILES.testing.mochitest.tests.junit += ["!%s" % xpi]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/installer/moz.build b/mobile/android/installer/moz.build
index 2d4f67a08bd06..8289d37d3f370 100644
--- a/mobile/android/installer/moz.build
+++ b/mobile/android/installer/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("GeckoView", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/locales/moz.build b/mobile/android/locales/moz.build
index 8a8407ca4c20d..15eaa2919a241 100644
--- a/mobile/android/locales/moz.build
+++ b/mobile/android/locales/moz.build
@@ -8,3 +8,6 @@ with Files("**"):
     BUG_COMPONENT = ("GeckoView", "General")
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/modules/geckoview/moz.build b/mobile/android/modules/geckoview/moz.build
index 9c2693c85e9b5..b4ed6316de524 100644
--- a/mobile/android/modules/geckoview/moz.build
+++ b/mobile/android/modules/geckoview/moz.build
@@ -43,3 +43,6 @@ EXTRA_JS_MODULES += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/modules/moz.build b/mobile/android/modules/moz.build
index 52db19075d4eb..d1a8251dfc9c8 100644
--- a/mobile/android/modules/moz.build
+++ b/mobile/android/modules/moz.build
@@ -16,3 +16,6 @@ DIRS += [
 EXTRA_JS_MODULES += [
     "dbg-browser-actors.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/modules/test/moz.build b/mobile/android/modules/test/moz.build
index b81665c00aa29..651683af3647b 100644
--- a/mobile/android/modules/test/moz.build
+++ b/mobile/android/modules/test/moz.build
@@ -5,3 +5,6 @@
 TESTING_JS_MODULES += [
     "AppUiTestDelegate.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/moz.build b/mobile/android/moz.build
index 689ec829338b2..3ff142b333361 100644
--- a/mobile/android/moz.build
+++ b/mobile/android/moz.build
@@ -88,3 +88,6 @@ SPHINX_TREES["/mobile/android"] = "docs"
 
 with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/android/themes/geckoview/moz.build b/mobile/android/themes/geckoview/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/mobile/android/themes/geckoview/moz.build
+++ b/mobile/android/themes/geckoview/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mobile/locales/moz.build b/mobile/locales/moz.build
index 2d4f67a08bd06..8289d37d3f370 100644
--- a/mobile/locales/moz.build
+++ b/mobile/locales/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("GeckoView", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/brotli/moz.build b/modules/brotli/moz.build
index 60db05ec901ec..e67e87fe28d8e 100644
--- a/modules/brotli/moz.build
+++ b/modules/brotli/moz.build
@@ -34,3 +34,6 @@ AllowCompilerWarnings()
 CFLAGS += ['-DBROTLI_BUILD_PORTABLE']
 
 Library('brotli')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/fdlibm/moz.build b/modules/fdlibm/moz.build
index 4ee1eb1a3e17e..2034fe40f7810 100644
--- a/modules/fdlibm/moz.build
+++ b/modules/fdlibm/moz.build
@@ -8,3 +8,6 @@ with Files('**'):
     BUG_COMPONENT = ('Core', 'JavaScript Engine')
 
 DIRS += ['src']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/fdlibm/src/moz.build b/modules/fdlibm/src/moz.build
index 08b76b572a00c..182f6cd0f397f 100644
--- a/modules/fdlibm/src/moz.build
+++ b/modules/fdlibm/src/moz.build
@@ -92,3 +92,6 @@ SOURCES += [
     's_trunc.cpp',
     's_truncf.cpp',
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/freetype2/moz.build b/modules/freetype2/moz.build
index dfa53dfd89c12..06f5d7ed9e4a7 100644
--- a/modules/freetype2/moz.build
+++ b/modules/freetype2/moz.build
@@ -92,3 +92,6 @@ CFLAGS += CONFIG['MOZ_PNG_CFLAGS']
 USE_LIBS += ['mozpng']
 
 FINAL_LIBRARY = 'freetype'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libjar/moz.build b/modules/libjar/moz.build
index c99c893169335..644a665c5b649 100644
--- a/modules/libjar/moz.build
+++ b/modules/libjar/moz.build
@@ -46,3 +46,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libjar/zipwriter/moz.build b/modules/libjar/zipwriter/moz.build
index e9a310f068740..22c244d965b67 100644
--- a/modules/libjar/zipwriter/moz.build
+++ b/modules/libjar/zipwriter/moz.build
@@ -25,3 +25,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libmar/moz.build b/modules/libmar/moz.build
index d74a03de16aca..cada9e0b38fed 100644
--- a/modules/libmar/moz.build
+++ b/modules/libmar/moz.build
@@ -15,3 +15,6 @@ DIRS += [
 ]
 
 TEST_DIRS += ["tests"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libmar/sign/moz.build b/modules/libmar/sign/moz.build
index 92f0d6cefd33b..8710dd22b0fb6 100644
--- a/modules/libmar/sign/moz.build
+++ b/modules/libmar/sign/moz.build
@@ -28,3 +28,6 @@ c11_flags = ["-std=gnu11"]
 if CONFIG["CC_TYPE"] == "clang-cl":
     c11_flags.insert(0, "-Xclang")
 CFLAGS += c11_flags
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libmar/src/moz.build b/modules/libmar/src/moz.build
index 5c40291e92b44..c31cc87fe879b 100644
--- a/modules/libmar/src/moz.build
+++ b/modules/libmar/src/moz.build
@@ -37,3 +37,6 @@ if CONFIG["MOZ_BUILD_APP"] != "tools/update-packaging":
 
     if CONFIG["OS_ARCH"] == "WINNT":
         USE_STATIC_LIBS = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libmar/tests/moz.build b/modules/libmar/tests/moz.build
index 34e767760919f..5b9b4057ea3e5 100644
--- a/modules/libmar/tests/moz.build
+++ b/modules/libmar/tests/moz.build
@@ -10,3 +10,6 @@ if CONFIG["OS_TARGET"] != "Android" and CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.xpcshell.modules.libmar.tests.unit += [
         "!/dist/bin/signmar%s" % CONFIG["BIN_SUFFIX"],
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libmar/tool/moz.build b/modules/libmar/tool/moz.build
index b2772544d50d1..d019c8d36d717 100644
--- a/modules/libmar/tool/moz.build
+++ b/modules/libmar/tool/moz.build
@@ -70,3 +70,6 @@ for var in ("MAR_CHANNEL_ID", "MOZ_APP_VERSION"):
     HOST_DEFINES[var] = '"%s"' % CONFIG[var]
     if SOURCES:
         DEFINES[var] = HOST_DEFINES[var]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libmar/verify/moz.build b/modules/libmar/verify/moz.build
index 5ea079a666bbb..8faa0e7451eb5 100644
--- a/modules/libmar/verify/moz.build
+++ b/modules/libmar/verify/moz.build
@@ -50,3 +50,6 @@ c11_flags = ["-std=gnu11"]
 if CONFIG["CC_TYPE"] == "clang-cl":
     c11_flags.insert(0, "-Xclang")
 CFLAGS += c11_flags
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libpref/moz.build b/modules/libpref/moz.build
index 3a3751c7b85cb..0affdb721dccd 100644
--- a/modules/libpref/moz.build
+++ b/modules/libpref/moz.build
@@ -175,3 +175,6 @@ else:
     FINAL_TARGET_PP_FILES += [
         "greprefs.js",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/libpref/test/gtest/moz.build b/modules/libpref/test/gtest/moz.build
index d689b382f8dce..5b0d1282ced9e 100644
--- a/modules/libpref/test/gtest/moz.build
+++ b/modules/libpref/test/gtest/moz.build
@@ -21,3 +21,6 @@ if CONFIG["CC_TYPE"] == "clang":
     CXXFLAGS += ["-Wno-inconsistent-missing-override"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/moz.build b/modules/moz.build
index ea5bee9c30941..a6172463e3e02 100644
--- a/modules/moz.build
+++ b/modules/moz.build
@@ -9,3 +9,6 @@ with Files("**"):
 
 with Files("freetype2/**"):
     BUG_COMPONENT = ("Core", "Graphics: Text")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/woff2/moz.build b/modules/woff2/moz.build
index 3af9c00923c0a..aea53ed3942f8 100644
--- a/modules/woff2/moz.build
+++ b/modules/woff2/moz.build
@@ -24,3 +24,6 @@ EXPORTS.woff2 += [
 AllowCompilerWarnings()
 
 Library('woff2')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/xz-embedded/moz.build b/modules/xz-embedded/moz.build
index f80c93c65b6f6..53bf88e6bb9f6 100644
--- a/modules/xz-embedded/moz.build
+++ b/modules/xz-embedded/moz.build
@@ -32,3 +32,6 @@ if CONFIG['OS_ARCH'] == 'WINNT':
     USE_STATIC_LIBS = True
 
 Library('xz-embedded')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/zlib/moz.build b/modules/zlib/moz.build
index fd246b6a5835b..1862378dcb574 100644
--- a/modules/zlib/moz.build
+++ b/modules/zlib/moz.build
@@ -9,3 +9,6 @@ with Files('**'):
 
 DIRS += ['src']
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/modules/zlib/src/moz.build b/modules/zlib/src/moz.build
index 87c33d4936c4c..927878b5d0f73 100644
--- a/modules/zlib/src/moz.build
+++ b/modules/zlib/src/moz.build
@@ -41,3 +41,6 @@ AllowCompilerWarnings()
 # ... most warnings, anyway. https://github.com/madler/zlib/issues/633
 if CONFIG['CC_TYPE'] in ('clang', 'clang-cl'):
     CFLAGS += ["-Wno-deprecated-non-prototype"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/moz.build b/moz.build
index 5af3642165579..be8e6807a2c8d 100644
--- a/moz.build
+++ b/moz.build
@@ -218,3 +218,6 @@ SPHINX_TREES["mots"] = "docs/mots"
 SPHINX_TREES["update-infrastructure"] = "docs/update-infrastructure"
 
 include("build/templates.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mozconfig b/mozconfig
new file mode 100644
index 0000000000000..34ab5ab9c26a4
--- /dev/null
+++ b/mozconfig
@@ -0,0 +1,42 @@
+# force using the toolchain from the .mozbuild directory created from a mozill-central repo
+ac_add_options CC=/home/jdrescher/.mozbuild/clang/bin/clang
+ac_add_options CXX=/home/jdrescher/.mozbuild/clang/bin/clang++
+ac_add_options --with-libclang-path=/home/jdrescher/.mozbuild/clang/lib
+
+# manually created
+# ac_add_options --enable-debug
+# ac_add_options --enable-debug-symbols
+# ac_add_options --enable-fuzzing
+
+export MOZ_PACKAGE_JSSHELL=1
+# mk_add_options ENABLE_WEBDRIVER=1
+
+ac_add_options --with-app-name=firefox
+mk_add_options MOZ_APP_NAME=firefox
+mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/release-cov
+
+# Enable ASan specific code and build workarounds
+ac_add_options --enable-address-sanitizer
+
+# These three are required by ASan
+ac_add_options --disable-jemalloc
+ac_add_options --disable-crashreporter
+ac_add_options --disable-elf-hack
+
+# Keep symbols to symbolize ASan traces later
+export MOZ_DEBUG_SYMBOLS=1
+ac_add_options --enable-debug-symbols
+ac_add_options --disable-install-strip
+
+# Settings for an opt build (preferred)
+# The -gline-tables-only ensures that all the necessary debug information for ASan
+# is present, but the rest is stripped so the resulting binaries are smaller.
+ac_add_options --enable-optimize="-O2 -gline-tables-only"
+ac_add_options --disable-debug
+
+# Settings for a debug+opt build
+#ac_add_options --enable-optimize
+#ac_add_options --enable-debug
+
+# ac_add_options --enable-valgrind
+
diff --git a/mozconfig.example b/mozconfig.example
new file mode 100644
index 0000000000000..45e19f0df537b
--- /dev/null
+++ b/mozconfig.example
@@ -0,0 +1,21 @@
+# force using the toolchain from the .mozbuild directory created from a mozill-central repo
+ac_add_options CC=/home/jdrescher/.mozbuild/clang/bin/clang
+ac_add_options CXX=/home/jdrescher/.mozbuild/clang/bin/clang++
+ac_add_options --with-libclang-path=/home/jdrescher/.mozbuild/clang/lib
+
+# manually created
+# ac_add_options --enable-debug
+# ac_add_options --enable-debug-symbols
+# ac_add_options --enable-fuzzing
+
+export MOZ_PACKAGE_JSSHELL=1
+# mk_add_options ENABLE_WEBDRIVER=1
+
+ac_add_options --with-app-name=firefox
+mk_add_options MOZ_APP_NAME=firefox
+mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/release
+# ac_add_options --disable-tests
+# ac_add_options --disable-sandbox
+# ac_add_options --without-wasm-sandboxed-libraries
+
+
diff --git a/mozglue/android/moz.build b/mozglue/android/moz.build
index bf5813d96370b..c920673c8ccf8 100644
--- a/mozglue/android/moz.build
+++ b/mozglue/android/moz.build
@@ -42,3 +42,6 @@ DEFINES["XPCOM_GLUE"] = True
 USE_LIBS += [
     "xpcomglue",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mozglue/baseprofiler/moz.build b/mozglue/baseprofiler/moz.build
index fb6efddc25b4a..0e584a59dcbad 100644
--- a/mozglue/baseprofiler/moz.build
+++ b/mozglue/baseprofiler/moz.build
@@ -131,3 +131,6 @@ if CONFIG["CC_TYPE"] in ("clang", "gcc"):
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "Gecko Profiler")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mozglue/build/moz.build b/mozglue/build/moz.build
index f982f7dc49077..ba27903cc8dde 100644
--- a/mozglue/build/moz.build
+++ b/mozglue/build/moz.build
@@ -112,3 +112,6 @@ if CONFIG["MOZ_LINKER"] and CONFIG["TARGET_CPU"] == "arm":
 DIST_INSTALL = True
 
 include("replace_malloc.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mozglue/interposers/moz.build b/mozglue/interposers/moz.build
index 48e88946b5571..7c61f91c22eb5 100644
--- a/mozglue/interposers/moz.build
+++ b/mozglue/interposers/moz.build
@@ -23,3 +23,6 @@ if CONFIG["MOZ_LINKER"]:
     ]
 
 FINAL_LIBRARY = "mozglue"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mozglue/linker/moz.build b/mozglue/linker/moz.build
index a7b37030ff059..0c54ff28b7c96 100644
--- a/mozglue/linker/moz.build
+++ b/mozglue/linker/moz.build
@@ -15,3 +15,6 @@ SOURCES += [
 Library("linker")
 
 FINAL_LIBRARY = "mozglue"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mozglue/misc/moz.build b/mozglue/misc/moz.build
index c0ff86ea0517c..5b6a7f8cd9e96 100644
--- a/mozglue/misc/moz.build
+++ b/mozglue/misc/moz.build
@@ -155,3 +155,6 @@ if CONFIG["CC_TYPE"] in ("clang", "clang-cl"):
 
 for var in ("MOZ_APP_BASENAME", "MOZ_APP_VENDOR"):
     DEFINES[var] = '"%s"' % CONFIG[var]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mozglue/moz.build b/mozglue/moz.build
index b94a862793458..2f7835f71c66f 100644
--- a/mozglue/moz.build
+++ b/mozglue/moz.build
@@ -24,3 +24,6 @@ DIRS += [
 
 if CONFIG["MOZ_WIDGET_TOOLKIT"]:
     TEST_DIRS += ["tests"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mozglue/tests/gtest/moz.build b/mozglue/tests/gtest/moz.build
index 8f6ba9ad7b30f..6b21ec09cc2a6 100644
--- a/mozglue/tests/gtest/moz.build
+++ b/mozglue/tests/gtest/moz.build
@@ -18,3 +18,6 @@ if not CONFIG["MOZ_TSAN"]:
     SOURCES["TestStackWalk.cpp"].flags += ["-O2"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/mozglue/tests/moz.build b/mozglue/tests/moz.build
index ac68508ebd486..c77a9fcd1d589 100644
--- a/mozglue/tests/moz.build
+++ b/mozglue/tests/moz.build
@@ -51,3 +51,6 @@ if CONFIG["OS_TARGET"] == "WINNT" and CONFIG["CC_TYPE"] in ("gcc", "clang"):
 TEST_DIRS += [
     "gtest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/base/LoadInfo.cpp b/netwerk/base/LoadInfo.cpp
index b15f24fffd7ea..0279f6626f2ac 100644
--- a/netwerk/base/LoadInfo.cpp
+++ b/netwerk/base/LoadInfo.cpp
@@ -653,7 +653,8 @@ LoadInfo::LoadInfo(const LoadInfo& rhs)
       mInterceptionInfo(rhs.mInterceptionInfo),
       mHasInjectedCookieForCookieBannerHandling(
           rhs.mHasInjectedCookieForCookieBannerHandling),
-      mWasSchemelessInput(rhs.mWasSchemelessInput) {
+      mWasSchemelessInput(rhs.mWasSchemelessInput),
+      mJugglerLoadIdentifier(rhs.mJugglerLoadIdentifier) {
 }
 
 LoadInfo::LoadInfo(
@@ -2369,4 +2370,16 @@ LoadInfo::SetWasSchemelessInput(bool aWasSchemelessInput) {
   return NS_OK;
 }
 
+NS_IMETHODIMP
+LoadInfo::GetJugglerLoadIdentifier(uint64_t* aResult) {
+  *aResult = mJugglerLoadIdentifier;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
+LoadInfo::SetJugglerLoadIdentifier(uint64_t aID) {
+  mJugglerLoadIdentifier = aID;
+  return NS_OK;
+}
+
 }  // namespace mozilla::net
diff --git a/netwerk/base/LoadInfo.h b/netwerk/base/LoadInfo.h
index a8631b09b2670..a0bd72113e353 100644
--- a/netwerk/base/LoadInfo.h
+++ b/netwerk/base/LoadInfo.h
@@ -401,6 +401,8 @@ class LoadInfo final : public nsILoadInfo {
 
   bool mHasInjectedCookieForCookieBannerHandling = false;
   bool mWasSchemelessInput = false;
+
+  uint64_t mJugglerLoadIdentifier = 0;
 };
 
 // This is exposed solely for testing purposes and should not be used outside of
diff --git a/netwerk/base/TRRLoadInfo.cpp b/netwerk/base/TRRLoadInfo.cpp
index 920e7623a7f91..dfea0d0f7a72d 100644
--- a/netwerk/base/TRRLoadInfo.cpp
+++ b/netwerk/base/TRRLoadInfo.cpp
@@ -861,5 +861,15 @@ TRRLoadInfo::SetWasSchemelessInput(bool aWasSchemelessInput) {
   return NS_ERROR_NOT_IMPLEMENTED;
 }
 
+NS_IMETHODIMP
+TRRLoadInfo::GetJugglerLoadIdentifier(uint64_t* aResult) {
+  return NS_ERROR_NOT_IMPLEMENTED;
+}
+
+NS_IMETHODIMP
+TRRLoadInfo::SetJugglerLoadIdentifier(uint64_t aResult) {
+  return NS_ERROR_NOT_IMPLEMENTED;
+}
+
 }  // namespace net
 }  // namespace mozilla
diff --git a/netwerk/base/http-sfv/moz.build b/netwerk/base/http-sfv/moz.build
index ed857c91a841f..97d67e973479d 100644
--- a/netwerk/base/http-sfv/moz.build
+++ b/netwerk/base/http-sfv/moz.build
@@ -15,3 +15,6 @@ EXPORTS.mozilla.net += ["SFVService.h"]
 SOURCES += ["SFVService.cpp"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/base/moz.build b/netwerk/base/moz.build
index e069a5f2967e9..871822a4fb0fa 100644
--- a/netwerk/base/moz.build
+++ b/netwerk/base/moz.build
@@ -317,3 +317,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "cocoa":
 GeneratedFile(
     "ascii_pac_utils.inc", script="makecppstring.py", inputs=["ascii_pac_utils.js"]
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/base/mozurl/moz.build b/netwerk/base/mozurl/moz.build
index 0a4e522b5acee..e1434fb8e232d 100644
--- a/netwerk/base/mozurl/moz.build
+++ b/netwerk/base/mozurl/moz.build
@@ -20,3 +20,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     EXPORTS.mozilla.net += [
         "!MozURL_ffi.h",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/base/nsILoadInfo.idl b/netwerk/base/nsILoadInfo.idl
index ddfcb223e6126..4280b836c55e5 100644
--- a/netwerk/base/nsILoadInfo.idl
+++ b/netwerk/base/nsILoadInfo.idl
@@ -1532,4 +1532,6 @@ interface nsILoadInfo : nsISupports
    * Whether the load has gone through the URL bar, where the fixup had to add * the protocol scheme.
    */
    [infallible] attribute boolean wasSchemelessInput;
+
+  [infallible] attribute unsigned long long jugglerLoadIdentifier;
 };
diff --git a/netwerk/base/nsINetworkInterceptController.idl b/netwerk/base/nsINetworkInterceptController.idl
index 155daa5cd52c4..02e8a2614a27a 100644
--- a/netwerk/base/nsINetworkInterceptController.idl
+++ b/netwerk/base/nsINetworkInterceptController.idl
@@ -59,6 +59,7 @@ interface nsIInterceptedChannel : nsISupports
      * results in the resulting client not being controlled.
      */
     void resetInterception(in boolean bypass);
+    void resetInterceptionWithURI(in nsIURI aURI);
 
     /**
      * Set the status and reason for the forthcoming synthesized response.
diff --git a/netwerk/base/rust-helper/moz.build b/netwerk/base/rust-helper/moz.build
index 1f7512ecf9eb5..85a07fcd88933 100644
--- a/netwerk/base/rust-helper/moz.build
+++ b/netwerk/base/rust-helper/moz.build
@@ -10,3 +10,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     EXPORTS.mozilla.net += [
         "!rust_helper.h",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/build/moz.build b/netwerk/build/moz.build
index a3c3fbdd662c5..81c287dadd6a4 100644
--- a/netwerk/build/moz.build
+++ b/netwerk/build/moz.build
@@ -51,3 +51,6 @@ LOCAL_INCLUDES += [
     "!/netwerk/dns",
     "/modules/brotli/dec",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/cache2/moz.build b/netwerk/cache2/moz.build
index 54afa11a09032..c7176606ac3d9 100644
--- a/netwerk/cache2/moz.build
+++ b/netwerk/cache2/moz.build
@@ -64,3 +64,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/cookie/moz.build b/netwerk/cookie/moz.build
index 1667943a313cc..76e958aa88664 100644
--- a/netwerk/cookie/moz.build
+++ b/netwerk/cookie/moz.build
@@ -75,3 +75,6 @@ TESTING_JS_MODULES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/dns/moz.build b/netwerk/dns/moz.build
index c926d14707d15..e9a9ca3400ea9 100644
--- a/netwerk/dns/moz.build
+++ b/netwerk/dns/moz.build
@@ -120,3 +120,6 @@ LOCAL_INCLUDES += [
 ]
 
 USE_LIBS += ["icu"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/dns/tests/moz.build b/netwerk/dns/tests/moz.build
index fb176c1bd3420..8d16ff6b5c6a9 100644
--- a/netwerk/dns/tests/moz.build
+++ b/netwerk/dns/tests/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["unit"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/dns/tests/unit/data/moz.build b/netwerk/dns/tests/unit/data/moz.build
index 0f5a164f77913..1cfd8743cbe6d 100644
--- a/netwerk/dns/tests/unit/data/moz.build
+++ b/netwerk/dns/tests/unit/data/moz.build
@@ -12,3 +12,6 @@ GeneratedFile(
 )
 
 TEST_HARNESS_FILES.xpcshell.netwerk.dns.tests.unit.data += ["!fake_remote_dafsa.bin"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/dns/tests/unit/moz.build b/netwerk/dns/tests/unit/moz.build
index e5ce568e7076c..1e3aeb32b27e6 100644
--- a/netwerk/dns/tests/unit/moz.build
+++ b/netwerk/dns/tests/unit/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["data"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/ipc/DocumentLoadListener.cpp b/netwerk/ipc/DocumentLoadListener.cpp
index ca1f59e8847bd..d114f0bcadded 100644
--- a/netwerk/ipc/DocumentLoadListener.cpp
+++ b/netwerk/ipc/DocumentLoadListener.cpp
@@ -167,6 +167,7 @@ static auto CreateDocumentLoadInfo(CanonicalBrowsingContext* aBrowsingContext,
   loadInfo->SetHasValidUserGestureActivation(
       aLoadState->HasValidUserGestureActivation());
   loadInfo->SetIsMetaRefresh(aLoadState->IsMetaRefresh());
+  loadInfo->SetJugglerLoadIdentifier(aLoadState->GetLoadIdentifier());
 
   return loadInfo.forget();
 }
diff --git a/netwerk/ipc/moz.build b/netwerk/ipc/moz.build
index ee878627851cf..3bf80640e52d0 100644
--- a/netwerk/ipc/moz.build
+++ b/netwerk/ipc/moz.build
@@ -115,3 +115,6 @@ LOCAL_INCLUDES += [
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/locales/moz.build b/netwerk/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/netwerk/locales/moz.build
+++ b/netwerk/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/mime/moz.build b/netwerk/mime/moz.build
index a7b62777f408b..eaef3971ac92f 100644
--- a/netwerk/mime/moz.build
+++ b/netwerk/mime/moz.build
@@ -21,3 +21,6 @@ SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/moz.build b/netwerk/moz.build
index fd4002b9c6362..9ac1a3c01e253 100644
--- a/netwerk/moz.build
+++ b/netwerk/moz.build
@@ -33,3 +33,6 @@ DIRS += ["build"]
 TEST_DIRS += ["test"]
 
 SPHINX_TREES["/networking"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/about/moz.build b/netwerk/protocol/about/moz.build
index f130d9b07b22b..bb24f05bef5d2 100644
--- a/netwerk/protocol/about/moz.build
+++ b/netwerk/protocol/about/moz.build
@@ -30,3 +30,6 @@ LOCAL_INCLUDES += [
     "/netwerk/base",
     "/netwerk/cache2",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/data/moz.build b/netwerk/protocol/data/moz.build
index 482c0b8a2ff78..6f11277ad0959 100644
--- a/netwerk/protocol/data/moz.build
+++ b/netwerk/protocol/data/moz.build
@@ -27,3 +27,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/netwerk/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/file/moz.build b/netwerk/protocol/file/moz.build
index 821e20e1c5a4b..428cee632d866 100644
--- a/netwerk/protocol/file/moz.build
+++ b/netwerk/protocol/file/moz.build
@@ -38,3 +38,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/netwerk/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/gio/moz.build b/netwerk/protocol/gio/moz.build
index 4078e5605c81d..e721a65f792ae 100644
--- a/netwerk/protocol/gio/moz.build
+++ b/netwerk/protocol/gio/moz.build
@@ -40,3 +40,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "Widget: Gtk")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/http/HttpBaseChannel.cpp b/netwerk/protocol/http/HttpBaseChannel.cpp
index 59242f69337e6..0d23a5077378f 100644
--- a/netwerk/protocol/http/HttpBaseChannel.cpp
+++ b/netwerk/protocol/http/HttpBaseChannel.cpp
@@ -107,6 +107,9 @@
 #include "mozilla/dom/ContentChild.h"
 #include "nsQueryObject.h"
 
+#include "mozilla/ipc/IPCFuzzerCore.h"
+
+
 using mozilla::dom::RequestMode;
 
 #define LOGORB(msg, ...)                \
@@ -5212,6 +5215,11 @@ bool HttpBaseChannel::ShouldTaintReplacementChannelOrigin(
 
 // Redirect Tracking
 bool HttpBaseChannel::SameOriginWithOriginalUri(nsIURI* aURI) {
+  // PATCH(JN)
+  if (::mozilla::ipc::IPCFuzzerCore::getInstance().deactivate_renderer_checks_flag & 0x20){
+    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE HttpBaseChannel::SameOriginWithOriginalUri"));
+    return true;
+  }
   nsIScriptSecurityManager* ssm = nsContentUtils::GetSecurityManager();
   bool isPrivateWin = mLoadInfo->GetOriginAttributes().mPrivateBrowsingId > 0;
   nsresult rv =
diff --git a/netwerk/protocol/http/InterceptedHttpChannel.cpp b/netwerk/protocol/http/InterceptedHttpChannel.cpp
index c58fbc96391f8..c121c891b61c9 100644
--- a/netwerk/protocol/http/InterceptedHttpChannel.cpp
+++ b/netwerk/protocol/http/InterceptedHttpChannel.cpp
@@ -727,6 +727,14 @@ NS_IMPL_ISUPPORTS(ResetInterceptionHeaderVisitor, nsIHttpHeaderVisitor)
 
 }  // anonymous namespace
 
+NS_IMETHODIMP
+InterceptedHttpChannel::ResetInterceptionWithURI(nsIURI* aURI) {
+  if (aURI) {
+    mURI = aURI;
+  }
+  return ResetInterception(true);
+}
+
 NS_IMETHODIMP
 InterceptedHttpChannel::ResetInterception(bool aBypass) {
   INTERCEPTED_LOG(("InterceptedHttpChannel::ResetInterception [%p] bypass: %s",
@@ -1140,11 +1148,18 @@ InterceptedHttpChannel::OnStartRequest(nsIRequest* aRequest) {
     GetCallback(mProgressSink);
   }
 
+  // Playwright: main requests in firefox do not have loading principal.
+  // As they are intercepted by Playwright, they don't have
+  // serviceWorkerTainting as well.
+  // Thus these asserts are wrong for Playwright world.
+  // Note: these checks were added in https://github.com/mozilla/gecko-dev/commit/92e2cdde79c11510c3e4192e1b6264d00398ed95
+  /*
   MOZ_ASSERT_IF(!mLoadInfo->GetServiceWorkerTaintingSynthesized(),
                 mLoadInfo->GetLoadingPrincipal());
   // No need to do ORB checks if these conditions hold.
   MOZ_DIAGNOSTIC_ASSERT(mLoadInfo->GetServiceWorkerTaintingSynthesized() ||
                         mLoadInfo->GetLoadingPrincipal()->IsSystemPrincipal());
+  */
 
   if (mPump && mLoadFlags & LOAD_CALL_CONTENT_SNIFFERS) {
     mPump->PeekStream(CallTypeSniffers, static_cast<nsIChannel*>(this));
diff --git a/netwerk/protocol/http/moz.build b/netwerk/protocol/http/moz.build
index db6b2a1a68a85..c0416ce2202d7 100644
--- a/netwerk/protocol/http/moz.build
+++ b/netwerk/protocol/http/moz.build
@@ -217,3 +217,6 @@ XPCOM_MANIFESTS += [
 ]
 
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/moz.build b/netwerk/protocol/moz.build
index aa3200c856e5e..c20b9c4ecb895 100644
--- a/netwerk/protocol/moz.build
+++ b/netwerk/protocol/moz.build
@@ -8,3 +8,6 @@ DIRS += ["about", "data", "file"]
 if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     DIRS += ["gio"]
 DIRS += ["http", "res", "viewsource", "websocket", "webtransport"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/res/moz.build b/netwerk/protocol/res/moz.build
index 63407eebd8b31..6b6c8576a216d 100644
--- a/netwerk/protocol/res/moz.build
+++ b/netwerk/protocol/res/moz.build
@@ -40,3 +40,6 @@ LOCAL_INCLUDES += [
     "/netwerk/base",
     "/xpcom/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/viewsource/moz.build b/netwerk/protocol/viewsource/moz.build
index adf19615f0dd1..1014dec3931f8 100644
--- a/netwerk/protocol/viewsource/moz.build
+++ b/netwerk/protocol/viewsource/moz.build
@@ -27,3 +27,6 @@ LOCAL_INCLUDES += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/websocket/moz.build b/netwerk/protocol/websocket/moz.build
index 123d364b7040b..a5b59c55fd1f2 100644
--- a/netwerk/protocol/websocket/moz.build
+++ b/netwerk/protocol/websocket/moz.build
@@ -65,3 +65,6 @@ LOCAL_INCLUDES += [
 ]
 
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/protocol/webtransport/moz.build b/netwerk/protocol/webtransport/moz.build
index 2dd99978ac55a..d64e87606d488 100644
--- a/netwerk/protocol/webtransport/moz.build
+++ b/netwerk/protocol/webtransport/moz.build
@@ -34,3 +34,6 @@ LOCAL_INCLUDES += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/sctp/datachannel/moz.build b/netwerk/sctp/datachannel/moz.build
index 94656f084ef20..1df0dfb96fa8c 100644
--- a/netwerk/sctp/datachannel/moz.build
+++ b/netwerk/sctp/datachannel/moz.build
@@ -34,3 +34,6 @@ if CONFIG["OS_TARGET"] == "WINNT":
     DEFINES["__Userspace_os_Windows"] = 1
 else:
     DEFINES["__Userspace_os_%s" % CONFIG["OS_TARGET"]] = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/sctp/src/moz.build b/netwerk/sctp/src/moz.build
index 9fa964127686a..398728bd5befb 100644
--- a/netwerk/sctp/src/moz.build
+++ b/netwerk/sctp/src/moz.build
@@ -56,3 +56,6 @@ if CONFIG['OS_TARGET'] in ('Linux', 'Android'):
     DEFINES['_GNU_SOURCE'] = 1
 elif CONFIG['OS_TARGET'] == 'Darwin':
     DEFINES['__APPLE_USE_RFC_2292'] = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/socket/moz.build b/netwerk/socket/moz.build
index d8ce8d0b2bb14..4001fa2c0de82 100644
--- a/netwerk/socket/moz.build
+++ b/netwerk/socket/moz.build
@@ -44,3 +44,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "windows":
 FINAL_LIBRARY = "xul"
 
 CONFIGURE_SUBST_FILES += ["neqo/extra-bindgen-flags"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/socket/neqo_glue/moz.build b/netwerk/socket/neqo_glue/moz.build
index b3123dde4f0bc..89d8a4fed682a 100644
--- a/netwerk/socket/neqo_glue/moz.build
+++ b/netwerk/socket/neqo_glue/moz.build
@@ -19,3 +19,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     EXPORTS.mozilla.net += [
         "!neqo_glue_ffi_generated.h",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/streamconv/converters/moz.build b/netwerk/streamconv/converters/moz.build
index d985eb363a08e..c39a159f70ca1 100644
--- a/netwerk/streamconv/converters/moz.build
+++ b/netwerk/streamconv/converters/moz.build
@@ -29,3 +29,6 @@ LOCAL_INCLUDES += [
     "/modules/brotli/dec",
     "/netwerk/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/streamconv/moz.build b/netwerk/streamconv/moz.build
index e7ef5b95b7fb9..ec12d7eb16d74 100644
--- a/netwerk/streamconv/moz.build
+++ b/netwerk/streamconv/moz.build
@@ -22,3 +22,6 @@ SOURCES += [
 XPIDL_MODULE = "necko_strconv"
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/system/android/moz.build b/netwerk/system/android/moz.build
index c60b3e5871670..607cd0f759bc9 100644
--- a/netwerk/system/android/moz.build
+++ b/netwerk/system/android/moz.build
@@ -12,3 +12,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/netwerk/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/system/linux/moz.build b/netwerk/system/linux/moz.build
index 8ddc517c3e539..278d54432fd85 100644
--- a/netwerk/system/linux/moz.build
+++ b/netwerk/system/linux/moz.build
@@ -14,3 +14,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/system/mac/moz.build b/netwerk/system/mac/moz.build
index f6436fab56e5a..7655549969242 100644
--- a/netwerk/system/mac/moz.build
+++ b/netwerk/system/mac/moz.build
@@ -9,3 +9,6 @@ SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/system/moz.build b/netwerk/system/moz.build
index b70eb40aaaa5f..cf9ea1393847c 100644
--- a/netwerk/system/moz.build
+++ b/netwerk/system/moz.build
@@ -21,3 +21,6 @@ SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/system/netlink/moz.build b/netwerk/system/netlink/moz.build
index 6882a2112664f..92b3176f6df95 100644
--- a/netwerk/system/netlink/moz.build
+++ b/netwerk/system/netlink/moz.build
@@ -10,3 +10,6 @@ if CONFIG["OS_ARCH"] == "Linux":
     ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/system/win32/moz.build b/netwerk/system/win32/moz.build
index 2d7e668c3cddb..25035c3efb3ff 100644
--- a/netwerk/system/win32/moz.build
+++ b/netwerk/system/win32/moz.build
@@ -14,3 +14,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/test/fuzz/moz.build b/netwerk/test/fuzz/moz.build
index 969b9b0b82785..d018430acc3e9 100644
--- a/netwerk/test/fuzz/moz.build
+++ b/netwerk/test/fuzz/moz.build
@@ -30,3 +30,6 @@ FINAL_LIBRARY = "xul-gtest"
 LOCAL_INCLUDES += ["!/xpcom", "/xpcom/components"]
 
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/test/gtest/moz.build b/netwerk/test/gtest/moz.build
index b6d82b41db35a..39cf3207c4365 100644
--- a/netwerk/test/gtest/moz.build
+++ b/netwerk/test/gtest/moz.build
@@ -78,3 +78,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 FINAL_LIBRARY = "xul-gtest"
 
 LOCAL_INCLUDES += ["!/xpcom", "/xpcom/components"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/test/http3server/moz.build b/netwerk/test/http3server/moz.build
index 8be2cdb31e90a..d217e5bed48c6 100644
--- a/netwerk/test/http3server/moz.build
+++ b/netwerk/test/http3server/moz.build
@@ -16,3 +16,6 @@ if CONFIG["OS_ARCH"] == "Darwin":
     LDFLAGS += ["-Wl,-rpath,@executable_path"]
 
 USE_LIBS += ["nss"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/test/httpserver/moz.build b/netwerk/test/httpserver/moz.build
index f4c978b16058e..7d915cafe6b5c 100644
--- a/netwerk/test/httpserver/moz.build
+++ b/netwerk/test/httpserver/moz.build
@@ -19,3 +19,6 @@ EXTRA_COMPONENTS += [
 TESTING_JS_MODULES += [
     "httpd.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/test/moz.build b/netwerk/test/moz.build
index 864d1f5b87fbe..af90c99a0ab1e 100644
--- a/netwerk/test/moz.build
+++ b/netwerk/test/moz.build
@@ -31,3 +31,6 @@ MARIONETTE_MANIFESTS += ["marionette/manifest.toml"]
 
 if CONFIG["FUZZING_INTERFACES"]:
     TEST_DIRS += ["fuzz"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/url-classifier/moz.build b/netwerk/url-classifier/moz.build
index d63206780e505..4605906acf4ae 100644
--- a/netwerk/url-classifier/moz.build
+++ b/netwerk/url-classifier/moz.build
@@ -66,3 +66,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/wifi/gtest/moz.build b/netwerk/wifi/gtest/moz.build
index d47976926f052..3cff43d6c3514 100644
--- a/netwerk/wifi/gtest/moz.build
+++ b/netwerk/wifi/gtest/moz.build
@@ -11,3 +11,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/netwerk/wifi/moz.build b/netwerk/wifi/moz.build
index 75a9384c09876..e214be851800f 100644
--- a/netwerk/wifi/moz.build
+++ b/netwerk/wifi/moz.build
@@ -61,3 +61,6 @@ TEST_DIRS += ["gtest"]
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/other-licenses/bsdiff/moz.build b/other-licenses/bsdiff/moz.build
index c7080a6e249f4..4eec7af7c208c 100644
--- a/other-licenses/bsdiff/moz.build
+++ b/other-licenses/bsdiff/moz.build
@@ -20,3 +20,6 @@ LOCAL_INCLUDES += [
     '/toolkit/mozapps/update/updater',
     '/toolkit/mozapps/update/updater/bspatch',
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/other-licenses/moz.build b/other-licenses/moz.build
index 66da6b1bfdb78..40ab1a1c091e8 100644
--- a/other-licenses/moz.build
+++ b/other-licenses/moz.build
@@ -27,3 +27,6 @@ with Files('ply/**'):
 
 with Files('snappy/**'):
     BUG_COMPONENT = ('Core', 'XPCOM')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/other-licenses/snappy/moz.build b/other-licenses/snappy/moz.build
index 56fc2ce4c34b5..5af2d976567ef 100644
--- a/other-licenses/snappy/moz.build
+++ b/other-licenses/snappy/moz.build
@@ -31,3 +31,6 @@ if CONFIG['CC_TYPE'] in ('clang', 'gcc'):
 
 if CONFIG['TARGET_ENDIANNESS'] == 'big':
     DEFINES['SNAPPY_IS_BIG_ENDIAN'] = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/parser/expat/lib/moz.build b/parser/expat/lib/moz.build
index f0301d37a07ac..5f766e51e8704 100644
--- a/parser/expat/lib/moz.build
+++ b/parser/expat/lib/moz.build
@@ -22,3 +22,6 @@ FINAL_LIBRARY = 'gkmedias'
 
 for k, v in expat_defines:
     DEFINES[k] = v
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/parser/expat/moz.build b/parser/expat/moz.build
index f79e8a9083eaa..f28484bd83af6 100644
--- a/parser/expat/moz.build
+++ b/parser/expat/moz.build
@@ -20,3 +20,6 @@ EXPORTS += [
 LOCAL_INCLUDES += [
     '!/security/rlbox',
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/parser/html/moz.build b/parser/html/moz.build
index 12fe8c8ada939..bfe15a5fdb5f9 100644
--- a/parser/html/moz.build
+++ b/parser/html/moz.build
@@ -90,3 +90,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/dom/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/parser/html/nsHtml5TreeOpExecutor.cpp b/parser/html/nsHtml5TreeOpExecutor.cpp
index 3cb38dcf28a5c..4d9ae3ab666d4 100644
--- a/parser/html/nsHtml5TreeOpExecutor.cpp
+++ b/parser/html/nsHtml5TreeOpExecutor.cpp
@@ -1381,6 +1381,10 @@ void nsHtml5TreeOpExecutor::UpdateReferrerInfoFromMeta(
 void nsHtml5TreeOpExecutor::AddSpeculationCSP(const nsAString& aCSP) {
   NS_ASSERTION(NS_IsMainThread(), "Wrong thread!");
 
+  if (mDocShell && static_cast<nsDocShell*>(mDocShell.get())->IsBypassCSPEnabled()) {
+    return;
+  }
+
   nsresult rv = NS_OK;
   nsCOMPtr<nsIContentSecurityPolicy> preloadCsp = mDocument->GetPreloadCsp();
   if (!preloadCsp) {
diff --git a/parser/htmlparser/moz.build b/parser/htmlparser/moz.build
index c5b1cc378da40..807a3e8d06894 100644
--- a/parser/htmlparser/moz.build
+++ b/parser/htmlparser/moz.build
@@ -50,3 +50,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "!/security/rlbox",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/parser/moz.build b/parser/moz.build
index 729ecf91909af..a9d0df65c015d 100644
--- a/parser/moz.build
+++ b/parser/moz.build
@@ -12,3 +12,6 @@ DIRS += ["expat", "prototype", "xml", "htmlparser", "html"]
 EXPORTS += [
     "nsCharsetSource.h",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/parser/prototype/moz.build b/parser/prototype/moz.build
index 4a2ea437a8fe8..bfd3b3514f3df 100644
--- a/parser/prototype/moz.build
+++ b/parser/prototype/moz.build
@@ -22,3 +22,6 @@ LOCAL_INCLUDES += [
     "../htmlparser",
     "/dom/xul",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/parser/xml/moz.build b/parser/xml/moz.build
index 2612106e3a973..e6ab4552ca120 100644
--- a/parser/xml/moz.build
+++ b/parser/xml/moz.build
@@ -8,3 +8,6 @@ with Files("**"):
     BUG_COMPONENT = ("Core", "DOM: HTML Parser")
 
 TEST_DIRS += ["test"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/parser/xml/test/moz.build b/parser/xml/test/moz.build
index c398a08e7bb3f..c75526b07025d 100644
--- a/parser/xml/test/moz.build
+++ b/parser/xml/test/moz.build
@@ -6,3 +6,6 @@
 
 # Note: set the test module's name to test_<yourmodule>
 XPCSHELL_TESTS_MANIFESTS += ["unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/patch.diff b/patch.diff
new file mode 100644
index 0000000000000..6f1fd67551dd9
--- /dev/null
+++ b/patch.diff
@@ -0,0 +1,2215 @@
+diff --git a/caps/BasePrincipal.cpp b/caps/BasePrincipal.cpp
+index ca611b13f8232..6d6654999be3c 100644
+--- a/caps/BasePrincipal.cpp
++++ b/caps/BasePrincipal.cpp
+@@ -45,6 +45,8 @@
+ #include "json/json.h"
+ #include "nsSerializationHelper.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
+ namespace mozilla {
+ 
+ const char* BasePrincipal::JSONEnumKeyStrings[4] = {
+@@ -416,6 +418,11 @@ nsresult BasePrincipal::ToJSON(Json::Value& aObject) {
+ 
+ bool BasePrincipal::FastSubsumesIgnoringFPD(
+     nsIPrincipal* aOther, DocumentDomainConsideration aConsideration) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::FastSubsumesIgnoringFPD"));
++    return true;
++  }
+   MOZ_ASSERT(aOther);
+ 
+   if (Kind() == eContentPrincipal &&
+@@ -429,6 +436,11 @@ bool BasePrincipal::FastSubsumesIgnoringFPD(
+ 
+ bool BasePrincipal::Subsumes(nsIPrincipal* aOther,
+                              DocumentDomainConsideration aConsideration) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::Subsumes"));
++    return true;
++  }
+   MOZ_ASSERT(aOther);
+   MOZ_ASSERT_IF(Kind() == eContentPrincipal, mOriginSuffix);
+ 
+@@ -456,6 +468,13 @@ BasePrincipal::Equals(nsIPrincipal* aOther, bool* aResult) {
+ NS_IMETHODIMP
+ BasePrincipal::EqualsForPermission(nsIPrincipal* aOther, bool aExactHost,
+                                    bool* aResult) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::EqualsForPermission"));
++    *aResult = true;
++    return NS_OK;
++  }
++
+   *aResult = false;
+   NS_ENSURE_ARG_POINTER(aOther);
+   NS_ENSURE_ARG_POINTER(aResult);
+@@ -576,6 +595,12 @@ BasePrincipal::EqualsForPermission(nsIPrincipal* aOther, bool aExactHost,
+ 
+ NS_IMETHODIMP
+ BasePrincipal::EqualsConsideringDomain(nsIPrincipal* aOther, bool* aResult) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::EqualsConsideringDomain"));
++    *aResult = true;
++    return NS_OK;
++  }
+   NS_ENSURE_ARG_POINTER(aOther);
+ 
+   *aResult = FastEqualsConsideringDomain(aOther);
+@@ -585,6 +610,12 @@ BasePrincipal::EqualsConsideringDomain(nsIPrincipal* aOther, bool* aResult) {
+ 
+ NS_IMETHODIMP
+ BasePrincipal::EqualsURI(nsIURI* aOtherURI, bool* aResult) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::EqualsURI"));
++    *aResult = true;
++    return NS_OK;
++  }
+   *aResult = false;
+   nsCOMPtr<nsIURI> prinURI;
+   nsresult rv = GetURI(getter_AddRefs(prinURI));
+@@ -596,6 +627,12 @@ BasePrincipal::EqualsURI(nsIURI* aOtherURI, bool* aResult) {
+ 
+ NS_IMETHODIMP
+ BasePrincipal::Subsumes(nsIPrincipal* aOther, bool* aResult) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::Subsumes"));
++    *aResult = true;
++    return NS_OK;
++  }
+   NS_ENSURE_ARG_POINTER(aOther);
+ 
+   *aResult = FastSubsumes(aOther);
+@@ -605,6 +642,12 @@ BasePrincipal::Subsumes(nsIPrincipal* aOther, bool* aResult) {
+ 
+ NS_IMETHODIMP
+ BasePrincipal::SubsumesConsideringDomain(nsIPrincipal* aOther, bool* aResult) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::SubsumesConsideringDomain"));
++    *aResult = true;
++    return NS_OK;
++  }
+   NS_ENSURE_ARG_POINTER(aOther);
+ 
+   *aResult = FastSubsumesConsideringDomain(aOther);
+@@ -615,6 +658,12 @@ BasePrincipal::SubsumesConsideringDomain(nsIPrincipal* aOther, bool* aResult) {
+ NS_IMETHODIMP
+ BasePrincipal::SubsumesConsideringDomainIgnoringFPD(nsIPrincipal* aOther,
+                                                     bool* aResult) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::SubsumesConsideringDomainIgnoringFPD"));
++    *aResult = true;
++    return NS_OK;
++  }
+   NS_ENSURE_ARG_POINTER(aOther);
+ 
+   *aResult = FastSubsumesConsideringDomainIgnoringFPD(aOther);
+@@ -625,6 +674,11 @@ BasePrincipal::SubsumesConsideringDomainIgnoringFPD(nsIPrincipal* aOther,
+ NS_IMETHODIMP
+ BasePrincipal::CheckMayLoad(nsIURI* aURI, bool aAllowIfInheritsPrincipal) {
+   AssertIsOnMainThread();
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::CheckMayLoad"));
++    return NS_OK;
++  }
+   return CheckMayLoadHelper(aURI, aAllowIfInheritsPrincipal, false, 0);
+ }
+ 
+@@ -633,6 +687,11 @@ BasePrincipal::CheckMayLoadWithReporting(nsIURI* aURI,
+                                          bool aAllowIfInheritsPrincipal,
+                                          uint64_t aInnerWindowID) {
+   AssertIsOnMainThread();
++    // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::CheckMayLoadWithReporting"));
++    return NS_OK;
++  }
+   return CheckMayLoadHelper(aURI, aAllowIfInheritsPrincipal, true,
+                             aInnerWindowID);
+ }
+@@ -643,6 +702,11 @@ nsresult BasePrincipal::CheckMayLoadHelper(nsIURI* aURI,
+                                            uint64_t aInnerWindowID) {
+   AssertIsOnMainThread();  // Accesses non-threadsafe URI flags and the
+                            // non-threadsafe ExtensionPolicyService
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::CheckMayLoadHelper"));
++    return NS_OK;
++  }
+   NS_ENSURE_ARG_POINTER(aURI);
+   MOZ_ASSERT(
+       aReport || aInnerWindowID == 0,
+@@ -753,6 +817,12 @@ BasePrincipal::IsThirdPartyChannel(nsIChannel* aChan, bool* aRes) {
+ 
+ NS_IMETHODIMP
+ BasePrincipal::IsSameOrigin(nsIURI* aURI, bool* aRes) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::IsSameOrigin"));
++    *aRes = true;
++    return NS_OK;
++  }
+   *aRes = false;
+   nsCOMPtr<nsIURI> prinURI;
+   nsresult rv = GetURI(getter_AddRefs(prinURI));
+@@ -768,6 +838,13 @@ BasePrincipal::IsSameOrigin(nsIURI* aURI, bool* aRes) {
+ NS_IMETHODIMP
+ BasePrincipal::IsL10nAllowed(nsIURI* aURI, bool* aRes) {
+   AssertIsOnMainThread();  // URI_DANGEROUS_TO_LOAD is not threadsafe to query.
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::IsL10nAllowed"));
++    *aRes = true;
++    return NS_OK;
++  }
++
+   *aRes = false;
+ 
+   if (nsContentUtils::IsErrorPage(aURI)) {
+@@ -812,6 +889,12 @@ BasePrincipal::IsL10nAllowed(nsIURI* aURI, bool* aRes) {
+ 
+ NS_IMETHODIMP
+ BasePrincipal::AllowsRelaxStrictFileOriginPolicy(nsIURI* aURI, bool* aRes) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::AllowsRelaxStrictFileOriginPolicy"));
++    *aRes = true;
++    return NS_OK;
++  }
+   *aRes = false;
+   nsCOMPtr<nsIURI> prinURI;
+   nsresult rv = GetURI(getter_AddRefs(prinURI));
+@@ -864,9 +947,17 @@ BasePrincipal::HasFirstpartyStorageAccess(mozIDOMWindow* aCheckWindow,
+                                           uint32_t* aRejectedReason,
+                                           bool* aOutAllowed) {
+   AssertIsOnMainThread();
++
+   *aRejectedReason = 0;
+   *aOutAllowed = false;
+ 
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::HasFirstpartyStorageAccess"));
++    *aOutAllowed = true;
++    return NS_OK;
++  }
++
+   nsPIDOMWindowInner* win = nsPIDOMWindowInner::From(aCheckWindow);
+   nsCOMPtr<nsIURI> uri;
+   nsresult rv = GetURI(getter_AddRefs(uri));
+@@ -1128,6 +1219,13 @@ BasePrincipal::IsContentAccessibleAboutURI(bool* aResult) {
+ NS_IMETHODIMP
+ BasePrincipal::GetIsOriginPotentiallyTrustworthy(bool* aResult) {
+   AssertIsOnMainThread();
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::GetIsOriginPotentiallyTrustworthy"));
++    *aResult = true;
++    return NS_OK;
++  }
++
+   *aResult = false;
+ 
+   nsCOMPtr<nsIURI> uri;
+@@ -1558,6 +1656,13 @@ BasePrincipal::GetStorageOriginKey(nsACString& aOriginKey) {
+ NS_IMETHODIMP
+ BasePrincipal::GetIsScriptAllowedByPolicy(bool* aIsScriptAllowedByPolicy) {
+   AssertIsOnMainThread();
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE BasePrincipal::GetIsScriptAllowedByPolicy"));
++    *aIsScriptAllowedByPolicy = true;
++    return NS_OK;
++  }
++
+   *aIsScriptAllowedByPolicy = false;
+   nsCOMPtr<nsIURI> prinURI;
+   nsresult rv = GetURI(getter_AddRefs(prinURI));
+diff --git a/caps/ContentPrincipal.cpp b/caps/ContentPrincipal.cpp
+index 5aeecaf2bd426..5e4a34171ae1d 100644
+--- a/caps/ContentPrincipal.cpp
++++ b/caps/ContentPrincipal.cpp
+@@ -40,6 +40,9 @@
+ #include "nsSerializationHelper.h"
+ #include "json/json.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
++
+ using namespace mozilla;
+ 
+ NS_IMPL_CLASSINFO(ContentPrincipal, nullptr, 0, NS_PRINCIPAL_CID)
+@@ -222,6 +225,12 @@ bool ContentPrincipal::SubsumesInternal(
+     BasePrincipal::DocumentDomainConsideration aConsideration) {
+   MOZ_ASSERT(aOther);
+ 
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE ContentPrincipal::SubsumesInternal"));
++    return true;
++  }
++
+   // For ContentPrincipal, Subsumes is equivalent to Equals.
+   if (aOther == this) {
+     return true;
+diff --git a/caps/ExpandedPrincipal.cpp b/caps/ExpandedPrincipal.cpp
+index ce8ccd8b82775..3a199e1d5a6ad 100644
+--- a/caps/ExpandedPrincipal.cpp
++++ b/caps/ExpandedPrincipal.cpp
+@@ -12,6 +12,9 @@
+ #include "mozilla/extensions/WebExtensionPolicy.h"
+ #include "json/json.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
++
+ using namespace mozilla;
+ 
+ NS_IMPL_CLASSINFO(ExpandedPrincipal, nullptr, 0, NS_EXPANDEDPRINCIPAL_CID)
+@@ -65,6 +68,11 @@ ExpandedPrincipal::SetDomain(nsIURI* aDomain) { return NS_OK; }
+ bool ExpandedPrincipal::SubsumesInternal(
+     nsIPrincipal* aOther,
+     BasePrincipal::DocumentDomainConsideration aConsideration) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE ExpandedPrincipal::SubsumesInternal"));
++    return true;
++  }
+   // If aOther is an ExpandedPrincipal too, we break it down into its component
+   // nsIPrincipals, and check subsumes on each one.
+   if (Cast(aOther)->Is<ExpandedPrincipal>()) {
+diff --git a/caps/NullPrincipal.cpp b/caps/NullPrincipal.cpp
+index f0a0ad4708776..9b7354fd6007f 100644
+--- a/caps/NullPrincipal.cpp
++++ b/caps/NullPrincipal.cpp
+@@ -29,6 +29,9 @@
+ 
+ #include "json/json.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
++
+ using namespace mozilla;
+ 
+ NS_IMPL_CLASSINFO(NullPrincipal, nullptr, 0, NS_NULLPRINCIPAL_CID)
+@@ -166,6 +169,12 @@ NullPrincipal::GetURI(nsIURI** aURI) {
+ }
+ NS_IMETHODIMP
+ NullPrincipal::GetIsOriginPotentiallyTrustworthy(bool* aResult) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE NullPrincipal::GetIsOriginPotentiallyTrustworthy"));
++    *aResult = true;
++    return NS_OK;
++  }
+   *aResult = false;
+   return NS_OK;
+ }
+@@ -185,6 +194,11 @@ NullPrincipal::SetDomain(nsIURI* aDomain) {
+ }
+ 
+ bool NullPrincipal::MayLoadInternal(nsIURI* aURI) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE NullPrincipal::MayLoadInternal"));
++    return true;
++  }
+   // Also allow the load if we are the principal of the URI being checked.
+   nsCOMPtr<nsIPrincipal> blobPrincipal;
+   if (dom::BlobURLProtocolHandler::GetBlobURLPrincipal(
+diff --git a/caps/nsJSPrincipals.cpp b/caps/nsJSPrincipals.cpp
+index d089bffdf5640..44192053f8d1d 100644
+--- a/caps/nsJSPrincipals.cpp
++++ b/caps/nsJSPrincipals.cpp
+@@ -15,6 +15,9 @@
+ #include "mozilla/ipc/BackgroundUtils.h"
+ #include "mozilla/ipc/PBackgroundSharedTypes.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
++
+ using namespace mozilla;
+ using namespace mozilla::dom;
+ using namespace mozilla::ipc;
+@@ -41,6 +44,10 @@ nsJSPrincipals::Release() {
+ 
+ /* static */
+ bool nsJSPrincipals::Subsume(JSPrincipals* jsprin, JSPrincipals* other) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    return true;
++  }
+   bool result;
+   nsresult rv = nsJSPrincipals::get(jsprin)->Subsumes(
+       nsJSPrincipals::get(other), &result);
+diff --git a/caps/nsScriptSecurityManager.cpp b/caps/nsScriptSecurityManager.cpp
+index 842b41811e8d5..3d5b4692ff878 100644
+--- a/caps/nsScriptSecurityManager.cpp
++++ b/caps/nsScriptSecurityManager.cpp
+@@ -73,12 +73,13 @@
+ #include "nsILoadInfo.h"
+ #include "js/ColumnNumber.h"  // JS::ColumnNumberOneOrigin
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
+ // This should be probably defined on some other place... but I couldn't find it
+ #define WEBAPPS_PERM_NAME "webapps-manage"
+ 
+ using namespace mozilla;
+ using namespace mozilla::dom;
+-
+ StaticRefPtr<nsIIOService> nsScriptSecurityManager::sIOService;
+ std::atomic<bool> nsScriptSecurityManager::sStrictFileOriginPolicy = true;
+ 
+@@ -214,6 +215,11 @@ inline void SetPendingException(JSContext* cx, const char16_t* aMsg) {
+ /* static */
+ bool nsScriptSecurityManager::SecurityCompareURIs(nsIURI* aSourceURI,
+                                                   nsIURI* aTargetURI) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::SecurityCompareURIs"));
++    return true;
++  }
+   return NS_SecurityCompareURIs(aSourceURI, aTargetURI,
+                                 sStrictFileOriginPolicy);
+ }
+@@ -450,6 +456,12 @@ NS_IMPL_ISUPPORTS(nsScriptSecurityManager, nsIScriptSecurityManager)
+ 
+ bool nsScriptSecurityManager::ContentSecurityPolicyPermitsJSAction(
+     JSContext* cx, JS::RuntimeCode aKind, JS::Handle<JSString*> aCode) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::ContentSecurityPolicyPermitsJSAction"));
++    return true;
++  }
++
+   MOZ_ASSERT(cx == nsContentUtils::GetCurrentJSContext());
+ 
+   nsCOMPtr<nsIPrincipal> subjectPrincipal = nsContentUtils::SubjectPrincipal();
+@@ -564,6 +576,11 @@ bool nsScriptSecurityManager::ContentSecurityPolicyPermitsJSAction(
+ // static
+ bool nsScriptSecurityManager::JSPrincipalsSubsume(JSPrincipals* first,
+                                                   JSPrincipals* second) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::JSPrincipalsSubsume"));
++    return true;
++  }
+   return nsJSPrincipals::get(first)->Subsumes(nsJSPrincipals::get(second));
+ }
+ 
+@@ -572,6 +589,11 @@ nsScriptSecurityManager::CheckSameOriginURI(nsIURI* aSourceURI,
+                                             nsIURI* aTargetURI,
+                                             bool reportError,
+                                             bool aFromPrivateWindow) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CheckSameOriginURI"));
++    return NS_OK;
++  }
+   // Please note that aFromPrivateWindow is only 100% accurate if
+   // reportError is true.
+   if (!SecurityCompareURIs(aSourceURI, aTargetURI)) {
+@@ -586,6 +608,11 @@ nsScriptSecurityManager::CheckSameOriginURI(nsIURI* aSourceURI,
+ 
+ NS_IMETHODIMP
+ nsScriptSecurityManager::CheckLoadURIFromScript(JSContext* cx, nsIURI* aURI) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CheckLoadURIFromScript"));
++    return NS_OK;
++  }
+   // Get principal of currently executing script.
+   MOZ_ASSERT(cx == nsContentUtils::GetCurrentJSContext());
+   nsIPrincipal* principal = nsContentUtils::SubjectPrincipal();
+@@ -659,6 +686,11 @@ nsScriptSecurityManager::CheckLoadURIWithPrincipal(nsIPrincipal* aPrincipal,
+                                                    nsIURI* aTargetURI,
+                                                    uint32_t aFlags,
+                                                    uint64_t aInnerWindowID) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CheckLoadURIWithPrincipal"));
++    return NS_OK;
++  }
+   MOZ_ASSERT(aPrincipal, "CheckLoadURIWithPrincipal must have a principal");
+ 
+   // If someone passes a flag that we don't understand, we should
+@@ -1255,6 +1287,7 @@ NS_IMETHODIMP
+ nsScriptSecurityManager::CheckLoadURIWithPrincipalFromJS(
+     nsIPrincipal* aPrincipal, nsIURI* aTargetURI, uint32_t aFlags,
+     uint64_t aInnerWindowID, JSContext* aCx) {
++
+   MOZ_ASSERT(aPrincipal,
+              "CheckLoadURIWithPrincipalFromJS must have a principal");
+   NS_ENSURE_ARG_POINTER(aPrincipal);
+@@ -1295,6 +1328,11 @@ nsScriptSecurityManager::CheckLoadURIStrWithPrincipalFromJS(
+ 
+ NS_IMETHODIMP
+ nsScriptSecurityManager::InFileURIAllowlist(nsIURI* aUri, bool* aResult) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::InFileURIAllowlist"));
++    return NS_OK;
++  }
+   MOZ_ASSERT(aUri);
+   MOZ_ASSERT(aResult);
+ 
+@@ -1501,6 +1539,11 @@ nsScriptSecurityManager::CanCreateWrapper(JSContext* cx, const nsIID& aIID,
+ 
+ NS_IMETHODIMP
+ nsScriptSecurityManager::CanCreateInstance(JSContext* cx, const nsCID& aCID) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CanCreateInstance"));
++    return NS_OK;
++  }
+   if (nsContentUtils::IsCallerChrome()) {
+     return NS_OK;
+   }
+@@ -1516,6 +1559,11 @@ nsScriptSecurityManager::CanCreateInstance(JSContext* cx, const nsCID& aCID) {
+ 
+ NS_IMETHODIMP
+ nsScriptSecurityManager::CanGetService(JSContext* cx, const nsCID& aCID) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsScriptSecurityManager::CanGetService"));
++    return NS_OK;
++  }
+   if (nsContentUtils::IsCallerChrome()) {
+     return NS_OK;
+   }
+diff --git a/dom/base/MaybeCrossOriginObject.cpp b/dom/base/MaybeCrossOriginObject.cpp
+index 5c9eb227c60d0..e2e69385452d1 100644
+--- a/dom/base/MaybeCrossOriginObject.cpp
++++ b/dom/base/MaybeCrossOriginObject.cpp
+@@ -23,6 +23,8 @@
+ #include "AccessCheck.h"
+ #include "nsContentUtils.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
+ #ifdef DEBUG
+ static bool IsLocation(JSObject* obj) {
+   return strcmp(JS::GetClass(obj)->name, "Location") == 0;
+@@ -34,6 +36,11 @@ namespace mozilla::dom {
+ /* static */
+ bool MaybeCrossOriginObjectMixins::IsPlatformObjectSameOrigin(JSContext* cx,
+                                                               JSObject* obj) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE MaybeCrossOriginObjectMixins::IsPlatformObjectSameOrigin"));
++    return true;
++  }
+   MOZ_ASSERT(!js::IsCrossCompartmentWrapper(obj));
+   // WindowProxy and Window must always be same-Realm, so we can do
+   // our IsPlatformObjectSameOrigin check against either one.  But verify that
+diff --git a/dom/base/nsContentUtils.cpp b/dom/base/nsContentUtils.cpp
+index 4330414dd4583..48dcad5f6057e 100644
+--- a/dom/base/nsContentUtils.cpp
++++ b/dom/base/nsContentUtils.cpp
+@@ -402,6 +402,9 @@
+ #include "xpcprivate.h"
+ #include "xpcpublic.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
++
+ #if defined(XP_WIN)
+ // Undefine LoadImage to prevent naming conflict with Windows.
+ #  undef LoadImage
+@@ -2043,6 +2046,12 @@ nsresult nsContentUtils::CheckSameOrigin(const nsINode* aTrustedNode,
+   MOZ_ASSERT(aTrustedNode);
+   MOZ_ASSERT(unTrustedNode);
+ 
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsContentUtils::CheckSameOrigin"));
++    return NS_OK;
++  }
++
+   /*
+    * Get hold of each node's principal
+    */
+@@ -6589,6 +6598,12 @@ nsIInterfaceRequestor* nsContentUtils::SameOriginChecker() {
+ /* static */
+ nsresult nsContentUtils::CheckSameOrigin(nsIChannel* aOldChannel,
+                                          nsIChannel* aNewChannel) {
++    // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE nsContentUtils::CheckSameOrigin"));
++    return NS_OK;
++  }
++
+   if (!nsContentUtils::GetSecurityManager()) return NS_ERROR_NOT_AVAILABLE;
+ 
+   nsCOMPtr<nsIPrincipal> oldPrincipal;
+diff --git a/dom/bindings/Bindings.conf b/dom/bindings/Bindings.conf
+index bf736e9ac2213..808d342bf056f 100644
+--- a/dom/bindings/Bindings.conf
++++ b/dom/bindings/Bindings.conf
+@@ -1677,6 +1677,11 @@ DOMInterfaces = {
+     'nativeType': 'mozilla::extensions::ExtensionAlarms',
+ },
+ 
++'IPCFuzzer': {
++    'nativeType': 'mozilla::dom::IPCFuzzer',
++    'headerFile': 'mozilla/dom/IPCFuzzer.h'
++},
++
+ }
+ 
+ if buildconfig.substs.get("MOZ_WEBRTC", False):
+diff --git a/dom/ipc-fuzzer/IPCFuzzer.cpp b/dom/ipc-fuzzer/IPCFuzzer.cpp
+new file mode 100644
+index 0000000000000..804e9343c59d6
+--- /dev/null
++++ b/dom/ipc-fuzzer/IPCFuzzer.cpp
+@@ -0,0 +1,74 @@
++#include "mozilla/dom/IPCFuzzer.h"
++#include "mozilla/dom/IPCFuzzerBinding.h"
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
++namespace mozilla::dom {
++
++JSObject* IPCFuzzer::WrapObject(JSContext* aCx,
++                                JS::Handle<JSObject*> aGivenProto) {
++  return IPCFuzzer_Binding::Wrap(aCx, this, aGivenProto);
++}
++
++NS_IMPL_CYCLE_COLLECTION_WRAPPERCACHE_0(IPCFuzzer)
++NS_IMPL_CYCLE_COLLECTING_ADDREF(IPCFuzzer)
++NS_IMPL_CYCLE_COLLECTING_RELEASE(IPCFuzzer)
++NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION(IPCFuzzer)
++  NS_WRAPPERCACHE_INTERFACE_MAP_ENTRY
++  NS_INTERFACE_MAP_ENTRY(nsISupports)
++NS_INTERFACE_MAP_END
++
++void IPCFuzzer::Mutate_url(const GlobalObject& aGlobal,
++                           const ::nsAString& url) {
++  NS_ConvertUTF16toUTF8 utf8Str(url);
++  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation(
++      new ::mozilla::ipc::Mutation(mozilla::ipc::Mutation::TARGET::URL,
++                                   mozilla::ipc::Mutation::KIND::REPLACE_WHOLE,
++                                   utf8Str));
++  mozilla::ipc::IPCFuzzerCore::getInstance().enqueue_mutation(
++      std::move(mutation));
++}
++
++void IPCFuzzer::Mutate_origin(const GlobalObject& aGlobal,
++                              const ::nsAString& origin, bool systemPrincipal) {
++  NS_ConvertUTF16toUTF8 utf8Str(origin);
++  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation(
++      new ::mozilla::ipc::Mutation(mozilla::ipc::Mutation::TARGET::ORIGIN,
++                                   mozilla::ipc::Mutation::KIND::REPLACE_WHOLE,
++                                   utf8Str, systemPrincipal));
++  mozilla::ipc::IPCFuzzerCore::getInstance().enqueue_mutation(
++      std::move(mutation));
++}
++
++void IPCFuzzer::Mutate_url_replace_host(const GlobalObject& aGlobal,
++                                        const ::nsAString& host) {
++  NS_ConvertUTF16toUTF8 utf8Str(host);
++  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation(
++      new ::mozilla::ipc::Mutation(mozilla::ipc::Mutation::TARGET::URL,
++                                   mozilla::ipc::Mutation::KIND::REPLACE_HOST,
++                                   utf8Str));
++  mozilla::ipc::IPCFuzzerCore::getInstance().enqueue_mutation(
++      std::move(mutation));
++}
++
++void IPCFuzzer::Mutate_origin_replace_host(const GlobalObject& aGlobal,
++                                           const ::nsAString& host) {
++  NS_ConvertUTF16toUTF8 utf8Str(host);
++  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation(
++      new ::mozilla::ipc::Mutation(mozilla::ipc::Mutation::TARGET::ORIGIN,
++                                   mozilla::ipc::Mutation::KIND::REPLACE_HOST,
++                                   utf8Str));
++  mozilla::ipc::IPCFuzzerCore::getInstance().enqueue_mutation(
++      std::move(mutation));
++}
++
++bool IPCFuzzer::Check_isolation(const GlobalObject& aGlobal,
++                                const ::nsAString& url) {
++  NS_ConvertUTF16toUTF8 utf8Str(url);
++  return mozilla::ipc::IPCFuzzerCore::getInstance().check_isolation(utf8Str);
++}
++
++void IPCFuzzer::Deactivate_checks(const GlobalObject& aGlobal) {
++  mozilla::ipc::IPCFuzzerCore::getInstance().set_compromised();
++}
++
++}  // namespace mozilla::dom
+\ No newline at end of file
+diff --git a/dom/ipc-fuzzer/IPCFuzzer.h b/dom/ipc-fuzzer/IPCFuzzer.h
+new file mode 100644
+index 0000000000000..cec7b1f00489a
+--- /dev/null
++++ b/dom/ipc-fuzzer/IPCFuzzer.h
+@@ -0,0 +1,42 @@
++#ifndef mozilla_dom_IPCFuzzer_h
++#define mozilla_dom_IPCFuzzer_h
++
++#include "nsWrapperCache.h"
++#include "mozilla/ipc/IPCFuzzer.h"
++
++#include "js/TypeDecls.h"
++#include "mozilla/Attributes.h"
++#include "mozilla/dom/BindingDeclarations.h"
++#include "nsCycleCollectionParticipant.h"
++
++namespace mozilla::dom {
++class IPCFuzzer final : public nsISupports, public nsWrapperCache {
++ public:
++  IPCFuzzer() {}
++
++  nsIGlobalObject* GetParentObject() const { return nullptr; }
++
++  JSObject* WrapObject(JSContext* aCx,
++                       JS::Handle<JSObject*> aGivenProto) override;
++
++  NS_DECL_CYCLE_COLLECTING_ISUPPORTS
++  NS_DECL_CYCLE_COLLECTION_WRAPPERCACHE_CLASS(IPCFuzzer)
++
++  // JS API methods to enqueue mutations
++  static void Mutate_url(const GlobalObject& aGlobal, const ::nsAString& url);
++  static void Mutate_origin(const GlobalObject& aGlobal,
++                            const ::nsAString& origin, bool systemPricipal);
++  static void Mutate_url_replace_host(const GlobalObject& aGlobal,
++                                      const ::nsAString& host);
++  static void Mutate_origin_replace_host(const GlobalObject& aGlobal,
++                                         const ::nsAString& host);
++  static bool Check_isolation(const GlobalObject& aGlobal,
++                              const ::nsAString& url);
++  static void Deactivate_checks(const GlobalObject& aGlobal);
++
++ protected:
++  ~IPCFuzzer() {}
++};
++}  // namespace mozilla::dom
++
++#endif  // mozilla_dom_IPCFuzzer_h
+\ No newline at end of file
+diff --git a/dom/ipc-fuzzer/moz.build b/dom/ipc-fuzzer/moz.build
+new file mode 100644
+index 0000000000000..a9a5a28f444e1
+--- /dev/null
++++ b/dom/ipc-fuzzer/moz.build
+@@ -0,0 +1,30 @@
++# -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
++# vim: set filetype=python:
++# This Source Code Form is subject to the terms of the Mozilla Public
++# License, v. 2.0. If a copy of the MPL was not distributed with this
++# file, You can obtain one at http://mozilla.org/MPL/2.0/.
++
++with Files("**"):
++    BUG_COMPONENT = ("Core", "IPC Fuzzer")
++
++
++EXPORTS.mozilla.dom += [
++    "IPCFuzzer.h",
++]
++
++UNIFIED_SOURCES += [
++    "IPCFuzzer.cpp",
++]
++
++
++include("/ipc/chromium/chromium-config.mozbuild")
++
++FINAL_LIBRARY = "xul"
++
++
++LOCAL_INCLUDES += [
++    "/dom/base",
++    "/ipc/fuzzer",
++]
++
++
+diff --git a/dom/ipc/WindowGlobalChild.cpp b/dom/ipc/WindowGlobalChild.cpp
+index 62dffe7549a39..f5f618b0e128d 100644
+--- a/dom/ipc/WindowGlobalChild.cpp
++++ b/dom/ipc/WindowGlobalChild.cpp
+@@ -44,6 +44,8 @@
+ #include "nsIURIMutator.h"
+ #include "nsURLHelper.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
+ using namespace mozilla::ipc;
+ using namespace mozilla::dom::ipc;
+ 
+@@ -681,6 +683,11 @@ void WindowGlobalChild::ActorDestroy(ActorDestroyReason aWhy) {
+ 
+ bool WindowGlobalChild::IsSameOriginWith(
+     const dom::WindowContext* aOther) const {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE WindowGlobalChild::IsSameOriginWith"));
++    return true;
++  }
+   if (aOther == WindowContext()) {
+     return true;
+   }
+@@ -707,6 +714,11 @@ bool WindowGlobalChild::SameOriginWithTop() {
+ // Bug 1810619: Crash at null in nsDocShell::ValidateOrigin
+ bool WindowGlobalChild::CanNavigate(dom::BrowsingContext* aTarget,
+                                     bool aConsiderOpener) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE WindowGlobalChild::CanNavigate"));
++    return true;
++  }
+   MOZ_DIAGNOSTIC_ASSERT(WindowContext()->Group() == aTarget->Group(),
+                         "A WindowGlobalChild should never try to navigate a "
+                         "BrowsingContext from another group");
+diff --git a/dom/moz.build b/dom/moz.build
+index 5a3b2d26d3477..54e07a7f8f8fb 100644
+--- a/dom/moz.build
++++ b/dom/moz.build
+@@ -106,6 +106,7 @@ DIRS += [
+     "l10n",
+     "origin-trials",
+     "webscheduling",
++    "ipc-fuzzer",
+ ]
+ 
+ 
+diff --git a/dom/webidl/IPCFuzzer.webidl b/dom/webidl/IPCFuzzer.webidl
+new file mode 100644
+index 0000000000000..687ac2a7cd4a2
+--- /dev/null
++++ b/dom/webidl/IPCFuzzer.webidl
+@@ -0,0 +1,9 @@
++[Exposed=Window]
++interface IPCFuzzer {
++    static undefined mutate_url(DOMString url);
++    static undefined mutate_url_replace_host(DOMString host);
++    static undefined mutate_origin(DOMString url, optional boolean systemPrincipal = false);
++    static undefined mutate_origin_replace_host(DOMString host);
++    static boolean check_isolation(DOMString url);
++    static undefined deactivate_checks();
++};
+\ No newline at end of file
+diff --git a/dom/webidl/Window.webidl b/dom/webidl/Window.webidl
+index 009ec26198601..feb6e1aa88c99 100644
+--- a/dom/webidl/Window.webidl
++++ b/dom/webidl/Window.webidl
+@@ -264,6 +264,7 @@ interface nsIPrintSettings;
+   undefined postMessage(any message, optional WindowPostMessageOptions options = {});
+ 
+   // also has obsolete members
++  // readonly attribute IPCFuzzer IPCFuzzer;
+ };
+ Window includes GlobalEventHandlers;
+ Window includes WindowEventHandlers;
+diff --git a/dom/webidl/moz.build b/dom/webidl/moz.build
+index 68b42a9c54ef9..4e1135d6b527c 100644
+--- a/dom/webidl/moz.build
++++ b/dom/webidl/moz.build
+@@ -388,6 +388,9 @@ with Files("Extension*"):
+ with Files("WebTransport*"):
+     BUG_COMPONENT = ("Core", "Networking")
+ 
++with Files("IPCFuzzer.webidl"):
++    BUG_COMPONENT = ("Core", "IPC Fuzzer")
++
+ GENERATED_WEBIDL_FILES = [
+     "CSS2Properties.webidl",
+ ]
+@@ -688,6 +691,7 @@ WEBIDL_FILES = [
+     "IntlUtils.webidl",
+     "InvokeEvent.webidl",
+     "InvokerElement.webidl",
++    "IPCFuzzer.webidl",
+     "IterableIterator.webidl",
+     "KeyAlgorithm.webidl",
+     "KeyboardEvent.webidl",
+diff --git a/ipc/fuzzer/IPCFuzzer.cpp b/ipc/fuzzer/IPCFuzzer.cpp
+new file mode 100644
+index 0000000000000..1cd7961977e36
+--- /dev/null
++++ b/ipc/fuzzer/IPCFuzzer.cpp
+@@ -0,0 +1,314 @@
++#include "mozilla/ipc/IPCFuzzer.h"
++
++#include "Mutation.h"
++#include "nsNetUtil.h"
++#include "IPCFuzzerCore.h"
++#include "nsIURIMutator.h"
++#include "mozilla/Logging.h"
++#include "mozilla/OriginAttributes.h"
++
++using mozilla::LogLevel;
++static mozilla::LazyLogModule mylogger("my_ipc_logger");
++
++namespace mozilla::ipc {
++
++void IPCFuzzer::mutate_url(::nsString& url_str) {
++  nsCString cStr = NS_ConvertUTF16toUTF8(url_str);
++  return mutate_url(cStr);
++}
++void IPCFuzzer::mutate_origin(::nsString& origin_str) {
++  nsCString cStr = NS_ConvertUTF16toUTF8(origin_str);
++  return mutate_origin(cStr);
++}
++void IPCFuzzer::mutate_host(::nsString& host_str) {
++  nsCString cStr = NS_ConvertUTF16toUTF8(host_str);
++  return mutate_origin(cStr);
++}
++
++void IPCFuzzer::mutate_url(::nsCString& url_str) {
++  MOZ_LOG(mylogger, LogLevel::Debug,
++          ("IPCFuzzer intercept url: %s", url_str.get()));
++
++  // get mutation from queue
++  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation =
++      IPCFuzzerCore::getInstance().dequeue_url_mutation();
++  if (mutation == nullptr) {
++    // no mutation enqueued
++    MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer no url mutation"));
++    return;
++  }
++
++  switch (mutation->kind()) {
++    case Mutation::KIND::REPLACE_WHOLE:
++      // write url from mutation to url string variable
++      mutation->url()->GetSpec(url_str);
++      MOZ_LOG(mylogger, LogLevel::Debug,
++              ("IPCFuzzer replaced url: %s", url_str.get()));
++
++      return;
++    case Mutation::KIND::REPLACE_HOST: {
++      if (!hasHost(mutation->url())) {
++        // replace whole
++        mutation->url()->GetSpec(url_str);
++        MOZ_LOG(
++            mylogger, LogLevel::Debug,
++            ("IPCFuzzer mutation no host, replaced url: %s", url_str.get()));
++
++        return;
++      }  // get mutation from queue
++      ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation =
++          IPCFuzzerCore::getInstance().dequeue_origin_mutation();
++      if (mutation == nullptr) {  // no mutation enqueued
++        return;
++      }
++
++      // parse url string
++      nsresult rv;
++      nsCOMPtr<nsIURI> parsed_url;
++      rv = NS_NewURI(getter_AddRefs(parsed_url), url_str);
++      if (NS_FAILED(rv)) {
++        MOZ_LOG(mylogger, LogLevel::Error, ("IPCFuzzer parsing url failed"));
++        return;  // parsing failed
++      }
++
++      if (!hasHost(parsed_url)) {
++        // replace whole
++        mutation->url()->GetSpec(url_str);
++        MOZ_LOG(mylogger, LogLevel::Debug,
++                ("IPCFuzzer url no host, replaced url: %s", url_str.get()));
++        return;
++      }
++
++      // read replacements from mutation
++      nsAutoCString host;
++      int32_t port;
++      mutation->url()->GetHost(host);
++      mutation->url()->GetPort(&port);
++
++      rv = NS_MutateURI(parsed_url)
++               .SetHost(host)
++               .SetPort(port)
++               .Finalize(parsed_url);
++      if (NS_FAILED(rv)) {
++        MOZ_LOG(mylogger, LogLevel::Error, ("IPCFuzzer mutating url failed"));
++
++        return;
++      }
++
++      // write mutated url to url string variable
++      parsed_url->GetSpec(url_str);
++      MOZ_LOG(mylogger, LogLevel::Debug,
++              ("IPCFuzzer replaced host: %s", url_str.get()));
++    } break;
++  }
++}
++
++void IPCFuzzer::mutate_origin(::nsCString& origin_str) {
++  MOZ_LOG(mylogger, LogLevel::Debug,
++          ("IPCFuzzer intercept origin: %s", origin_str.get()));
++
++  // get mutation from queue
++  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation =
++      IPCFuzzerCore::getInstance().dequeue_origin_mutation();
++
++  if (mutation == nullptr) {
++    // no mutation enqueued
++    MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer no origin mutation"));
++    return;
++  }
++
++  switch (mutation->kind()) {
++    case Mutation::KIND::REPLACE_WHOLE:
++      // write origin from mutation to origin string variable
++      origin_str = getOrigin(mutation->url());
++      MOZ_LOG(mylogger, LogLevel::Debug,
++              ("IPCFuzzer replaced origin: %s", origin_str.get()));
++      return;
++    case Mutation::KIND::REPLACE_HOST: {
++      if (!hasHost(mutation->url())) {
++        // replace whole
++        origin_str = getOrigin(mutation->url());
++        MOZ_LOG(mylogger, LogLevel::Debug,
++                ("IPCFuzzer mutation no host, replaced origin: %s",
++                 origin_str.get()));
++        return;
++      }
++
++      // parse origin string
++      nsresult rv;
++      nsCOMPtr<nsIURI> parsed_origin;
++      rv = NS_NewURI(getter_AddRefs(parsed_origin), origin_str);
++      if (NS_FAILED(rv)) {
++        MOZ_LOG(mylogger, LogLevel::Error, ("IPCFuzzer parsing origin failed"));
++        return;  // parsing failed
++      }
++
++      if (!hasHost(parsed_origin)) {
++        // replace whole
++        origin_str = getOrigin(mutation->url());
++        MOZ_LOG(mylogger, LogLevel::Debug,
++                ("IPCFuzzer origin no host, replaced origin: %s",
++                 origin_str.get()));
++        return;
++      }
++
++      // read replacements from mutation
++      nsAutoCString host;
++      int32_t port;
++      mutation->url()->GetHost(host);
++      mutation->url()->GetPort(&port);
++
++      rv = NS_MutateURI(parsed_origin)
++               .SetHost(host)
++               .SetPort(port)
++               .Finalize(parsed_origin);
++      if (NS_FAILED(rv)) {
++        MOZ_LOG(mylogger, LogLevel::Error,
++                ("IPCFuzzer mutating origin failed"));
++        return;
++      }
++
++      // write mutated origin to origin string variable
++      origin_str = getOrigin(parsed_origin);
++      MOZ_LOG(mylogger, LogLevel::Debug,
++              ("IPCFuzzer replaced host: %s", origin_str.get()));
++    } break;
++  }
++}
++
++void IPCFuzzer::mutate_host(nsCString& host_str) {
++  MOZ_LOG(mylogger, LogLevel::Debug,
++          ("IPCFuzzer intercept host: %s", host_str.get()));
++
++  // get mutation from queue
++  ::mozilla::UniquePtr<mozilla::ipc::Mutation> mutation =
++      IPCFuzzerCore::getInstance().dequeue_origin_mutation();
++
++  if (mutation == nullptr) {
++    // no mutation enqueued
++    MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer no origin mutation"));
++    return;
++  }
++
++  if (!hasHost(mutation->url())) {
++    MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer mutation no host"));
++    return;
++  }
++
++  mutation->url()->GetHost(host_str);
++  MOZ_LOG(mylogger, LogLevel::Debug,
++          ("IPCFuzzer replaced host: %s", host_str.get()));
++}
++
++mozilla::UniquePtr<::mozilla::ipc::PrincipalInfo>
++IPCFuzzer::replacePrincipalInfo() {
++  ::mozilla::UniquePtr<::mozilla::ipc::Mutation> mutation =
++      IPCFuzzerCore::getInstance().dequeue_origin_mutation();
++  if (mutation == nullptr) {
++    return nullptr;
++  }
++
++  if (mutation->isSystemPrincipal()) {
++    const ::mozilla::ipc::SystemPrincipalInfo spi =
++        ::mozilla::ipc::SystemPrincipalInfo();
++    ::mozilla::UniquePtr<::mozilla::ipc::PrincipalInfo> pi(
++        new ::mozilla::ipc::PrincipalInfo(spi));
++    return pi;
++  }
++
++  ::mozilla::OriginAttributes oa = ::mozilla::OriginAttributes();
++  nsCString host, spec;
++  mutation->url()->GetHost(host);
++  mutation->url()->GetSpec(spec);
++
++  nsCString origin = getOrigin(mutation->url());
++
++  const ::mozilla::ipc::ContentPrincipalInfo cpi =
++      ::mozilla::ipc::ContentPrincipalInfo(oa, origin, spec, mozilla::Nothing(),
++                                           host);
++  ::mozilla::UniquePtr<::mozilla::ipc::PrincipalInfo> pi(
++      new ::mozilla::ipc::PrincipalInfo(cpi));
++  return pi;
++}
++
++bool IPCFuzzer::isJSUrl(nsCOMPtr<nsIURI> url) {
++  return url->SchemeIs("javascript");
++}
++bool IPCFuzzer::isBlobUrl(nsCOMPtr<nsIURI> url) {
++  return url->SchemeIs("blob");
++}
++bool IPCFuzzer::isDataUrl(nsCOMPtr<nsIURI> url) {
++  return url->SchemeIs("data");
++}
++
++nsCString IPCFuzzer::getOrigin(const nsCOMPtr<nsIURI>& url) {
++  nsCString scheme, host, hostPort;
++  url->GetScheme(scheme);
++  url->GetHostPort(hostPort);
++  return scheme + "://"_ns + hostPort;
++}
++
++bool IPCFuzzer::hasHost(nsCOMPtr<nsIURI> url) {
++  nsAutoCString host;
++  url->GetHost(host);
++  return !host.IsEmpty();
++}
++
++// void IPCFuzzer::log(const char* component) {
++//   //   MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer: %s", component));
++// }
++
++// void IPCFuzzer::log(const nsACString& str, const char* component) {
++//   //   nsCString truncatedStr(str);
++//   //   MOZ_LOG(mylogger, LogLevel::Debug,
++//   //           ("IPCFuzzer: %s %s", component, truncatedStr.Data()));
++// }
++
++// void IPCFuzzer::log(const ::mozilla::dom::IPCClientInfo& clientInfo,
++//                     const char* component) {
++//   //   PrincipalInfo principalInfo = clientInfo.principalInfo();
++
++//   //   switch (principalInfo.type()) {
++//   //     case PrincipalInfo::TContentPrincipalInfo:
++//   //       MOZ_LOG(mylogger, LogLevel::Debug,
++//   //               ("IPCFuzzer: %s %s", component,
++//   //                principalInfo.get_ContentPrincipalInfo().spec().get()));
++//   //       break;
++//   //     case PrincipalInfo::TNullPrincipalInfo:
++//   //       MOZ_LOG(mylogger, LogLevel::Debug,
++//   //               ("IPCFuzzer: %s %s", component, "NullPrincipalInfo"));
++//   //       break;
++//   //     case PrincipalInfo::TExpandedPrincipalInfo:
++//   //       MOZ_LOG(mylogger, LogLevel::Debug,
++//   //               ("IPCFuzzer: %s %s", component, "ExpandedPrincipalInfo"));
++//   //       break;
++//   //     case PrincipalInfo::TSystemPrincipalInfo:
++//   //       MOZ_LOG(mylogger, LogLevel::Debug,
++//   //               ("IPCFuzzer: %s %s", component, "SystemPrincipalInfo"));
++//   //       break;
++//   //     default:
++//   //       MOZ_LOG(mylogger, LogLevel::Debug,
++//   //               ("IPCFuzzer: %s %s", component, "Default"));
++//   //       break;
++//   //   }
++
++//   //   MOZ_LOG(mylogger, LogLevel::Debug,
++//   //   ("IPCFuzzer: %s %s", component, clientInfo.url().get()));
++// }
++
++// void IPCFuzzer::log(const ::mozilla::ipc::PrincipalInfo& principalInfo,
++//                     const char* component) {
++//   //   MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer: %s", component));
++// }
++
++// void IPCFuzzer::log_param(const ::nsString& str, const char* name) {
++//   // ::nsCString cstr(str.get(), str.Length());
++//   // log_param(cstr, name);
++//   // MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer %s: %s", name, str.get()));
++// }
++
++// void IPCFuzzer::log_param(const ::nsCString& str, const char* name) {
++//   // MOZ_LOG(mylogger, LogLevel::Debug, ("IPCFuzzer %s: %s", name, str.get()));
++// }
++
++}  // namespace mozilla::ipc
+\ No newline at end of file
+diff --git a/ipc/fuzzer/IPCFuzzer.h b/ipc/fuzzer/IPCFuzzer.h
+new file mode 100644
+index 0000000000000..ba9410b15e495
+--- /dev/null
++++ b/ipc/fuzzer/IPCFuzzer.h
+@@ -0,0 +1,50 @@
++#ifndef mozilla_ipc_IPCFuzzer_h
++#define mozilla_ipc_IPCFuzzer_h
++
++// #include "mozilla/ipc/ProtocolUtils.h"
++#include "mozilla/ipc/PBackgroundSharedTypes.h"
++// #include "mozilla/dom/ClientIPCTypes.h"
++
++#include "nsIURI.h"
++#include "mozilla/UniquePtr.h"
++
++#include "mozilla/dom/ClientIPCTypes.h"
++#include "mozilla/ipc/PBackgroundSharedTypes.h"
++
++namespace mozilla::ipc {
++
++class IPCFuzzer {
++ public:
++  // static void log(const char* component);
++  // static void log(const nsACString& str, const char* component);
++  // static void log(const ::mozilla::dom::IPCClientInfo& clientInfo,
++  //                 const char* component);
++  // static void log(const ::mozilla::ipc::PrincipalInfo& principalInfo,
++  //                 const char* component);
++  // static void log_param(const ::nsString& str, const char* name);
++  // static void log_param(const ::nsCString& str, const char* name);
++
++  static void mutate_url(::nsString& url);
++  static void mutate_origin(::nsString& origin);
++  static void mutate_host(::nsString& host);
++
++  static void mutate_url(::nsCString& url);
++  static void mutate_origin(::nsCString& origin);
++  static void mutate_host(::nsCString& host);
++
++  static mozilla::UniquePtr<::mozilla::ipc::PrincipalInfo> replacePrincipalInfo();
++
++ private:
++  IPCFuzzer() = delete;
++  ~IPCFuzzer() = delete;
++
++  static bool isJSUrl(nsCOMPtr<nsIURI> url);
++  static bool isBlobUrl(nsCOMPtr<nsIURI> url);
++  static bool isDataUrl(nsCOMPtr<nsIURI> url);
++  static bool hasHost(nsCOMPtr<nsIURI> url);
++  static nsCString getOrigin(const nsCOMPtr<nsIURI>& url);
++};
++
++}  // namespace mozilla::ipc
++
++#endif  // mozilla_ipc_IPCFuzzer_h
+\ No newline at end of file
+diff --git a/ipc/fuzzer/IPCFuzzerCore.cpp b/ipc/fuzzer/IPCFuzzerCore.cpp
+new file mode 100644
+index 0000000000000..2f85588dfe3a4
+--- /dev/null
++++ b/ipc/fuzzer/IPCFuzzerCore.cpp
+@@ -0,0 +1,68 @@
++#include "mozilla/ipc/IPCFuzzerCore.h"
++#include "mozilla/Logging.h"
++
++namespace mozilla::ipc {
++
++::mozilla::StaticMutex IPCFuzzerCore::singletonMutex;
++
++::mozilla::UniquePtr<Mutation> IPCFuzzerCore::dequeue_url_mutation() {
++  urlMutationsMutex.Lock();
++  if (urlMutations.GetSize() == 0) {
++    urlMutationsMutex.Unlock();
++    return nullptr;
++  }
++  ::mozilla::UniquePtr<Mutation> mutation(urlMutations.PopFront());
++  urlMutationsMutex.Unlock();
++  return mutation;
++}
++
++::mozilla::UniquePtr<Mutation> IPCFuzzerCore::dequeue_origin_mutation() {
++  originMutationsMutex.Lock();
++  if (originMutations.GetSize() == 0) {
++    originMutationsMutex.Unlock();
++    return nullptr;
++  }
++  ::mozilla::UniquePtr<Mutation> mutation(originMutations.PopFront());
++  originMutationsMutex.Unlock();
++  return mutation;
++}
++
++void IPCFuzzerCore::enqueue_mutation(
++    ::mozilla::UniquePtr<::mozilla::ipc::Mutation> mutation) {
++  switch (mutation->target()) {
++    case Mutation::TARGET::URL: {
++      urlMutationsMutex.Lock();
++      urlMutations.Push(mutation.release());
++      urlMutationsMutex.Unlock();
++    } break;
++    case Mutation::TARGET::ORIGIN: {
++      originMutationsMutex.Lock();
++      originMutations.Push(mutation.release());
++      originMutationsMutex.Unlock();
++    } break;
++  }
++}
++
++bool IPCFuzzerCore::check_isolation(const ::nsACString& url) {
++  // parse url
++  nsCOMPtr<nsIURI> uri;
++  nsresult rv = NS_NewURI(getter_AddRefs(uri), url);
++  if (NS_FAILED(rv)) {
++    return false;
++  }
++
++  processLockMutex.Lock();
++  if (!processLock) {
++    processLock = std::move(uri);
++    processLockMutex.Unlock();
++    return false;
++  }
++
++  bool equal = true;
++  rv = processLock->Equals(
++      uri,
++      &equal);  // we do not check rv, because equal is true if rv is not NS_OK
++  processLockMutex.Unlock();
++  return !equal;
++}
++}  // namespace mozilla::ipc
+\ No newline at end of file
+diff --git a/ipc/fuzzer/IPCFuzzerCore.h b/ipc/fuzzer/IPCFuzzerCore.h
+new file mode 100644
+index 0000000000000..aa0175b465fc2
+--- /dev/null
++++ b/ipc/fuzzer/IPCFuzzerCore.h
+@@ -0,0 +1,56 @@
++#ifndef mozilla_ipc_IPCFuzzerCore_h
++#define mozilla_ipc_IPCFuzzerCore_h
++
++#include "nsDeque.h"
++#include "Mutation.h"
++#include "mozilla/Mutex.h"
++#include "mozilla/StaticMutex.h"
++#include "mozilla/UniquePtr.h"
++#include "mozilla/Logging.h"
++
++namespace mozilla::ipc {
++  using mozilla::LogLevel;
++  static mozilla::LazyLogModule IPCLogger("ipc_logger");
++class IPCFuzzerCore {
++  // Singleton class to keep process-global state
++  // https://stackoverflow.com/questions/1008019/how-do-you-implement-the-singleton-design-pattern
++
++ public:
++  // Singleton implementation
++  static IPCFuzzerCore& getInstance() {
++    singletonMutex.Lock();
++    static IPCFuzzerCore instance;
++    singletonMutex.Unlock();
++    return instance;
++  }
++  IPCFuzzerCore(IPCFuzzerCore const&) = delete;
++  void operator=(IPCFuzzerCore const&) = delete;
++
++  void enqueue_mutation(::mozilla::UniquePtr<::mozilla::ipc::Mutation> mutation);
++  bool check_isolation(const ::nsACString& url);
++
++  bool is_compromised() { return compromised; }
++  void set_compromised() { compromised = true; }
++
++  ::mozilla::UniquePtr<Mutation> dequeue_url_mutation();
++  ::mozilla::UniquePtr<Mutation> dequeue_origin_mutation();
++
++ private:
++  IPCFuzzerCore() {}
++
++  static mozilla::StaticMutex singletonMutex;
++
++  bool compromised = false;
++
++  nsDeque<Mutation> urlMutations;
++  mozilla::Mutex urlMutationsMutex{"IPCFuzzerCore::urlMutationsMutex"};
++
++  nsDeque<Mutation> originMutations;
++  mozilla::Mutex originMutationsMutex{"IPCFuzzerCore::originMutationsMutex"};
++
++  nsCOMPtr<nsIURI> processLock = nullptr;
++  mozilla::Mutex processLockMutex{"IPCFuzzerCore::processLockMutex"};
++};
++}  // namespace mozilla::ipc
++
++#endif  // mozilla_ipc_IPCFuzzerCore_h
+\ No newline at end of file
+diff --git a/ipc/fuzzer/Mutation.cpp b/ipc/fuzzer/Mutation.cpp
+new file mode 100644
+index 0000000000000..79cff82802a5f
+--- /dev/null
++++ b/ipc/fuzzer/Mutation.cpp
+@@ -0,0 +1,24 @@
++#include "mozilla/ipc/Mutation.h"
++
++#include "Mutation.h"
++#include "nsNetCID.h"
++#include "nsIURI.h"
++#include "nsCOMPtr.h"
++#include "nsNetUtil.h"
++
++namespace mozilla::ipc {
++Mutation::Mutation(TARGET target, KIND kind, const nsACString& uri, bool systemPrincipal)
++    : mTarget(target), mKind(kind), systemPrincipal(systemPrincipal) {
++  // nsCOMPtr<nsIURI> mURI;
++  nsresult rv = NS_NewURI(getter_AddRefs(mURI), uri);
++
++  if (NS_FAILED(rv)) {
++    // TODO(JN): add log
++    NS_NewURI(getter_AddRefs(mURI), "");
++  }
++
++}
++
++
++
++}  // namespace mozilla::ipc
+diff --git a/ipc/fuzzer/Mutation.h b/ipc/fuzzer/Mutation.h
+new file mode 100644
+index 0000000000000..99634f5a81e86
+--- /dev/null
++++ b/ipc/fuzzer/Mutation.h
+@@ -0,0 +1,36 @@
++#ifndef mozilla_ipc_Mutation_h
++#define mozilla_ipc_Mutation_h
++
++#include "nsNetCID.h"
++#include "nsIURI.h"
++#include "nsCOMPtr.h"
++
++namespace mozilla::ipc {
++class Mutation {
++ public:
++  enum class TARGET { URL, ORIGIN };
++  enum class KIND { REPLACE_HOST, REPLACE_WHOLE };
++
++  Mutation(TARGET target, KIND kind, nsCOMPtr<nsIURI> uri, bool systemPrincipal = false)
++      : mTarget(target),
++        mKind(kind),
++        mURI(std::move(uri)),
++        systemPrincipal(systemPrincipal) {}
++
++  Mutation(TARGET target, KIND kind, const nsACString& uri,
++           bool systemPrincipal = false);
++
++  const TARGET& target() const { return mTarget; }
++  const KIND& kind() const { return mKind; }
++  nsCOMPtr<nsIURI> url() const { return mURI; }
++  bool isSystemPrincipal() const { return systemPrincipal; }
++
++ private:
++  TARGET mTarget;
++  KIND mKind;
++  nsCOMPtr<nsIURI> mURI;
++  bool systemPrincipal;
++};
++}  // namespace mozilla::ipc
++
++#endif  // mozilla_ipc_Mutation_h
+\ No newline at end of file
+diff --git a/ipc/fuzzer/moz.build b/ipc/fuzzer/moz.build
+new file mode 100644
+index 0000000000000..7fdf3c7c6faec
+--- /dev/null
++++ b/ipc/fuzzer/moz.build
+@@ -0,0 +1,36 @@
++# -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
++# vim: set filetype=python:
++# This Source Code Form is subject to the terms of the Mozilla Public
++# License, v. 2.0. If a copy of the MPL was not distributed with this
++# file, You can obtain one at http://mozilla.org/MPL/2.0/.
++
++#with Files("**"):
++#    BUG_COMPONENT = ("Core", "Content Processes")
++
++
++EXPORTS.mozilla.ipc += [
++    "IPCFuzzer.h",
++    "IPCFuzzerCore.h",
++    "Mutation.h",
++]
++
++UNIFIED_SOURCES += [
++    "IPCFuzzer.cpp",
++    "IPCFuzzerCore.cpp",
++    "Mutation.cpp",
++]
++
++FINAL_LIBRARY = "xul"
++
++IPDL_SOURCES += [
++#    "PFileSystemParams.ipdlh",
++#    "PFileSystemRequest.ipdl",
++]
++
++include("/ipc/chromium/chromium-config.mozbuild")
++
++LOCAL_INCLUDES += [
++    "/accessible/xpcom",
++    "/dom/base",
++    "/netwerk/base",
++]
+diff --git a/ipc/ipdl/ipdl/ast.py b/ipc/ipdl/ipdl/ast.py
+index e50cbb5c655e6..23fb286d9350b 100644
+--- a/ipc/ipdl/ipdl/ast.py
++++ b/ipc/ipdl/ipdl/ast.py
+@@ -2,6 +2,7 @@
+ # License, v. 2.0. If a copy of the MPL was not distributed with this
+ # file, You can obtain one at http://mozilla.org/MPL/2.0/.
+ 
++from typing import Any
+ from .util import hash_str
+ 
+ 
+@@ -335,6 +336,12 @@ class StructDecl(NamespacedNode):
+         # for e.g. C++ constructors when new fields are added.
+         self.packed_field_ordering = []
+ 
++    def __str__(self):
++        return f"StructDecl(name={self.name}, fields={self.fields}, attributes={self.attributes})"
++
++    def __repr__(self):
++        return str(self)
++
+ 
+ class UnionDecl(NamespacedNode):
+     def __init__(self, loc, name, components, attributes):
+@@ -466,3 +473,9 @@ class Decl(Node):
+         self.type = None
+         self.scope = None
+         self.attributes = {}
++
++    def __str__(self) -> str:
++        return f"{self.progname} {self.type.fullname()}"
++
++    def __repr__(self) -> str:
++        return str(self)
+diff --git a/ipc/ipdl/ipdl/cxx/ast.py b/ipc/ipdl/ipdl/cxx/ast.py
+index 3b9448859b0f3..0b86adf0d44d9 100644
+--- a/ipc/ipdl/ipdl/cxx/ast.py
++++ b/ipc/ipdl/ipdl/cxx/ast.py
+@@ -741,6 +741,12 @@ class ExprVar(Node):
+         Node.__init__(self)
+         self.name = name
+ 
++    def __str__(self) -> str:
++        return f"Exprvar {self.name}"
++
++    def __repr__(self) -> str:
++        return str(self)
++
+ 
+ ExprVar.THIS = ExprVar("this")
+ 
+@@ -777,6 +783,12 @@ class ExprPrefixUnop(Node):
+         self.expr = expr
+         self.op = op
+ 
++    def __str__(self) -> str:
++        return f"ExprPrefixUnop {self.expr} {self.op}"
++
++    def __repr__(self) -> str:
++        return str(self)
++
+ 
+ class ExprNot(ExprPrefixUnop):
+     def __init__(self, expr):
+@@ -835,6 +847,12 @@ class ExprSelect(Node):
+         else:
+             self.field = field
+ 
++    def __str__(self) -> str:
++        return f"ExprSelect {self.obj} {self.op} {self.field}"
++
++    def __repr__(self) -> str:
++        return str(self)
++
+ 
+ class ExprAssn(Node):
+     def __init__(self, lhs, rhs, op="="):
+@@ -855,6 +873,12 @@ class ExprCall(Node):
+         self.func = func
+         self.args = args
+ 
++    def __str__(self) -> str:
++        return f"Exprcall {self.func}"
++
++    def __repr__(self) -> str:
++        return str(self)
++
+ 
+ class ExprMove(ExprCall):
+     def __init__(self, arg):
+diff --git a/ipc/ipdl/ipdl/lower.py b/ipc/ipdl/ipdl/lower.py
+index c6345419d1656..f0d7b5c4f26c8 100644
+--- a/ipc/ipdl/ipdl/lower.py
++++ b/ipc/ipdl/ipdl/lower.py
+@@ -9,9 +9,11 @@ import itertools
+ 
+ import ipdl.ast
+ import ipdl.builtin
++import ipdl.type
++import ipdl.cxx.ast
+ from ipdl.cxx.ast import *
+ from ipdl.cxx.code import *
+-from ipdl.type import ActorType, UnionType, TypeVisitor, builtinHeaderIncludes
++from ipdl.type import ActorType, UnionType, TypeVisitor, builtinHeaderIncludes, ImportedCxxType
+ from ipdl.util import hash_str
+ 
+ 
+@@ -917,6 +919,12 @@ class _StructField(_CompoundTypeComponent):
+     def memberVar(self):
+         return ExprVar(self.name + "_")
+ 
++    def __str__(self):
++        return f"_StructField(name={self.name}, type={self.ipdltype})"
++
++    def __repr__(self):
++        return str(self)
++
+ 
+ class UnionDecl(ipdl.ast.UnionDecl, HasFQName):
+     def callType(self, var=None):
+@@ -1595,6 +1603,10 @@ class _GenerateProtocolCode(ipdl.ast.Visitor):
+             )
+         )
+ 
++        # PATCH(JN)
++        cf.addthings([Whitespace.NL, CppDirective('include', '"mozilla/ipc/IPCFuzzer.h"'), Whitespace.NL])
++
++
+         if self.protocol:
+             # construct the namespace into which we'll stick all our defns
+             ns = Namespace(self.protocol.name)
+@@ -1976,16 +1988,102 @@ class _ParamTraits:
+             var = ExprMove(var)
+         return ExprCall(ExprVar("IPC::WriteParam"), args=[writervar, var])
+ 
++    @classmethod
++    def filter_keywords(cls, word):
++        url_keywords = ["uri", "spec", "url"]
++        origin_keywords = ["origin", "site", "principal"]
++        host_keywords = ["host", "domain"]
++
++        if any([keyword in word.lower() for keyword in url_keywords]):
++            return "url"
++        if any([keyword in word.lower() for keyword in origin_keywords]):
++            return "origin"
++        if any([keyword in word.lower() for keyword in host_keywords]):
++            return "host"
++        return None
++
+     @classmethod
+     def checkedWrite(cls, ipdltype, var, writervar, sentinelKey):
+         assert sentinelKey
+         block = Block()
+ 
+-        block.addstmts(
+-            [
+-                StmtExpr(cls.write(var, writervar, ipdltype)),
+-            ]
+-        )
++        # TODO(JN) inject fuzzer hooks here
++        # print(f"checkedWrite: {ipdltype} {type(ipdltype)} {var} {writervar}")
++        insert_hook = False
++        if isinstance(ipdltype, ipdl.type.ImportedCxxType):
++            param_type = ipdltype.fullname()
++            if param_type in ["::nsCString", "::nsString" ]:
++                if isinstance(var, ipdl.cxx.ast.ExprVar):
++                    param_name = var.name
++                    keyword_match = cls.filter_keywords(param_name)
++                    if keyword_match is not None:
++                        insert_hook = True
++                        var_copy = ipdl.cxx.ast.ExprVar(f"{param_name}_copy")
++                        block.addstmts([
++                            StmtCode("// INTERCEPTED VAR"),
++                            StmtCode(f"{param_type} {param_name}_copy({param_name});"),
++                            # StmtCode(f'::mozilla::ipc::IPCFuzzer::log_param({param_name}_copy, "{param_name}");')
++                            ])
++
++                        if keyword_match == "url":
++                            block.addstmts([
++                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_url({param_name}_copy);'),
++                                StmtExpr(cls.write(var_copy, writervar, ipdltype)),
++                                ])
++                        elif keyword_match == "origin":
++                            block.addstmts([
++                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_origin({param_name}_copy);'),
++                                StmtExpr(cls.write(var_copy, writervar, ipdltype)),
++                                ])
++                        elif keyword_match == "host":
++                            block.addstmts([
++                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_host({param_name}_copy);'),
++                                StmtExpr(cls.write(var_copy, writervar, ipdltype)),
++                                ])
++                        else:
++                            raise Exception(f"Unknown keyword match {keyword_match}")
++
++
++                elif isinstance(var, ipdl.cxx.ast.ExprCall) and isinstance(var.func, ipdl.cxx.ast.ExprSelect):
++                    param_name = var.func.field.name
++                    keyword_match = cls.filter_keywords(param_name)
++                    if keyword_match is not None:
++                        insert_hook = True
++                        var_copy = ipdl.cxx.ast.ExprVar(f"{param_name}_copy")
++                        param_access = f"{var.func.obj.name}{var.func.op}{param_name}()"
++                        block.addstmts([
++                            StmtCode("// INTERCEPTED MEMBER"),
++                            StmtCode(f"{param_type} {param_name}_copy({param_access});"),
++                            # StmtCode(f'::mozilla::ipc::IPCFuzzer::log_param({param_name}_copy, "{param_name}");')
++                            ])
++
++                        if keyword_match == "url":
++                            block.addstmts([
++                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_url({param_name}_copy);'),
++                                StmtExpr(cls.write(var_copy, writervar, None)),
++                                ])
++                        elif keyword_match == "origin":
++                            block.addstmts([
++                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_origin({param_name}_copy);'),
++                                StmtExpr(cls.write(var_copy, writervar, None)),
++                                ])
++                        elif keyword_match == "host":
++                            block.addstmts([
++                                StmtCode(f'::mozilla::ipc::IPCFuzzer::mutate_host({param_name}_copy);'),
++                                StmtExpr(cls.write(var_copy, writervar, None)),
++                                ])
++                        else:
++                            raise Exception(f"Unknown keyword match {keyword_match}")
++                else:
++                    print(f"CHECK {var}")
++
++        if not insert_hook:
++            block.addstmts(
++                [
++                    StmtExpr(cls.write(var, writervar, ipdltype)),
++                ]
++            )
++
+         block.addstmts(cls.writeSentinel(writervar, sentinelKey))
+         return block
+ 
+@@ -2224,6 +2322,8 @@ class _ParamTraits:
+         write = []
+         read = []
+ 
++        # print(f"STRUCT {sd}")
++
+         # First serialize/deserialize all non-pod data in IPDL order. These need
+         # to be read/written first because they'll be used to invoke the IPDL
+         # struct's constructor.
+@@ -2289,6 +2389,7 @@ class _ParamTraits:
+             cxxtype, write, read, needsmove=_cxxTypeNeedsMoveForSend(structtype)
+         )
+ 
++
+     @classmethod
+     def unionPickling(cls, uniontype):
+         # NOTE: Not using _cxxBareType here as we don't have a side
+@@ -2299,12 +2400,63 @@ class _ParamTraits:
+         alias = "union__"
+         typevar = ExprVar("type")
+ 
++        # TODO(JN) intercept PrincipalInfo here
++        fuzzedWrite = []
++        fuzzedUnionTypes = ["PrincipalInfo"]
++        if uniontype.name() in fuzzedUnionTypes:
++            var_replaced = ExprVar("var_replaced")
++            typevar_replaced = ExprVar("type_replaced")
++
++            writeswitch_replaced = StmtSwitch(typevar_replaced)
++            for c in ud.components:
++                caselabel = CaseLabel(alias + "::" + c.enum())
++                origenum = c.enum()
++
++                writecase = StmtBlock()
++                wstmt = cls.checkedWrite(
++                    c.ipdltype,
++                    ExprCall(ExprSelect(var_replaced, "->", c.getTypeName())),
++                    cls.writervar,
++                    sentinelKey=c.enum(),
++                )
++                writecase.addstmts([wstmt, StmtReturn()])
++                writeswitch_replaced.addcase(caselabel, writecase)
++
++            # Add the error default case
++            writeswitch_replaced.addcase(
++                DefaultLabel(),
++                StmtBlock(
++                    [
++                        cls.fatalError(
++                            cls.writervar, "unknown variant of union " + uniontype.name()
++                        ),
++                        StmtReturn(),
++                    ]
++                ),
++            )
++
++            stmtIf = StmtIf(ExprBinary(var_replaced, "!=", ExprLiteral.NULL))
++            stmtIf.addifstmts([
++                # StmtDecl(Decl(Type.INT, typevar_replaced.name), init=ud.callType(var_replaced)),
++                StmtCode(f"int {typevar_replaced.name} = {var_replaced.name}->type();"),
++                cls.checkedWrite(None, typevar_replaced, cls.writervar, sentinelKey=uniontype.name()),
++                Whitespace.NL,
++                writeswitch_replaced,
++                StmtReturn()])
++
++            fuzzedWrite = [
++                StmtCode(f"auto {var_replaced.name} = ::mozilla::ipc::IPCFuzzer::replace{uniontype.name()}();"),
++                stmtIf,
++                Whitespace.NL
++            ]
++
++
+         prelude = [
+             Typedef(cxxtype, alias),
+         ]
+ 
+         writeswitch = StmtSwitch(typevar)
+-        write = prelude + [
++        write = prelude + fuzzedWrite + [
+             StmtDecl(Decl(Type.INT, typevar.name), init=ud.callType(cls.var)),
+             cls.checkedWrite(
+                 None, typevar, cls.writervar, sentinelKey=uniontype.name()
+@@ -3513,6 +3665,9 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
+             )
+         )
+ 
++        # TODO(JN) import IPCFuzzer
++        cf.addthings([Whitespace.NL, CppDirective('include', '"mozilla/ipc/IPCFuzzer.h"'), Whitespace.NL])
++
+         cppns = makeNamespace(self.protocol, cf)
+         cppns.addstmts(
+             [Whitespace.NL, Whitespace.NL, clsdefn, Whitespace.NL, Whitespace.NL]
+@@ -4904,10 +5059,35 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
+         if "VirtualSendImpl" in md.attributes:
+             decl.methodspec = MethodSpec.VIRTUAL
+         method = MethodDefn(decl)
++
++        if self.clsname == "PServiceWorkerContainerChild" and ("Register" in md.name):
++            print(f"MD: {self.clsname}::{md.name} {md.inParams}")
++
++
++        if self.clsname == "PBackgroundChild" and ("StorageActivity" in md.name):
++            print(f"MD: {self.clsname}::{md.name} {md.inParams}")
++
++        logstmts = []
++        # # TODO(JN) add log statements if params are url, origin or IPCClientInfo
++        # for param in md.inParams:
++        #     # param is Decl object
++        #     if param.type.fullname() == "::nsCString":
++        #         if re.search(r".*(?:origin|url|site).*", param.progname, re.IGNORECASE):
++        #             # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}: %s", {param.progname}.Data()));'))
++        #             logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
++
++        #     elif param.type.fullname() == "::mozilla::dom::IPCClientInfo":
++        #         # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}: %s", {param.progname}.url().get()));'))
++        #         logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
++        #     elif param.type.fullname() == "::mozilla::ipc::PrincipalInfo":
++        #         # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}"));'))
++        #         logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
++
++
+         msgvar, stmts = self.makeMessage(md, errfnSend)
+         retvar, sendstmts = self.sendAsync(md, msgvar)
+ 
+-        method.addstmts(stmts + [Whitespace.NL] + sendstmts + [StmtReturn(retvar)])
++        method.addstmts([StmtCode('// ASYNC')] + logstmts + stmts + [Whitespace.NL] + sendstmts + [StmtReturn(retvar)])
+ 
+         movemethod = None
+ 
+@@ -4926,9 +5106,25 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
+ 
+         return method, movemethod, promisemethod, (lbl, case)
+ 
+-    def genBlockingSendMethod(self, md):
++    def genBlockingSendMethod(self, md): #
++        # md is a message declaration
+         method = MethodDefn(self.makeSendMethodDecl(md))
+ 
++        logstmts = []
++        # # TODO(JN) add log statements if params are url, origin or IPCClientInfo
++        # for param in md.inParams:
++        #     # param is Decl object
++        #     if param.type.fullname() == "::nsCString":
++        #         if re.search(r".*(?:origin|url|site).*", param.progname, re.IGNORECASE):
++        #             # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}: %s", {param.progname}.Data()));'))
++        #             logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
++        #     elif param.type.fullname() == "::mozilla::dom::IPCClientInfo":
++        #         # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}: %s", {param.progname}.url().get()));'))
++        #         logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
++        #     elif param.type.fullname() == "::mozilla::ipc::PrincipalInfo":
++        #         # logstmts.append(StmtCode(f'MOZ_LOG(my{self.clsname}IPCLogger, LogLevel::Debug, ("INTERCEPTED {self.clsname}::Send{md.name} {param.type.fullname()} {param.progname}"));'))
++        #         logstmts.append(StmtCode(f'::mozilla::ipc::IPCFuzzer::log({param.progname}, "{self.clsname}::Send{md.name}");'))
++
+         msgvar, serstmts = self.makeMessage(md, errfnSend)
+         replyvar = self.replyvar
+ 
+@@ -4941,7 +5137,9 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
+         )
+ 
+         method.addstmts(
+-            serstmts
++            [StmtCode('// BLOCKING')]
++            + logstmts
++            + serstmts
+             + [Whitespace.NL, StmtDecl(Decl(Type("UniquePtr<Message>"), replyvar.name))]
+             + sendstmts
+             + [failif]
+@@ -5476,7 +5674,7 @@ class _GenerateProtocolActorCode(ipdl.ast.Visitor):
+             ),
+         )
+ 
+-    def sendAsyncWithPromise(self, md):
++    def sendAsyncWithPromise(self, md): # creates the Send method that returns a promise
+         # Create a new promise, and forward to the callback send overload.
+         promise = _makePromise(md.returns, self.side, resolver=True)
+ 
+diff --git a/ipc/ipdl/ipdl/type.py b/ipc/ipdl/ipdl/type.py
+index c050b09345a05..7640eda6d8976 100644
+--- a/ipc/ipdl/ipdl/type.py
++++ b/ipc/ipdl/ipdl/type.py
+@@ -225,6 +225,12 @@ class ImportedCxxType(Type):
+     def fullname(self):
+         return str(self.qname)
+ 
++    def __str__(self) -> str:
++        return f"{self.fullname()}"
++
++    def __repr__(self) -> str:
++        return str(self)
++
+ 
+ # --------------------
+ 
+@@ -547,6 +553,12 @@ class StructType(_CompoundType):
+     def fullname(self):
+         return str(self.qname)
+ 
++    def __str__(self) -> str:
++        return f"StructType {self.name()} {self.fields}"
++
++    def __repr__(self) -> str:
++        return str(self)
++
+ 
+ class UnionType(_CompoundType):
+     def __init__(self, qname, components):
+@@ -567,6 +579,12 @@ class UnionType(_CompoundType):
+     def fullname(self):
+         return str(self.qname)
+ 
++    def __str__(self) -> str:
++        return f"UnionType {self.name()} {self.components}"
++
++    def __repr__(self) -> str:
++        return str(self)
++
+ 
+ class ArrayType(IPDLType):
+     def __init__(self, basetype):
+diff --git a/ipc/moz.build b/ipc/moz.build
+index a89607c83a72e..9b55b9224dce7 100644
+--- a/ipc/moz.build
++++ b/ipc/moz.build
+@@ -10,6 +10,7 @@ DIRS += [
+     "glue",
+     "ipdl",
+     "testshell",
++    "fuzzer",
+ ]
+ 
+ if CONFIG["OS_ARCH"] == "WINNT":
+diff --git a/ipdl_parser.py b/ipdl_parser.py
+new file mode 100755
+index 0000000000000..0a57a1fb8e93f
+--- /dev/null
++++ b/ipdl_parser.py
+@@ -0,0 +1,210 @@
++#!/usr/bin/env python3
++
++import os
++import json
++from collections import namedtuple
++
++"""
++Parse all .ipdl and .ipdlh files in this directory and subdirectories
++and extract all struct and union definitions that recursively contain origin releated parameters.
++"""
++
++
++class Param(namedtuple("Param", ["type", "identifier"])):
++    def __str__(self):
++        return f"{self.type}:{self.identifier}"
++
++    def __repr__(self):
++        return self.__str__()
++
++
++class Struct(namedtuple("Struct", ["name", "file", "params"])):
++    def __str__(self):
++        return f"struct {self.name}({self.params})"
++
++    def __repr__(self):
++        return self.__str__()
++
++    def __eq__(self, other) -> bool:
++        return self.name == other.name and self.file == other.file
++
++    def __hash__(self) -> int:
++        return hash(self.name) + hash(self.file)
++
++    def as_dict(self) -> dict:
++        ret = self._asdict()
++        ret['type'] = 'struct'
++        return ret
++
++
++class Union(namedtuple("Struct", ["name", "file", "params"])):
++    def __str__(self):
++        return f"union {self.name}({self.params})"
++
++    def __repr__(self):
++        return self.__str__()
++
++    def __eq__(self, other) -> bool:
++        return self.name == other.name and self.file == other.file
++
++    def __hash__(self) -> int:
++        return hash(self.name) + hash(self.file)
++
++    def as_dict(self) -> dict:
++        ret = self._asdict()
++        ret['type'] = 'union'
++        return ret
++
++
++def extract_definitions_from_file(content, filename):
++    """
++    Extracts struct and union definitions from a file.
++
++    Args:
++    file_content (str): The contents of a file as a string.
++
++    Returns:
++    list: A list of struct and union definitions.
++    """
++    definitions = []
++    lines = content.splitlines()
++    for i, line in enumerate(lines):
++        # remove [] annotations before struct/union definitions
++        if line.startswith("["):
++            line = line.split("]")[1].strip()
++
++        # parse struct definition
++        if line.startswith("struct"):
++            # skip empty structs
++            if "}" in line:
++                continue
++
++            # handle case of curly brace in new line
++            struct_idx = i + 1
++            if not "{" in line:
++                struct_idx += 1
++                # skip empty structs
++                if "}" in lines[i + 1]:
++                    continue
++
++            # read the struct name
++            name = line.split()[1].replace("{", "")
++            params = []
++
++            print(f"Parsing struct {name}")
++
++            # read the struct parameters
++            for struct_line in lines[struct_idx:]:
++                struct_line = struct_line.strip()
++                if struct_line.startswith("}"):
++                    break
++                if struct_line == "":
++                    continue
++                if struct_line.startswith(("//", "#", "/*", "/**", "*")):
++                    continue
++                if "//" in struct_line:
++                    struct_line = struct_line.split("//")[0]
++                if struct_line.startswith("nullable "):
++                    struct_line = struct_line.replace("nullable ", "")
++
++                # print("|" + struct_line + "|")
++                param_type, param_name, *_ = struct_line.split()
++                param_name = param_name.replace(";", "")
++                param_type = param_type.replace("?", "").replace("[]", "")
++                params.append(Param(param_type, param_name))
++
++            definitions.append(Struct(name, filename, params))
++
++        # parse union definition
++        if line.startswith("union"):
++            name = line.split()[1].replace("{", "")
++            params = []
++
++            print(f"Parsing union {name}")
++
++            # handle case of curly brace in new line
++            union_idx = i + 1
++            if not "{" in line:
++                union_idx += 1
++
++            # read the union parameters
++            for union_line in lines[union_idx:]:
++                union_line = union_line.strip()
++                if union_line.startswith("}"):
++                    break
++                if union_line.startswith(("//", "#", "/*", "/**", "*")):
++                    continue
++                if "//" in union_line:
++                    union_line = union_line.split("//")[0]
++                param_type = union_line.replace(";", "")
++                params.append(Param(param_type, None))  # union params don't have names
++            definitions.append(Union(name, filename, params))
++    return definitions
++
++
++def parse_files():
++    definitions = []
++
++    # find all .ipdl and .ipdlh files in this directory and subdirectories
++    for root, dirs, files in os.walk("."):
++        for file in files:
++            if file.endswith(".ipdl") or file.endswith(".ipdlh"):
++                with open(os.path.join(root, file), "r") as f:
++                    print(f"Processing file: {os.path.join(root, file)}")
++                    content = f.read()
++                    file_definitions = extract_definitions_from_file(
++                        content, os.path.join(root, file)
++                    )
++                    definitions.extend(file_definitions)
++    return definitions
++
++
++def find_structs_unions_with_relevant_params(definitions):
++    relevant = set()
++
++    for definition in definitions:
++        for param in definition.params:
++            if (
++                param.type in ["nsString", "nsCString"]
++                and param.identifier is not None
++                and any(
++                    keyword in param.identifier.lower()
++                    for keyword in ["url", "uri", "spec", "origin", "domain"]
++                )
++            ):
++                relevant.add(definition)
++                break
++    return relevant
++
++
++def find_recursively_relevant_structs(definitions, relevant_definitions):
++    found_new = True
++    while found_new:
++        found_new = False
++        for definition in definitions:
++            for param in definition.params:
++                if param.type in [relevant.name for relevant in relevant_definitions]:
++                    print(f"{definition.name} contains {param.type}")
++                    old_size = len(relevant_definitions)
++                    relevant_definitions.add(definition)
++                    if len(relevant_definitions) > old_size:
++                        found_new = True
++                        break
++    return relevant_definitions
++
++
++definitions = parse_files()
++relevant_definitions = find_structs_unions_with_relevant_params(definitions)
++
++
++with open("relevant_structs.json", "w") as f:
++    f.write(
++        json.dumps(
++            [definition.as_dict() for definition in relevant_definitions], indent=4
++        )
++    )
++
++all_relevant = find_recursively_relevant_structs(definitions, relevant_definitions)
++
++with open("recursively_relevant_structs.json", "w") as f:
++    f.write(json.dumps([definition.as_dict() for definition in all_relevant], indent=4))
+diff --git a/js/xpconnect/src/XPCJSRuntime.cpp b/js/xpconnect/src/XPCJSRuntime.cpp
+index 70cfa826e66a6..b7beb059f5410 100644
+--- a/js/xpconnect/src/XPCJSRuntime.cpp
++++ b/js/xpconnect/src/XPCJSRuntime.cpp
+@@ -84,6 +84,8 @@
+ #include "nsJSEnvironment.h"
+ #include "XPCInlines.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
+ #ifdef XP_WIN
+ #  include <windows.h>
+ #endif
+@@ -556,6 +558,11 @@ bool MightBeWebContentCompartment(JS::Compartment* compartment) {
+ }
+ 
+ bool CompartmentOriginInfo::IsSameOrigin(nsIPrincipal* aOther) const {
++    // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE CompartmentOriginInfo::IsSameOrigin"));
++    return true;
++  }
+   return mOrigin->FastEquals(aOther);
+ }
+ 
+diff --git a/log.source b/log.source
+new file mode 100644
+index 0000000000000..92381c25671cc
+--- /dev/null
++++ b/log.source
+@@ -0,0 +1,3 @@
++export MOZ_LOG="ipc_logger:5"
++#export MOZ_IPC_MESSAGE_LOG=1
++#export MOZ_DISABLE_CONTENT_SANDBOX=1
+diff --git a/netwerk/protocol/http/HttpBaseChannel.cpp b/netwerk/protocol/http/HttpBaseChannel.cpp
+index c7d22c9645f53..b5f9a4b909e8d 100644
+--- a/netwerk/protocol/http/HttpBaseChannel.cpp
++++ b/netwerk/protocol/http/HttpBaseChannel.cpp
+@@ -107,6 +107,9 @@
+ #include "mozilla/dom/ContentChild.h"
+ #include "nsQueryObject.h"
+ 
++#include "mozilla/ipc/IPCFuzzerCore.h"
++
++
+ using mozilla::dom::RequestMode;
+ 
+ #define LOGORB(msg, ...)                \
+@@ -5170,6 +5173,11 @@ bool HttpBaseChannel::ShouldTaintReplacementChannelOrigin(
+ 
+ // Redirect Tracking
+ bool HttpBaseChannel::SameOriginWithOriginalUri(nsIURI* aURI) {
++  // PATCH(JN)
++  if (::mozilla::ipc::IPCFuzzerCore::getInstance().is_compromised()){
++    MOZ_LOG(::mozilla::ipc::IPCLogger, LogLevel::Debug, ("OVERRIDE HttpBaseChannel::SameOriginWithOriginalUri"));
++    return true;
++  }
+   nsIScriptSecurityManager* ssm = nsContentUtils::GetSecurityManager();
+   bool isPrivateWin = mLoadInfo->GetOriginAttributes().mPrivateBrowsingId > 0;
+   nsresult rv =
diff --git a/playwright b/playwright
new file mode 160000
index 0000000000000..50769b4e23393
--- /dev/null
+++ b/playwright
@@ -0,0 +1 @@
+Subproject commit 50769b4e23393681470b45cc82b495a18437eb1a
diff --git a/playwright.cfg b/playwright.cfg
new file mode 100644
index 0000000000000..1a11fe1ba72b3
--- /dev/null
+++ b/playwright.cfg
@@ -0,0 +1,312 @@
+// Any comment. You must start the file with a comment!
+
+// =================================================================
+// THESE ARE THE PROPERTIES THAT MUST BE ENABLED FOR JUGGLER TO WORK
+// =================================================================
+pref("dom.input_events.security.minNumTicks", 0);
+pref("dom.input_events.security.minTimeElapsedInMS", 0);
+
+pref("dom.iframe_lazy_loading.enabled", false);
+
+pref("datareporting.policy.dataSubmissionEnabled", false);
+pref("datareporting.policy.dataSubmissionPolicyAccepted", false);
+pref("datareporting.policy.dataSubmissionPolicyBypassNotification", true);
+
+// Force pdfs into downloads.
+pref("pdfjs.disabled", true);
+
+pref("fission.autostart", true);
+
+// Disable cross-process iframes, but not cross-process navigations.
+pref("fission.webContentIsolationStrategy", 1);
+
+// Disable BFCache in parent process.
+// We also separately disable BFCache in content via docSchell property.
+pref("fission.bfcacheInParent", true);
+
+// Disable first-party-based cookie partitioning.
+// When it is enabled, we have to retain "thirdPartyCookie^" permissions
+// in the storageState.
+pref("network.cookie.cookieBehavior", 4);
+
+// Increase max number of child web processes so that new pages
+// get a new process by default and we have a process isolation
+// between pages from different contexts. If this becomes a performance
+// issue we can povide custom '@mozilla.org/ipc/processselector;1'
+pref("dom.ipc.processCount", 60000);
+
+// Never reuse processes as they may keep previously overridden values
+// (locale, timezone etc.).
+pref("dom.ipc.processPrelaunch.enabled", true);
+
+// Isolate permissions by user context.
+pref("permissions.isolateBy.userContext", true);
+
+// Allow creating files in content process - required for
+// |Page.setFileInputFiles| protocol method.
+pref("dom.file.createInChild", true);
+
+// Do not warn when closing all open tabs
+pref("browser.tabs.warnOnClose", false);
+
+// Do not warn when closing all other open tabs
+pref("browser.tabs.warnOnCloseOtherTabs", false);
+
+// Do not warn when multiple tabs will be opened
+pref("browser.tabs.warnOnOpen", false);
+
+// Do not warn on quitting Firefox
+pref("browser.warnOnQuit", false);
+
+// Disable popup-blocker
+pref("dom.disable_open_during_load", false);
+
+// Disable the ProcessHangMonitor
+pref("dom.ipc.reportProcessHangs", false);
+pref("hangmonitor.timeout", 0);
+
+// Allow the application to have focus even it runs in the background
+pref("focusmanager.testmode", true);
+
+// No ICC color correction. We need this for reproducible screenshots.
+// See https://developer.mozilla.org/en/docs/Mozilla/Firefox/Releases/3.5/ICC_color_correction_in_Firefox.
+pref("gfx.color_management.mode", 0);
+pref("gfx.color_management.rendering_intent", 3);
+
+// Always use network provider for geolocation tests so we bypass the
+// macOS dialog raised by the corelocation provider
+pref("geo.provider.testing", true);
+
+
+
+
+// =================================================================
+// THESE ARE NICHE PROPERTIES THAT ARE NICE TO HAVE
+// =================================================================
+
+// Enable software-backed webgl. See https://phabricator.services.mozilla.com/D164016
+pref("webgl.forbid-software", false);
+
+// Disable auto-fill for credit cards and addresses.
+// See https://github.com/microsoft/playwright/issues/21393
+pref("extensions.formautofill.creditCards.supported", "off");
+pref("extensions.formautofill.addresses.supported", "off");
+
+// Allow access to system-added self-signed certificates. This aligns
+// firefox behavior with other browser defaults.
+pref("security.enterprise_roots.enabled", true);
+
+// Avoid stalling on shutdown, after "xpcom-will-shutdown" phase.
+// This at least happens when shutting down soon after launching.
+// See AppShutdown.cpp for more details on shutdown phases.
+pref("toolkit.shutdown.fastShutdownStage", 3);
+
+// Use light theme by default.
+pref("ui.systemUsesDarkTheme", 0);
+
+// Only allow the old modal dialogs. This should be removed when there is
+// support for the new modal UI (see Bug 1686743).
+pref("prompts.contentPromptSubDialog", false);
+
+// Do not use system colors - they are affected by themes.
+pref("ui.use_standins_for_native_colors", true);
+
+pref("dom.push.serverURL", "");
+// This setting breaks settings loading.
+pref("services.settings.server", "");
+pref("browser.safebrowsing.provider.mozilla.updateURL", "");
+pref("browser.library.activity-stream.enabled", false);
+pref("browser.search.geoSpecificDefaults", false);
+pref("browser.search.geoSpecificDefaults.url", "");
+pref("captivedetect.canonicalURL", "");
+pref("network.captive-portal-service.enabled", false);
+pref("network.connectivity-service.enabled", false);
+pref("browser.newtabpage.activity-stream.asrouter.providers.snippets", "");
+
+// Make sure Shield doesnt hit the network.
+pref("app.normandy.api_url", "");
+pref("app.normandy.enabled", false);
+
+// Disable updater
+pref("app.update.enabled", false);
+// Disable Firefox old build background check
+pref("app.update.checkInstallTime", false);
+// Disable automatically upgrading Firefox
+pref("app.update.disabledForTesting", true);
+
+// make absolutely sure it is really off
+pref("app.update.auto", false);
+pref("app.update.mode", 0);
+pref("app.update.service.enabled", false);
+// Dislabe newtabpage
+pref("browser.startup.homepage", "about:blank");
+pref("browser.startup.page", 0);
+pref("browser.newtabpage.enabled", false);
+// Do not redirect user when a milstone upgrade of Firefox is detected
+pref("browser.startup.homepage_override.mstone", "ignore");
+
+// Disable topstories
+pref("browser.newtabpage.activity-stream.feeds.section.topstories", false);
+// DevTools JSONViewer sometimes fails to load dependencies with its require.js.
+// This spams console with a lot of unpleasant errors.
+// (bug 1424372)
+pref("devtools.jsonview.enabled", false);
+
+// Increase the APZ content response timeout in tests to 1 minute.
+// This is to accommodate the fact that test environments tends to be
+// slower than production environments (with the b2g emulator being
+// the slowest of them all), resulting in the production timeout value
+// sometimes being exceeded and causing false-positive test failures.
+//
+// (bug 1176798, bug 1177018, bug 1210465)
+pref("apz.content_response_timeout", 60000);
+
+// Indicate that the download panel has been shown once so that
+// whichever download test runs first doesnt show the popup
+// inconsistently.
+pref("browser.download.panel.shown", true);
+// Background thumbnails in particular cause grief, and disabling
+// thumbnails in general cannot hurt
+pref("browser.pagethumbnails.capturing_disabled", true);
+// Disable safebrowsing components.
+pref("browser.safebrowsing.blockedURIs.enabled", false);
+pref("browser.safebrowsing.downloads.enabled", false);
+pref("browser.safebrowsing.passwords.enabled", false);
+pref("browser.safebrowsing.malware.enabled", false);
+pref("browser.safebrowsing.phishing.enabled", false);
+// Disable updates to search engines.
+pref("browser.search.update", false);
+// Do not restore the last open set of tabs if the browser has crashed
+pref("browser.sessionstore.resume_from_crash", false);
+// Dont check for the default web browser during startup.
+pref("browser.shell.checkDefaultBrowser", false);
+
+// Disable browser animations (tabs, fullscreen, sliding alerts)
+pref("toolkit.cosmeticAnimations.enabled", false);
+
+// Close the window when the last tab gets closed
+pref("browser.tabs.closeWindowWithLastTab", true);
+
+// Do not allow background tabs to be zombified on Android, otherwise for
+// tests that open additional tabs, the test harness tab itself might get
+// unloaded
+pref("browser.tabs.disableBackgroundZombification", false);
+
+// Disable first run splash page on Windows 10
+pref("browser.usedOnWindows10.introURL", "");
+
+// Disable the UI tour.
+//
+// Should be set in profile.
+pref("browser.uitour.enabled", false);
+
+// Turn off search suggestions in the location bar so as not to trigger
+// network connections.
+pref("browser.urlbar.suggest.searches", false);
+
+// Do not show datareporting policy notifications which can
+// interfere with tests
+pref("datareporting.healthreport.documentServerURI", "");
+pref("datareporting.healthreport.about.reportUrl", "");
+pref("datareporting.healthreport.logging.consoleEnabled", false);
+pref("datareporting.healthreport.service.enabled", false);
+pref("datareporting.healthreport.service.firstRun", false);
+pref("datareporting.healthreport.uploadEnabled", false);
+
+// Automatically unload beforeunload alerts
+pref("dom.disable_beforeunload", false);
+
+// Disable slow script dialogues
+pref("dom.max_chrome_script_run_time", 0);
+pref("dom.max_script_run_time", 0);
+
+// Only load extensions from the application and user profile
+// AddonManager.SCOPE_PROFILE + AddonManager.SCOPE_APPLICATION
+pref("extensions.autoDisableScopes", 0);
+pref("extensions.enabledScopes", 5);
+
+// Disable metadata caching for installed add-ons by default
+pref("extensions.getAddons.cache.enabled", false);
+
+// Disable installing any distribution extensions or add-ons.
+pref("extensions.installDistroAddons", false);
+
+// Turn off extension updates so they do not bother tests
+pref("extensions.update.enabled", false);
+pref("extensions.update.notifyUser", false);
+
+// Make sure opening about:addons will not hit the network
+pref("extensions.webservice.discoverURL", "");
+
+pref("extensions.screenshots.disabled", true);
+pref("extensions.screenshots.upload-disabled", true);
+
+// Disable useragent updates
+pref("general.useragent.updates.enabled", false);
+
+// Do not scan Wifi
+pref("geo.wifi.scan", false);
+
+// Show chrome errors and warnings in the error console
+pref("javascript.options.showInConsole", true);
+
+// Disable download and usage of OpenH264: and Widevine plugins
+pref("media.gmp-manager.updateEnabled", false);
+
+// Do not prompt with long usernames or passwords in URLs
+pref("network.http.phishy-userpass-length", 255);
+
+// Do not prompt for temporary redirects
+pref("network.http.prompt-temp-redirect", false);
+
+// Disable speculative connections so they are not reported as leaking
+// when they are hanging around
+pref("network.http.speculative-parallel-limit", 0);
+
+// Do not automatically switch between offline and online
+pref("network.manage-offline-status", false);
+
+// Make sure SNTP requests do not hit the network
+pref("network.sntp.pools", "");
+
+// Disable Flash
+pref("plugin.state.flash", 0);
+
+pref("privacy.trackingprotection.enabled", false);
+
+pref("security.certerrors.mitm.priming.enabled", false);
+
+// Local documents have access to all other local documents,
+// including directory listings
+pref("security.fileuri.strict_origin_policy", true);
+
+// Tests do not wait for the notification button security delay
+pref("security.notification_enable_delay", 0);
+
+// Do not automatically fill sign-in forms with known usernames and
+// passwords
+pref("signon.autofillForms", false);
+
+// Disable password capture, so that tests that include forms are not
+// influenced by the presence of the persistent doorhanger notification
+pref("signon.rememberSignons", false);
+
+// Disable first-run welcome page
+pref("startup.homepage_welcome_url", "about:blank");
+pref("startup.homepage_welcome_url.additional", "");
+
+// Prevent starting into safe mode after application crashes
+pref("toolkit.startup.max_resumed_crashes", -1);
+lockPref("toolkit.crashreporter.enabled", false);
+
+pref("toolkit.telemetry.enabled", false);
+pref("toolkit.telemetry.server", "");
+
+// Disable downloading the list of blocked extensions.
+pref("extensions.blocklist.enabled", false);
+
+// Force Firefox Devtools to open in a separate window.
+pref("devtools.toolbox.host", "window");
+
+// Disable auto translations
+pref("browser.translations.enable", false);
diff --git a/python/moz.build b/python/moz.build
index 35514b76fd28b..7897920f32882 100644
--- a/python/moz.build
+++ b/python/moz.build
@@ -77,3 +77,6 @@ PYTHON_UNITTEST_MANIFESTS += [
     "mozterm/test/python.toml",
     "mozversioncontrol/test/python.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/code_analysis/moz.build b/python/mozbuild/mozbuild/code_analysis/moz.build
index bb49fbcd2fbd8..5356dcfbd9468 100644
--- a/python/mozbuild/mozbuild/code_analysis/moz.build
+++ b/python/mozbuild/mozbuild/code_analysis/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox Build System", "Source Code Analysis")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/frontend/context.py b/python/mozbuild/mozbuild/frontend/context.py
index 551ea00feb231..91bcb7fa5ae92 100644
--- a/python/mozbuild/mozbuild/frontend/context.py
+++ b/python/mozbuild/mozbuild/frontend/context.py
@@ -2619,6 +2619,12 @@ VARIABLES = {
         pre-processor to generate files with suitable syntax.
         """,
     ),
+    "RUSTFLAGS": (
+        List,
+        list,
+        """rust flags
+        """,
+    ),
 }
 
 # Sanity check: we don't want any variable above to have a list as storage type.
diff --git a/python/mozbuild/mozbuild/test/backend/data/build/app/moz.build b/python/mozbuild/mozbuild/test/backend/data/build/app/moz.build
index 27641b20803ce..4944fa8a202db 100644
--- a/python/mozbuild/mozbuild/test/backend/data/build/app/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/build/app/moz.build
@@ -52,3 +52,6 @@ JAR_MANIFESTS += [
 
 DEFINES["FOO"] = "bar"
 DEFINES["BAR"] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/build/moz.build b/python/mozbuild/mozbuild/test/backend/data/build/moz.build
index 700516754d580..65857cb6bdcb9 100644
--- a/python/mozbuild/mozbuild/test/backend/data/build/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/build/moz.build
@@ -66,3 +66,6 @@ JAR_MANIFESTS += [
 DIRS += [
     "app",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/database/moz.build b/python/mozbuild/mozbuild/test/backend/data/database/moz.build
index ebc5d05b5ce5a..828ec4cb03ad8 100644
--- a/python/mozbuild/mozbuild/test/backend/data/database/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/database/moz.build
@@ -12,3 +12,6 @@ def Library(name):
 Library("dummy")
 
 SOURCES = ["bar.c", "baz.cpp", "foo.c", "qux.cpp"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/defines/moz.build b/python/mozbuild/mozbuild/test/backend/data/defines/moz.build
index b603cac3ffa0f..bc1a8543534aa 100644
--- a/python/mozbuild/mozbuild/test/backend/data/defines/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/defines/moz.build
@@ -7,3 +7,6 @@ DEFINES["BAZ"] = '"ab\'cd"'
 DEFINES["QUX"] = False
 DEFINES["BAR"] = 7
 DEFINES["VALUE"] = value
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/dist-files/moz.build b/python/mozbuild/mozbuild/test/backend/data/dist-files/moz.build
index 25961f149f317..51d56895c5e73 100644
--- a/python/mozbuild/mozbuild/test/backend/data/dist-files/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/dist-files/moz.build
@@ -6,3 +6,6 @@ FINAL_TARGET_PP_FILES += [
     "install.rdf",
     "main.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/exports-generated/moz.build b/python/mozbuild/mozbuild/test/backend/data/exports-generated/moz.build
index 44c31a3d9ca04..46c60c045abed 100644
--- a/python/mozbuild/mozbuild/test/backend/data/exports-generated/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/exports-generated/moz.build
@@ -10,3 +10,6 @@ GENERATED_FILES += ["bar.h"]
 GENERATED_FILES += ["mozilla2.h"]
 GENERATED_FILES += ["dom2.h"]
 GENERATED_FILES += ["dom3.h"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/exports/moz.build b/python/mozbuild/mozbuild/test/backend/data/exports/moz.build
index 371f26f5721ba..3f11f8667085f 100644
--- a/python/mozbuild/mozbuild/test/backend/data/exports/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/exports/moz.build
@@ -6,3 +6,6 @@ EXPORTS.mozilla += ["mozilla1.h", "mozilla2.h"]
 EXPORTS.mozilla.dom += ["dom1.h", "dom2.h"]
 EXPORTS.mozilla.gfx += ["gfx.h"]
 EXPORTS.nspr.private += ["pprio.h"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/final-target-files-wildcard/moz.build b/python/mozbuild/mozbuild/test/backend/data/final-target-files-wildcard/moz.build
index d665855234028..b497d68d831a8 100644
--- a/python/mozbuild/mozbuild/test/backend/data/final-target-files-wildcard/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/final-target-files-wildcard/moz.build
@@ -3,3 +3,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 FINAL_TARGET_FILES.foo += ["*.xyz"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/final_target/both/moz.build b/python/mozbuild/mozbuild/test/backend/data/final_target/both/moz.build
index dfbda9183b53a..343b41f763bd3 100644
--- a/python/mozbuild/mozbuild/test/backend/data/final_target/both/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/final_target/both/moz.build
@@ -4,3 +4,6 @@
 
 XPI_NAME = "mycrazyxpi"
 DIST_SUBDIR = "asubdir"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/final_target/dist-subdir/moz.build b/python/mozbuild/mozbuild/test/backend/data/final_target/dist-subdir/moz.build
index e44dd197ad031..c6159342ee705 100644
--- a/python/mozbuild/mozbuild/test/backend/data/final_target/dist-subdir/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/final_target/dist-subdir/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIST_SUBDIR = "asubdir"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/final_target/final-target/moz.build b/python/mozbuild/mozbuild/test/backend/data/final_target/final-target/moz.build
index e008f94478f82..30e45e6bb6d54 100644
--- a/python/mozbuild/mozbuild/test/backend/data/final_target/final-target/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/final_target/final-target/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 FINAL_TARGET = "random-final-target"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/final_target/moz.build b/python/mozbuild/mozbuild/test/backend/data/final_target/moz.build
index 319062b78f3c2..06989a6cda5e4 100644
--- a/python/mozbuild/mozbuild/test/backend/data/final_target/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/final_target/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS += ["xpi-name", "dist-subdir", "both", "final-target"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/final_target/xpi-name/moz.build b/python/mozbuild/mozbuild/test/backend/data/final_target/xpi-name/moz.build
index 980810caa3660..5ad6d65af6b42 100644
--- a/python/mozbuild/mozbuild/test/backend/data/final_target/xpi-name/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/final_target/xpi-name/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 XPI_NAME = "mycrazyxpi"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/generated-files-force/moz.build b/python/mozbuild/mozbuild/test/backend/data/generated-files-force/moz.build
index d86b7b09ea182..93aef69676caf 100644
--- a/python/mozbuild/mozbuild/test/backend/data/generated-files-force/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/generated-files-force/moz.build
@@ -12,3 +12,6 @@ foo = GENERATED_FILES["foo.c"]
 foo.script = "generate-foo.py"
 foo.inputs = ["foo-data"]
 foo.force = False
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/generated-files/moz.build b/python/mozbuild/mozbuild/test/backend/data/generated-files/moz.build
index 01b444238e840..b5e7745948d2c 100644
--- a/python/mozbuild/mozbuild/test/backend/data/generated-files/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/generated-files/moz.build
@@ -10,3 +10,6 @@ bar.script = "generate-bar.py:baz"
 foo = GENERATED_FILES["foo.h"]
 foo.script = "generate-foo.py"
 foo.inputs = ["foo-data"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/generated_includes/moz.build b/python/mozbuild/mozbuild/test/backend/data/generated_includes/moz.build
index 31f9042c0a2d3..320b40f9ac60f 100644
--- a/python/mozbuild/mozbuild/test/backend/data/generated_includes/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/generated_includes/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 LOCAL_INCLUDES += ["!/bar/baz", "!foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/host-defines/moz.build b/python/mozbuild/mozbuild/test/backend/data/host-defines/moz.build
index f1a632c841e30..8ad919ab58a14 100644
--- a/python/mozbuild/mozbuild/test/backend/data/host-defines/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/host-defines/moz.build
@@ -7,3 +7,6 @@ HOST_DEFINES["BAZ"] = '"ab\'cd"'
 HOST_DEFINES["BAR"] = 7
 HOST_DEFINES["VALUE"] = value
 HOST_DEFINES["QUX"] = False
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/host-rust-library-features/moz.build b/python/mozbuild/mozbuild/test/backend/data/host-rust-library-features/moz.build
index 96fccf2063ca9..ecbfb1a441b2c 100644
--- a/python/mozbuild/mozbuild/test/backend/data/host-rust-library-features/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/host-rust-library-features/moz.build
@@ -20,3 +20,6 @@ def HostRustLibrary(name, features=None):
 
 
 HostRustLibrary("hostrusttool", ["musthave", "cantlivewithout"])
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/host-rust-library/moz.build b/python/mozbuild/mozbuild/test/backend/data/host-rust-library/moz.build
index 515f5d1a9f5f0..482897d942749 100644
--- a/python/mozbuild/mozbuild/test/backend/data/host-rust-library/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/host-rust-library/moz.build
@@ -20,3 +20,6 @@ def HostRustLibrary(name, features=None):
 
 
 HostRustLibrary("hostrusttool")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/install_substitute_config_files/moz.build b/python/mozbuild/mozbuild/test/backend/data/install_substitute_config_files/moz.build
index c38b472911862..17198a49600a2 100644
--- a/python/mozbuild/mozbuild/test/backend/data/install_substitute_config_files/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/install_substitute_config_files/moz.build
@@ -4,3 +4,6 @@
 
 # We want to test recursion into the subdir, so do the real work in 'sub'
 DIRS += ["sub"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/install_substitute_config_files/sub/moz.build b/python/mozbuild/mozbuild/test/backend/data/install_substitute_config_files/sub/moz.build
index 1420a99a8f865..7e5e10f3aaac7 100644
--- a/python/mozbuild/mozbuild/test/backend/data/install_substitute_config_files/sub/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/install_substitute_config_files/sub/moz.build
@@ -5,3 +5,6 @@
 CONFIGURE_SUBST_FILES = ["foo.h"]
 
 EXPORTS.out += ["!foo.h"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/bar/moz.build b/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/bar/moz.build
index f7d1560af31bd..5dfc19165ee84 100644
--- a/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/bar/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/bar/moz.build
@@ -14,3 +14,6 @@ IPDL_SOURCES += [
 ]
 
 FINAL_LIBRARY = "dummy"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/foo/moz.build b/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/foo/moz.build
index 02e9f78154fe1..dda1b9973352f 100644
--- a/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/foo/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/foo/moz.build
@@ -14,3 +14,6 @@ IPDL_SOURCES += [
 ]
 
 FINAL_LIBRARY = "dummy"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/ipdl/moz.build b/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/ipdl/moz.build
index 066397cb844d5..75efa4010ed1e 100644
--- a/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/ipdl/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/ipdl/moz.build
@@ -7,3 +7,6 @@
 # This file just exists to establish a directory as the IPDL root directory.
 
 FINAL_LIBRARY = "dummy"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/moz.build b/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/moz.build
index 4f0ddaa10e638..3e35d2742d057 100644
--- a/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/ipdl_sources/moz.build
@@ -17,3 +17,6 @@ DIRS += [
     "foo",
     "ipdl",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/jar-manifests/moz.build b/python/mozbuild/mozbuild/test/backend/data/jar-manifests/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/python/mozbuild/mozbuild/test/backend/data/jar-manifests/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/jar-manifests/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/moz.build
index f01a012760425..85d8c91d77da2 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/moz.build
@@ -9,3 +9,6 @@ DIRS += [
     "prog",
     "static",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/prog/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/prog/moz.build
index 3741f4be092ec..98581c49cfd3a 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/prog/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/prog/moz.build
@@ -9,3 +9,6 @@ USE_LIBS += [
     "bar",
     "baz",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/prog/qux/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/prog/qux/moz.build
index 3152de6211f83..a22870f9b9882 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/prog/qux/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/prog/qux/moz.build
@@ -4,3 +4,6 @@
 SOURCES += ["qux1.c"]
 
 SharedLibrary("qux")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/real/foo/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/real/foo/moz.build
index a0bd7526e63ca..68bbbfa3372ce 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/real/foo/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/real/foo/moz.build
@@ -4,3 +4,6 @@
 SOURCES += ["foo1.c", "foo2.c"]
 
 FINAL_LIBRARY = "foo"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/real/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/real/moz.build
index 32f9c1d656262..ed264ae9a4717 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/real/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/real/moz.build
@@ -12,3 +12,6 @@ OS_LIBS += ["-lbaz"]
 USE_LIBS += ["static:baz"]
 
 Library("foo")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/shared/baz/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/shared/baz/moz.build
index 3299fa28f41f9..561447ff8fa96 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/shared/baz/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/shared/baz/moz.build
@@ -4,3 +4,6 @@
 SOURCES += ["baz1.c"]
 
 FINAL_LIBRARY = "baz"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/shared/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/shared/moz.build
index 42d79fe1fd49e..b0f8f5e333b4f 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/shared/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/shared/moz.build
@@ -12,3 +12,6 @@ OS_LIBS += ["-lfoo"]
 USE_LIBS += ["qux"]
 
 SharedLibrary("baz")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/static/bar/bar_helper/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/static/bar/bar_helper/moz.build
index 12d0fc83fbf25..4d0e160be4ff5 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/static/bar/bar_helper/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/static/bar/bar_helper/moz.build
@@ -6,3 +6,6 @@ SOURCES += [
 ]
 
 FINAL_LIBRARY = "bar"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/static/bar/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/static/bar/moz.build
index d9d75803ed482..d306778f91d0f 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/static/bar/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/static/bar/moz.build
@@ -11,3 +11,6 @@ DIRS += [
 ]
 
 FINAL_LIBRARY = "bar"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/linkage/static/moz.build b/python/mozbuild/mozbuild/test/backend/data/linkage/static/moz.build
index 37b3d96cc71ce..93493c1494408 100644
--- a/python/mozbuild/mozbuild/test/backend/data/linkage/static/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/linkage/static/moz.build
@@ -10,3 +10,6 @@ USE_LIBS += ["foo"]
 OS_LIBS += ["-lbar"]
 
 Library("bar")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/local_includes/moz.build b/python/mozbuild/mozbuild/test/backend/data/local_includes/moz.build
index 1c29ac2ea2158..ed129e873e66b 100644
--- a/python/mozbuild/mozbuild/test/backend/data/local_includes/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/local_includes/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 LOCAL_INCLUDES += ["/bar/baz", "foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/localized-files/moz.build b/python/mozbuild/mozbuild/test/backend/data/localized-files/moz.build
index 93a97c7b8402c..0ce1f02c22d8b 100644
--- a/python/mozbuild/mozbuild/test/backend/data/localized-files/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/localized-files/moz.build
@@ -7,3 +7,6 @@ LOCALIZED_FILES += [
     "en-US/bar.ini",
     "en-US/foo.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/localized-generated-files-AB_CD/moz.build b/python/mozbuild/mozbuild/test/backend/data/localized-generated-files-AB_CD/moz.build
index 2b0cf472c9e7d..cdb616b1b4f6b 100644
--- a/python/mozbuild/mozbuild/test/backend/data/localized-generated-files-AB_CD/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/localized-generated-files-AB_CD/moz.build
@@ -30,3 +30,6 @@ bar.inputs = [
     "locales/en-US/localized-input",
     "non-localized-input",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/localized-generated-files-force/moz.build b/python/mozbuild/mozbuild/test/backend/data/localized-generated-files-force/moz.build
index 26fb165e068db..4341d0443f621 100644
--- a/python/mozbuild/mozbuild/test/backend/data/localized-generated-files-force/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/localized-generated-files-force/moz.build
@@ -20,3 +20,6 @@ abc.inputs = [
     "non-localized-input",
 ]
 abc.force = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/localized-generated-files/moz.build b/python/mozbuild/mozbuild/test/backend/data/localized-generated-files/moz.build
index f44325dfb1492..df205b3696e72 100644
--- a/python/mozbuild/mozbuild/test/backend/data/localized-generated-files/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/localized-generated-files/moz.build
@@ -13,3 +13,6 @@ foo.inputs = [
 
 # Also check that using it in LOCALIZED_FILES does the right thing.
 LOCALIZED_FILES += ["!foo.xyz"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/localized-pp-files/moz.build b/python/mozbuild/mozbuild/test/backend/data/localized-pp-files/moz.build
index 8cec207128568..f562a9bd45044 100644
--- a/python/mozbuild/mozbuild/test/backend/data/localized-pp-files/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/localized-pp-files/moz.build
@@ -6,3 +6,6 @@ LOCALIZED_PP_FILES += [
     "en-US/bar.ini",
     "en-US/foo.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-library/moz.build b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-library/moz.build
index 8e15d10c43003..bd107e583ef18 100644
--- a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-library/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-library/moz.build
@@ -5,3 +5,6 @@
 SharedLibrary("c_library")
 
 SOURCES = ["c-library.c"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-program/moz.build b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-program/moz.build
index 27f2cd3d5d056..acc22dc9ae579 100644
--- a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-program/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-program/moz.build
@@ -5,3 +5,6 @@
 Program("c_test_program")
 
 SOURCES = ["c_test_program.c"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-simple-programs/moz.build b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-simple-programs/moz.build
index db958d1d1f273..09374ccb31635 100644
--- a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-simple-programs/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/c-simple-programs/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 SimplePrograms(["c_simple_program"], ext=".c")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-library/moz.build b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-library/moz.build
index ee75ad0cb980f..e5f1c1bd57935 100644
--- a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-library/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-library/moz.build
@@ -8,3 +8,6 @@ SOURCES = [
     "c-source.c",
     "cxx-library.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-program/moz.build b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-program/moz.build
index 175f18c88ac58..507516872c6d9 100644
--- a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-program/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-program/moz.build
@@ -5,3 +5,6 @@
 Program("cxx_test_program")
 
 SOURCES = ["cxx_test_program.cpp"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-simple-programs/moz.build b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-simple-programs/moz.build
index e0553709007d1..0bee3b801da95 100644
--- a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-simple-programs/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/cxx-simple-programs/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 SimplePrograms(["cxx_simple_program"])
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/moz.build b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/moz.build
index 7f0a6b430bcb8..21843036c8e8e 100644
--- a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/moz.build
@@ -33,3 +33,6 @@ def SharedLibrary(name):
     Library(name)
 
     FORCE_SHARED_LIB = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/simple-programs/moz.build b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/simple-programs/moz.build
index 62966a58e127e..aac4845136869 100644
--- a/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/simple-programs/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/prog-lib-c-only/simple-programs/moz.build
@@ -1,3 +1,6 @@
 # -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
 # Any copyright is dedicated to the Public Domain.
 # http://creativecommons.org/publicdomain/zero/1.0/
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/program-paths/dist-bin/moz.build b/python/mozbuild/mozbuild/test/backend/data/program-paths/dist-bin/moz.build
index d8b952c0141a0..fef03a34a86cd 100644
--- a/python/mozbuild/mozbuild/test/backend/data/program-paths/dist-bin/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/program-paths/dist-bin/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 Program("dist-bin")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/program-paths/dist-subdir/moz.build b/python/mozbuild/mozbuild/test/backend/data/program-paths/dist-subdir/moz.build
index fc2f664c01d75..683084d7482e8 100644
--- a/python/mozbuild/mozbuild/test/backend/data/program-paths/dist-subdir/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/program-paths/dist-subdir/moz.build
@@ -3,3 +3,6 @@
 
 DIST_SUBDIR = "foo"
 Program("dist-subdir")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/program-paths/final-target/moz.build b/python/mozbuild/mozbuild/test/backend/data/program-paths/final-target/moz.build
index a0d580526280a..42ac37a2e1d12 100644
--- a/python/mozbuild/mozbuild/test/backend/data/program-paths/final-target/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/program-paths/final-target/moz.build
@@ -3,3 +3,6 @@
 
 FINAL_TARGET = "final/target"
 Program("final-target")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/program-paths/moz.build b/python/mozbuild/mozbuild/test/backend/data/program-paths/moz.build
index d1d087fd458f6..a2ebb15664dfb 100644
--- a/python/mozbuild/mozbuild/test/backend/data/program-paths/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/program-paths/moz.build
@@ -13,3 +13,6 @@ DIRS += [
     "final-target",
     "not-installed",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/program-paths/not-installed/moz.build b/python/mozbuild/mozbuild/test/backend/data/program-paths/not-installed/moz.build
index c725ab7326e27..03b721c3cd313 100644
--- a/python/mozbuild/mozbuild/test/backend/data/program-paths/not-installed/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/program-paths/not-installed/moz.build
@@ -3,3 +3,6 @@
 
 DIST_INSTALL = False
 Program("not-installed")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/resources/moz.build b/python/mozbuild/mozbuild/test/backend/data/resources/moz.build
index 619af26e64e41..16afa89b116e7 100644
--- a/python/mozbuild/mozbuild/test/backend/data/resources/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/resources/moz.build
@@ -7,3 +7,6 @@ RESOURCE_FILES.fonts += ["font1.ttf", "font2.ttf"]
 RESOURCE_FILES.fonts.desktop += ["desktop1.ttf", "desktop2.ttf"]
 RESOURCE_FILES.fonts.mobile += ["mobile.ttf"]
 RESOURCE_FILES.tests += ["extra.manifest", "test.manifest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/rust-library-features/moz.build b/python/mozbuild/mozbuild/test/backend/data/rust-library-features/moz.build
index f17f29b0e7a8f..eb204a49e3b2e 100644
--- a/python/mozbuild/mozbuild/test/backend/data/rust-library-features/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/rust-library-features/moz.build
@@ -18,3 +18,6 @@ def RustLibrary(name, features):
 
 
 RustLibrary("feature-library", ["musthave", "cantlivewithout"])
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/rust-library/moz.build b/python/mozbuild/mozbuild/test/backend/data/rust-library/moz.build
index b0f29a1ef522a..9e38c2172ce1a 100644
--- a/python/mozbuild/mozbuild/test/backend/data/rust-library/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/rust-library/moz.build
@@ -17,3 +17,6 @@ def RustLibrary(name):
 
 
 RustLibrary("test-library")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/rust-programs/code/moz.build b/python/mozbuild/mozbuild/test/backend/data/rust-programs/code/moz.build
index f0efdb3799e9c..98d1ca6b9d67c 100644
--- a/python/mozbuild/mozbuild/test/backend/data/rust-programs/code/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/rust-programs/code/moz.build
@@ -4,3 +4,6 @@
 
 RUST_PROGRAMS += ["target"]
 HOST_RUST_PROGRAMS += ["host"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/rust-programs/moz.build b/python/mozbuild/mozbuild/test/backend/data/rust-programs/moz.build
index cb635f6adb493..4bfda60026bc5 100644
--- a/python/mozbuild/mozbuild/test/backend/data/rust-programs/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/rust-programs/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS += ["code"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/sources/moz.build b/python/mozbuild/mozbuild/test/backend/data/sources/moz.build
index 40d5a8d38dbe9..c9cc963644d62 100644
--- a/python/mozbuild/mozbuild/test/backend/data/sources/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/sources/moz.build
@@ -24,3 +24,6 @@ SOURCES += ["titi.S", "toto.S"]
 
 WASM_SOURCES += ["bar.cpp"]
 WASM_SOURCES += ["baz.c"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/stub0/dir1/moz.build b/python/mozbuild/mozbuild/test/backend/data/stub0/dir1/moz.build
index 62966a58e127e..aac4845136869 100644
--- a/python/mozbuild/mozbuild/test/backend/data/stub0/dir1/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/stub0/dir1/moz.build
@@ -1,3 +1,6 @@
 # -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
 # Any copyright is dedicated to the Public Domain.
 # http://creativecommons.org/publicdomain/zero/1.0/
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/stub0/dir2/moz.build b/python/mozbuild/mozbuild/test/backend/data/stub0/dir2/moz.build
index 62966a58e127e..aac4845136869 100644
--- a/python/mozbuild/mozbuild/test/backend/data/stub0/dir2/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/stub0/dir2/moz.build
@@ -1,3 +1,6 @@
 # -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
 # Any copyright is dedicated to the Public Domain.
 # http://creativecommons.org/publicdomain/zero/1.0/
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/stub0/dir3/moz.build b/python/mozbuild/mozbuild/test/backend/data/stub0/dir3/moz.build
index 62966a58e127e..aac4845136869 100644
--- a/python/mozbuild/mozbuild/test/backend/data/stub0/dir3/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/stub0/dir3/moz.build
@@ -1,3 +1,6 @@
 # -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
 # Any copyright is dedicated to the Public Domain.
 # http://creativecommons.org/publicdomain/zero/1.0/
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/stub0/moz.build b/python/mozbuild/mozbuild/test/backend/data/stub0/moz.build
index 4f6e7cb318a1e..f89cf63fca135 100644
--- a/python/mozbuild/mozbuild/test/backend/data/stub0/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/stub0/moz.build
@@ -5,3 +5,6 @@
 DIRS += ["dir1"]
 DIRS += ["dir2"]
 TEST_DIRS += ["dir3"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/substitute_config_files/moz.build b/python/mozbuild/mozbuild/test/backend/data/substitute_config_files/moz.build
index bded13e07def9..56863fa7daa2c 100644
--- a/python/mozbuild/mozbuild/test/backend/data/substitute_config_files/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/substitute_config_files/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 CONFIGURE_SUBST_FILES = ["foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/test-manifest-shared-support/moz.build b/python/mozbuild/mozbuild/test/backend/data/test-manifest-shared-support/moz.build
index d28a244978919..280a0dc94154a 100644
--- a/python/mozbuild/mozbuild/test/backend/data/test-manifest-shared-support/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/test-manifest-shared-support/moz.build
@@ -3,3 +3,6 @@
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
 BROWSER_CHROME_MANIFESTS += ["child/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/test-manifests-backend-sources/moz.build b/python/mozbuild/mozbuild/test/backend/data/test-manifests-backend-sources/moz.build
index f9bb774449852..176bfd60024a0 100644
--- a/python/mozbuild/mozbuild/test/backend/data/test-manifests-backend-sources/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/test-manifests-backend-sources/moz.build
@@ -4,3 +4,6 @@
 MOCHITEST_MANIFESTS += [
     "mochitest.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/test-manifests-duplicate-support-files/moz.build b/python/mozbuild/mozbuild/test/backend/data/test-manifests-duplicate-support-files/moz.build
index 1723f844ca06f..8c24467a4120c 100644
--- a/python/mozbuild/mozbuild/test/backend/data/test-manifests-duplicate-support-files/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/test-manifests-duplicate-support-files/moz.build
@@ -5,3 +5,6 @@ MOCHITEST_MANIFESTS += [
     "mochitest1.toml",
     "mochitest2.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/test-manifests-package-tests/moz.build b/python/mozbuild/mozbuild/test/backend/data/test-manifests-package-tests/moz.build
index 64b41ad939666..015b08966f019 100644
--- a/python/mozbuild/mozbuild/test/backend/data/test-manifests-package-tests/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/test-manifests-package-tests/moz.build
@@ -8,3 +8,6 @@ MOCHITEST_MANIFESTS += [
 ANDROID_INSTRUMENTATION_MANIFESTS += [
     "instrumentation.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/test-manifests-written/moz.build b/python/mozbuild/mozbuild/test/backend/data/test-manifests-written/moz.build
index db63557f94f4f..108307a989466 100644
--- a/python/mozbuild/mozbuild/test/backend/data/test-manifests-written/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/test-manifests-written/moz.build
@@ -7,3 +7,6 @@ XPCSHELL_TESTS_MANIFESTS += [
 ]
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/moz.build b/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/moz.build
index eb83fd1826b91..d3be791d033e0 100644
--- a/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS += ["test", "src"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/src/moz.build b/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/src/moz.build
index 69cde19c29f55..5973d4f07f005 100644
--- a/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/src/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/src/moz.build
@@ -10,3 +10,6 @@ def Library(name):
 
 
 Library("foo")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/test/moz.build b/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/test/moz.build
index a43f4083b3d00..e38ddedb57f70 100644
--- a/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/test/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/test-support-binaries-tracked/test/moz.build
@@ -30,3 +30,6 @@ def HostLibrary(name):
 Library("test-library")
 HostLibrary("host-test-library")
 SimplePrograms(["test-one", "test-two"])
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/test_config/moz.build b/python/mozbuild/mozbuild/test/backend/data/test_config/moz.build
index 5cf4c78f90c4e..b9fcb2175ff4e 100644
--- a/python/mozbuild/mozbuild/test/backend/data/test_config/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/test_config/moz.build
@@ -1,3 +1,6 @@
 CONFIGURE_SUBST_FILES = [
     "file",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/variable_passthru/moz.build b/python/mozbuild/mozbuild/test/backend/data/variable_passthru/moz.build
index 81595d2db3836..51b3697904a15 100644
--- a/python/mozbuild/mozbuild/test/backend/data/variable_passthru/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/variable_passthru/moz.build
@@ -9,3 +9,6 @@ RCINCLUDE = "bar.rc"
 DEFFILE = "baz.def"
 
 WIN32_EXE_LDFLAGS += ["-subsystem:console"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/visual-studio/dir1/moz.build b/python/mozbuild/mozbuild/test/backend/data/visual-studio/dir1/moz.build
index ae1fc0c370ca3..fe0b054e1014d 100644
--- a/python/mozbuild/mozbuild/test/backend/data/visual-studio/dir1/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/visual-studio/dir1/moz.build
@@ -7,3 +7,6 @@ SOURCES += ["bar.cpp", "foo.cpp"]
 LOCAL_INCLUDES += ["/includeA/foo"]
 DEFINES["DEFINEFOO"] = True
 DEFINES["DEFINEBAR"] = "bar"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/visual-studio/moz.build b/python/mozbuild/mozbuild/test/backend/data/visual-studio/moz.build
index a0a888fa01c42..f478ccf1cfe83 100644
--- a/python/mozbuild/mozbuild/test/backend/data/visual-studio/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/visual-studio/moz.build
@@ -5,3 +5,6 @@
 DIRS += ["dir1"]
 
 Library("test")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/backend/data/xpidl/moz.build b/python/mozbuild/mozbuild/test/backend/data/xpidl/moz.build
index df521ac7c5eb9..6d133214742c8 100644
--- a/python/mozbuild/mozbuild/test/backend/data/xpidl/moz.build
+++ b/python/mozbuild/mozbuild/test/backend/data/xpidl/moz.build
@@ -4,3 +4,6 @@
 
 XPIDL_MODULE = "my_module"
 XPIDL_SOURCES = ["bar.idl", "foo.idl"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/allow-compiler-warnings/moz.build b/python/mozbuild/mozbuild/test/frontend/data/allow-compiler-warnings/moz.build
index 0bf5b55ecb6ef..d953abf73f3e6 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/allow-compiler-warnings/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/allow-compiler-warnings/moz.build
@@ -18,3 +18,6 @@ Library("dummy")
 UNIFIED_SOURCES += ["test1.c"]
 
 AllowCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/asflags/moz.build b/python/mozbuild/mozbuild/test/frontend/data/asflags/moz.build
index 80f48a7d81659..fe846c29e8736 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/asflags/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/asflags/moz.build
@@ -13,3 +13,6 @@ Library("dummy")
 SOURCES += ["test1.c", "test2.S"]
 
 ASFLAGS += ["-no-integrated-as"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/branding-files/moz.build b/python/mozbuild/mozbuild/test/frontend/data/branding-files/moz.build
index 65f22d578b22c..f8dcc3af1454d 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/branding-files/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/branding-files/moz.build
@@ -10,3 +10,6 @@ BRANDING_FILES += [
 BRANDING_FILES.icons += [
     "quux.icns",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/compile-defines/moz.build b/python/mozbuild/mozbuild/test/frontend/data/compile-defines/moz.build
index 65d71dae2b215..b9f708f2d6438 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/compile-defines/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/compile-defines/moz.build
@@ -14,3 +14,6 @@ UNIFIED_SOURCES += ["test1.c"]
 
 DEFINES["MOZ_TEST_DEFINE"] = True
 LIBRARY_DEFINES["MOZ_LIBRARY_DEFINE"] = "MOZ_TEST"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/compile-flags-field-validation/moz.build b/python/mozbuild/mozbuild/test/frontend/data/compile-flags-field-validation/moz.build
index 70622bc4e1521..f53ff07673a95 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/compile-flags-field-validation/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/compile-flags-field-validation/moz.build
@@ -13,3 +13,6 @@ Library("dummy")
 COMPILE_FLAGS["STL_FLAGS"] = []
 
 UNIFIED_SOURCES += ["test1.c"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/compile-flags-templates/moz.build b/python/mozbuild/mozbuild/test/frontend/data/compile-flags-templates/moz.build
index 6e611fc59825d..9c16b09cceb33 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/compile-flags-templates/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/compile-flags-templates/moz.build
@@ -25,3 +25,6 @@ UNIFIED_SOURCES += ["test1.c"]
 
 DisableStlWrapping()
 NoVisibilityFlags()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/compile-flags-type-validation/moz.build b/python/mozbuild/mozbuild/test/frontend/data/compile-flags-type-validation/moz.build
index 31094736a7e83..d0516faf2501e 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/compile-flags-type-validation/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/compile-flags-type-validation/moz.build
@@ -13,3 +13,6 @@ Library("dummy")
 COMPILE_FLAGS["STL"] = [None, 123]
 
 UNIFIED_SOURCES += ["test1.c"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/compile-flags/moz.build b/python/mozbuild/mozbuild/test/frontend/data/compile-flags/moz.build
index 0e6f75cfa134e..978794d98363e 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/compile-flags/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/compile-flags/moz.build
@@ -20,3 +20,6 @@ UNIFIED_SOURCES += ["test1.c"]
 
 CXXFLAGS += ["-funroll-loops", "-Wall"]
 CFLAGS += ["-Wall", "-funroll-loops"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/compile-includes/moz.build b/python/mozbuild/mozbuild/test/frontend/data/compile-includes/moz.build
index 10c28e2833f53..b3933addad57a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/compile-includes/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/compile-includes/moz.build
@@ -13,3 +13,6 @@ Library("dummy")
 UNIFIED_SOURCES += ["test1.c"]
 
 LOCAL_INCLUDES += ["subdir"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/config-file-substitution/moz.build b/python/mozbuild/mozbuild/test/frontend/data/config-file-substitution/moz.build
index f42dc0a517fd3..38a73d84a83be 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/config-file-substitution/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/config-file-substitution/moz.build
@@ -4,3 +4,6 @@
 
 CONFIGURE_SUBST_FILES += ["foo"]
 CONFIGURE_SUBST_FILES += ["bar"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/crate-dependency-path-resolution/moz.build b/python/mozbuild/mozbuild/test/frontend/data/crate-dependency-path-resolution/moz.build
index de1967c519e22..151c5174df6e3 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/crate-dependency-path-resolution/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/crate-dependency-path-resolution/moz.build
@@ -17,3 +17,6 @@ def RustLibrary(name):
 
 
 RustLibrary("random-crate")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/defines/moz.build b/python/mozbuild/mozbuild/test/frontend/data/defines/moz.build
index 6085619c58deb..97ad9f0ccd1a9 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/defines/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/defines/moz.build
@@ -7,3 +7,6 @@ DEFINES["BAZ"] = '"abcd"'
 DEFINES["BAR"] = 7
 DEFINES["VALUE"] = value
 DEFINES["QUX"] = False
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/disable-compiler-warnings/moz.build b/python/mozbuild/mozbuild/test/frontend/data/disable-compiler-warnings/moz.build
index 064fa0989332d..10bd002dc324d 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/disable-compiler-warnings/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/disable-compiler-warnings/moz.build
@@ -18,3 +18,6 @@ Library("dummy")
 UNIFIED_SOURCES += ["test1.c"]
 
 DisableCompilerWarnings()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/disable-stl-wrapping/moz.build b/python/mozbuild/mozbuild/test/frontend/data/disable-stl-wrapping/moz.build
index 40cb3e778117b..8703f37e8e87d 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/disable-stl-wrapping/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/disable-stl-wrapping/moz.build
@@ -19,3 +19,6 @@ def DisableStlWrapping():
 UNIFIED_SOURCES += ["test1.c"]
 
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/dist-files-missing/moz.build b/python/mozbuild/mozbuild/test/frontend/data/dist-files-missing/moz.build
index 25961f149f317..51d56895c5e73 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/dist-files-missing/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/dist-files-missing/moz.build
@@ -6,3 +6,6 @@ FINAL_TARGET_PP_FILES += [
     "install.rdf",
     "main.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/dist-files/moz.build b/python/mozbuild/mozbuild/test/frontend/data/dist-files/moz.build
index 25961f149f317..51d56895c5e73 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/dist-files/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/dist-files/moz.build
@@ -6,3 +6,6 @@ FINAL_TARGET_PP_FILES += [
     "install.rdf",
     "main.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/exports-generated/moz.build b/python/mozbuild/mozbuild/test/frontend/data/exports-generated/moz.build
index bd3507c97b48c..a8b9e84811832 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/exports-generated/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/exports-generated/moz.build
@@ -6,3 +6,6 @@ EXPORTS.mozilla += ["mozilla1.h"]
 EXPORTS.mozilla += ["!mozilla2.h"]
 
 GENERATED_FILES += ["mozilla2.h"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/exports-missing-generated/moz.build b/python/mozbuild/mozbuild/test/frontend/data/exports-missing-generated/moz.build
index d81109d37d114..902f62c05aacc 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/exports-missing-generated/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/exports-missing-generated/moz.build
@@ -3,3 +3,6 @@
 
 EXPORTS += ["foo.h"]
 EXPORTS += ["!bar.h"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/exports-missing/moz.build b/python/mozbuild/mozbuild/test/frontend/data/exports-missing/moz.build
index 3f94fbdccdccc..2f29ced3f7f24 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/exports-missing/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/exports-missing/moz.build
@@ -4,3 +4,6 @@
 EXPORTS += ["foo.h"]
 EXPORTS.mozilla += ["mozilla1.h"]
 EXPORTS.mozilla += ["mozilla2.h"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/exports/moz.build b/python/mozbuild/mozbuild/test/frontend/data/exports/moz.build
index 64253b1cf0080..e12752c87eb09 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/exports/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/exports/moz.build
@@ -11,3 +11,6 @@ EXPORTS.mozilla.gfx += ["gfx.h"]
 EXPORTS.vpx = ["mem.h"]
 EXPORTS.vpx += ["mem2.h"]
 EXPORTS.nspr.private = ["pprio.h", "pprthred.h"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/bad-assignment/moz.build b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/bad-assignment/moz.build
index 693b6cc96206e..d706d97e9413c 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/bad-assignment/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/bad-assignment/moz.build
@@ -1,2 +1,5 @@
 with Files("*"):
     BUG_COMPONENT = "bad value"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/different-matchers/moz.build b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/different-matchers/moz.build
index ca5c74fd6abe8..f8edd9c80f67f 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/different-matchers/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/different-matchers/moz.build
@@ -2,3 +2,6 @@ with Files("*.jsm"):
     BUG_COMPONENT = ("Firefox", "JS")
 with Files("*.cpp"):
     BUG_COMPONENT = ("Firefox", "C++")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/final/moz.build b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/final/moz.build
index 9b1d05a9b008c..56f3967a4cc88 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/final/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/final/moz.build
@@ -1,3 +1,6 @@
 with Files("**/Makefile.in"):
     BUG_COMPONENT = ("Firefox Build System", "General")
     FINAL = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/final/subcomponent/moz.build b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/final/subcomponent/moz.build
index 9b2152981219e..e2b532b7bbb33 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/final/subcomponent/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/final/subcomponent/moz.build
@@ -1,2 +1,5 @@
 with Files("**"):
     BUG_COMPONENT = ("Another", "Component")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/moz.build b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/moz.build
index 4bbca3dc09aa3..7eb3042e4366a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/moz.build
@@ -1,2 +1,5 @@
 with Files("**"):
     BUG_COMPONENT = ("default_product", "default_component")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/simple/moz.build b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/simple/moz.build
index e8b99df68d3e3..c4e45df44001f 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/simple/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/simple/moz.build
@@ -1,2 +1,5 @@
 with Files("*"):
     BUG_COMPONENT = ("Firefox Build System", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/static/moz.build b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/static/moz.build
index 49acf291968bb..280a22ff1902d 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/static/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/files-info/bug_component/static/moz.build
@@ -3,3 +3,6 @@ with Files("foo"):
 
 with Files("bar"):
     BUG_COMPONENT = ("BarProduct", "BarComponent")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/files-info/moz.build b/python/mozbuild/mozbuild/test/frontend/data/files-info/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/files-info/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/files-info/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/final-target-pp-files-non-srcdir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/final-target-pp-files-non-srcdir/moz.build
index 67e5fb5dceec3..a41c4d6ae1608 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/final-target-pp-files-non-srcdir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/final-target-pp-files-non-srcdir/moz.build
@@ -5,3 +5,6 @@
 FINAL_TARGET_PP_FILES += [
     "!foo.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/generated-files-absolute-script/moz.build b/python/mozbuild/mozbuild/test/frontend/data/generated-files-absolute-script/moz.build
index 860f025eac0cf..f55686a66ebaa 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/generated-files-absolute-script/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/generated-files-absolute-script/moz.build
@@ -7,3 +7,6 @@ GENERATED_FILES += ["bar.c"]
 bar = GENERATED_FILES["bar.c"]
 bar.script = "/script.py:make_bar"
 bar.inputs = []
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/generated-files-force/moz.build b/python/mozbuild/mozbuild/test/frontend/data/generated-files-force/moz.build
index 33f54a17e8ab1..898167813934b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/generated-files-force/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/generated-files-force/moz.build
@@ -9,3 +9,6 @@ GENERATED_FILES += [
 ]
 GENERATED_FILES["bar.c"].force = True
 GENERATED_FILES["foo.c"].force = False
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/generated-files-method-names/moz.build b/python/mozbuild/mozbuild/test/frontend/data/generated-files-method-names/moz.build
index 298513383ba5b..9c98af7ea5969 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/generated-files-method-names/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/generated-files-method-names/moz.build
@@ -11,3 +11,6 @@ bar.inputs = []
 foo = GENERATED_FILES["foo.c"]
 foo.script = "script.py"
 foo.inputs = []
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-inputs/moz.build b/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-inputs/moz.build
index 50f703c696e33..5c55edc413870 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-inputs/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-inputs/moz.build
@@ -7,3 +7,6 @@ GENERATED_FILES += ["bar.c", "foo.c"]
 foo = GENERATED_FILES["foo.c"]
 foo.script = "script.py"
 foo.inputs = ["datafile"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-python-script/moz.build b/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-python-script/moz.build
index ebdb7bfaf5518..cc33a4b5afc5e 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-python-script/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-python-script/moz.build
@@ -6,3 +6,6 @@ GENERATED_FILES += ["bar.c", "foo.c"]
 
 bar = GENERATED_FILES["bar.c"]
 bar.script = "script.rb"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-script/moz.build b/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-script/moz.build
index 258a0f2325a57..719b647f179a9 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-script/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/generated-files-no-script/moz.build
@@ -6,3 +6,6 @@ GENERATED_FILES += ["bar.c", "foo.c"]
 
 bar = GENERATED_FILES["bar.c"]
 bar.script = "nonexistent-script.py"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/generated-files/moz.build b/python/mozbuild/mozbuild/test/frontend/data/generated-files/moz.build
index 97267c5d26092..02ff522cc59a5 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/generated-files/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/generated-files/moz.build
@@ -7,3 +7,6 @@ GENERATED_FILES += [
     "foo.c",
     ("xpidllex.py", "xpidlyacc.py"),
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/generated-sources/moz.build b/python/mozbuild/mozbuild/test/frontend/data/generated-sources/moz.build
index e305d9d32f2e9..c34625cb9e44b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/generated-sources/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/generated-sources/moz.build
@@ -37,3 +37,6 @@ SOURCES += [
     "!h.s",
     "!i.asm",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/generated_includes/moz.build b/python/mozbuild/mozbuild/test/frontend/data/generated_includes/moz.build
index 31f9042c0a2d3..320b40f9ac60f 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/generated_includes/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/generated_includes/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 LOCAL_INCLUDES += ["!/bar/baz", "!foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-compile-flags/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-compile-flags/moz.build
index 4225234c65b8d..5990e39c25765 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-compile-flags/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-compile-flags/moz.build
@@ -20,3 +20,6 @@ HOST_DEFINES["VALUE"] = value
 HOST_DEFINES["QUX"] = False
 
 HOST_CFLAGS += ["-funroll-loops", "-host-arg"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/final-target/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/final-target/moz.build
index a2136749dce83..e47a35fa19d5e 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/final-target/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/final-target/moz.build
@@ -3,3 +3,6 @@
 
 FINAL_TARGET = "final/target"
 HostProgram("final-target")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/installed/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/installed/moz.build
index 0d10d35508fc4..4c3adb0af5c0b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/installed/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/installed/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 HostProgram("dist-host-bin")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/moz.build
index ef9175fa54e36..842cd7351ba2f 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/moz.build
@@ -12,3 +12,6 @@ DIRS += [
     "installed",
     "not-installed",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/not-installed/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/not-installed/moz.build
index 4a8451bc8ffe9..ade24091f9c1d 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/not-installed/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-program-paths/not-installed/moz.build
@@ -3,3 +3,6 @@
 
 DIST_INSTALL = False
 HostProgram("not-installed")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-rust-libraries/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-rust-libraries/moz.build
index 37b6728ae39ae..d5a9d239f2ab9 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-rust-libraries/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-rust-libraries/moz.build
@@ -20,3 +20,6 @@ def HostRustLibrary(name, features=None):
 
 
 HostRustLibrary("host-lib")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-rust-program-no-cargo-toml/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-rust-program-no-cargo-toml/moz.build
index c60e731d99171..c3aaaf6463ff2 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-rust-program-no-cargo-toml/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-rust-program-no-cargo-toml/moz.build
@@ -1 +1,4 @@
 HOST_RUST_PROGRAMS += ["none"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-rust-program-nonexistent-name/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-rust-program-nonexistent-name/moz.build
index c60e731d99171..c3aaaf6463ff2 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-rust-program-nonexistent-name/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-rust-program-nonexistent-name/moz.build
@@ -1 +1,4 @@
 HOST_RUST_PROGRAMS += ["none"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-rust-programs/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-rust-programs/moz.build
index 2d75958b074bf..3116acf08cfa9 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-rust-programs/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-rust-programs/moz.build
@@ -1 +1,4 @@
 HOST_RUST_PROGRAMS += ["some"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/host-sources/moz.build b/python/mozbuild/mozbuild/test/frontend/data/host-sources/moz.build
index b1f5b98039c9f..1dc561a07f637 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/host-sources/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/host-sources/moz.build
@@ -25,3 +25,6 @@ HOST_SOURCES += [
     "e.mm",
     "f.mm",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/include-basic/moz.build b/python/mozbuild/mozbuild/test/frontend/data/include-basic/moz.build
index b8e37c69ea2ba..64791eed598e3 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/include-basic/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/include-basic/moz.build
@@ -5,3 +5,6 @@
 DIRS = ["foo"]
 
 include("included.build")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/include-file-stack/moz.build b/python/mozbuild/mozbuild/test/frontend/data/include-file-stack/moz.build
index def43513c7a01..df99f6fac0fae 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/include-file-stack/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/include-file-stack/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 include("included-1.build")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/include-missing/moz.build b/python/mozbuild/mozbuild/test/frontend/data/include-missing/moz.build
index 34129f7c93cec..2b181d5c6983a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/include-missing/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/include-missing/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 include("missing.build")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/include-topsrcdir-relative/moz.build b/python/mozbuild/mozbuild/test/frontend/data/include-topsrcdir-relative/moz.build
index 879b832ed86e7..3f2f853e6e5c0 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/include-topsrcdir-relative/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/include-topsrcdir-relative/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 include("/sibling.build")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/bar/moz.build b/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/bar/moz.build
index 568f361a54234..e0a4b0d541f38 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/bar/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/bar/moz.build
@@ -3,3 +3,6 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/foo/baz/moz.build b/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/foo/baz/moz.build
index 9c392681c73cf..6af962642f9e4 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/foo/baz/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/foo/baz/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 XPIDL_MODULE = "baz"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/foo/moz.build b/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/foo/moz.build
index f3368867ad71a..704d4f56362d0 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/foo/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/foo/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["baz"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/moz.build b/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/moz.build
index 169e9d155423e..4486c0807d8f7 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/inheriting-variables/moz.build
@@ -8,3 +8,6 @@ XPIDL_MODULE = "foobar"
 export("XPIDL_MODULE")
 
 DIRS += ["foo", "bar"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/bar/moz.build b/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/bar/moz.build
index b49ec1216bcf9..3170a85227e8e 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/bar/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/bar/moz.build
@@ -12,3 +12,6 @@ IPDL_SOURCES += [
     "bar.ipdl",
     "bar2.ipdlh",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/foo/moz.build b/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/foo/moz.build
index c2e891572bc98..40edc993bc3e8 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/foo/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/foo/moz.build
@@ -12,3 +12,6 @@ IPDL_SOURCES += [
     "foo.ipdl",
     "foo2.ipdlh",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/moz.build b/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/moz.build
index 9fe769951942b..32c2b2373abc9 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/ipdl_sources/moz.build
@@ -8,3 +8,6 @@ DIRS += [
     "bar",
     "foo",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/jar-manifests-multiple-files/moz.build b/python/mozbuild/mozbuild/test/frontend/data/jar-manifests-multiple-files/moz.build
index fa61c94006eab..19db488b4ef78 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/jar-manifests-multiple-files/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/jar-manifests-multiple-files/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn", "other.jar"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/jar-manifests/moz.build b/python/mozbuild/mozbuild/test/frontend/data/jar-manifests/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/jar-manifests/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/jar-manifests/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/library-defines/liba/moz.build b/python/mozbuild/mozbuild/test/frontend/data/library-defines/liba/moz.build
index 65fcc6d08e208..8fb7a7e54cd90 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/library-defines/liba/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/library-defines/liba/moz.build
@@ -3,3 +3,6 @@
 
 Library("liba")
 LIBRARY_DEFINES["IN_LIBA"] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/library-defines/libb/moz.build b/python/mozbuild/mozbuild/test/frontend/data/library-defines/libb/moz.build
index f4cf7b31a06d4..a5eef02274f73 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/library-defines/libb/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/library-defines/libb/moz.build
@@ -5,3 +5,6 @@ Library("libb")
 FINAL_LIBRARY = "liba"
 LIBRARY_DEFINES["IN_LIBB"] = True
 USE_LIBS += ["libd"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/library-defines/libc/moz.build b/python/mozbuild/mozbuild/test/frontend/data/library-defines/libc/moz.build
index 022a67559d1c2..f8d2458be7632 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/library-defines/libc/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/library-defines/libc/moz.build
@@ -3,3 +3,6 @@
 
 Library("libc")
 FINAL_LIBRARY = "libb"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/library-defines/libd/moz.build b/python/mozbuild/mozbuild/test/frontend/data/library-defines/libd/moz.build
index 0bd94be069305..c365743c38b08 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/library-defines/libd/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/library-defines/libd/moz.build
@@ -3,3 +3,6 @@
 
 Library("libd")
 FORCE_STATIC_LIB = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/library-defines/moz.build b/python/mozbuild/mozbuild/test/frontend/data/library-defines/moz.build
index dcc955cf28243..13db93dd690e5 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/library-defines/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/library-defines/moz.build
@@ -9,3 +9,6 @@ def Library(name):
 
 
 DIRS = ["liba", "libb", "libc", "libd"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/link-flags/moz.build b/python/mozbuild/mozbuild/test/frontend/data/link-flags/moz.build
index 9e25efdcbff50..f2e87c4522403 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/link-flags/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/link-flags/moz.build
@@ -14,3 +14,6 @@ UNIFIED_SOURCES += ["test1.c"]
 
 LDFLAGS += ["-Wl,-U_foo"]
 LDFLAGS += ["-framework Foo", "-x"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/local_includes-filename/moz.build b/python/mozbuild/mozbuild/test/frontend/data/local_includes-filename/moz.build
index 70259db75b409..90018995d4912 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/local_includes-filename/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/local_includes-filename/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 LOCAL_INCLUDES += ["foo.h"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/local_includes-invalid/objdir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/local_includes-invalid/objdir/moz.build
index 6dcbab537d54d..d3d9406afc96d 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/local_includes-invalid/objdir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/local_includes-invalid/objdir/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 LOCAL_INCLUDES += ["!/"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/local_includes-invalid/srcdir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/local_includes-invalid/srcdir/moz.build
index 6d8f6cd2af0e4..97b606ab170cf 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/local_includes-invalid/srcdir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/local_includes-invalid/srcdir/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 LOCAL_INCLUDES += ["/"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/local_includes/moz.build b/python/mozbuild/mozbuild/test/frontend/data/local_includes/moz.build
index 1c29ac2ea2158..ed129e873e66b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/local_includes/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/local_includes/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 LOCAL_INCLUDES += ["/bar/baz", "foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/localized-files-from-generated/moz.build b/python/mozbuild/mozbuild/test/frontend/data/localized-files-from-generated/moz.build
index 491a02641971b..0e619399f9ad5 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/localized-files-from-generated/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/localized-files-from-generated/moz.build
@@ -4,3 +4,6 @@
 
 LOCALIZED_GENERATED_FILES += ["abc.ini"]
 LOCALIZED_FILES += ["!abc.ini"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/localized-files-no-en-us/moz.build b/python/mozbuild/mozbuild/test/frontend/data/localized-files-no-en-us/moz.build
index 5c3efc8117a80..40d0d6be1453d 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/localized-files-no-en-us/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/localized-files-no-en-us/moz.build
@@ -7,3 +7,6 @@ LOCALIZED_FILES.foo += [
     "foo.js",
     "inner/locales/en-US/bar.ini",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/localized-files-not-localized-generated/moz.build b/python/mozbuild/mozbuild/test/frontend/data/localized-files-not-localized-generated/moz.build
index 678f503174289..3b10a7e05e502 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/localized-files-not-localized-generated/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/localized-files-not-localized-generated/moz.build
@@ -4,3 +4,6 @@
 
 GENERATED_FILES += ["abc.ini"]
 LOCALIZED_FILES += ["!abc.ini"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/localized-files/moz.build b/python/mozbuild/mozbuild/test/frontend/data/localized-files/moz.build
index 25a903088154f..949bf2f58361f 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/localized-files/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/localized-files/moz.build
@@ -7,3 +7,6 @@ LOCALIZED_FILES.foo += [
     "en-US/code/*.js",
     "en-US/foo.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files-final-target-files/moz.build b/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files-final-target-files/moz.build
index 48acff144732b..2d6633fb2dfa8 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files-final-target-files/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files-final-target-files/moz.build
@@ -4,3 +4,6 @@
 
 LOCALIZED_GENERATED_FILES += ["abc.ini"]
 FINAL_TARGET_FILES += ["!abc.ini"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files-force/moz.build b/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files-force/moz.build
index 73685545de8be..1a21a5def9cca 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files-force/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files-force/moz.build
@@ -4,3 +4,6 @@
 
 LOCALIZED_GENERATED_FILES += ["abc.ini", ("bar", "baz")]
 LOCALIZED_GENERATED_FILES["abc.ini"].force = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files/moz.build b/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files/moz.build
index cc306d5991a7c..529cc42739ec5 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/localized-generated-files/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 LOCALIZED_GENERATED_FILES += ["abc.ini", ("bar", "baz")]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/localized-pp-files/moz.build b/python/mozbuild/mozbuild/test/frontend/data/localized-pp-files/moz.build
index b2916a1226a3e..0eb2de447b215 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/localized-pp-files/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/localized-pp-files/moz.build
@@ -6,3 +6,6 @@ LOCALIZED_PP_FILES.foo += [
     "en-US/bar.ini",
     "en-US/foo.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/missing-local-includes/moz.build b/python/mozbuild/mozbuild/test/frontend/data/missing-local-includes/moz.build
index 1c29ac2ea2158..ed129e873e66b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/missing-local-includes/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/missing-local-includes/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 LOCAL_INCLUDES += ["/bar/baz", "foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/missing-xpidl/moz.build b/python/mozbuild/mozbuild/test/frontend/data/missing-xpidl/moz.build
index e3a2a69d07e98..5c2c5af98abb6 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/missing-xpidl/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/missing-xpidl/moz.build
@@ -4,3 +4,6 @@
 
 XPIDL_MODULE = "my_module"
 XPIDL_SOURCES = ["nonexistant.idl"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/moz.build b/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/moz.build
index 7956580d144fb..2eac9bad18352 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/moz.build
@@ -27,3 +27,6 @@ USE_LIBS += [
     "rust1",
     "rust2",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/rust1/moz.build b/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/rust1/moz.build
index 0cc01e1e24ff8..60593701958bb 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/rust1/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/rust1/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 RustLibrary("rust1")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/rust2/moz.build b/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/rust2/moz.build
index 4ec4ea9c7939c..397774c131b36 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/rust2/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/multiple-rust-libraries/rust2/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 RustLibrary("rust2")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/1/moz.build b/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/1/moz.build
index 44610a781ca6d..b74ac40fd1ed8 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/1/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/1/moz.build
@@ -2,3 +2,6 @@ SOURCES += [
     "Test.c",
     "Test.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/2/moz.build b/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/2/moz.build
index b1064ae0c0b73..63d17e4ba1155 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/2/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/2/moz.build
@@ -2,3 +2,6 @@ SOURCES += [
     "subdir/Test.cpp",
     "Test.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/3/moz.build b/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/3/moz.build
index a225907caeeec..da3a145221fde 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/3/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/3/moz.build
@@ -5,3 +5,6 @@ SOURCES += [
 UNIFIED_SOURCES += [
     "Test.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/4/moz.build b/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/4/moz.build
index ea5da28d887f8..80d18d0d06446 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/4/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/object-conflicts/4/moz.build
@@ -2,3 +2,6 @@ UNIFIED_SOURCES += [
     "Test.c",
     "Test.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/program-paths/dist-bin/moz.build b/python/mozbuild/mozbuild/test/frontend/data/program-paths/dist-bin/moz.build
index d8b952c0141a0..fef03a34a86cd 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/program-paths/dist-bin/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/program-paths/dist-bin/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 Program("dist-bin")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/program-paths/dist-subdir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/program-paths/dist-subdir/moz.build
index fc2f664c01d75..683084d7482e8 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/program-paths/dist-subdir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/program-paths/dist-subdir/moz.build
@@ -3,3 +3,6 @@
 
 DIST_SUBDIR = "foo"
 Program("dist-subdir")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/program-paths/final-target/moz.build b/python/mozbuild/mozbuild/test/frontend/data/program-paths/final-target/moz.build
index a0d580526280a..42ac37a2e1d12 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/program-paths/final-target/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/program-paths/final-target/moz.build
@@ -3,3 +3,6 @@
 
 FINAL_TARGET = "final/target"
 Program("final-target")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/program-paths/moz.build b/python/mozbuild/mozbuild/test/frontend/data/program-paths/moz.build
index d1d087fd458f6..a2ebb15664dfb 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/program-paths/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/program-paths/moz.build
@@ -13,3 +13,6 @@ DIRS += [
     "final-target",
     "not-installed",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/program-paths/not-installed/moz.build b/python/mozbuild/mozbuild/test/frontend/data/program-paths/not-installed/moz.build
index c725ab7326e27..03b721c3cd313 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/program-paths/not-installed/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/program-paths/not-installed/moz.build
@@ -3,3 +3,6 @@
 
 DIST_INSTALL = False
 Program("not-installed")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/program/moz.build b/python/mozbuild/mozbuild/test/frontend/data/program/moz.build
index b3f70627328bd..3fd8d0541e863 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/program/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/program/moz.build
@@ -16,3 +16,6 @@ def SimplePrograms(names, ext=".cpp"):
 Program("test_program")
 
 SimplePrograms(["test_program1", "test_program2"])
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-bad-dir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-bad-dir/moz.build
index 68581574b152b..795af274ae460 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-bad-dir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-bad-dir/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = ["foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-basic/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-basic/moz.build
index 0a91c4692b69e..fa78996e1c2ee 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-basic/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-basic/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 ILLEGAL = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-empty-list/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-empty-list/moz.build
index 4dfba1c60fddf..2b3ac8993c148 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-empty-list/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-empty-list/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = []
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-error-func/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-error-func/moz.build
index d0f35c4c1d45b..25fa8a5cd9861 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-error-func/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-error-func/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 error("Some error.")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-included-from/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-included-from/moz.build
index 603f3a7204a12..07b9e581d674a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-included-from/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-included-from/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 include("child.build")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-missing-include/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-missing-include/moz.build
index 34129f7c93cec..2b181d5c6983a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-missing-include/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-missing-include/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 include("missing.build")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-outside-topsrcdir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-outside-topsrcdir/moz.build
index 040c1f5df12ac..88ec2bc5128fe 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-outside-topsrcdir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-outside-topsrcdir/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 include("../include-basic/moz.build")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-read-unknown-global/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-read-unknown-global/moz.build
index 6fc10f766a762..2b438eed3e328 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-read-unknown-global/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-read-unknown-global/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 l = FOO
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-repeated-dir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-repeated-dir/moz.build
index 91845b337fa14..a10f23d66c7d3 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-repeated-dir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-repeated-dir/moz.build
@@ -5,3 +5,6 @@
 DIRS = ["foo"]
 
 DIRS += ["foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-script-error/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-script-error/moz.build
index a91d38b415cdc..bfddfbe42f5fe 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-script-error/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-script-error/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 foo = True + None
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-syntax/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-syntax/moz.build
index 70a0d2c066670..0ab04b8e8f085 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-syntax/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-syntax/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 foo =
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-write-bad-value/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-write-bad-value/moz.build
index 2e8194b22369b..587ea79bca5f3 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-write-bad-value/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-write-bad-value/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = "dir"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-error-write-unknown-global/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-error-write-unknown-global/moz.build
index 567503175362a..2f89f7bc53c2a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-error-write-unknown-global/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-error-write-unknown-global/moz.build
@@ -5,3 +5,6 @@
 DIRS = ["dir1", "dir2"]
 
 FOO = "bar"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/a/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/a/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/a/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/a/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/b/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/b/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/b/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/b/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/every-level/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/no-intermediate-moz-build/child/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/no-intermediate-moz-build/child/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/no-intermediate-moz-build/child/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/no-intermediate-moz-build/child/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/parent-is-far/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/parent-is-far/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/parent-is-far/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d1/parent-is-far/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/dir1/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/dir1/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/dir1/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/dir1/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/dir2/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/dir2/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/dir2/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/dir2/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/d2/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/moz.build b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/reader-relevant-mozbuild/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/resolved-flags-error/moz.build b/python/mozbuild/mozbuild/test/frontend/data/resolved-flags-error/moz.build
index d4b9a3075d263..65cc43bc7e9ca 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/resolved-flags-error/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/resolved-flags-error/moz.build
@@ -15,3 +15,6 @@ UNIFIED_SOURCES += ["test1.c"]
 DEFINES["MOZ_TEST_DEFINE"] = True
 LIBRARY_DEFINES["MOZ_LIBRARY_DEFINE"] = "MOZ_TEST"
 COMPILE_FLAGS["DEFINES"] = ["-DFOO"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-library-dash-folding/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-library-dash-folding/moz.build
index de1967c519e22..151c5174df6e3 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-library-dash-folding/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-library-dash-folding/moz.build
@@ -17,3 +17,6 @@ def RustLibrary(name):
 
 
 RustLibrary("random-crate")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-library-duplicate-features/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-library-duplicate-features/moz.build
index ccd8ede3c043b..d60eddb5555a5 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-library-duplicate-features/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-library-duplicate-features/moz.build
@@ -18,3 +18,6 @@ def RustLibrary(name, features):
 
 
 RustLibrary("random-crate", ["musthave", "cantlivewithout", "musthave"])
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-library-features/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-library-features/moz.build
index 9d88bdea086e3..ec55dbc676103 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-library-features/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-library-features/moz.build
@@ -18,3 +18,6 @@ def RustLibrary(name, features):
 
 
 RustLibrary("random-crate", ["musthave", "cantlivewithout"])
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-library-invalid-crate-type/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-library-invalid-crate-type/moz.build
index de1967c519e22..151c5174df6e3 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-library-invalid-crate-type/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-library-invalid-crate-type/moz.build
@@ -17,3 +17,6 @@ def RustLibrary(name):
 
 
 RustLibrary("random-crate")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-library-name-mismatch/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-library-name-mismatch/moz.build
index de1967c519e22..151c5174df6e3 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-library-name-mismatch/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-library-name-mismatch/moz.build
@@ -17,3 +17,6 @@ def RustLibrary(name):
 
 
 RustLibrary("random-crate")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-library-no-cargo-toml/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-library-no-cargo-toml/moz.build
index de1967c519e22..151c5174df6e3 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-library-no-cargo-toml/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-library-no-cargo-toml/moz.build
@@ -17,3 +17,6 @@ def RustLibrary(name):
 
 
 RustLibrary("random-crate")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-library-no-lib-section/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-library-no-lib-section/moz.build
index de1967c519e22..151c5174df6e3 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-library-no-lib-section/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-library-no-lib-section/moz.build
@@ -17,3 +17,6 @@ def RustLibrary(name):
 
 
 RustLibrary("random-crate")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-no-workspace-hack/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-no-workspace-hack/moz.build
index c82c03205c311..18c8e186cf675 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-no-workspace-hack/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-no-workspace-hack/moz.build
@@ -7,3 +7,6 @@ def RustLibrary(name):
 
 
 RustLibrary("random-crate")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-old-workspace-hack/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-old-workspace-hack/moz.build
index c82c03205c311..18c8e186cf675 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-old-workspace-hack/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-old-workspace-hack/moz.build
@@ -7,3 +7,6 @@ def RustLibrary(name):
 
 
 RustLibrary("random-crate")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-program-no-cargo-toml/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-program-no-cargo-toml/moz.build
index 56601854f97c1..48ba0074ddeea 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-program-no-cargo-toml/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-program-no-cargo-toml/moz.build
@@ -1 +1,4 @@
 RUST_PROGRAMS += ["none"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-program-nonexistent-name/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-program-nonexistent-name/moz.build
index 56601854f97c1..48ba0074ddeea 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-program-nonexistent-name/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-program-nonexistent-name/moz.build
@@ -1 +1,4 @@
 RUST_PROGRAMS += ["none"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/rust-programs/moz.build b/python/mozbuild/mozbuild/test/frontend/data/rust-programs/moz.build
index 80dc15120a9e6..3934248d99047 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/rust-programs/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/rust-programs/moz.build
@@ -1 +1,4 @@
 RUST_PROGRAMS += ["some"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/schedules/moz.build b/python/mozbuild/mozbuild/test/frontend/data/schedules/moz.build
index 3f4f450d375c8..59a23cfe76e34 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/schedules/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/schedules/moz.build
@@ -17,3 +17,6 @@ with Files("subd/**.py"):
 
 with Files("**/*.js"):
     SCHEDULES.inclusive += ["js-lint"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/schedules/subd/moz.build b/python/mozbuild/mozbuild/test/frontend/data/schedules/subd/moz.build
index b9c3bf6c74113..c118f5a333cd4 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/schedules/subd/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/schedules/subd/moz.build
@@ -3,3 +3,6 @@ with Files("yaml.py"):
 
 with Files("win.js"):
     SCHEDULES.exclusive = ["windows"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/sources-just-c/moz.build b/python/mozbuild/mozbuild/test/frontend/data/sources-just-c/moz.build
index 29abd6de5d30a..3399ca29d0b8b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/sources-just-c/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/sources-just-c/moz.build
@@ -27,3 +27,6 @@ SOURCES += [
     "h.s",
     "i.asm",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/sources/moz.build b/python/mozbuild/mozbuild/test/frontend/data/sources/moz.build
index e25f865f721ba..0b9613f7909ca 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/sources/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/sources/moz.build
@@ -37,3 +37,6 @@ SOURCES += [
     "h.s",
     "i.asm",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-harness-files-root/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-harness-files-root/moz.build
index d7f6377d0de81..c7c452cd476a5 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-harness-files-root/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-harness-files-root/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 TEST_HARNESS_FILES += ["foo.py"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-harness-files/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-harness-files/moz.build
index 8e2acab1455f4..df5fee83eef60 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-harness-files/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-harness-files/moz.build
@@ -5,3 +5,6 @@ TEST_HARNESS_FILES.mochitest += ["runtests.py"]
 TEST_HARNESS_FILES.mochitest += ["utils.py"]
 TEST_HARNESS_FILES.testing.mochitest += ["mochitest.py"]
 TEST_HARNESS_FILES.testing.mochitest += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-install-shared-lib/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-install-shared-lib/moz.build
index fa592c72a39ca..2adc018c40cfa 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-install-shared-lib/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-install-shared-lib/moz.build
@@ -14,3 +14,6 @@ SharedLibrary("foo")
 TEST_HARNESS_FILES.foo.bar += [
     "!%sfoo%s" % (CONFIG["DLL_PREFIX"], CONFIG["DLL_SUFFIX"])
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/moz.build
index 0f84eb5554c7d..783e782cf803a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/moz.build
@@ -12,3 +12,6 @@ def SharedLibrary(name):
 
 SharedLibrary("cxx_shared")
 USE_LIBS += ["cxx_static"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/one/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/one/moz.build
index f03a34c33f81a..4040f8fda549b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/one/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/one/moz.build
@@ -9,3 +9,6 @@ def Library(name):
 
 Library("cxx_static")
 SOURCES += ["foo.cpp"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/three/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/three/moz.build
index 08e26c4eb3bbf..eef585c6c7c47 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/three/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/three/moz.build
@@ -3,3 +3,6 @@
 
 SharedLibrary("just_c_shared")
 USE_LIBS += ["just_c_static"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/two/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/two/moz.build
index d3bb738ba481c..584e999fdbdeb 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/two/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-linkables-cxx-link/two/moz.build
@@ -9,3 +9,6 @@ def Library(name):
 
 Library("just_c_static")
 SOURCES += ["foo.c"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-absolute-support/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-absolute-support/moz.build
index 17ac7234a158d..3a3a1251a65f6 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-absolute-support/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-absolute-support/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 MOCHITEST_MANIFESTS += ["absolute-support.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-dupes/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-dupes/moz.build
index d2b33addedf89..a2a129ac41e54 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-dupes/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-dupes/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-emitted-includes/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-emitted-includes/moz.build
index 8f321387afb73..dcfc8901ab302 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-emitted-includes/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-emitted-includes/moz.build
@@ -1 +1,4 @@
 REFTEST_MANIFESTS += ["reftest.list"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-empty/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-empty/moz.build
index c6adbbead9f73..3aee5f4cdf94b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-empty/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-empty/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 MOCHITEST_MANIFESTS += ["empty.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-install-includes/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-install-includes/moz.build
index d2b33addedf89..a2a129ac41e54 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-install-includes/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-install-includes/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-just-support/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-just-support/moz.build
index adf2a0d91c16c..f36ca7758b299 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-just-support/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-just-support/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 MOCHITEST_MANIFESTS += ["just-support.ini"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-keys-extracted/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-keys-extracted/moz.build
index 0a3f851d843b2..974432b6ad989 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-keys-extracted/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-keys-extracted/moz.build
@@ -10,3 +10,6 @@ XPCSHELL_TESTS_MANIFESTS += ["xpcshell.toml"]
 REFTEST_MANIFESTS += ["reftest.list"]
 CRASHTEST_MANIFESTS += ["crashtest.list"]
 PYTHON_UNITTEST_MANIFESTS += ["python.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-manifest/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-manifest/moz.build
index 9986156310669..0c7f6b908d51b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-manifest/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-manifest/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 XPCSHELL_TESTS_MANIFESTS += ["does_not_exist.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-test-file-unfiltered/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-test-file-unfiltered/moz.build
index 827201f8e9300..e8120c8053da0 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-test-file-unfiltered/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-test-file-unfiltered/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 XPCSHELL_TESTS_MANIFESTS += ["xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-test-file/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-test-file/moz.build
index d2b33addedf89..a2a129ac41e54 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-test-file/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-missing-test-file/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-parent-support-files-dir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-parent-support-files-dir/moz.build
index f4f4be54142a5..f797e0e76aaff 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-parent-support-files-dir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-parent-support-files-dir/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 MOCHITEST_MANIFESTS += ["child/mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-shared-missing/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-shared-missing/moz.build
index d28a244978919..280a0dc94154a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-shared-missing/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-shared-missing/moz.build
@@ -3,3 +3,6 @@
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
 BROWSER_CHROME_MANIFESTS += ["child/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-shared-support/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-shared-support/moz.build
index d28a244978919..280a0dc94154a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-shared-support/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-shared-support/moz.build
@@ -3,3 +3,6 @@
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
 BROWSER_CHROME_MANIFESTS += ["child/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-unmatched-generated/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-unmatched-generated/moz.build
index 9d098e0eab2fc..bcfbd4fe8300e 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-manifest-unmatched-generated/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-manifest-unmatched-generated/moz.build
@@ -2,3 +2,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 MOCHITEST_MANIFESTS += ["test.ini"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file-objdir-missing-generated/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file-objdir-missing-generated/moz.build
index 450af01d9a1c4..39171d52f3a29 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file-objdir-missing-generated/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file-objdir-missing-generated/moz.build
@@ -10,3 +10,6 @@ def SharedLibrary(name):
 
 SharedLibrary("foo")
 SYMBOLS_FILE = "!foo.symbols"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file-objdir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file-objdir/moz.build
index 7ea07b4ee95c8..8b93dd9774ab2 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file-objdir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file-objdir/moz.build
@@ -13,3 +13,6 @@ SYMBOLS_FILE = "!foo.symbols"
 
 GENERATED_FILES += ["foo.symbols"]
 GENERATED_FILES["foo.symbols"].script = "foo.py"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file/moz.build b/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file/moz.build
index 47e435dbf5e64..e01808ec590fe 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/test-symbols-file/moz.build
@@ -10,3 +10,6 @@ def SharedLibrary(name):
 
 SharedLibrary("foo")
 SYMBOLS_FILE = "foo.symbols"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/moz.build
index 480808eb8a011..84e2ca994c185 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/moz.build
@@ -4,3 +4,6 @@
 
 DIRS += ["regular"]
 TEST_DIRS += ["test"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/parallel/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/parallel/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/parallel/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/parallel/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/regular/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/regular/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/regular/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/regular/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/test/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/test/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/test/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-all-vars/test/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-outside-topsrcdir/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-outside-topsrcdir/moz.build
index dbdc694a6a878..5be1f8e9960a0 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-outside-topsrcdir/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-outside-topsrcdir/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = ["../../foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/bar/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/bar/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/bar/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/bar/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/foo/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/foo/moz.build
index 4b42bbc5ab01c..9e7752d6250f4 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/foo/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/foo/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = ["../bar"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/moz.build
index 68581574b152b..795af274ae460 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-relative-dirs/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = ["foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/bar/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/bar/moz.build
index f204e245b42bc..9f84b3553d6ca 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/bar/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/bar/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = ["../foo"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/foo/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/foo/moz.build
index 4b42bbc5ab01c..9e7752d6250f4 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/foo/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/foo/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = ["../bar"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/moz.build
index 5a9445a6e6c9e..fe8878ab8c5e4 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-repeated-dirs/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = ["foo", "bar"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/bar/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/bar/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/bar/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/bar/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/foo/biz/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/foo/biz/moz.build
index e69de29bb2d1d..aab2eecbe2f1a 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/foo/biz/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/foo/biz/moz.build
@@ -0,0 +1,3 @@
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/foo/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/foo/moz.build
index 3ad8a1501d5b3..886d65e6f9550 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/foo/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/foo/moz.build
@@ -1,2 +1,5 @@
 # -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
 DIRS = ["biz"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/moz.build b/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/moz.build
index 5a9445a6e6c9e..fe8878ab8c5e4 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/traversal-simple/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 DIRS = ["foo", "bar"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/unified-sources-non-unified/moz.build b/python/mozbuild/mozbuild/test/frontend/data/unified-sources-non-unified/moz.build
index 217e43831f156..2b60a38dd6fc2 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/unified-sources-non-unified/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/unified-sources-non-unified/moz.build
@@ -28,3 +28,6 @@ UNIFIED_SOURCES += [
 ]
 
 FILES_PER_UNIFIED_FILE = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/unified-sources/moz.build b/python/mozbuild/mozbuild/test/frontend/data/unified-sources/moz.build
index 8a86e055dab9a..1d0ac0a10bfba 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/unified-sources/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/unified-sources/moz.build
@@ -28,3 +28,6 @@ UNIFIED_SOURCES += [
 ]
 
 FILES_PER_UNIFIED_FILE = 32
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/use-nasm/moz.build b/python/mozbuild/mozbuild/test/frontend/data/use-nasm/moz.build
index 63ac5283f6f5e..f9c117b01e6de 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/use-nasm/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/use-nasm/moz.build
@@ -13,3 +13,6 @@ Library("dummy")
 USE_NASM = True
 
 SOURCES += ["test1.S"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/variable-passthru/moz.build b/python/mozbuild/mozbuild/test/frontend/data/variable-passthru/moz.build
index d080b00c9272f..2363ae039b63b 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/variable-passthru/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/variable-passthru/moz.build
@@ -11,3 +11,6 @@ RCINCLUDE = "bar.rc"
 DEFFILE = "baz.def"
 
 WIN32_EXE_LDFLAGS += ["-subsystem:console"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/visibility-flags/moz.build b/python/mozbuild/mozbuild/test/frontend/data/visibility-flags/moz.build
index 630a3afd80687..75326f50c8765 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/visibility-flags/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/visibility-flags/moz.build
@@ -19,3 +19,6 @@ def NoVisibilityFlags():
 UNIFIED_SOURCES += ["test1.c"]
 
 NoVisibilityFlags()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/wasm-compile-flags/moz.build b/python/mozbuild/mozbuild/test/frontend/data/wasm-compile-flags/moz.build
index e7cf13088ff82..066c0af37360d 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/wasm-compile-flags/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/wasm-compile-flags/moz.build
@@ -12,3 +12,6 @@ WASM_DEFINES["BAR"] = 7
 WASM_DEFINES["VALUE"] = value
 WASM_DEFINES["QUX"] = False
 WASM_CFLAGS += ["-funroll-loops", "-wasm-arg"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/wasm-sources/moz.build b/python/mozbuild/mozbuild/test/frontend/data/wasm-sources/moz.build
index e266bcb0dde64..f0c09d2506d6c 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/wasm-sources/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/wasm-sources/moz.build
@@ -13,3 +13,6 @@ WASM_SOURCES += [
 WASM_SOURCES += [
     "d.c",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/test/frontend/data/xpidl-module-no-sources/moz.build b/python/mozbuild/mozbuild/test/frontend/data/xpidl-module-no-sources/moz.build
index f0abd45382b67..9526d2b4878f2 100644
--- a/python/mozbuild/mozbuild/test/frontend/data/xpidl-module-no-sources/moz.build
+++ b/python/mozbuild/mozbuild/test/frontend/data/xpidl-module-no-sources/moz.build
@@ -3,3 +3,6 @@
 # http://creativecommons.org/publicdomain/zero/1.0/
 
 XPIDL_MODULE = "xpidl_module"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/python/mozbuild/mozbuild/vendor/moz.build b/python/mozbuild/mozbuild/vendor/moz.build
index 315dc32600c24..27d0f8e4e31f1 100644
--- a/python/mozbuild/mozbuild/vendor/moz.build
+++ b/python/mozbuild/mozbuild/vendor/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Developer Infrastructure", "Mach Vendor & Updatebot")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/remote/cdp/moz.build b/remote/cdp/moz.build
index f1966f0101e9e..7d6b27cef6ee4 100644
--- a/remote/cdp/moz.build
+++ b/remote/cdp/moz.build
@@ -26,3 +26,6 @@ BROWSER_CHROME_MANIFESTS += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/remote/components/moz.build b/remote/components/moz.build
index 82b4891b6a699..c942bfbb97253 100644
--- a/remote/components/moz.build
+++ b/remote/components/moz.build
@@ -15,3 +15,6 @@ with Files("Marionette.sys.mjs"):
     BUG_COMPONENT = ("Remote Protocol", "Marionette")
 with Files("nsIMarionette.idl"):
     BUG_COMPONENT = ("Remote Protocol", "Marionette")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/remote/marionette/moz.build b/remote/marionette/moz.build
index 52237f8719c1a..9f8cab2bf5324 100644
--- a/remote/marionette/moz.build
+++ b/remote/marionette/moz.build
@@ -8,3 +8,6 @@ XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Remote Protocol", "Marionette")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/remote/moz.build b/remote/moz.build
index e508edcb31688..def6ebb90b681 100644
--- a/remote/moz.build
+++ b/remote/moz.build
@@ -20,3 +20,6 @@ with Files("doc/**"):
 
 SPHINX_TREES["/remote"] = "doc"
 SPHINX_TREES["/testing/marionette"] = "doc/marionette"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/remote/shared/moz.build b/remote/shared/moz.build
index 69b7d9e8a1ae2..ba280ac5d85c6 100644
--- a/remote/shared/moz.build
+++ b/remote/shared/moz.build
@@ -15,3 +15,6 @@ XPCSHELL_TESTS_MANIFESTS += [
     "test/xpcshell/xpcshell.toml",
     "webdriver/test/xpcshell/xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/remote/webdriver-bidi/moz.build b/remote/webdriver-bidi/moz.build
index 1b58153c45b5f..3601d65e57ae8 100644
--- a/remote/webdriver-bidi/moz.build
+++ b/remote/webdriver-bidi/moz.build
@@ -12,3 +12,6 @@ BROWSER_CHROME_MANIFESTS += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/run.sh b/run.sh
new file mode 100755
index 0000000000000..924afc3a6a777
--- /dev/null
+++ b/run.sh
@@ -0,0 +1,4 @@
+#!/bin/bash
+
+rm -rf release/tmp/profile-default/
+./mach run "http://127.0.0.1:8080/seed" "http://127.0.0.2:8080/seed" "http://127.0.0.2:8080/input-${1}_page-1.html" "http://127.0.0.1:8080/input-${1}_page-1.html" 
diff --git a/security/certverifier/moz.build b/security/certverifier/moz.build
index cdf2a75814e40..08e690fb6d89c 100644
--- a/security/certverifier/moz.build
+++ b/security/certverifier/moz.build
@@ -52,3 +52,6 @@ FINAL_LIBRARY = "xul"
 
 if CONFIG["CC_TYPE"] == "clang-cl":
     AllowCompilerWarnings()  # workaround for bug 1090497
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/certverifier/tests/gtest/moz.build b/security/certverifier/tests/gtest/moz.build
index e67d01b0468e5..5e3e9993f3355 100644
--- a/security/certverifier/tests/gtest/moz.build
+++ b/security/certverifier/tests/gtest/moz.build
@@ -16,3 +16,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/ct/moz.build b/security/ct/moz.build
index b9a2a62b28947..6e3c92c4f2dd8 100644
--- a/security/ct/moz.build
+++ b/security/ct/moz.build
@@ -51,3 +51,6 @@ FINAL_LIBRARY = "xul"
 
 if CONFIG["CC_TYPE"] == "clang-cl":
     AllowCompilerWarnings()  # workaround for bug 1090497
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/ct/tests/gtest/moz.build b/security/ct/tests/gtest/moz.build
index 4c0ed38557978..f25afd5aed3ec 100644
--- a/security/ct/tests/gtest/moz.build
+++ b/security/ct/tests/gtest/moz.build
@@ -54,3 +54,6 @@ if not CONFIG["MOZ_DEBUG"]:
     DEFINES["NDEBUG"] = True
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/locales/moz.build b/security/manager/locales/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/security/manager/locales/moz.build
+++ b/security/manager/locales/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/moz.build b/security/manager/moz.build
index 38900075038bb..6cb6952dc847e 100644
--- a/security/manager/moz.build
+++ b/security/manager/moz.build
@@ -11,3 +11,6 @@ DIRS += ["ssl", "locales"]
 
 if CONFIG["MOZ_BUILD_APP"] != "mobile/android":
     DIRS += ["pki"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/pki/moz.build b/security/manager/pki/moz.build
index 5f0bf9573874c..1c37fa7431a9e 100644
--- a/security/manager/pki/moz.build
+++ b/security/manager/pki/moz.build
@@ -32,3 +32,6 @@ if CONFIG["CC_TYPE"] in ("clang", "gcc"):
     CXXFLAGS += [
         "-Wno-unused-parameter",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/pki/resources/moz.build b/security/manager/pki/resources/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/security/manager/pki/resources/moz.build
+++ b/security/manager/pki/resources/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/builtins/dynamic-library/moz.build b/security/manager/ssl/builtins/dynamic-library/moz.build
index 2413a4c441ade..6fcf9077b5c6d 100644
--- a/security/manager/ssl/builtins/dynamic-library/moz.build
+++ b/security/manager/ssl/builtins/dynamic-library/moz.build
@@ -36,3 +36,6 @@ SharedLibrary("nssckbi")
 
 NoVisibilityFlags()
 SYMBOLS_FILE = "builtins.symbols"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/builtins/moz.build b/security/manager/ssl/builtins/moz.build
index f612798d79654..5aa5ebf19c47c 100644
--- a/security/manager/ssl/builtins/moz.build
+++ b/security/manager/ssl/builtins/moz.build
@@ -7,3 +7,6 @@
 DIRS += ["dynamic-library"]
 
 RustLibrary("builtins-static")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/ipcclientcerts/dynamic-library/moz.build b/security/manager/ssl/ipcclientcerts/dynamic-library/moz.build
index 7f2ab5e27fa21..846ec169027b9 100644
--- a/security/manager/ssl/ipcclientcerts/dynamic-library/moz.build
+++ b/security/manager/ssl/ipcclientcerts/dynamic-library/moz.build
@@ -38,3 +38,6 @@ SharedLibrary("ipcclientcerts")
 
 NoVisibilityFlags()
 SYMBOLS_FILE = "ipcclientcerts.symbols"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/ipcclientcerts/moz.build b/security/manager/ssl/ipcclientcerts/moz.build
index 1d24bdea31dab..234496c8d5203 100644
--- a/security/manager/ssl/ipcclientcerts/moz.build
+++ b/security/manager/ssl/ipcclientcerts/moz.build
@@ -7,3 +7,6 @@
 DIRS += ["dynamic-library"]
 
 RustLibrary("ipcclientcerts-static")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/moz.build b/security/manager/ssl/moz.build
index 676652db28700..117cb47b1eb1a 100644
--- a/security/manager/ssl/moz.build
+++ b/security/manager/ssl/moz.build
@@ -271,3 +271,6 @@ for header, array_name, cert in headers_arrays_certs:
     GeneratedFile(
         header, script="gen_cert_header.py", entry_point=array_name, inputs=[cert]
     )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/nsCertOverrideService.cpp b/security/manager/ssl/nsCertOverrideService.cpp
index b8d0bbc3a12f7..a50379c571587 100644
--- a/security/manager/ssl/nsCertOverrideService.cpp
+++ b/security/manager/ssl/nsCertOverrideService.cpp
@@ -438,7 +438,12 @@ nsCertOverrideService::HasMatchingOverride(
   bool disableAllSecurityCheck = false;
   {
     MutexAutoLock lock(mMutex);
-    disableAllSecurityCheck = mDisableAllSecurityCheck;
+    if (aOriginAttributes.mUserContextId) {
+      disableAllSecurityCheck = mUserContextIdsWithDisabledSecurityChecks.has(
+          aOriginAttributes.mUserContextId);
+    } else {
+      disableAllSecurityCheck = mDisableAllSecurityCheck;
+    }
   }
   if (disableAllSecurityCheck) {
     *aIsTemporary = false;
@@ -650,14 +655,24 @@ static bool IsDebugger() {
 
 NS_IMETHODIMP
 nsCertOverrideService::
-    SetDisableAllSecurityChecksAndLetAttackersInterceptMyData(bool aDisable) {
-  if (!(PR_GetEnv("XPCSHELL_TEST_PROFILE_DIR") || IsDebugger())) {
+    SetDisableAllSecurityChecksAndLetAttackersInterceptMyData(
+      bool aDisable, uint32_t aUserContextId) {
+  if (false /* juggler hacks */ && !(PR_GetEnv("XPCSHELL_TEST_PROFILE_DIR") || IsDebugger())) {
     return NS_ERROR_NOT_AVAILABLE;
   }
 
   {
     MutexAutoLock lock(mMutex);
-    mDisableAllSecurityCheck = aDisable;
+    if (aUserContextId) {
+      if (aDisable) {
+        mozilla::Unused << mUserContextIdsWithDisabledSecurityChecks.put(aUserContextId);
+      } else {
+        mUserContextIdsWithDisabledSecurityChecks.remove(aUserContextId);
+      }
+      return NS_OK;
+    } else {
+      mDisableAllSecurityCheck = aDisable;
+    }
   }
 
   nsCOMPtr<nsINSSComponent> nss(do_GetService(PSM_COMPONENT_CONTRACTID));
diff --git a/security/manager/ssl/nsCertOverrideService.h b/security/manager/ssl/nsCertOverrideService.h
index 21cff56300db6..ce9a7fc16c2d5 100644
--- a/security/manager/ssl/nsCertOverrideService.h
+++ b/security/manager/ssl/nsCertOverrideService.h
@@ -118,6 +118,7 @@ class nsCertOverrideService final : public nsICertOverrideService,
 
   mozilla::Mutex mMutex;
   bool mDisableAllSecurityCheck MOZ_GUARDED_BY(mMutex);
+  mozilla::HashSet<uint32_t> mUserContextIdsWithDisabledSecurityChecks MOZ_GUARDED_BY(mMutex);
   nsCOMPtr<nsIFile> mSettingsFile MOZ_GUARDED_BY(mMutex);
   nsTHashtable<nsCertOverrideEntry> mSettingsTable MOZ_GUARDED_BY(mMutex);
 
diff --git a/security/manager/ssl/nsICertOverrideService.idl b/security/manager/ssl/nsICertOverrideService.idl
index 6dfd07d6b676a..e3c6794363cd6 100644
--- a/security/manager/ssl/nsICertOverrideService.idl
+++ b/security/manager/ssl/nsICertOverrideService.idl
@@ -137,7 +137,9 @@ interface nsICertOverrideService : nsISupports {
    *  @param aDisable If true, disable all security check and make
    *                  hasMatchingOverride always return true.
    */
-  void setDisableAllSecurityChecksAndLetAttackersInterceptMyData(in boolean aDisable);
+  void setDisableAllSecurityChecksAndLetAttackersInterceptMyData(
+      in boolean aDisable,
+      [optional] in uint32_t aUserContextId);
 
   readonly attribute boolean securityCheckDisabled;
 };
diff --git a/security/manager/ssl/osclientcerts/dynamic-library/moz.build b/security/manager/ssl/osclientcerts/dynamic-library/moz.build
index 36c0341ca7b6b..855209846813f 100644
--- a/security/manager/ssl/osclientcerts/dynamic-library/moz.build
+++ b/security/manager/ssl/osclientcerts/dynamic-library/moz.build
@@ -31,3 +31,6 @@ SharedLibrary("osclientcerts")
 
 NoVisibilityFlags()
 SYMBOLS_FILE = "osclientcerts.symbols"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/osclientcerts/moz.build b/security/manager/ssl/osclientcerts/moz.build
index fa484af6a44bd..a9db43934f611 100644
--- a/security/manager/ssl/osclientcerts/moz.build
+++ b/security/manager/ssl/osclientcerts/moz.build
@@ -7,3 +7,6 @@
 DIRS += ["dynamic-library"]
 
 RustLibrary("osclientcerts-static")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/gtest/moz.build b/security/manager/ssl/tests/gtest/moz.build
index 400b1e02cc874..8fa4162eb076b 100644
--- a/security/manager/ssl/tests/gtest/moz.build
+++ b/security/manager/ssl/tests/gtest/moz.build
@@ -22,3 +22,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/mochitest/browser/moz.build b/security/manager/ssl/tests/mochitest/browser/moz.build
index cfd5452a0e38e..def6df11adaa6 100644
--- a/security/manager/ssl/tests/mochitest/browser/moz.build
+++ b/security/manager/ssl/tests/mochitest/browser/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 BROWSER_CHROME_MANIFESTS += ["browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/mochitest/mixedcontent/moz.build b/security/manager/ssl/tests/mochitest/mixedcontent/moz.build
index 2f4100812868c..f4f8c9e2e7782 100644
--- a/security/manager/ssl/tests/mochitest/mixedcontent/moz.build
+++ b/security/manager/ssl/tests/mochitest/mixedcontent/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/mochitest/moz.build b/security/manager/ssl/tests/mochitest/moz.build
index ddb344c83c92f..ab5f2103c95d4 100644
--- a/security/manager/ssl/tests/mochitest/moz.build
+++ b/security/manager/ssl/tests/mochitest/moz.build
@@ -8,3 +8,6 @@ TEST_DIRS += [
     "browser",
     "mixedcontent",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/moz.build b/security/manager/ssl/tests/moz.build
index 89ebbd9febb60..8dc8a4977799b 100644
--- a/security/manager/ssl/tests/moz.build
+++ b/security/manager/ssl/tests/moz.build
@@ -15,3 +15,6 @@ XPCSHELL_TESTS_MANIFESTS += ["unit/xpcshell.toml"]
 
 if not CONFIG["MOZ_NO_SMART_CARDS"]:
     XPCSHELL_TESTS_MANIFESTS += ["unit/xpcshell-smartcards.ini"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/unit/moz.build b/security/manager/ssl/tests/unit/moz.build
index 561502dd5156f..e90639fee933a 100644
--- a/security/manager/ssl/tests/unit/moz.build
+++ b/security/manager/ssl/tests/unit/moz.build
@@ -8,3 +8,6 @@ DIRS += ["tlsserver", "test_signed_apps"]
 
 if not CONFIG["MOZ_NO_SMART_CARDS"]:
     DIRS += ["pkcs11testmodule"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/unit/pkcs11testmodule/moz.build b/security/manager/ssl/tests/unit/pkcs11testmodule/moz.build
index 0eef91b076404..8f1713463b18b 100644
--- a/security/manager/ssl/tests/unit/pkcs11testmodule/moz.build
+++ b/security/manager/ssl/tests/unit/pkcs11testmodule/moz.build
@@ -18,3 +18,6 @@ NoVisibilityFlags()
 SYMBOLS_FILE = "pkcs11testmodule.symbols"
 
 NO_PGO = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/unit/test_signed_apps/moz.build b/security/manager/ssl/tests/unit/test_signed_apps/moz.build
index 8680c8d4571b2..3fa4ea496e996 100644
--- a/security/manager/ssl/tests/unit/test_signed_apps/moz.build
+++ b/security/manager/ssl/tests/unit/test_signed_apps/moz.build
@@ -76,3 +76,6 @@ def SignedAppFile(name, flags, app_directory="app/"):
 # To generate a new entry, add SignedAppFile, run mach build and copy from
 # objdir/_tests/xpcshell/security/manager/ssl/tests/unit/test_signed_apps/
 # to this directory.
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/unit/tlsserver/cmd/moz.build b/security/manager/ssl/tests/unit/tlsserver/cmd/moz.build
index ebf8f8e3e78e5..7c60ad62f694d 100644
--- a/security/manager/ssl/tests/unit/tlsserver/cmd/moz.build
+++ b/security/manager/ssl/tests/unit/tlsserver/cmd/moz.build
@@ -43,3 +43,6 @@ else:
 
 if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/unit/tlsserver/lib/moz.build b/security/manager/ssl/tests/unit/tlsserver/lib/moz.build
index 54820f9b525ae..c533250842b8d 100644
--- a/security/manager/ssl/tests/unit/tlsserver/lib/moz.build
+++ b/security/manager/ssl/tests/unit/tlsserver/lib/moz.build
@@ -46,3 +46,6 @@ if not CONFIG["MOZ_SYSTEM_NSS"]:
         USE_LIBS += ["nssutil3"]
 
 Library("tlsserver")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/manager/ssl/tests/unit/tlsserver/moz.build b/security/manager/ssl/tests/unit/tlsserver/moz.build
index 14883529141f1..6342a353f311e 100644
--- a/security/manager/ssl/tests/unit/tlsserver/moz.build
+++ b/security/manager/ssl/tests/unit/tlsserver/moz.build
@@ -6,3 +6,6 @@
 
 # lib must be first, because cmd depends on its output
 DIRS += ["lib", "cmd"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/moz.build b/security/moz.build
index d19bb9e6e20b0..baf8a26fc5e53 100644
--- a/security/moz.build
+++ b/security/moz.build
@@ -186,3 +186,6 @@ SPHINX_TREES["nss"] = "nss/doc/rst"
 
 with Files("nss/doc/rst/**"):
     SCHEDULES.exclusive = ["nss"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/rlbox/moz.build b/security/rlbox/moz.build
index 7ad8d076f0f1f..9c0a8833aad82 100644
--- a/security/rlbox/moz.build
+++ b/security/rlbox/moz.build
@@ -64,3 +64,6 @@ if CONFIG["MOZ_WASM_SANDBOXING_WOFF2"]:
     include("/modules/woff2/sources.mozbuild")
     WASM_SOURCES += ["/modules/woff2/" + s for s in woff2_sources]
     LOCAL_INCLUDES += ["/modules/woff2/include"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/common/moz.build b/security/sandbox/common/moz.build
index 0116873a9ad05..e9e85a6474a18 100644
--- a/security/sandbox/common/moz.build
+++ b/security/sandbox/common/moz.build
@@ -52,3 +52,6 @@ FINAL_LIBRARY = "xul"
 EXPORTS.mozilla += [
     "SandboxSettings.h",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/linux/broker/moz.build b/security/sandbox/linux/broker/moz.build
index 4ad2dfcb3bd68..3352d61bb3251 100644
--- a/security/sandbox/linux/broker/moz.build
+++ b/security/sandbox/linux/broker/moz.build
@@ -35,3 +35,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/linux/glue/moz.build b/security/sandbox/linux/glue/moz.build
index e44a561d69bad..39591be6d3405 100644
--- a/security/sandbox/linux/glue/moz.build
+++ b/security/sandbox/linux/glue/moz.build
@@ -33,3 +33,6 @@ USE_LIBS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/linux/gtest/moz.build b/security/sandbox/linux/gtest/moz.build
index f80482aee3e27..9181787f904fc 100644
--- a/security/sandbox/linux/gtest/moz.build
+++ b/security/sandbox/linux/gtest/moz.build
@@ -24,3 +24,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/linux/interfaces/moz.build b/security/sandbox/linux/interfaces/moz.build
index 4ff62e8aba276..bcdde87a795af 100644
--- a/security/sandbox/linux/interfaces/moz.build
+++ b/security/sandbox/linux/interfaces/moz.build
@@ -9,3 +9,6 @@ XPIDL_MODULE = "sandbox"
 XPIDL_SOURCES += [
     "mozISandboxReporter.idl",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/linux/launch/moz.build b/security/sandbox/linux/launch/moz.build
index 09f483f5194c6..b6080dcebb088 100644
--- a/security/sandbox/linux/launch/moz.build
+++ b/security/sandbox/linux/launch/moz.build
@@ -31,3 +31,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/linux/moz.build b/security/sandbox/linux/moz.build
index cbb99e514c3e2..1ebf66596aa35 100644
--- a/security/sandbox/linux/moz.build
+++ b/security/sandbox/linux/moz.build
@@ -137,3 +137,6 @@ DIRS += [
 TEST_DIRS += [
     "gtest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/linux/reporter/moz.build b/security/sandbox/linux/reporter/moz.build
index d5b037fd097ab..cf4affcb3cf5c 100644
--- a/security/sandbox/linux/reporter/moz.build
+++ b/security/sandbox/linux/reporter/moz.build
@@ -32,3 +32,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/mac/moz.build b/security/sandbox/mac/moz.build
index 00b96334b6ce2..a18a1c2998cfc 100644
--- a/security/sandbox/mac/moz.build
+++ b/security/sandbox/mac/moz.build
@@ -17,3 +17,6 @@ SOURCES += [
 ]
 
 Library("mozsandbox")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/moz.build b/security/sandbox/moz.build
index 27237740986d3..53a40696a698a 100644
--- a/security/sandbox/moz.build
+++ b/security/sandbox/moz.build
@@ -209,3 +209,6 @@ elif CONFIG["OS_ARCH"] == "WINNT":
         CXXFLAGS += [
             "-Wno-deprecated-declarations",  # 'GetVersionExW': was declared deprecated
         ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/win/src/remotesandboxbroker/moz.build b/security/sandbox/win/src/remotesandboxbroker/moz.build
index 6d661ace4c797..d0e9f2382a7f4 100644
--- a/security/sandbox/win/src/remotesandboxbroker/moz.build
+++ b/security/sandbox/win/src/remotesandboxbroker/moz.build
@@ -28,3 +28,6 @@ FINAL_LIBRARY = "xul"
 IPDL_SOURCES += ["PRemoteSandboxBroker.ipdl"]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/win/src/sandboxbroker/moz.build b/security/sandbox/win/src/sandboxbroker/moz.build
index 5eaf0de937656..464994a3076eb 100644
--- a/security/sandbox/win/src/sandboxbroker/moz.build
+++ b/security/sandbox/win/src/sandboxbroker/moz.build
@@ -19,3 +19,6 @@ LOCAL_INCLUDES += ["/security/sandbox/chromium-shim"]
 LOCAL_INCLUDES += ["/security/sandbox/chromium"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/security/sandbox/win/src/sandboxtarget/moz.build b/security/sandbox/win/src/sandboxtarget/moz.build
index 3c28eebba226b..6ebc4a5cc50fa 100644
--- a/security/sandbox/win/src/sandboxtarget/moz.build
+++ b/security/sandbox/win/src/sandboxtarget/moz.build
@@ -20,3 +20,6 @@ LOCAL_INCLUDES += [
 DEFINES["UNICODE"] = True
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/automation/moz.build b/services/automation/moz.build
index 61b4815f4251a..13155b835e65d 100644
--- a/services/automation/moz.build
+++ b/services/automation/moz.build
@@ -12,3 +12,6 @@ EXTRA_COMPONENTS += [
 EXTRA_JS_MODULES["services-automation"] += [
     "ServicesAutomation.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/common/moz.build b/services/common/moz.build
index 3585dc5426161..bcc990e2a9f24 100644
--- a/services/common/moz.build
+++ b/services/common/moz.build
@@ -45,3 +45,6 @@ SPHINX_TREES["/services/common"] = "docs"
 XPCOM_MANIFESTS += [
     "app_services_logger/components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/common/tests/moz.build b/services/common/tests/moz.build
index 77d36223189ef..e6cde205dbaf6 100644
--- a/services/common/tests/moz.build
+++ b/services/common/tests/moz.build
@@ -7,3 +7,6 @@
 XPCSHELL_TESTS_MANIFESTS += ["unit/xpcshell.toml"]
 
 TEST_DIRS += ["unit"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/common/tests/unit/moz.build b/services/common/tests/unit/moz.build
index 568f361a54234..e0a4b0d541f38 100644
--- a/services/common/tests/unit/moz.build
+++ b/services/common/tests/unit/moz.build
@@ -3,3 +3,6 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/crypto/moz.build b/services/crypto/moz.build
index 4a1650cb6dd64..313bd4893d62e 100644
--- a/services/crypto/moz.build
+++ b/services/crypto/moz.build
@@ -18,3 +18,6 @@ EXTRA_JS_MODULES["services-crypto"] += [
 EXTRA_COMPONENTS += [
     "cryptoComponents.manifest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/docs/moz.build b/services/docs/moz.build
index 8eba15268d693..073acedfbad39 100644
--- a/services/docs/moz.build
+++ b/services/docs/moz.build
@@ -4,3 +4,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Sync")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/fxaccounts/moz.build b/services/fxaccounts/moz.build
index 0047122c2d3ed..888f3848729a8 100644
--- a/services/fxaccounts/moz.build
+++ b/services/fxaccounts/moz.build
@@ -36,3 +36,6 @@ EXTRA_JS_MODULES += [
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/interfaces/moz.build b/services/interfaces/moz.build
index 18b570f63cd5b..747ea5640108e 100644
--- a/services/interfaces/moz.build
+++ b/services/interfaces/moz.build
@@ -17,3 +17,6 @@ XPIDL_SOURCES += [
     "mozIInterruptible.idl",
     "mozIServicesLogSink.idl",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/moz.build b/services/moz.build
index 4ef95d88d209a..3a303993babab 100644
--- a/services/moz.build
+++ b/services/moz.build
@@ -27,3 +27,6 @@ if CONFIG["MOZ_SERVICES_SYNC"]:
     DIRS += ["sync"]
 
 SPHINX_TREES["/services"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/settings/Utils.sys.mjs b/services/settings/Utils.sys.mjs
index 73c83e526be1a..db5977c54221e 100644
--- a/services/settings/Utils.sys.mjs
+++ b/services/settings/Utils.sys.mjs
@@ -95,7 +95,7 @@ function _isUndefined(value) {
 
 export var Utils = {
   get SERVER_URL() {
-    return lazy.allowServerURLOverride
+    return true || lazy.allowServerURLOverride
       ? lazy.gServerURL
       : AppConstants.REMOTE_SETTINGS_SERVER_URL;
   },
@@ -108,6 +108,9 @@ export var Utils = {
   log,
 
   get shouldSkipRemoteActivityDueToTests() {
+    // Playwright does not set Cu.isInAutomation, hence we just return true
+    // here in order to disable the remote activity.
+    return true;
     return (
       (lazy.isRunningTests || Cu.isInAutomation) &&
       this.SERVER_URL == "data:,#remote-settings-dummy/v1"
diff --git a/services/settings/dumps/blocklists/moz.build b/services/settings/dumps/blocklists/moz.build
index 8ace1d05417dc..ac78a845fcba7 100644
--- a/services/settings/dumps/blocklists/moz.build
+++ b/services/settings/dumps/blocklists/moz.build
@@ -22,3 +22,6 @@ FINAL_TARGET_FILES.defaults.settings.blocklists["addons-bloomfilters"] += [
 
 if CONFIG["MOZ_BUILD_APP"] == "browser":
     DIST_SUBDIR = "browser"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/settings/dumps/main/moz.build b/services/settings/dumps/main/moz.build
index 6352c00f5d265..790248f9f6986 100644
--- a/services/settings/dumps/main/moz.build
+++ b/services/settings/dumps/main/moz.build
@@ -119,3 +119,6 @@ FINAL_TARGET_FILES.defaults.settings.main["search-config-icons"] += [
 
 if CONFIG["MOZ_BUILD_APP"] == "browser":
     DIST_SUBDIR = "browser"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/settings/dumps/moz.build b/services/settings/dumps/moz.build
index f407580bfa647..81abc2dd65b8a 100644
--- a/services/settings/dumps/moz.build
+++ b/services/settings/dumps/moz.build
@@ -14,3 +14,6 @@ FINAL_TARGET_FILES.defaults.settings += ["!%s" % dump_summary]
 
 if CONFIG["MOZ_BUILD_APP"] == "browser":
     DIST_SUBDIR = "browser"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/settings/dumps/security-state/moz.build b/services/settings/dumps/security-state/moz.build
index 9133cd4e3ed69..48b94c30382d6 100644
--- a/services/settings/dumps/security-state/moz.build
+++ b/services/settings/dumps/security-state/moz.build
@@ -9,3 +9,6 @@ FINAL_TARGET_FILES.defaults.settings["security-state"] += [
 
 if CONFIG["MOZ_BUILD_APP"] == "browser":
     DIST_SUBDIR = "browser"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/settings/moz.build b/services/settings/moz.build
index 6c3f622d56d9e..ad5b4a6b20daf 100644
--- a/services/settings/moz.build
+++ b/services/settings/moz.build
@@ -35,3 +35,6 @@ XPCOM_MANIFESTS += [
 XPCSHELL_TESTS_MANIFESTS += ["test/unit/xpcshell.toml"]
 
 SPHINX_TREES["/services/settings"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/settings/static-dumps/main/moz.build b/services/settings/static-dumps/main/moz.build
index cc7658a22a7eb..46bcac1382296 100644
--- a/services/settings/static-dumps/main/moz.build
+++ b/services/settings/static-dumps/main/moz.build
@@ -9,3 +9,6 @@ FINAL_TARGET_FILES.defaults.settings.main += [
 
 if CONFIG["MOZ_BUILD_APP"] == "browser":
     DIST_SUBDIR = "browser"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/settings/static-dumps/moz.build b/services/settings/static-dumps/moz.build
index 557c1d80d958c..bbb9f0114627e 100644
--- a/services/settings/static-dumps/moz.build
+++ b/services/settings/static-dumps/moz.build
@@ -5,3 +5,6 @@
 DIRS += [
     "main",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/services/sync/moz.build b/services/sync/moz.build
index a00472056ebf3..05bec464209a5 100644
--- a/services/sync/moz.build
+++ b/services/sync/moz.build
@@ -70,3 +70,6 @@ TESTING_JS_MODULES.services.sync += [
 ]
 
 SPHINX_TREES["/services/sync"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/servo/components/style/gecko/media_features.rs b/servo/components/style/gecko/media_features.rs
index c9ad30b28b069..f32dbcfe26fe2 100644
--- a/servo/components/style/gecko/media_features.rs
+++ b/servo/components/style/gecko/media_features.rs
@@ -293,10 +293,15 @@ pub enum ForcedColors {
 
 /// https://drafts.csswg.org/mediaqueries-5/#forced-colors
 fn eval_forced_colors(context: &Context, query_value: Option<ForcedColors>) -> bool {
-    let forced = !context.device().use_document_colors();
+    let prefers_forced_colors =
+        unsafe { bindings::Gecko_MediaFeatures_ForcedColors(context.device().document()) };
+    let query_value = match query_value {
+        Some(v) => v,
+        None => return prefers_forced_colors,
+    };
     match query_value {
-        Some(query_value) => forced == (query_value == ForcedColors::Active),
-        None => forced,
+        ForcedColors::Active => prefers_forced_colors,
+        ForcedColors::None => !prefers_forced_colors,
     }
 }
 
diff --git a/servo/moz.build b/servo/moz.build
index 7ca6de73a5c25..dfd59b5608580 100644
--- a/servo/moz.build
+++ b/servo/moz.build
@@ -27,3 +27,6 @@ with Files("ports/geckolib/**"):
 
 with Files("tests/unit/style/**"):
     BUG_COMPONENT = ("Core", "CSS Parsing and Computation")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/startupcache/moz.build b/startupcache/moz.build
index 767c856dab847..47518f64056f2 100644
--- a/startupcache/moz.build
+++ b/startupcache/moz.build
@@ -32,3 +32,6 @@ XPIDL_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/startupcache/test/moz.build b/startupcache/test/moz.build
index 01976593096a4..842b9ad8de188 100644
--- a/startupcache/test/moz.build
+++ b/startupcache/test/moz.build
@@ -8,3 +8,6 @@ UNIFIED_SOURCES += [
     "TestStartupCache.cpp",
 ]
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/storage/build/moz.build b/storage/build/moz.build
index 0af582bb734ca..0662d1acdb485 100644
--- a/storage/build/moz.build
+++ b/storage/build/moz.build
@@ -15,3 +15,6 @@ XPCOM_MANIFESTS += [
 FINAL_LIBRARY = "xul"
 
 CXXFLAGS += CONFIG["SQLITE_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/storage/moz.build b/storage/moz.build
index 3dc1cd4bf7d77..72db96f5c0413 100644
--- a/storage/moz.build
+++ b/storage/moz.build
@@ -110,3 +110,6 @@ if CONFIG["MOZ_FOLD_LIBS"]:
     DEFINES["MOZ_FOLD_LIBS"] = True
 
 CXXFLAGS += CONFIG["SQLITE_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/storage/test/gtest/moz.build b/storage/test/gtest/moz.build
index db15c440f8962..feddcb7ec2597 100644
--- a/storage/test/gtest/moz.build
+++ b/storage/test/gtest/moz.build
@@ -38,3 +38,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/storage/test/moz.build b/storage/test/moz.build
index 7dd21f5fe24c7..7163111d9b216 100644
--- a/storage/test/moz.build
+++ b/storage/test/moz.build
@@ -11,3 +11,6 @@ TEST_DIRS += ["gtest"]
 TESTING_JS_MODULES += [
     "unit/VacuumParticipant.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/supply-chain/moz.build b/supply-chain/moz.build
index 8366935dc87b0..ba7bf2ce63ff9 100644
--- a/supply-chain/moz.build
+++ b/supply-chain/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox Build System", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/taskcluster/ci/fetch/moz.build b/taskcluster/ci/fetch/moz.build
index 28b8003edf36a..4430c61ed280a 100644
--- a/taskcluster/ci/fetch/moz.build
+++ b/taskcluster/ci/fetch/moz.build
@@ -6,3 +6,6 @@
 
 with Files("updatebot.yml"):
     BUG_COMPONENT = ("Developer Infrastructure", "Mach Vendor & Updatebot")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/taskcluster/ci/updatebot/moz.build b/taskcluster/ci/updatebot/moz.build
index 315dc32600c24..27d0f8e4e31f1 100644
--- a/taskcluster/ci/updatebot/moz.build
+++ b/taskcluster/ci/updatebot/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Developer Infrastructure", "Mach Vendor & Updatebot")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/taskcluster/docker/updatebot/moz.build b/taskcluster/docker/updatebot/moz.build
index 315dc32600c24..27d0f8e4e31f1 100644
--- a/taskcluster/docker/updatebot/moz.build
+++ b/taskcluster/docker/updatebot/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Developer Infrastructure", "Mach Vendor & Updatebot")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/taskcluster/moz.build b/taskcluster/moz.build
index f51f6dd51d3f8..a99dce0f1c032 100644
--- a/taskcluster/moz.build
+++ b/taskcluster/moz.build
@@ -16,3 +16,6 @@ SPHINX_PYTHON_PACKAGE_DIRS += ["gecko_taskgraph"]
 
 with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/taskcluster/scripts/misc/moz.build b/taskcluster/scripts/misc/moz.build
index 3b5b0e1e58346..94f2b4cdf445c 100644
--- a/taskcluster/scripts/misc/moz.build
+++ b/taskcluster/scripts/misc/moz.build
@@ -6,3 +6,6 @@
 
 with Files("verify-updatebot.py"):
     BUG_COMPONENT = ("Developer Infrastructure", "Mach Vendor & Updatebot")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/awsy/moz.build b/testing/awsy/moz.build
index b3360f0f4b0ee..c15519b4d4aa6 100644
--- a/testing/awsy/moz.build
+++ b/testing/awsy/moz.build
@@ -7,3 +7,6 @@
 with Files("awsy/**"):
     BUG_COMPONENT = ("Testing", "AWSY")
     SCHEDULES.exclusive = ["awsy"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/condprofile/moz.build b/testing/condprofile/moz.build
index 94cd2f1555b30..a15720115c17d 100644
--- a/testing/condprofile/moz.build
+++ b/testing/condprofile/moz.build
@@ -5,3 +5,6 @@
 with Files("**"):
     BUG_COMPONENT = ("Testing", "Condprofile")
     SCHEDULES.exclusive = ["condprofile"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/config/moz.build b/testing/config/moz.build
index 4d3977799c10f..dda34e0c96cbb 100644
--- a/testing/config/moz.build
+++ b/testing/config/moz.build
@@ -19,3 +19,6 @@ with Files("telemetry*"):
 
 with Files("tooltool-manifests/**"):
     BUG_COMPONENT = ("Release Engineering", "Applications: MozharnessCore")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/crashtest/moz.build b/testing/crashtest/moz.build
index 2d9b9d6842a27..03faed48629b2 100644
--- a/testing/crashtest/moz.build
+++ b/testing/crashtest/moz.build
@@ -7,3 +7,6 @@
 with Files("**"):
     BUG_COMPONENT = ("Testing", "Reftest")
     SCHEDULES.exclusive = ["crashtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/extensions/moz.build b/testing/extensions/moz.build
index 5689d31985775..a115c773403a3 100644
--- a/testing/extensions/moz.build
+++ b/testing/extensions/moz.build
@@ -3,3 +3,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 # This file will be overwritten when adding custom extension tests.
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/firefox-ui/moz.build b/testing/firefox-ui/moz.build
index e23fa6ac36043..df00d9a28b408 100644
--- a/testing/firefox-ui/moz.build
+++ b/testing/firefox-ui/moz.build
@@ -7,3 +7,6 @@ FIREFOX_UI_FUNCTIONAL_MANIFESTS += ["tests/functional/manifest.toml"]
 with Files("**"):
     BUG_COMPONENT = ("Testing", "Firefox UI Tests")
     SCHEDULES.exclusive = ["firefox-ui"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/geckodriver/moz.build b/testing/geckodriver/moz.build
index 1964156bc7dc9..b3371cc6363d7 100644
--- a/testing/geckodriver/moz.build
+++ b/testing/geckodriver/moz.build
@@ -28,3 +28,6 @@ with Files("doc/**"):
 
 COMPILE_FLAGS["BASE_INCLUDES"] = []
 HOST_COMPILE_FLAGS["BASE_INCLUDES"] = []
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/gtest/benchmark/moz.build b/testing/gtest/benchmark/moz.build
index 19cd3aee4525b..a2ace0aa8e522 100644
--- a/testing/gtest/benchmark/moz.build
+++ b/testing/gtest/benchmark/moz.build
@@ -9,3 +9,6 @@ if CONFIG["ENABLE_TESTS"]:
     ]
 
     FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/gtest/moz.build b/testing/gtest/moz.build
index 5d51f208ebc21..a40e39eba9182 100644
--- a/testing/gtest/moz.build
+++ b/testing/gtest/moz.build
@@ -19,3 +19,6 @@ if CONFIG["ENABLE_TESTS"]:
     ]
 
     DIRS += ["benchmark", "mozilla", "../../third_party/googletest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/gtest/mozilla/moz.build b/testing/gtest/mozilla/moz.build
index e5cccadd180d3..0546bff2ed087 100644
--- a/testing/gtest/mozilla/moz.build
+++ b/testing/gtest/mozilla/moz.build
@@ -38,3 +38,6 @@ if CONFIG["ENABLE_TESTS"]:
         ]
 
     FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/marionette/moz.build b/testing/marionette/moz.build
index 1986d20904244..c9fd654a83c33 100644
--- a/testing/marionette/moz.build
+++ b/testing/marionette/moz.build
@@ -11,3 +11,6 @@ with Files("harness/**"):
     SCHEDULES.exclusive = ["marionette", "firefox-ui"]
 
 SPHINX_PYTHON_PACKAGE_DIRS += ["client/marionette_driver"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mochitest/BrowserTestUtils/moz.build b/testing/mochitest/BrowserTestUtils/moz.build
index 24095eae702ed..6c1d3a781ddb6 100644
--- a/testing/mochitest/BrowserTestUtils/moz.build
+++ b/testing/mochitest/BrowserTestUtils/moz.build
@@ -13,3 +13,6 @@ TESTING_JS_MODULES += [
     "ContentEventListenerParent.sys.mjs",
     "ContentTask.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mochitest/manifests/moz.build b/testing/mochitest/manifests/moz.build
index 01da50873cca1..5280f7eba5592 100644
--- a/testing/mochitest/manifests/moz.build
+++ b/testing/mochitest/manifests/moz.build
@@ -7,3 +7,6 @@
 TEST_HARNESS_FILES.testing.mochitest.manifests += [
     "emulator-jb.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mochitest/moz.build b/testing/mochitest/moz.build
index 0690cd89b5b4c..1f98240c6c092 100644
--- a/testing/mochitest/moz.build
+++ b/testing/mochitest/moz.build
@@ -269,3 +269,6 @@ with Files("**"):
 
 with Files("*remote*"):
     BUG_COMPONENT = ("GeckoView", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mochitest/ssltunnel/moz.build b/testing/mochitest/ssltunnel/moz.build
index f9f6227153a6f..d73cf0a7e4fee 100644
--- a/testing/mochitest/ssltunnel/moz.build
+++ b/testing/mochitest/ssltunnel/moz.build
@@ -18,3 +18,6 @@ USE_LIBS += [
 # This isn't XPCOM code, but it wants to use STL, so disable the STL
 # wrappers
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mochitest/tests/SimpleTest/moz.build b/testing/mochitest/tests/SimpleTest/moz.build
index 55c54e6255e2b..bcd0e673131e3 100644
--- a/testing/mochitest/tests/SimpleTest/moz.build
+++ b/testing/mochitest/tests/SimpleTest/moz.build
@@ -25,3 +25,6 @@ TEST_HARNESS_FILES.testing.mochitest.tests.SimpleTest += [
     "WorkerHandler.js",
     "WorkerSimpleTest.js",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mochitest/tests/moz.build b/testing/mochitest/tests/moz.build
index e265d56c14334..e246bf06c4cf2 100644
--- a/testing/mochitest/tests/moz.build
+++ b/testing/mochitest/tests/moz.build
@@ -9,3 +9,6 @@ DIRS += ["SimpleTest"]
 MOCHITEST_MANIFESTS += ["Harness_sanity/mochitest.toml"]
 XPCSHELL_TESTS_MANIFESTS += ["Harness_sanity/xpcshell.toml"]
 BROWSER_CHROME_MANIFESTS += ["browser/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/modules/moz.build b/testing/modules/moz.build
index f078152ce35b4..d7ec50e5c615a 100644
--- a/testing/modules/moz.build
+++ b/testing/modules/moz.build
@@ -37,3 +37,6 @@ with Files("tests/xpcshell/**"):
 
 with Files("tests/browser/**"):
     BUG_COMPONENT = ("Testing", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/moz.build b/testing/moz.build
index cfc06ded243bd..60d98746f365e 100644
--- a/testing/moz.build
+++ b/testing/moz.build
@@ -17,3 +17,6 @@ DIRS += ["mozbase"]
 PERFTESTS_MANIFESTS += [
     "performance/perftest.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mozbase/moz.build b/testing/mozbase/moz.build
index 8d44dbc852d58..96478f6bf7781 100644
--- a/testing/mozbase/moz.build
+++ b/testing/mozbase/moz.build
@@ -68,3 +68,6 @@ with Files("**"):
 
 with Files("rust/**"):
     BUG_COMPONENT = ("Testing", "Mozbase Rust")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mozbase/moztest/tests/data/srcdir/apple/moz.build b/testing/mozbase/moztest/tests/data/srcdir/apple/moz.build
index f86a251ad9e48..f208a84abd1b3 100644
--- a/testing/mozbase/moztest/tests/data/srcdir/apple/moz.build
+++ b/testing/mozbase/moztest/tests/data/srcdir/apple/moz.build
@@ -1 +1,4 @@
 A11Y_MANIFESTS += ["a11y.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mozbase/moztest/tests/data/srcdir/banana/moz.build b/testing/mozbase/moztest/tests/data/srcdir/banana/moz.build
index b71e5e29a1234..bb8c365f0870f 100644
--- a/testing/mozbase/moztest/tests/data/srcdir/banana/moz.build
+++ b/testing/mozbase/moztest/tests/data/srcdir/banana/moz.build
@@ -1 +1,4 @@
 XPCSHELL_TESTS_MANIFESTS += ["xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mozbase/moztest/tests/data/srcdir/carrot/moz.build b/testing/mozbase/moztest/tests/data/srcdir/carrot/moz.build
index a82183c0bc563..8199fb7fbc019 100644
--- a/testing/mozbase/moztest/tests/data/srcdir/carrot/moz.build
+++ b/testing/mozbase/moztest/tests/data/srcdir/carrot/moz.build
@@ -1 +1,4 @@
 XPCSHELL_TESTS_MANIFESTS += ["xpcshell-one.toml", "xpcshell-two.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mozbase/moztest/tests/data/srcdir/dragonfruit/moz.build b/testing/mozbase/moztest/tests/data/srcdir/dragonfruit/moz.build
index b71e5e29a1234..bb8c365f0870f 100644
--- a/testing/mozbase/moztest/tests/data/srcdir/dragonfruit/moz.build
+++ b/testing/mozbase/moztest/tests/data/srcdir/dragonfruit/moz.build
@@ -1 +1,4 @@
 XPCSHELL_TESTS_MANIFESTS += ["xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mozbase/moztest/tests/data/srcdir/fig/moz.build b/testing/mozbase/moztest/tests/data/srcdir/fig/moz.build
index 8f46de2e35727..0cacaffcccf96 100644
--- a/testing/mozbase/moztest/tests/data/srcdir/fig/moz.build
+++ b/testing/mozbase/moztest/tests/data/srcdir/fig/moz.build
@@ -2,3 +2,6 @@ ANDROID_INSTRUMENTATION_MANIFESTS += [
     "grape/instrumentation.toml",
     "huckleberry/instrumentation.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mozbase/moztest/tests/data/srcdir/moz.build b/testing/mozbase/moztest/tests/data/srcdir/moz.build
index 9de14eb3fc81c..79c419ec42225 100644
--- a/testing/mozbase/moztest/tests/data/srcdir/moz.build
+++ b/testing/mozbase/moztest/tests/data/srcdir/moz.build
@@ -2,3 +2,6 @@ BROWSER_CHROME_MANIFESTS += [
     "juniper/browser.toml",
     "kiwi/browser.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/mozharness/moz.build b/testing/mozharness/moz.build
index 5bc4cdad9b0fb..0b5ebd1914074 100644
--- a/testing/mozharness/moz.build
+++ b/testing/mozharness/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Release Engineering", "Applications: MozharnessCore")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/perfdocs/moz.build b/testing/perfdocs/moz.build
index 9905709937d4c..e058bfc2e8fc4 100644
--- a/testing/perfdocs/moz.build
+++ b/testing/perfdocs/moz.build
@@ -1 +1,4 @@
 SPHINX_TREES["/testing/perfdocs"] = "generated"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/profiles/moz.build b/testing/profiles/moz.build
index 579b510d4d404..d4f57c9ab67f9 100644
--- a/testing/profiles/moz.build
+++ b/testing/profiles/moz.build
@@ -24,3 +24,6 @@ TEST_HARNESS_FILES["web-platform"].prefs += profile_files
 
 with Files("**"):
     BUG_COMPONENT = ("Testing", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/raptor/moz.build b/testing/raptor/moz.build
index 7d2d5695f3bd5..ff426e14d8341 100644
--- a/testing/raptor/moz.build
+++ b/testing/raptor/moz.build
@@ -5,3 +5,6 @@
 with Files("**"):
     BUG_COMPONENT = ("Testing", "Raptor")
     SCHEDULES.exclusive = ["raptor"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/runtimes/moz.build b/testing/runtimes/moz.build
index 8f7942d3b7178..87055e8516a30 100644
--- a/testing/runtimes/moz.build
+++ b/testing/runtimes/moz.build
@@ -10,3 +10,6 @@ TEST_HARNESS_FILES.testing.mochitest.runtimes += [
 
 with Files("**"):
     BUG_COMPONENT = ("Testing", "Mochitest")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/specialpowers/moz.build b/testing/specialpowers/moz.build
index 7a2413e2a2c1b..30bb59e689fb8 100644
--- a/testing/specialpowers/moz.build
+++ b/testing/specialpowers/moz.build
@@ -38,3 +38,6 @@ FINAL_TARGET_FILES.modules += modules
 
 with Files("**"):
     BUG_COMPONENT = ("Testing", "Mochitest")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/talos/moz.build b/testing/talos/moz.build
index 02ec61441c762..f1b9ebf4b7c31 100644
--- a/testing/talos/moz.build
+++ b/testing/talos/moz.build
@@ -55,3 +55,6 @@ with Files("talos/tests/video/**"):
 
 with Files("talos/tests/webgl/**"):
     BUG_COMPONENT = ("Core", "Graphics: CanvasWebGL")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/tools/minidumpwriter/moz.build b/testing/tools/minidumpwriter/moz.build
index 7528da9430d53..93ed47ab228b0 100644
--- a/testing/tools/minidumpwriter/moz.build
+++ b/testing/tools/minidumpwriter/moz.build
@@ -17,3 +17,6 @@ if CONFIG["ENABLE_TESTS"] and CONFIG["OS_ARCH"] == "WINNT":
         WIN32_EXE_LDFLAGS += ["-municode"]
 
 NO_PGO = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/tools/moz.build b/testing/tools/moz.build
index 096f256d4e81e..26dca834d09f3 100644
--- a/testing/tools/moz.build
+++ b/testing/tools/moz.build
@@ -15,3 +15,6 @@ with Files("minidumpwriter/**"):
 
 with Files("websocketprocessbridge/**"):
     BUG_COMPONENT = ("Core", "WebRTC: Networking")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/tools/screenshot/moz.build b/testing/tools/screenshot/moz.build
index 14b9b321ba7d3..b0932df03b9bd 100644
--- a/testing/tools/screenshot/moz.build
+++ b/testing/tools/screenshot/moz.build
@@ -29,3 +29,6 @@ elif CONFIG["MOZ_WIDGET_TOOLKIT"] == "windows":
 
 NO_PGO = True
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/tps/moz.build b/testing/tps/moz.build
index 06a74e1bfc5b4..e58a33033d7d6 100644
--- a/testing/tps/moz.build
+++ b/testing/tps/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Testing", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/web-platform/moz.build b/testing/web-platform/moz.build
index a32967e1b18bc..209ccba19a341 100644
--- a/testing/web-platform/moz.build
+++ b/testing/web-platform/moz.build
@@ -799,3 +799,6 @@ with Files("tests/x-frame-options/**"):
     BUG_COMPONENT = ("Core", "DOM: Security")
 
 SPHINX_TREES["/web-platform"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/webdriver/moz.build b/testing/webdriver/moz.build
index 88b907e6f27e1..e2cfa19901c14 100644
--- a/testing/webdriver/moz.build
+++ b/testing/webdriver/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Testing", "geckodriver")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/xpcshell/example/moz.build b/testing/xpcshell/example/moz.build
index 194bd3f7a03ee..c3632b76c7ea0 100644
--- a/testing/xpcshell/example/moz.build
+++ b/testing/xpcshell/example/moz.build
@@ -10,3 +10,6 @@ XPCSHELL_TESTS_MANIFESTS += [
     "unit/xpcshell-with-prefs.toml",
     "unit/xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/testing/xpcshell/moz.build b/testing/xpcshell/moz.build
index 727f16eddbe2a..a10e7196eca44 100644
--- a/testing/xpcshell/moz.build
+++ b/testing/xpcshell/moz.build
@@ -13,3 +13,6 @@ TESTING_JS_MODULES += [
 with Files("**"):
     BUG_COMPONENT = ("Testing", "XPCShell Harness")
     SCHEDULES.exclusive = ["xpcshell", "xpcshell-coverage"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/drm/libdrm/moz.build b/third_party/drm/libdrm/moz.build
index 3c5ebbf1e0786..c7b61eda24f01 100644
--- a/third_party/drm/libdrm/moz.build
+++ b/third_party/drm/libdrm/moz.build
@@ -17,3 +17,6 @@ LOCAL_INCLUDES += [
     ]
 
 FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/drm/moz.build b/third_party/drm/moz.build
index 970a82391267a..3da9bacdd59eb 100644
--- a/third_party/drm/moz.build
+++ b/third_party/drm/moz.build
@@ -4,3 +4,6 @@ if CONFIG['MOZ_WEBRTC']:
         'drm/xf86drm.h',
     ]
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/gbm/libgbm/moz.build b/third_party/gbm/libgbm/moz.build
index 0953d2f17a540..d3c2a817c5f84 100644
--- a/third_party/gbm/libgbm/moz.build
+++ b/third_party/gbm/libgbm/moz.build
@@ -14,3 +14,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 LOCAL_INCLUDES += ['/third_party/gbm']
 
 FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/gbm/moz.build b/third_party/gbm/moz.build
index 1bac699bb3a40..e0ebd4095e6ac 100644
--- a/third_party/gbm/moz.build
+++ b/third_party/gbm/moz.build
@@ -3,3 +3,6 @@ if CONFIG['MOZ_WEBRTC']:
 	'gbm/gbm.h',
     ]
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/googletest/moz.build b/third_party/googletest/moz.build
index 2d36b89489f1d..26df66cce627f 100644
--- a/third_party/googletest/moz.build
+++ b/third_party/googletest/moz.build
@@ -113,3 +113,6 @@ if CONFIG["ENABLE_TESTS"]:
         DEFINES["UNICODE"] = True
 
     FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libepoxy/moz.build b/third_party/libepoxy/moz.build
index cfcefe2bf0eb5..1f1ffc02c8681 100644
--- a/third_party/libepoxy/moz.build
+++ b/third_party/libepoxy/moz.build
@@ -31,3 +31,6 @@ CFLAGS += [
 
 FINAL_LIBRARY = 'xul'
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libsrtp/src/moz.build b/third_party/libsrtp/src/moz.build
index ec0e2de009638..edbc75a42ef43 100644
--- a/third_party/libsrtp/src/moz.build
+++ b/third_party/libsrtp/src/moz.build
@@ -75,3 +75,6 @@ if CONFIG['OS_TARGET'] == 'WINNT':
     DEFINES['inline'] = '__inline'
 else:
     DEFINES['HAVE_NETINET_IN_H'] = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/adaptation/resource_adaptation_api_gn/moz.build b/third_party/libwebrtc/api/adaptation/resource_adaptation_api_gn/moz.build
index c06f943d1b759..2553de7b9673c 100644
--- a/third_party/libwebrtc/api/adaptation/resource_adaptation_api_gn/moz.build
+++ b/third_party/libwebrtc/api/adaptation/resource_adaptation_api_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("resource_adaptation_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/array_view_gn/moz.build b/third_party/libwebrtc/api/array_view_gn/moz.build
index e89811c36f3a7..7617672d00f48 100644
--- a/third_party/libwebrtc/api/array_view_gn/moz.build
+++ b/third_party/libwebrtc/api/array_view_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("array_view_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio/aec3_config_gn/moz.build b/third_party/libwebrtc/api/audio/aec3_config_gn/moz.build
index 4b96910919081..0f9a54a4cbdb7 100644
--- a/third_party/libwebrtc/api/audio/aec3_config_gn/moz.build
+++ b/third_party/libwebrtc/api/audio/aec3_config_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("aec3_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio/aec3_factory_gn/moz.build b/third_party/libwebrtc/api/audio/aec3_factory_gn/moz.build
index de044719ccf59..84a5dd4239af0 100644
--- a/third_party/libwebrtc/api/audio/aec3_factory_gn/moz.build
+++ b/third_party/libwebrtc/api/audio/aec3_factory_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("aec3_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio/audio_frame_api_gn/moz.build b/third_party/libwebrtc/api/audio/audio_frame_api_gn/moz.build
index ca2c90ecfa0dc..ac7a34eb6ca18 100644
--- a/third_party/libwebrtc/api/audio/audio_frame_api_gn/moz.build
+++ b/third_party/libwebrtc/api/audio/audio_frame_api_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_frame_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio/audio_frame_processor_gn/moz.build b/third_party/libwebrtc/api/audio/audio_frame_processor_gn/moz.build
index 87847bb863f09..99a08b58cc547 100644
--- a/third_party/libwebrtc/api/audio/audio_frame_processor_gn/moz.build
+++ b/third_party/libwebrtc/api/audio/audio_frame_processor_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_frame_processor_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio/audio_mixer_api_gn/moz.build b/third_party/libwebrtc/api/audio/audio_mixer_api_gn/moz.build
index 27baf1a796562..2cf1d2c140364 100644
--- a/third_party/libwebrtc/api/audio/audio_mixer_api_gn/moz.build
+++ b/third_party/libwebrtc/api/audio/audio_mixer_api_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_mixer_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio/echo_control_gn/moz.build b/third_party/libwebrtc/api/audio/echo_control_gn/moz.build
index 6a5ce44f46f96..91cfb50b37175 100644
--- a/third_party/libwebrtc/api/audio/echo_control_gn/moz.build
+++ b/third_party/libwebrtc/api/audio/echo_control_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("echo_control_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/L16/audio_decoder_L16_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/L16/audio_decoder_L16_gn/moz.build
index 9ab87e6a0e844..037cc9ae082c7 100644
--- a/third_party/libwebrtc/api/audio_codecs/L16/audio_decoder_L16_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/L16/audio_decoder_L16_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_decoder_L16_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/L16/audio_encoder_L16_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/L16/audio_encoder_L16_gn/moz.build
index 0efa8c28a2195..caabcf4fbed3d 100644
--- a/third_party/libwebrtc/api/audio_codecs/L16/audio_encoder_L16_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/L16/audio_encoder_L16_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_L16_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/audio_codecs_api_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/audio_codecs_api_gn/moz.build
index 6c8b6b3b2b89d..d5a0c6b6a4fdb 100644
--- a/third_party/libwebrtc/api/audio_codecs/audio_codecs_api_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/audio_codecs_api_gn/moz.build
@@ -233,3 +233,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_codecs_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/builtin_audio_decoder_factory_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/builtin_audio_decoder_factory_gn/moz.build
index f64e3e3340757..13c4bc869239a 100644
--- a/third_party/libwebrtc/api/audio_codecs/builtin_audio_decoder_factory_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/builtin_audio_decoder_factory_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("builtin_audio_decoder_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/builtin_audio_encoder_factory_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/builtin_audio_encoder_factory_gn/moz.build
index 6965c4298fe3d..ad926755f6d05 100644
--- a/third_party/libwebrtc/api/audio_codecs/builtin_audio_encoder_factory_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/builtin_audio_encoder_factory_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("builtin_audio_encoder_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/g711/audio_decoder_g711_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/g711/audio_decoder_g711_gn/moz.build
index e0dcf8f032749..de29946dbe22f 100644
--- a/third_party/libwebrtc/api/audio_codecs/g711/audio_decoder_g711_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/g711/audio_decoder_g711_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_decoder_g711_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/g711/audio_encoder_g711_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/g711/audio_encoder_g711_gn/moz.build
index 708744cf3b724..0433c4031081d 100644
--- a/third_party/libwebrtc/api/audio_codecs/g711/audio_encoder_g711_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/g711/audio_encoder_g711_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_g711_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/g722/audio_decoder_g722_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/g722/audio_decoder_g722_gn/moz.build
index 4b96ef2068797..c723fbd27fac0 100644
--- a/third_party/libwebrtc/api/audio_codecs/g722/audio_decoder_g722_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/g722/audio_decoder_g722_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_decoder_g722_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/g722/audio_encoder_g722_config_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/g722/audio_encoder_g722_config_gn/moz.build
index bddf7d557198c..7c81b9504c189 100644
--- a/third_party/libwebrtc/api/audio_codecs/g722/audio_encoder_g722_config_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/g722/audio_encoder_g722_config_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_g722_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/g722/audio_encoder_g722_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/g722/audio_encoder_g722_gn/moz.build
index e35ace4e0ab90..44ae244c5f8cb 100644
--- a/third_party/libwebrtc/api/audio_codecs/g722/audio_encoder_g722_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/g722/audio_encoder_g722_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_g722_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/ilbc/audio_decoder_ilbc_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/ilbc/audio_decoder_ilbc_gn/moz.build
index 123ba8eb1c6f9..3cf59e98ead36 100644
--- a/third_party/libwebrtc/api/audio_codecs/ilbc/audio_decoder_ilbc_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/ilbc/audio_decoder_ilbc_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_decoder_ilbc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/ilbc/audio_encoder_ilbc_config_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/ilbc/audio_encoder_ilbc_config_gn/moz.build
index 843a9aee3bc93..d2ef6102c5fb1 100644
--- a/third_party/libwebrtc/api/audio_codecs/ilbc/audio_encoder_ilbc_config_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/ilbc/audio_encoder_ilbc_config_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_ilbc_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/ilbc/audio_encoder_ilbc_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/ilbc/audio_encoder_ilbc_gn/moz.build
index a01bbe78d5af0..8df82f982c7d2 100644
--- a/third_party/libwebrtc/api/audio_codecs/ilbc/audio_encoder_ilbc_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/ilbc/audio_encoder_ilbc_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_ilbc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_multiopus_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_multiopus_gn/moz.build
index fec5701696ded..8b3a959782682 100644
--- a/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_multiopus_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_multiopus_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_decoder_multiopus_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_opus_config_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_opus_config_gn/moz.build
index 41887d1871595..b5ca4fed0822f 100644
--- a/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_opus_config_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_opus_config_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_decoder_opus_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_opus_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_opus_gn/moz.build
index 9c9bbb415b262..37206809b8deb 100644
--- a/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_opus_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/opus/audio_decoder_opus_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_decoder_opus_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_multiopus_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_multiopus_gn/moz.build
index ec36454e9f09d..ab37afd16b36b 100644
--- a/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_multiopus_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_multiopus_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_multiopus_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_opus_config_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_opus_config_gn/moz.build
index 6c061ce58f6b9..54b301c45f61c 100644
--- a/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_opus_config_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_opus_config_gn/moz.build
@@ -224,3 +224,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_opus_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_opus_gn/moz.build b/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_opus_gn/moz.build
index b5c0f484ad6ee..0068d796a1473 100644
--- a/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_opus_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_codecs/opus/audio_encoder_opus_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_opus_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/audio_options_api_gn/moz.build b/third_party/libwebrtc/api/audio_options_api_gn/moz.build
index f31b23065002f..b2728b2a79360 100644
--- a/third_party/libwebrtc/api/audio_options_api_gn/moz.build
+++ b/third_party/libwebrtc/api/audio_options_api_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_options_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/bitrate_allocation_gn/moz.build b/third_party/libwebrtc/api/bitrate_allocation_gn/moz.build
index dcf9b27ca369d..de7e874ac9a09 100644
--- a/third_party/libwebrtc/api/bitrate_allocation_gn/moz.build
+++ b/third_party/libwebrtc/api/bitrate_allocation_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bitrate_allocation_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/call_api_gn/moz.build b/third_party/libwebrtc/api/call_api_gn/moz.build
index 5c4a7f29a0050..e5b53eefb86d5 100644
--- a/third_party/libwebrtc/api/call_api_gn/moz.build
+++ b/third_party/libwebrtc/api/call_api_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("call_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/callfactory_api_gn/moz.build b/third_party/libwebrtc/api/callfactory_api_gn/moz.build
index a67107994317b..aa6a399925530 100644
--- a/third_party/libwebrtc/api/callfactory_api_gn/moz.build
+++ b/third_party/libwebrtc/api/callfactory_api_gn/moz.build
@@ -218,3 +218,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("callfactory_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/crypto/frame_decryptor_interface_gn/moz.build b/third_party/libwebrtc/api/crypto/frame_decryptor_interface_gn/moz.build
index 65794fbdd2ac4..55c48b160f07d 100644
--- a/third_party/libwebrtc/api/crypto/frame_decryptor_interface_gn/moz.build
+++ b/third_party/libwebrtc/api/crypto/frame_decryptor_interface_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_decryptor_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/crypto/frame_encryptor_interface_gn/moz.build b/third_party/libwebrtc/api/crypto/frame_encryptor_interface_gn/moz.build
index 19352a6da41ce..830301fe31dcf 100644
--- a/third_party/libwebrtc/api/crypto/frame_encryptor_interface_gn/moz.build
+++ b/third_party/libwebrtc/api/crypto/frame_encryptor_interface_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_encryptor_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/crypto/options_gn/moz.build b/third_party/libwebrtc/api/crypto/options_gn/moz.build
index 3219fce47f9c8..bb273e04355ff 100644
--- a/third_party/libwebrtc/api/crypto/options_gn/moz.build
+++ b/third_party/libwebrtc/api/crypto/options_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("options_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/fec_controller_api_gn/moz.build b/third_party/libwebrtc/api/fec_controller_api_gn/moz.build
index a0129cce5aa17..f2f1a7befab33 100644
--- a/third_party/libwebrtc/api/fec_controller_api_gn/moz.build
+++ b/third_party/libwebrtc/api/fec_controller_api_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("fec_controller_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/field_trials_registry_gn/moz.build b/third_party/libwebrtc/api/field_trials_registry_gn/moz.build
index 5133134fc2686..5395b281673ea 100644
--- a/third_party/libwebrtc/api/field_trials_registry_gn/moz.build
+++ b/third_party/libwebrtc/api/field_trials_registry_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("field_trials_registry_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/field_trials_view_gn/moz.build b/third_party/libwebrtc/api/field_trials_view_gn/moz.build
index 0e5ed09f70fc6..208d594725446 100644
--- a/third_party/libwebrtc/api/field_trials_view_gn/moz.build
+++ b/third_party/libwebrtc/api/field_trials_view_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("field_trials_view_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/frame_transformer_interface_gn/moz.build b/third_party/libwebrtc/api/frame_transformer_interface_gn/moz.build
index 20da3e9cdbaee..63ee00c414e14 100644
--- a/third_party/libwebrtc/api/frame_transformer_interface_gn/moz.build
+++ b/third_party/libwebrtc/api/frame_transformer_interface_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_transformer_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/function_view_gn/moz.build b/third_party/libwebrtc/api/function_view_gn/moz.build
index 0854c1f771154..8d7b69b5013f6 100644
--- a/third_party/libwebrtc/api/function_view_gn/moz.build
+++ b/third_party/libwebrtc/api/function_view_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("function_view_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/libjingle_logging_api_gn/moz.build b/third_party/libwebrtc/api/libjingle_logging_api_gn/moz.build
index 3a6a8537c24dc..b6908569c61f6 100644
--- a/third_party/libwebrtc/api/libjingle_logging_api_gn/moz.build
+++ b/third_party/libwebrtc/api/libjingle_logging_api_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("jingle_logging_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/libjingle_peerconnection_api_gn/moz.build b/third_party/libwebrtc/api/libjingle_peerconnection_api_gn/moz.build
index b4ff24a0b54c6..82c6a3d455dac 100644
--- a/third_party/libwebrtc/api/libjingle_peerconnection_api_gn/moz.build
+++ b/third_party/libwebrtc/api/libjingle_peerconnection_api_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("jingle_peerconnection_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/location_gn/moz.build b/third_party/libwebrtc/api/location_gn/moz.build
index 5e7de58f06b59..ba1f3961d21d1 100644
--- a/third_party/libwebrtc/api/location_gn/moz.build
+++ b/third_party/libwebrtc/api/location_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("location_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/make_ref_counted_gn/moz.build b/third_party/libwebrtc/api/make_ref_counted_gn/moz.build
index 2eb6226bfb2d4..0eb9f765e7b4b 100644
--- a/third_party/libwebrtc/api/make_ref_counted_gn/moz.build
+++ b/third_party/libwebrtc/api/make_ref_counted_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("make_ref_counted_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/media_stream_interface_gn/moz.build b/third_party/libwebrtc/api/media_stream_interface_gn/moz.build
index b066645cd26c4..d695f678315f8 100644
--- a/third_party/libwebrtc/api/media_stream_interface_gn/moz.build
+++ b/third_party/libwebrtc/api/media_stream_interface_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("media_stream_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/metronome/metronome_gn/moz.build b/third_party/libwebrtc/api/metronome/metronome_gn/moz.build
index d89c86ef4bb1f..1c6e54fc70006 100644
--- a/third_party/libwebrtc/api/metronome/metronome_gn/moz.build
+++ b/third_party/libwebrtc/api/metronome/metronome_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("metronome_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/neteq/default_neteq_controller_factory_gn/moz.build b/third_party/libwebrtc/api/neteq/default_neteq_controller_factory_gn/moz.build
index 75602ac5122ac..5430d048a5864 100644
--- a/third_party/libwebrtc/api/neteq/default_neteq_controller_factory_gn/moz.build
+++ b/third_party/libwebrtc/api/neteq/default_neteq_controller_factory_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("default_neteq_controller_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/neteq/neteq_api_gn/moz.build b/third_party/libwebrtc/api/neteq/neteq_api_gn/moz.build
index 7c4e1c550a827..e1cbfd54b8742 100644
--- a/third_party/libwebrtc/api/neteq/neteq_api_gn/moz.build
+++ b/third_party/libwebrtc/api/neteq/neteq_api_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("neteq_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/neteq/neteq_controller_api_gn/moz.build b/third_party/libwebrtc/api/neteq/neteq_controller_api_gn/moz.build
index 617ffd753eb24..44706675d129b 100644
--- a/third_party/libwebrtc/api/neteq/neteq_controller_api_gn/moz.build
+++ b/third_party/libwebrtc/api/neteq/neteq_controller_api_gn/moz.build
@@ -218,3 +218,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("neteq_controller_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/neteq/tick_timer_gn/moz.build b/third_party/libwebrtc/api/neteq/tick_timer_gn/moz.build
index 8106b395ca554..1f6a8f524aa15 100644
--- a/third_party/libwebrtc/api/neteq/tick_timer_gn/moz.build
+++ b/third_party/libwebrtc/api/neteq/tick_timer_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("tick_timer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/network_state_predictor_api_gn/moz.build b/third_party/libwebrtc/api/network_state_predictor_api_gn/moz.build
index 0ffd6a24063bb..6bab65348de18 100644
--- a/third_party/libwebrtc/api/network_state_predictor_api_gn/moz.build
+++ b/third_party/libwebrtc/api/network_state_predictor_api_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("network_state_predictor_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/priority_gn/moz.build b/third_party/libwebrtc/api/priority_gn/moz.build
index 090d23dd76264..edcc33ffad567 100644
--- a/third_party/libwebrtc/api/priority_gn/moz.build
+++ b/third_party/libwebrtc/api/priority_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("priority_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/refcountedbase_gn/moz.build b/third_party/libwebrtc/api/refcountedbase_gn/moz.build
index c18c17de99946..b3e1b675d2c33 100644
--- a/third_party/libwebrtc/api/refcountedbase_gn/moz.build
+++ b/third_party/libwebrtc/api/refcountedbase_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("refcountedbase_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/rtc_error_gn/moz.build b/third_party/libwebrtc/api/rtc_error_gn/moz.build
index 19bee500727e2..b65e42f171618 100644
--- a/third_party/libwebrtc/api/rtc_error_gn/moz.build
+++ b/third_party/libwebrtc/api/rtc_error_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_error_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/rtc_event_log/rtc_event_log_gn/moz.build b/third_party/libwebrtc/api/rtc_event_log/rtc_event_log_gn/moz.build
index 1965bc7a12dd6..3866397f885fd 100644
--- a/third_party/libwebrtc/api/rtc_event_log/rtc_event_log_gn/moz.build
+++ b/third_party/libwebrtc/api/rtc_event_log/rtc_event_log_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_log_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/rtp_headers_gn/moz.build b/third_party/libwebrtc/api/rtp_headers_gn/moz.build
index 7328eb81c0132..fabb4429f905c 100644
--- a/third_party/libwebrtc/api/rtp_headers_gn/moz.build
+++ b/third_party/libwebrtc/api/rtp_headers_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_headers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/rtp_packet_info_gn/moz.build b/third_party/libwebrtc/api/rtp_packet_info_gn/moz.build
index 92eb6cb3693b6..d73c89ac4073d 100644
--- a/third_party/libwebrtc/api/rtp_packet_info_gn/moz.build
+++ b/third_party/libwebrtc/api/rtp_packet_info_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_packet_info_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/rtp_parameters_gn/moz.build b/third_party/libwebrtc/api/rtp_parameters_gn/moz.build
index 480114ad07dd8..dbe2fab3568b5 100644
--- a/third_party/libwebrtc/api/rtp_parameters_gn/moz.build
+++ b/third_party/libwebrtc/api/rtp_parameters_gn/moz.build
@@ -224,3 +224,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_parameters_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/rtp_sender_interface_gn/moz.build b/third_party/libwebrtc/api/rtp_sender_interface_gn/moz.build
index 9938ecca35ee0..a126b00be0c0b 100644
--- a/third_party/libwebrtc/api/rtp_sender_interface_gn/moz.build
+++ b/third_party/libwebrtc/api/rtp_sender_interface_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_sender_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/rtp_sender_setparameters_callback_gn/moz.build b/third_party/libwebrtc/api/rtp_sender_setparameters_callback_gn/moz.build
index f8cd38576d8ed..3e9bf204d23f3 100644
--- a/third_party/libwebrtc/api/rtp_sender_setparameters_callback_gn/moz.build
+++ b/third_party/libwebrtc/api/rtp_sender_setparameters_callback_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_sender_setparameters_callback_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/rtp_transceiver_direction_gn/moz.build b/third_party/libwebrtc/api/rtp_transceiver_direction_gn/moz.build
index 9f3a7424ae8a0..a180a2bb7dc2c 100644
--- a/third_party/libwebrtc/api/rtp_transceiver_direction_gn/moz.build
+++ b/third_party/libwebrtc/api/rtp_transceiver_direction_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_transceiver_direction_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/scoped_refptr_gn/moz.build b/third_party/libwebrtc/api/scoped_refptr_gn/moz.build
index c2f167533dc25..4f9a2bc5f1a22 100644
--- a/third_party/libwebrtc/api/scoped_refptr_gn/moz.build
+++ b/third_party/libwebrtc/api/scoped_refptr_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("scoped_refptr_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/sequence_checker_gn/moz.build b/third_party/libwebrtc/api/sequence_checker_gn/moz.build
index a45bc8e9c1e12..f1ffae49907d6 100644
--- a/third_party/libwebrtc/api/sequence_checker_gn/moz.build
+++ b/third_party/libwebrtc/api/sequence_checker_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("sequence_checker_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/simulated_network_api_gn/moz.build b/third_party/libwebrtc/api/simulated_network_api_gn/moz.build
index b46ec1656b482..9f5b65369b98a 100644
--- a/third_party/libwebrtc/api/simulated_network_api_gn/moz.build
+++ b/third_party/libwebrtc/api/simulated_network_api_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("simulated_network_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/task_queue/pending_task_safety_flag_gn/moz.build b/third_party/libwebrtc/api/task_queue/pending_task_safety_flag_gn/moz.build
index 52a2e5003b5a2..84143a14f0af9 100644
--- a/third_party/libwebrtc/api/task_queue/pending_task_safety_flag_gn/moz.build
+++ b/third_party/libwebrtc/api/task_queue/pending_task_safety_flag_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("pending_task_safety_flag_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/task_queue/task_queue_gn/moz.build b/third_party/libwebrtc/api/task_queue/task_queue_gn/moz.build
index 73630a2ad9882..83c645e437f81 100644
--- a/third_party/libwebrtc/api/task_queue/task_queue_gn/moz.build
+++ b/third_party/libwebrtc/api/task_queue/task_queue_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("task_queue_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/transport/bitrate_settings_gn/moz.build b/third_party/libwebrtc/api/transport/bitrate_settings_gn/moz.build
index d99d149fa37c4..4202be04a2926 100644
--- a/third_party/libwebrtc/api/transport/bitrate_settings_gn/moz.build
+++ b/third_party/libwebrtc/api/transport/bitrate_settings_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bitrate_settings_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/transport/datagram_transport_interface_gn/moz.build b/third_party/libwebrtc/api/transport/datagram_transport_interface_gn/moz.build
index 9168cf915658d..7ac2a6ec41987 100644
--- a/third_party/libwebrtc/api/transport/datagram_transport_interface_gn/moz.build
+++ b/third_party/libwebrtc/api/transport/datagram_transport_interface_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("datagram_transport_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/transport/field_trial_based_config_gn/moz.build b/third_party/libwebrtc/api/transport/field_trial_based_config_gn/moz.build
index fd2b2dd12b034..17fe39d4d790d 100644
--- a/third_party/libwebrtc/api/transport/field_trial_based_config_gn/moz.build
+++ b/third_party/libwebrtc/api/transport/field_trial_based_config_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("field_trial_based_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/transport/goog_cc_gn/moz.build b/third_party/libwebrtc/api/transport/goog_cc_gn/moz.build
index 4a7c84915c5ea..06a76ecb44510 100644
--- a/third_party/libwebrtc/api/transport/goog_cc_gn/moz.build
+++ b/third_party/libwebrtc/api/transport/goog_cc_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("goog_cc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/transport/network_control_gn/moz.build b/third_party/libwebrtc/api/transport/network_control_gn/moz.build
index 76dd117a863f6..359c1a5fcdde7 100644
--- a/third_party/libwebrtc/api/transport/network_control_gn/moz.build
+++ b/third_party/libwebrtc/api/transport/network_control_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("network_control_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/transport/rtp/dependency_descriptor_gn/moz.build b/third_party/libwebrtc/api/transport/rtp/dependency_descriptor_gn/moz.build
index a2fe75e60e9b9..de26ff6df277c 100644
--- a/third_party/libwebrtc/api/transport/rtp/dependency_descriptor_gn/moz.build
+++ b/third_party/libwebrtc/api/transport/rtp/dependency_descriptor_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("dependency_descriptor_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/transport/rtp/rtp_source_gn/moz.build b/third_party/libwebrtc/api/transport/rtp/rtp_source_gn/moz.build
index 9a7b0b69bf3b2..45fd14d59833e 100644
--- a/third_party/libwebrtc/api/transport/rtp/rtp_source_gn/moz.build
+++ b/third_party/libwebrtc/api/transport/rtp/rtp_source_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_source_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/transport/stun_types_gn/moz.build b/third_party/libwebrtc/api/transport/stun_types_gn/moz.build
index 36750a2f188e0..60697c0457bb5 100644
--- a/third_party/libwebrtc/api/transport/stun_types_gn/moz.build
+++ b/third_party/libwebrtc/api/transport/stun_types_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("stun_types_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/transport_api_gn/moz.build b/third_party/libwebrtc/api/transport_api_gn/moz.build
index af080bee0bd04..d0f06f8badff2 100644
--- a/third_party/libwebrtc/api/transport_api_gn/moz.build
+++ b/third_party/libwebrtc/api/transport_api_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("transport_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/units/data_rate_gn/moz.build b/third_party/libwebrtc/api/units/data_rate_gn/moz.build
index 4964c3e05f884..aed0c8c4d64a6 100644
--- a/third_party/libwebrtc/api/units/data_rate_gn/moz.build
+++ b/third_party/libwebrtc/api/units/data_rate_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("data_rate_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/units/data_size_gn/moz.build b/third_party/libwebrtc/api/units/data_size_gn/moz.build
index 0fe0bc100b9ef..0573c6cb9b9d2 100644
--- a/third_party/libwebrtc/api/units/data_size_gn/moz.build
+++ b/third_party/libwebrtc/api/units/data_size_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("data_size_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/units/frequency_gn/moz.build b/third_party/libwebrtc/api/units/frequency_gn/moz.build
index 413a57a8f3c40..f3e59a9385f43 100644
--- a/third_party/libwebrtc/api/units/frequency_gn/moz.build
+++ b/third_party/libwebrtc/api/units/frequency_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frequency_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/units/time_delta_gn/moz.build b/third_party/libwebrtc/api/units/time_delta_gn/moz.build
index 39355ed5881c4..313814755300a 100644
--- a/third_party/libwebrtc/api/units/time_delta_gn/moz.build
+++ b/third_party/libwebrtc/api/units/time_delta_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("time_delta_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/units/timestamp_gn/moz.build b/third_party/libwebrtc/api/units/timestamp_gn/moz.build
index da68eea1608bf..10ff4ab6748bd 100644
--- a/third_party/libwebrtc/api/units/timestamp_gn/moz.build
+++ b/third_party/libwebrtc/api/units/timestamp_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("timestamp_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/builtin_video_bitrate_allocator_factory_gn/moz.build b/third_party/libwebrtc/api/video/builtin_video_bitrate_allocator_factory_gn/moz.build
index cb32b05fa6ce7..a62ea03c8f321 100644
--- a/third_party/libwebrtc/api/video/builtin_video_bitrate_allocator_factory_gn/moz.build
+++ b/third_party/libwebrtc/api/video/builtin_video_bitrate_allocator_factory_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("builtin_video_bitrate_allocator_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/encoded_frame_gn/moz.build b/third_party/libwebrtc/api/video/encoded_frame_gn/moz.build
index fdb34bf903a5b..2fb5fd4f2af5c 100644
--- a/third_party/libwebrtc/api/video/encoded_frame_gn/moz.build
+++ b/third_party/libwebrtc/api/video/encoded_frame_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("encoded_frame_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/encoded_image_gn/moz.build b/third_party/libwebrtc/api/video/encoded_image_gn/moz.build
index 3bc012ad28674..91ce8ed1e1e19 100644
--- a/third_party/libwebrtc/api/video/encoded_image_gn/moz.build
+++ b/third_party/libwebrtc/api/video/encoded_image_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("encoded_image_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/frame_buffer_gn/moz.build b/third_party/libwebrtc/api/video/frame_buffer_gn/moz.build
index 2614e67133bcd..4e901a627cc55 100644
--- a/third_party/libwebrtc/api/video/frame_buffer_gn/moz.build
+++ b/third_party/libwebrtc/api/video/frame_buffer_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/recordable_encoded_frame_gn/moz.build b/third_party/libwebrtc/api/video/recordable_encoded_frame_gn/moz.build
index ace02623f71cd..9160c4bb124d8 100644
--- a/third_party/libwebrtc/api/video/recordable_encoded_frame_gn/moz.build
+++ b/third_party/libwebrtc/api/video/recordable_encoded_frame_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("recordable_encoded_frame_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/render_resolution_gn/moz.build b/third_party/libwebrtc/api/video/render_resolution_gn/moz.build
index f27e4cc9441bf..fc10083b68eb3 100644
--- a/third_party/libwebrtc/api/video/render_resolution_gn/moz.build
+++ b/third_party/libwebrtc/api/video/render_resolution_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("render_resolution_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/resolution_gn/moz.build b/third_party/libwebrtc/api/video/resolution_gn/moz.build
index 673bb4f1c9f3f..36a8f022138e9 100644
--- a/third_party/libwebrtc/api/video/resolution_gn/moz.build
+++ b/third_party/libwebrtc/api/video/resolution_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("resolution_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_adaptation_gn/moz.build b/third_party/libwebrtc/api/video/video_adaptation_gn/moz.build
index ffff5639eeef0..dce7023adc7fb 100644
--- a/third_party/libwebrtc/api/video/video_adaptation_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_adaptation_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_adaptation_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_bitrate_allocation_gn/moz.build b/third_party/libwebrtc/api/video/video_bitrate_allocation_gn/moz.build
index be63dc82523fc..c60ebf7e85997 100644
--- a/third_party/libwebrtc/api/video/video_bitrate_allocation_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_bitrate_allocation_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_bitrate_allocation_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_bitrate_allocator_factory_gn/moz.build b/third_party/libwebrtc/api/video/video_bitrate_allocator_factory_gn/moz.build
index 222bcaf25116e..557c9a64ae305 100644
--- a/third_party/libwebrtc/api/video/video_bitrate_allocator_factory_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_bitrate_allocator_factory_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_bitrate_allocator_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_bitrate_allocator_gn/moz.build b/third_party/libwebrtc/api/video/video_bitrate_allocator_gn/moz.build
index e7f3f5a4de364..8f5348542686c 100644
--- a/third_party/libwebrtc/api/video/video_bitrate_allocator_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_bitrate_allocator_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_bitrate_allocator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_codec_constants_gn/moz.build b/third_party/libwebrtc/api/video/video_codec_constants_gn/moz.build
index 403c521a1f564..c2962b9abeeff 100644
--- a/third_party/libwebrtc/api/video/video_codec_constants_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_codec_constants_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_codec_constants_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_frame_gn/moz.build b/third_party/libwebrtc/api/video/video_frame_gn/moz.build
index b0fc90582b6e2..b2678339b060a 100644
--- a/third_party/libwebrtc/api/video/video_frame_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_frame_gn/moz.build
@@ -241,3 +241,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_frame_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_frame_i010_gn/moz.build b/third_party/libwebrtc/api/video/video_frame_i010_gn/moz.build
index 7fe6e4df955d8..4733abf42d5ba 100644
--- a/third_party/libwebrtc/api/video/video_frame_i010_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_frame_i010_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_frame_i010_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_frame_metadata_gn/moz.build b/third_party/libwebrtc/api/video/video_frame_metadata_gn/moz.build
index d80dda91786bc..69c9a50620b6f 100644
--- a/third_party/libwebrtc/api/video/video_frame_metadata_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_frame_metadata_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_frame_metadata_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_frame_type_gn/moz.build b/third_party/libwebrtc/api/video/video_frame_type_gn/moz.build
index 8fcbef76e8e6b..d246b33e5c807 100644
--- a/third_party/libwebrtc/api/video/video_frame_type_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_frame_type_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_frame_type_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_layers_allocation_gn/moz.build b/third_party/libwebrtc/api/video/video_layers_allocation_gn/moz.build
index b8ba6ec54b86b..28c6a05b7af7f 100644
--- a/third_party/libwebrtc/api/video/video_layers_allocation_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_layers_allocation_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_layers_allocation_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_rtp_headers_gn/moz.build b/third_party/libwebrtc/api/video/video_rtp_headers_gn/moz.build
index f65965f80bcd0..cef939aafdac5 100644
--- a/third_party/libwebrtc/api/video/video_rtp_headers_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_rtp_headers_gn/moz.build
@@ -233,3 +233,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_rtp_headers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video/video_stream_encoder_gn/moz.build b/third_party/libwebrtc/api/video/video_stream_encoder_gn/moz.build
index 7b8a329463c78..3e8888fd5175c 100644
--- a/third_party/libwebrtc/api/video/video_stream_encoder_gn/moz.build
+++ b/third_party/libwebrtc/api/video/video_stream_encoder_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_stream_encoder_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video_codecs/bitstream_parser_api_gn/moz.build b/third_party/libwebrtc/api/video_codecs/bitstream_parser_api_gn/moz.build
index c3642c46d0fe6..1008131a1bad6 100644
--- a/third_party/libwebrtc/api/video_codecs/bitstream_parser_api_gn/moz.build
+++ b/third_party/libwebrtc/api/video_codecs/bitstream_parser_api_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bitstream_parser_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video_codecs/rtc_software_fallback_wrappers_gn/moz.build b/third_party/libwebrtc/api/video_codecs/rtc_software_fallback_wrappers_gn/moz.build
index 4e928c91a4301..c0b72c4a3eadc 100644
--- a/third_party/libwebrtc/api/video_codecs/rtc_software_fallback_wrappers_gn/moz.build
+++ b/third_party/libwebrtc/api/video_codecs/rtc_software_fallback_wrappers_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_software_fallback_wrappers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video_codecs/scalability_mode_gn/moz.build b/third_party/libwebrtc/api/video_codecs/scalability_mode_gn/moz.build
index d63795ed948e3..1e1a657da17fd 100644
--- a/third_party/libwebrtc/api/video_codecs/scalability_mode_gn/moz.build
+++ b/third_party/libwebrtc/api/video_codecs/scalability_mode_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("scalability_mode_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video_codecs/video_codecs_api_gn/moz.build b/third_party/libwebrtc/api/video_codecs/video_codecs_api_gn/moz.build
index 89cce4215bb68..307e5c2620981 100644
--- a/third_party/libwebrtc/api/video_codecs/video_codecs_api_gn/moz.build
+++ b/third_party/libwebrtc/api/video_codecs/video_codecs_api_gn/moz.build
@@ -240,3 +240,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_codecs_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video_codecs/vp8_temporal_layers_factory_gn/moz.build b/third_party/libwebrtc/api/video_codecs/vp8_temporal_layers_factory_gn/moz.build
index e757e9ed510c3..f88c2d434d6f7 100644
--- a/third_party/libwebrtc/api/video_codecs/vp8_temporal_layers_factory_gn/moz.build
+++ b/third_party/libwebrtc/api/video_codecs/vp8_temporal_layers_factory_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("vp8_temporal_layers_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/api/video_track_source_constraints_gn/moz.build b/third_party/libwebrtc/api/video_track_source_constraints_gn/moz.build
index 8213e3088f485..32c780df7a298 100644
--- a/third_party/libwebrtc/api/video_track_source_constraints_gn/moz.build
+++ b/third_party/libwebrtc/api/video_track_source_constraints_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_track_source_constraints_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/audio/audio_gn/moz.build b/third_party/libwebrtc/audio/audio_gn/moz.build
index e81a4f673bac7..709c5465ecc12 100644
--- a/third_party/libwebrtc/audio/audio_gn/moz.build
+++ b/third_party/libwebrtc/audio/audio_gn/moz.build
@@ -247,3 +247,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/audio/utility/audio_frame_operations_gn/moz.build b/third_party/libwebrtc/audio/utility/audio_frame_operations_gn/moz.build
index e215792f649df..55d832e8892ae 100644
--- a/third_party/libwebrtc/audio/utility/audio_frame_operations_gn/moz.build
+++ b/third_party/libwebrtc/audio/utility/audio_frame_operations_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_frame_operations_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/adaptation/resource_adaptation_gn/moz.build b/third_party/libwebrtc/call/adaptation/resource_adaptation_gn/moz.build
index d8893a7341524..301e4659603f7 100644
--- a/third_party/libwebrtc/call/adaptation/resource_adaptation_gn/moz.build
+++ b/third_party/libwebrtc/call/adaptation/resource_adaptation_gn/moz.build
@@ -244,3 +244,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("resource_adaptation_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/audio_sender_interface_gn/moz.build b/third_party/libwebrtc/call/audio_sender_interface_gn/moz.build
index 2b42e8ebf96e8..c0de193acd89c 100644
--- a/third_party/libwebrtc/call/audio_sender_interface_gn/moz.build
+++ b/third_party/libwebrtc/call/audio_sender_interface_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_sender_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/bitrate_allocator_gn/moz.build b/third_party/libwebrtc/call/bitrate_allocator_gn/moz.build
index a56b55faf3bc0..ae971b4b8bbc8 100644
--- a/third_party/libwebrtc/call/bitrate_allocator_gn/moz.build
+++ b/third_party/libwebrtc/call/bitrate_allocator_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bitrate_allocator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/bitrate_configurator_gn/moz.build b/third_party/libwebrtc/call/bitrate_configurator_gn/moz.build
index e6f73025aa61c..ad1827b33a3a3 100644
--- a/third_party/libwebrtc/call/bitrate_configurator_gn/moz.build
+++ b/third_party/libwebrtc/call/bitrate_configurator_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bitrate_configurator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/call_gn/moz.build b/third_party/libwebrtc/call/call_gn/moz.build
index 25c1961b89ae2..ce6fbdb8822ef 100644
--- a/third_party/libwebrtc/call/call_gn/moz.build
+++ b/third_party/libwebrtc/call/call_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("call_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/call_interfaces_gn/moz.build b/third_party/libwebrtc/call/call_interfaces_gn/moz.build
index a5796666d84d4..0fd8bdb24dfc0 100644
--- a/third_party/libwebrtc/call/call_interfaces_gn/moz.build
+++ b/third_party/libwebrtc/call/call_interfaces_gn/moz.build
@@ -241,3 +241,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("call_interfaces_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/receive_stream_interface_gn/moz.build b/third_party/libwebrtc/call/receive_stream_interface_gn/moz.build
index 92973e6d7b60a..a82f36ff9b7af 100644
--- a/third_party/libwebrtc/call/receive_stream_interface_gn/moz.build
+++ b/third_party/libwebrtc/call/receive_stream_interface_gn/moz.build
@@ -218,3 +218,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("receive_stream_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/rtp_interfaces_gn/moz.build b/third_party/libwebrtc/call/rtp_interfaces_gn/moz.build
index c83031d5b5063..1a88d529c5f0f 100644
--- a/third_party/libwebrtc/call/rtp_interfaces_gn/moz.build
+++ b/third_party/libwebrtc/call/rtp_interfaces_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_interfaces_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/rtp_receiver_gn/moz.build b/third_party/libwebrtc/call/rtp_receiver_gn/moz.build
index 8809c7664f766..1098f78a9a1f3 100644
--- a/third_party/libwebrtc/call/rtp_receiver_gn/moz.build
+++ b/third_party/libwebrtc/call/rtp_receiver_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_receiver_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/rtp_sender_gn/moz.build b/third_party/libwebrtc/call/rtp_sender_gn/moz.build
index 09560bbaab542..d37f83fb36046 100644
--- a/third_party/libwebrtc/call/rtp_sender_gn/moz.build
+++ b/third_party/libwebrtc/call/rtp_sender_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_sender_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/version_gn/moz.build b/third_party/libwebrtc/call/version_gn/moz.build
index e2e087a17fe3f..f7f91f8967715 100644
--- a/third_party/libwebrtc/call/version_gn/moz.build
+++ b/third_party/libwebrtc/call/version_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("version_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/call/video_stream_api_gn/moz.build b/third_party/libwebrtc/call/video_stream_api_gn/moz.build
index f2ec65de01cc9..8ce7322bc1ce4 100644
--- a/third_party/libwebrtc/call/video_stream_api_gn/moz.build
+++ b/third_party/libwebrtc/call/video_stream_api_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_stream_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/common_audio_avx2_gn/moz.build b/third_party/libwebrtc/common_audio/common_audio_avx2_gn/moz.build
index 390c83ec43a48..798960b46c0b0 100644
--- a/third_party/libwebrtc/common_audio/common_audio_avx2_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/common_audio_avx2_gn/moz.build
@@ -188,3 +188,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86":
     ]
 
 Library("common_audio_avx2_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/common_audio_c_arm_asm_gn/moz.build b/third_party/libwebrtc/common_audio/common_audio_c_arm_asm_gn/moz.build
index ec4329a9cc6e7..a3c4cfa4e0ef6 100644
--- a/third_party/libwebrtc/common_audio/common_audio_c_arm_asm_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/common_audio_c_arm_asm_gn/moz.build
@@ -208,3 +208,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("common_audio_c_arm_asm_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/common_audio_c_gn/moz.build b/third_party/libwebrtc/common_audio/common_audio_c_gn/moz.build
index 2a9bfac234f19..a1cbc7116444d 100644
--- a/third_party/libwebrtc/common_audio/common_audio_c_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/common_audio_c_gn/moz.build
@@ -369,3 +369,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     ]
 
 Library("common_audio_c_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/common_audio_cc_gn/moz.build b/third_party/libwebrtc/common_audio/common_audio_cc_gn/moz.build
index 31757c2b89d38..e32abbdcf6b88 100644
--- a/third_party/libwebrtc/common_audio/common_audio_cc_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/common_audio_cc_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("common_audio_cc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/common_audio_gn/moz.build b/third_party/libwebrtc/common_audio/common_audio_gn/moz.build
index b6c5dc57c8fb8..b7d8feaffb81d 100644
--- a/third_party/libwebrtc/common_audio/common_audio_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/common_audio_gn/moz.build
@@ -247,3 +247,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("common_audio_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/common_audio_neon_c_gn/moz.build b/third_party/libwebrtc/common_audio/common_audio_neon_c_gn/moz.build
index f2ef55667bcb3..876cd8aabc996 100644
--- a/third_party/libwebrtc/common_audio/common_audio_neon_c_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/common_audio_neon_c_gn/moz.build
@@ -195,3 +195,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "aarch64":
     DEFINES["WEBRTC_ARCH_ARM64"] = True
 
 Library("common_audio_neon_c_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/common_audio_neon_gn/moz.build b/third_party/libwebrtc/common_audio/common_audio_neon_gn/moz.build
index 2b5a1cf4ccbea..8922c6a9a1050 100644
--- a/third_party/libwebrtc/common_audio/common_audio_neon_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/common_audio_neon_gn/moz.build
@@ -194,3 +194,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "aarch64":
     DEFINES["WEBRTC_ARCH_ARM64"] = True
 
 Library("common_audio_neon_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/common_audio_sse2_gn/moz.build b/third_party/libwebrtc/common_audio/common_audio_sse2_gn/moz.build
index 298c08b4189fc..bd5885064ccf5 100644
--- a/third_party/libwebrtc/common_audio/common_audio_sse2_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/common_audio_sse2_gn/moz.build
@@ -205,3 +205,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     ]
 
 Library("common_audio_sse2_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/fir_filter_factory_gn/moz.build b/third_party/libwebrtc/common_audio/fir_filter_factory_gn/moz.build
index 699fdd0267341..b6f0d3f4f3907 100644
--- a/third_party/libwebrtc/common_audio/fir_filter_factory_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/fir_filter_factory_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("fir_filter_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/fir_filter_gn/moz.build b/third_party/libwebrtc/common_audio/fir_filter_gn/moz.build
index b0236d1067a16..547d79691ca73 100644
--- a/third_party/libwebrtc/common_audio/fir_filter_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/fir_filter_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("fir_filter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/sinc_resampler_gn/moz.build b/third_party/libwebrtc/common_audio/sinc_resampler_gn/moz.build
index cda88c03f924b..86333e6509398 100644
--- a/third_party/libwebrtc/common_audio/sinc_resampler_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/sinc_resampler_gn/moz.build
@@ -218,3 +218,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("sinc_resampler_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/third_party/ooura/fft_size_128_gn/moz.build b/third_party/libwebrtc/common_audio/third_party/ooura/fft_size_128_gn/moz.build
index 328c77410ca2a..2cff8fdb0f6aa 100644
--- a/third_party/libwebrtc/common_audio/third_party/ooura/fft_size_128_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/third_party/ooura/fft_size_128_gn/moz.build
@@ -278,3 +278,6 @@ if CONFIG["OS_TARGET"] == "OpenBSD" and CONFIG["TARGET_CPU"] == "x86_64":
     ]
 
 Library("fft_size_128_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/third_party/ooura/fft_size_256_gn/moz.build b/third_party/libwebrtc/common_audio/third_party/ooura/fft_size_256_gn/moz.build
index e65c7c572fc8f..96e96b83c3dc3 100644
--- a/third_party/libwebrtc/common_audio/third_party/ooura/fft_size_256_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/third_party/ooura/fft_size_256_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("fft_size_256_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_audio/third_party/spl_sqrt_floor/spl_sqrt_floor_gn/moz.build b/third_party/libwebrtc/common_audio/third_party/spl_sqrt_floor/spl_sqrt_floor_gn/moz.build
index 316c1991d5f20..aff0b5a626f06 100644
--- a/third_party/libwebrtc/common_audio/third_party/spl_sqrt_floor/spl_sqrt_floor_gn/moz.build
+++ b/third_party/libwebrtc/common_audio/third_party/spl_sqrt_floor/spl_sqrt_floor_gn/moz.build
@@ -275,3 +275,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     ]
 
 Library("spl_sqrt_floor_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_video/common_video_gn/moz.build b/third_party/libwebrtc/common_video/common_video_gn/moz.build
index a767c9c765310..8c0b185e3620e 100644
--- a/third_party/libwebrtc/common_video/common_video_gn/moz.build
+++ b/third_party/libwebrtc/common_video/common_video_gn/moz.build
@@ -242,3 +242,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("common_video_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_video/frame_counts_gn/moz.build b/third_party/libwebrtc/common_video/frame_counts_gn/moz.build
index 0ccbf9ac76367..e188a1b0952cc 100644
--- a/third_party/libwebrtc/common_video/frame_counts_gn/moz.build
+++ b/third_party/libwebrtc/common_video/frame_counts_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_counts_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/common_video/generic_frame_descriptor/generic_frame_descriptor_gn/moz.build b/third_party/libwebrtc/common_video/generic_frame_descriptor/generic_frame_descriptor_gn/moz.build
index 7aa4e9bfff479..ba83181fbd9b8 100644
--- a/third_party/libwebrtc/common_video/generic_frame_descriptor/generic_frame_descriptor_gn/moz.build
+++ b/third_party/libwebrtc/common_video/generic_frame_descriptor/generic_frame_descriptor_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("generic_frame_descriptor_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/experiments/registered_field_trials_gn/moz.build b/third_party/libwebrtc/experiments/registered_field_trials_gn/moz.build
index 023dd46dd1ee1..5d0e6a2851d32 100644
--- a/third_party/libwebrtc/experiments/registered_field_trials_gn/moz.build
+++ b/third_party/libwebrtc/experiments/registered_field_trials_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("registered_field_trials_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/experiments/registered_field_trials_header_gn/moz.build b/third_party/libwebrtc/experiments/registered_field_trials_header_gn/moz.build
index 2f9f14acb4303..cdd42e721392c 100644
--- a/third_party/libwebrtc/experiments/registered_field_trials_header_gn/moz.build
+++ b/third_party/libwebrtc/experiments/registered_field_trials_header_gn/moz.build
@@ -37,3 +37,6 @@ if CONFIG["OS_TARGET"] == "WINNT":
     DEFINES["_UNICODE"] = True
 
 Library("registered_field_trials_header_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/logging/rtc_event_audio_gn/moz.build b/third_party/libwebrtc/logging/rtc_event_audio_gn/moz.build
index f4f41e48ae54e..d69d36f324080 100644
--- a/third_party/libwebrtc/logging/rtc_event_audio_gn/moz.build
+++ b/third_party/libwebrtc/logging/rtc_event_audio_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_audio_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/logging/rtc_event_bwe_gn/moz.build b/third_party/libwebrtc/logging/rtc_event_bwe_gn/moz.build
index 72e02793f70cd..7b4b893fad1a4 100644
--- a/third_party/libwebrtc/logging/rtc_event_bwe_gn/moz.build
+++ b/third_party/libwebrtc/logging/rtc_event_bwe_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_bwe_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/logging/rtc_event_field_gn/moz.build b/third_party/libwebrtc/logging/rtc_event_field_gn/moz.build
index 6a37b25112a84..17ec10fc9701c 100644
--- a/third_party/libwebrtc/logging/rtc_event_field_gn/moz.build
+++ b/third_party/libwebrtc/logging/rtc_event_field_gn/moz.build
@@ -233,3 +233,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_field_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/logging/rtc_event_log_parse_status_gn/moz.build b/third_party/libwebrtc/logging/rtc_event_log_parse_status_gn/moz.build
index 5ad6834dff133..95815da9acd62 100644
--- a/third_party/libwebrtc/logging/rtc_event_log_parse_status_gn/moz.build
+++ b/third_party/libwebrtc/logging/rtc_event_log_parse_status_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_log_parse_status_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/logging/rtc_event_number_encodings_gn/moz.build b/third_party/libwebrtc/logging/rtc_event_number_encodings_gn/moz.build
index af4c0bf656d0d..b86885c392487 100644
--- a/third_party/libwebrtc/logging/rtc_event_number_encodings_gn/moz.build
+++ b/third_party/libwebrtc/logging/rtc_event_number_encodings_gn/moz.build
@@ -225,3 +225,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_number_encodings_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/logging/rtc_event_pacing_gn/moz.build b/third_party/libwebrtc/logging/rtc_event_pacing_gn/moz.build
index abf04bb09f55a..b17254fc0a71f 100644
--- a/third_party/libwebrtc/logging/rtc_event_pacing_gn/moz.build
+++ b/third_party/libwebrtc/logging/rtc_event_pacing_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_pacing_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/logging/rtc_event_rtp_rtcp_gn/moz.build b/third_party/libwebrtc/logging/rtc_event_rtp_rtcp_gn/moz.build
index b003d287bd3b4..93d827fb04c4f 100644
--- a/third_party/libwebrtc/logging/rtc_event_rtp_rtcp_gn/moz.build
+++ b/third_party/libwebrtc/logging/rtc_event_rtp_rtcp_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_rtp_rtcp_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/logging/rtc_event_video_gn/moz.build b/third_party/libwebrtc/logging/rtc_event_video_gn/moz.build
index 264fc2cf4b44c..244b061e19b0e 100644
--- a/third_party/libwebrtc/logging/rtc_event_video_gn/moz.build
+++ b/third_party/libwebrtc/logging/rtc_event_video_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_video_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/logging/rtc_stream_config_gn/moz.build b/third_party/libwebrtc/logging/rtc_stream_config_gn/moz.build
index eb3342a9262b4..9dad365bbec73 100644
--- a/third_party/libwebrtc/logging/rtc_stream_config_gn/moz.build
+++ b/third_party/libwebrtc/logging/rtc_stream_config_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_stream_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/codec_gn/moz.build b/third_party/libwebrtc/media/codec_gn/moz.build
index a6fa3b4063602..03d42ad3f44a4 100644
--- a/third_party/libwebrtc/media/codec_gn/moz.build
+++ b/third_party/libwebrtc/media/codec_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("codec_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/media_channel_gn/moz.build b/third_party/libwebrtc/media/media_channel_gn/moz.build
index 1bedb41bf2af0..1d6bdf273bc26 100644
--- a/third_party/libwebrtc/media/media_channel_gn/moz.build
+++ b/third_party/libwebrtc/media/media_channel_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("media_channel_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/media_channel_impl_gn/moz.build b/third_party/libwebrtc/media/media_channel_impl_gn/moz.build
index 7d0a4bd6506df..609213f416d00 100644
--- a/third_party/libwebrtc/media/media_channel_impl_gn/moz.build
+++ b/third_party/libwebrtc/media/media_channel_impl_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("media_channel_impl_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/media_constants_gn/moz.build b/third_party/libwebrtc/media/media_constants_gn/moz.build
index af4cd6b257f8b..1a5c0c1580235 100644
--- a/third_party/libwebrtc/media/media_constants_gn/moz.build
+++ b/third_party/libwebrtc/media/media_constants_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("media_constants_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/rid_description_gn/moz.build b/third_party/libwebrtc/media/rid_description_gn/moz.build
index 61afeec945979..f450a6b655edf 100644
--- a/third_party/libwebrtc/media/rid_description_gn/moz.build
+++ b/third_party/libwebrtc/media/rid_description_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rid_description_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/rtc_media_base_gn/moz.build b/third_party/libwebrtc/media/rtc_media_base_gn/moz.build
index cfff6f34114e4..fe0b541aec0ac 100644
--- a/third_party/libwebrtc/media/rtc_media_base_gn/moz.build
+++ b/third_party/libwebrtc/media/rtc_media_base_gn/moz.build
@@ -238,3 +238,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_media_base_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/rtc_media_config_gn/moz.build b/third_party/libwebrtc/media/rtc_media_config_gn/moz.build
index 17afebe8da993..2673001a09769 100644
--- a/third_party/libwebrtc/media/rtc_media_config_gn/moz.build
+++ b/third_party/libwebrtc/media/rtc_media_config_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_media_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/rtc_simulcast_encoder_adapter_gn/moz.build b/third_party/libwebrtc/media/rtc_simulcast_encoder_adapter_gn/moz.build
index c09703ddd6a23..d2662b96e2ed8 100644
--- a/third_party/libwebrtc/media/rtc_simulcast_encoder_adapter_gn/moz.build
+++ b/third_party/libwebrtc/media/rtc_simulcast_encoder_adapter_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_simulcast_encoder_adapter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/rtp_utils_gn/moz.build b/third_party/libwebrtc/media/rtp_utils_gn/moz.build
index 1aaa347151a29..fccebd6d753f0 100644
--- a/third_party/libwebrtc/media/rtp_utils_gn/moz.build
+++ b/third_party/libwebrtc/media/rtp_utils_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_utils_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/media/stream_params_gn/moz.build b/third_party/libwebrtc/media/stream_params_gn/moz.build
index 71875c4e01652..4ab82504e9a76 100644
--- a/third_party/libwebrtc/media/stream_params_gn/moz.build
+++ b/third_party/libwebrtc/media/stream_params_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("stream_params_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/async_audio_processing/async_audio_processing_gn/moz.build b/third_party/libwebrtc/modules/async_audio_processing/async_audio_processing_gn/moz.build
index 347559a342cb4..5e8e42ce4a46a 100644
--- a/third_party/libwebrtc/modules/async_audio_processing/async_audio_processing_gn/moz.build
+++ b/third_party/libwebrtc/modules/async_audio_processing/async_audio_processing_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("async_audio_processing_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/audio_coding_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/audio_coding_gn/moz.build
index 4dad1217d030a..8711a108f88c7 100644
--- a/third_party/libwebrtc/modules/audio_coding/audio_coding_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/audio_coding_gn/moz.build
@@ -238,3 +238,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_coding_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/audio_coding_module_typedefs_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/audio_coding_module_typedefs_gn/moz.build
index 704026c84512c..3df7bd1fbcef8 100644
--- a/third_party/libwebrtc/modules/audio_coding/audio_coding_module_typedefs_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/audio_coding_module_typedefs_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_coding_module_typedefs_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/audio_coding_opus_common_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/audio_coding_opus_common_gn/moz.build
index bbb1557baa57a..554784ba2f5ee 100644
--- a/third_party/libwebrtc/modules/audio_coding/audio_coding_opus_common_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/audio_coding_opus_common_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_coding_opus_common_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/audio_encoder_cng_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/audio_encoder_cng_gn/moz.build
index 75153f32214b2..c9a873c28bd60 100644
--- a/third_party/libwebrtc/modules/audio_coding/audio_encoder_cng_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/audio_encoder_cng_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_encoder_cng_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/audio_network_adaptor_config_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/audio_network_adaptor_config_gn/moz.build
index b9d3c55453a76..94ac9ae47c341 100644
--- a/third_party/libwebrtc/modules/audio_coding/audio_network_adaptor_config_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/audio_network_adaptor_config_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_network_adaptor_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/audio_network_adaptor_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/audio_network_adaptor_gn/moz.build
index 7d446965f130c..b394ff6d5b6bc 100644
--- a/third_party/libwebrtc/modules/audio_coding/audio_network_adaptor_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/audio_network_adaptor_gn/moz.build
@@ -244,3 +244,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_network_adaptor_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/default_neteq_factory_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/default_neteq_factory_gn/moz.build
index aea0a80ed4fa9..d12645186366c 100644
--- a/third_party/libwebrtc/modules/audio_coding/default_neteq_factory_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/default_neteq_factory_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("default_neteq_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/g711_c_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/g711_c_gn/moz.build
index 575478702e32b..98d45e6626c3a 100644
--- a/third_party/libwebrtc/modules/audio_coding/g711_c_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/g711_c_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("g711_c_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/g711_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/g711_gn/moz.build
index fa25fde0bd429..677ca8ec3a8ea 100644
--- a/third_party/libwebrtc/modules/audio_coding/g711_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/g711_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("g711_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/g722_c_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/g722_c_gn/moz.build
index 4821c2bd8267e..35beb49061b46 100644
--- a/third_party/libwebrtc/modules/audio_coding/g722_c_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/g722_c_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("g722_c_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/g722_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/g722_gn/moz.build
index 0a56f32af0b5b..d8cb822af8576 100644
--- a/third_party/libwebrtc/modules/audio_coding/g722_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/g722_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("g722_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/ilbc_c_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/ilbc_c_gn/moz.build
index 43d69c766282c..6be495c48a98e 100644
--- a/third_party/libwebrtc/modules/audio_coding/ilbc_c_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/ilbc_c_gn/moz.build
@@ -302,3 +302,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("ilbc_c_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/ilbc_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/ilbc_gn/moz.build
index c4b3b4cd1309b..c6a5c76a7a59b 100644
--- a/third_party/libwebrtc/modules/audio_coding/ilbc_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/ilbc_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("ilbc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/isac_bwinfo_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/isac_bwinfo_gn/moz.build
index 4f4a5c0e7e9bd..df1f0c72386d2 100644
--- a/third_party/libwebrtc/modules/audio_coding/isac_bwinfo_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/isac_bwinfo_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("isac_bwinfo_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/isac_vad_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/isac_vad_gn/moz.build
index a5cc52279a9f0..f201d7933af1b 100644
--- a/third_party/libwebrtc/modules/audio_coding/isac_vad_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/isac_vad_gn/moz.build
@@ -222,3 +222,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("isac_vad_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/legacy_encoded_audio_frame_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/legacy_encoded_audio_frame_gn/moz.build
index 78b7338ddd81c..0bb564d93a6e4 100644
--- a/third_party/libwebrtc/modules/audio_coding/legacy_encoded_audio_frame_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/legacy_encoded_audio_frame_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("legacy_encoded_audio_frame_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/neteq_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/neteq_gn/moz.build
index 04dbb03279749..4a2ae65680e84 100644
--- a/third_party/libwebrtc/modules/audio_coding/neteq_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/neteq_gn/moz.build
@@ -269,3 +269,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("neteq_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/pcm16b_c_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/pcm16b_c_gn/moz.build
index 41f722069cded..50e0cff547bed 100644
--- a/third_party/libwebrtc/modules/audio_coding/pcm16b_c_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/pcm16b_c_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("pcm16b_c_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/pcm16b_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/pcm16b_gn/moz.build
index ed96e7c0f8b86..cd2665682ca31 100644
--- a/third_party/libwebrtc/modules/audio_coding/pcm16b_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/pcm16b_gn/moz.build
@@ -232,3 +232,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("pcm16b_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/red_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/red_gn/moz.build
index 479cf67a2a661..d6288fa84fcad 100644
--- a/third_party/libwebrtc/modules/audio_coding/red_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/red_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("red_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/webrtc_cng_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/webrtc_cng_gn/moz.build
index a8a6c576e22b3..a4c276d3dcd01 100644
--- a/third_party/libwebrtc/modules/audio_coding/webrtc_cng_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/webrtc_cng_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_cng_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/webrtc_multiopus_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/webrtc_multiopus_gn/moz.build
index 491f0cc543ac1..81dbdafd6fa8c 100644
--- a/third_party/libwebrtc/modules/audio_coding/webrtc_multiopus_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/webrtc_multiopus_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_multiopus_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/webrtc_opus_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/webrtc_opus_gn/moz.build
index e2c57b99afb17..8d72eb8f5d160 100644
--- a/third_party/libwebrtc/modules/audio_coding/webrtc_opus_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/webrtc_opus_gn/moz.build
@@ -239,3 +239,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_opus_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_coding/webrtc_opus_wrapper_gn/moz.build b/third_party/libwebrtc/modules/audio_coding/webrtc_opus_wrapper_gn/moz.build
index 268854264f5ba..8fd573b94515b 100644
--- a/third_party/libwebrtc/modules/audio_coding/webrtc_opus_wrapper_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_coding/webrtc_opus_wrapper_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_opus_wrapper_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_device/audio_device_gn/moz.build b/third_party/libwebrtc/modules/audio_device/audio_device_gn/moz.build
index df00e056c6776..b15ed1883ec17 100644
--- a/third_party/libwebrtc/modules/audio_device/audio_device_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_device/audio_device_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_device_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_mixer/audio_frame_manipulator_gn/moz.build b/third_party/libwebrtc/modules/audio_mixer/audio_frame_manipulator_gn/moz.build
index edfac56a3a52b..d8aaabd8bfbcf 100644
--- a/third_party/libwebrtc/modules/audio_mixer/audio_frame_manipulator_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_mixer/audio_frame_manipulator_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_frame_manipulator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_mixer/audio_mixer_impl_gn/moz.build b/third_party/libwebrtc/modules/audio_mixer/audio_mixer_impl_gn/moz.build
index 7108d9fbe1c4f..847f5df7107b4 100644
--- a/third_party/libwebrtc/modules/audio_mixer/audio_mixer_impl_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_mixer/audio_mixer_impl_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_mixer_impl_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/adaptive_fir_filter_erl_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/adaptive_fir_filter_erl_gn/moz.build
index f21e65fb4a2bf..1f81fc6a7ad73 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/adaptive_fir_filter_erl_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/adaptive_fir_filter_erl_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("adaptive_fir_filter_erl_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/adaptive_fir_filter_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/adaptive_fir_filter_gn/moz.build
index b9c819893ff95..0c97a952add0c 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/adaptive_fir_filter_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/adaptive_fir_filter_gn/moz.build
@@ -218,3 +218,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("adaptive_fir_filter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/aec3_avx2_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/aec3_avx2_gn/moz.build
index 097e67bbe502e..68d5fc6ed2bbd 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/aec3_avx2_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/aec3_avx2_gn/moz.build
@@ -192,3 +192,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86":
     ]
 
 Library("aec3_avx2_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/aec3_common_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/aec3_common_gn/moz.build
index 955fe2022fd3e..133f638926f75 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/aec3_common_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/aec3_common_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("aec3_common_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/aec3_fft_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/aec3_fft_gn/moz.build
index 154d9f4406654..7d39a19549732 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/aec3_fft_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/aec3_fft_gn/moz.build
@@ -218,3 +218,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("aec3_fft_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/aec3_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/aec3_gn/moz.build
index 7ad4cffedf285..4afe0339e6f56 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/aec3_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/aec3_gn/moz.build
@@ -291,3 +291,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("aec3_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/fft_data_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/fft_data_gn/moz.build
index 0084077435c52..65371b9b7bc46 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/fft_data_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/fft_data_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("fft_data_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/matched_filter_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/matched_filter_gn/moz.build
index be2c3bbf56ee9..5e1b3b63f83df 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/matched_filter_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/matched_filter_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("matched_filter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/render_buffer_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/render_buffer_gn/moz.build
index 2bd3ae0c01328..cd00f9a8132c5 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/render_buffer_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/render_buffer_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("render_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec3/vector_math_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec3/vector_math_gn/moz.build
index e40fdb1cf187c..0d8fac217d787 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec3/vector_math_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec3/vector_math_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("vector_math_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec_dump/aec_dump_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec_dump/aec_dump_gn/moz.build
index f1280fed0dcb0..8bcd8e4ad3bb9 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec_dump/aec_dump_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec_dump/aec_dump_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("aec_dump_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec_dump/null_aec_dump_factory_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec_dump/null_aec_dump_factory_gn/moz.build
index 2966151ab6a6c..81684b84bd9d7 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec_dump/null_aec_dump_factory_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec_dump/null_aec_dump_factory_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("null_aec_dump_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aec_dump_interface_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aec_dump_interface_gn/moz.build
index 02b847ed761e3..daba13fe8a3ef 100644
--- a/third_party/libwebrtc/modules/audio_processing/aec_dump_interface_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aec_dump_interface_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("aec_dump_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/aecm/aecm_core_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/aecm/aecm_core_gn/moz.build
index a645dceff4b05..7777c99fcb92f 100644
--- a/third_party/libwebrtc/modules/audio_processing/aecm/aecm_core_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/aecm/aecm_core_gn/moz.build
@@ -295,3 +295,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     ]
 
 Library("aecm_core_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc/agc_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc/agc_gn/moz.build
index f6f4442cfc84e..9dfdb596afd10 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc/agc_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc/agc_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("agc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc/gain_control_interface_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc/gain_control_interface_gn/moz.build
index be6b4f9b27f5f..4477b03c5cd3f 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc/gain_control_interface_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc/gain_control_interface_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("gain_control_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc/legacy_agc_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc/legacy_agc_gn/moz.build
index 4e6e295d34a8f..f2106e36d8e67 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc/legacy_agc_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc/legacy_agc_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("legacy_agc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc/level_estimation_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc/level_estimation_gn/moz.build
index 64ffa7596019b..15c3b46dbbbf0 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc/level_estimation_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc/level_estimation_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("level_estimation_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/adaptive_digital_gain_controller_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/adaptive_digital_gain_controller_gn/moz.build
index 9473ac62f52bd..42daf4df2554f 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/adaptive_digital_gain_controller_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/adaptive_digital_gain_controller_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("adaptive_digital_gain_controller_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/biquad_filter_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/biquad_filter_gn/moz.build
index c7a2f6d21536c..633d7989d92a9 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/biquad_filter_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/biquad_filter_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("biquad_filter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/clipping_predictor_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/clipping_predictor_gn/moz.build
index e70e3f68e9365..d26bce5eb160f 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/clipping_predictor_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/clipping_predictor_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("clipping_predictor_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/common_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/common_gn/moz.build
index 869061354209b..51d594185e863 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/common_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/common_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("common_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/cpu_features_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/cpu_features_gn/moz.build
index 4b0431db1a98f..cb39256961630 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/cpu_features_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/cpu_features_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("cpu_features_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/fixed_digital_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/fixed_digital_gn/moz.build
index 1b8da82f58179..6ac67058b662e 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/fixed_digital_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/fixed_digital_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("fixed_digital_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/gain_applier_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/gain_applier_gn/moz.build
index bea71dcee3e5a..463ab448cc72c 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/gain_applier_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/gain_applier_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("gain_applier_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/gain_map_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/gain_map_gn/moz.build
index 03eb1fb3a1df7..d9047ab3f7dbf 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/gain_map_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/gain_map_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("gain_map_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/input_volume_controller_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/input_volume_controller_gn/moz.build
index f1a841d5aee96..fb27a1bf76b3c 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/input_volume_controller_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/input_volume_controller_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("input_volume_controller_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/input_volume_stats_reporter_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/input_volume_stats_reporter_gn/moz.build
index 40448f68a9d21..df69a39ce5287 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/input_volume_stats_reporter_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/input_volume_stats_reporter_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("input_volume_stats_reporter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/noise_level_estimator_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/noise_level_estimator_gn/moz.build
index 9d4629e9abeb6..7286ea6f65497 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/noise_level_estimator_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/noise_level_estimator_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("noise_level_estimator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_auto_correlation_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_auto_correlation_gn/moz.build
index 134ffac5fd31f..e8544a70933fd 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_auto_correlation_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_auto_correlation_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_auto_correlation_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_common_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_common_gn/moz.build
index cf3de48a578aa..9101c880497be 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_common_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_common_gn/moz.build
@@ -218,3 +218,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_common_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_gn/moz.build
index dbb926c5fcb61..3ad42a4ca5dd9 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_layers_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_layers_gn/moz.build
index 92da260f905a6..d4b1a4ba09d6c 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_layers_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_layers_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_layers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_lp_residual_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_lp_residual_gn/moz.build
index cedb17bc22b74..4aad27d9b67ad 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_lp_residual_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_lp_residual_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_lp_residual_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_pitch_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_pitch_gn/moz.build
index d45bc78ff6aef..42436148a738b 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_pitch_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_pitch_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_pitch_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_ring_buffer_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_ring_buffer_gn/moz.build
index 20da5f3615d14..f48fedfdc9070 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_ring_buffer_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_ring_buffer_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_ring_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_sequence_buffer_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_sequence_buffer_gn/moz.build
index b0ba79562e46a..65724f2e922a9 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_sequence_buffer_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_sequence_buffer_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_sequence_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_spectral_features_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_spectral_features_gn/moz.build
index 2d8396fa2aa97..4244c99f5ef93 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_spectral_features_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_spectral_features_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_spectral_features_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_symmetric_matrix_buffer_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_symmetric_matrix_buffer_gn/moz.build
index 143ba6960c6f2..2eb33b94e52cb 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_symmetric_matrix_buffer_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/rnn_vad_symmetric_matrix_buffer_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_symmetric_matrix_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/vector_math_avx2_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/vector_math_avx2_gn/moz.build
index d4dd169f1523f..d9400563d9813 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/vector_math_avx2_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/vector_math_avx2_gn/moz.build
@@ -187,3 +187,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86":
     ]
 
 Library("vector_math_avx2_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/vector_math_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/vector_math_gn/moz.build
index 09fe0c3d2452a..f25aaafe1ca07 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/vector_math_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/rnn_vad/vector_math_gn/moz.build
@@ -218,3 +218,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("vector_math_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/saturation_protector_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/saturation_protector_gn/moz.build
index 6b8def8650b54..5c2532b913788 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/saturation_protector_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/saturation_protector_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("saturation_protector_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/speech_level_estimator_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/speech_level_estimator_gn/moz.build
index 8f2996fa264e2..170e80f3fc3b2 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/speech_level_estimator_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/speech_level_estimator_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("speech_level_estimator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/agc2/vad_wrapper_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/agc2/vad_wrapper_gn/moz.build
index 55cfbb60e71de..61a7bf0224ad6 100644
--- a/third_party/libwebrtc/modules/audio_processing/agc2/vad_wrapper_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/agc2/vad_wrapper_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("vad_wrapper_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/api_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/api_gn/moz.build
index 7a02b7e10c3f0..f5dc2bb99b09f 100644
--- a/third_party/libwebrtc/modules/audio_processing/api_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/api_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/apm_logging_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/apm_logging_gn/moz.build
index 992376cd8a354..b6854358bddd0 100644
--- a/third_party/libwebrtc/modules/audio_processing/apm_logging_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/apm_logging_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("apm_logging_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/audio_buffer_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/audio_buffer_gn/moz.build
index 88031a747de77..f0df6c3748c07 100644
--- a/third_party/libwebrtc/modules/audio_processing/audio_buffer_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/audio_buffer_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/audio_frame_proxies_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/audio_frame_proxies_gn/moz.build
index 7e73b704838dd..e9bec704ac728 100644
--- a/third_party/libwebrtc/modules/audio_processing/audio_frame_proxies_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/audio_frame_proxies_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_frame_proxies_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/audio_frame_view_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/audio_frame_view_gn/moz.build
index 0f81755091825..4764969dd4796 100644
--- a/third_party/libwebrtc/modules/audio_processing/audio_frame_view_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/audio_frame_view_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_frame_view_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/audio_processing_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/audio_processing_gn/moz.build
index 7dc22bcf2bdc0..eaadea469a641 100644
--- a/third_party/libwebrtc/modules/audio_processing/audio_processing_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/audio_processing_gn/moz.build
@@ -241,3 +241,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_processing_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/audio_processing_statistics_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/audio_processing_statistics_gn/moz.build
index 6d174505ed038..0833b1372c112 100644
--- a/third_party/libwebrtc/modules/audio_processing/audio_processing_statistics_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/audio_processing_statistics_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_processing_statistics_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/capture_levels_adjuster/capture_levels_adjuster_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/capture_levels_adjuster/capture_levels_adjuster_gn/moz.build
index d80a3bb1c6d27..60dfa0deeca6a 100644
--- a/third_party/libwebrtc/modules/audio_processing/capture_levels_adjuster/capture_levels_adjuster_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/capture_levels_adjuster/capture_levels_adjuster_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("capture_levels_adjuster_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/gain_controller2_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/gain_controller2_gn/moz.build
index d6d9d3658b8d6..c7b8f43a6215f 100644
--- a/third_party/libwebrtc/modules/audio_processing/gain_controller2_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/gain_controller2_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("gain_controller2_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/high_pass_filter_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/high_pass_filter_gn/moz.build
index 8769a3a318635..6e9320e192140 100644
--- a/third_party/libwebrtc/modules/audio_processing/high_pass_filter_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/high_pass_filter_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("high_pass_filter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/ns/ns_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/ns/ns_gn/moz.build
index 14595abaf908d..436ff67ade0d5 100644
--- a/third_party/libwebrtc/modules/audio_processing/ns/ns_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/ns/ns_gn/moz.build
@@ -247,3 +247,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("ns_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/optionally_built_submodule_creators_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/optionally_built_submodule_creators_gn/moz.build
index af79a781f6dee..9a4f3e89422c7 100644
--- a/third_party/libwebrtc/modules/audio_processing/optionally_built_submodule_creators_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/optionally_built_submodule_creators_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("optionally_built_submodule_creators_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/rms_level_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/rms_level_gn/moz.build
index 23f52652aebc3..4f36a510dfd20 100644
--- a/third_party/libwebrtc/modules/audio_processing/rms_level_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/rms_level_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rms_level_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/transient/transient_suppressor_api_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/transient/transient_suppressor_api_gn/moz.build
index 6310b948ac1fc..e600ffc165a86 100644
--- a/third_party/libwebrtc/modules/audio_processing/transient/transient_suppressor_api_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/transient/transient_suppressor_api_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("transient_suppressor_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/transient/transient_suppressor_impl_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/transient/transient_suppressor_impl_gn/moz.build
index 31e0736f308e5..0c96220af1e28 100644
--- a/third_party/libwebrtc/modules/audio_processing/transient/transient_suppressor_impl_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/transient/transient_suppressor_impl_gn/moz.build
@@ -238,3 +238,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("transient_suppressor_impl_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/transient/voice_probability_delay_unit_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/transient/voice_probability_delay_unit_gn/moz.build
index 52587c0890175..228c75ea694ce 100644
--- a/third_party/libwebrtc/modules/audio_processing/transient/voice_probability_delay_unit_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/transient/voice_probability_delay_unit_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("voice_probability_delay_unit_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/utility/cascaded_biquad_filter_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/utility/cascaded_biquad_filter_gn/moz.build
index 02813d2513b3c..7a579ffbc0c05 100644
--- a/third_party/libwebrtc/modules/audio_processing/utility/cascaded_biquad_filter_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/utility/cascaded_biquad_filter_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("cascaded_biquad_filter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/utility/legacy_delay_estimator_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/utility/legacy_delay_estimator_gn/moz.build
index 67c6a218f6db9..d0784dd3fd027 100644
--- a/third_party/libwebrtc/modules/audio_processing/utility/legacy_delay_estimator_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/utility/legacy_delay_estimator_gn/moz.build
@@ -224,3 +224,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("legacy_delay_estimator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/utility/pffft_wrapper_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/utility/pffft_wrapper_gn/moz.build
index 3213706005599..3a023d8c2427c 100644
--- a/third_party/libwebrtc/modules/audio_processing/utility/pffft_wrapper_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/utility/pffft_wrapper_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("pffft_wrapper_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/audio_processing/vad/vad_gn/moz.build b/third_party/libwebrtc/modules/audio_processing/vad/vad_gn/moz.build
index 3739bbef8afc9..7b29e70b6f5c5 100644
--- a/third_party/libwebrtc/modules/audio_processing/vad/vad_gn/moz.build
+++ b/third_party/libwebrtc/modules/audio_processing/vad/vad_gn/moz.build
@@ -241,3 +241,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("vad_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/congestion_controller_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/congestion_controller_gn/moz.build
index b5bcafa45fbca..1cc2db7accd6c 100644
--- a/third_party/libwebrtc/modules/congestion_controller/congestion_controller_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/congestion_controller_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("congestion_controller_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/alr_detector_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/alr_detector_gn/moz.build
index b48fc38c398c7..70f718fbd84f8 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/alr_detector_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/alr_detector_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("alr_detector_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/delay_based_bwe_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/delay_based_bwe_gn/moz.build
index 31d8c420f6b6a..6b29aa5219e08 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/delay_based_bwe_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/delay_based_bwe_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("delay_based_bwe_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/estimators_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/estimators_gn/moz.build
index e233806b437f7..298a884086926 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/estimators_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/estimators_gn/moz.build
@@ -240,3 +240,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("estimators_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/goog_cc_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/goog_cc_gn/moz.build
index 147a08113b86d..e3c1dc568d69c 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/goog_cc_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/goog_cc_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("goog_cc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/link_capacity_estimator_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/link_capacity_estimator_gn/moz.build
index 0ee8a34df8b9a..37399f4b2e46d 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/link_capacity_estimator_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/link_capacity_estimator_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("link_capacity_estimator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/loss_based_bwe_v1_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/loss_based_bwe_v1_gn/moz.build
index 5931292efe338..f9065193e96be 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/loss_based_bwe_v1_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/loss_based_bwe_v1_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("loss_based_bwe_v1_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/loss_based_bwe_v2_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/loss_based_bwe_v2_gn/moz.build
index ca9f20ab87e60..89d02290b1d58 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/loss_based_bwe_v2_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/loss_based_bwe_v2_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("loss_based_bwe_v2_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/probe_controller_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/probe_controller_gn/moz.build
index 703c22a59092f..68cfdeeab127a 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/probe_controller_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/probe_controller_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("probe_controller_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/pushback_controller_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/pushback_controller_gn/moz.build
index 291502c95a37c..df4e9ac3900a4 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/pushback_controller_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/pushback_controller_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("pushback_controller_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/goog_cc/send_side_bwe_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/goog_cc/send_side_bwe_gn/moz.build
index d83d51f98500c..8a86e4d8cc77b 100644
--- a/third_party/libwebrtc/modules/congestion_controller/goog_cc/send_side_bwe_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/goog_cc/send_side_bwe_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("send_side_bwe_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/rtp/control_handler_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/rtp/control_handler_gn/moz.build
index 7e8cb87820207..f2dc1ef2f2898 100644
--- a/third_party/libwebrtc/modules/congestion_controller/rtp/control_handler_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/rtp/control_handler_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("control_handler_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/congestion_controller/rtp/transport_feedback_gn/moz.build b/third_party/libwebrtc/modules/congestion_controller/rtp/transport_feedback_gn/moz.build
index 40ead5619cded..0ad8aee0c831b 100644
--- a/third_party/libwebrtc/modules/congestion_controller/rtp/transport_feedback_gn/moz.build
+++ b/third_party/libwebrtc/modules/congestion_controller/rtp/transport_feedback_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("transport_feedback_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/desktop_capture/desktop_capture_differ_sse2_gn/moz.build b/third_party/libwebrtc/modules/desktop_capture/desktop_capture_differ_sse2_gn/moz.build
index e02d81561426a..3d9704051a975 100644
--- a/third_party/libwebrtc/modules/desktop_capture/desktop_capture_differ_sse2_gn/moz.build
+++ b/third_party/libwebrtc/modules/desktop_capture/desktop_capture_differ_sse2_gn/moz.build
@@ -154,3 +154,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     ]
 
 Library("desktop_capture_differ_sse2_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/desktop_capture/desktop_capture_gn/moz.build b/third_party/libwebrtc/modules/desktop_capture/desktop_capture_gn/moz.build
index 22a76e9e761e9..61e357bdb816e 100644
--- a/third_party/libwebrtc/modules/desktop_capture/desktop_capture_gn/moz.build
+++ b/third_party/libwebrtc/modules/desktop_capture/desktop_capture_gn/moz.build
@@ -677,3 +677,6 @@ if CONFIG["MOZ_X11"] == "1" and CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGE
     ]
 
 Library("desktop_capture_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/desktop_capture/desktop_capture_objc_gn/moz.build b/third_party/libwebrtc/modules/desktop_capture/desktop_capture_objc_gn/moz.build
index 3b34c0cc8b0ba..fc417432cb1cb 100644
--- a/third_party/libwebrtc/modules/desktop_capture/desktop_capture_objc_gn/moz.build
+++ b/third_party/libwebrtc/modules/desktop_capture/desktop_capture_objc_gn/moz.build
@@ -75,3 +75,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("desktop_capture_objc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/desktop_capture/primitives_gn/moz.build b/third_party/libwebrtc/modules/desktop_capture/primitives_gn/moz.build
index de232571beb42..ed06ae48a6a23 100644
--- a/third_party/libwebrtc/modules/desktop_capture/primitives_gn/moz.build
+++ b/third_party/libwebrtc/modules/desktop_capture/primitives_gn/moz.build
@@ -215,3 +215,6 @@ if CONFIG["MOZ_X11"] == "1" and CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGE
     DEFINES["USE_X11"] = "1"
 
 Library("primitives_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/module_api_gn/moz.build b/third_party/libwebrtc/modules/module_api_gn/moz.build
index d61cca4a488c6..4f4591031e778 100644
--- a/third_party/libwebrtc/modules/module_api_gn/moz.build
+++ b/third_party/libwebrtc/modules/module_api_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("module_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/module_api_public_gn/moz.build b/third_party/libwebrtc/modules/module_api_public_gn/moz.build
index 45518d1a8a19e..2543b8f105932 100644
--- a/third_party/libwebrtc/modules/module_api_public_gn/moz.build
+++ b/third_party/libwebrtc/modules/module_api_public_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("module_api_public_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/module_fec_api_gn/moz.build b/third_party/libwebrtc/modules/module_fec_api_gn/moz.build
index 7b4274f1b8a5a..1c90bbc64f0b5 100644
--- a/third_party/libwebrtc/modules/module_fec_api_gn/moz.build
+++ b/third_party/libwebrtc/modules/module_fec_api_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("module_fec_api_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/pacing/interval_budget_gn/moz.build b/third_party/libwebrtc/modules/pacing/interval_budget_gn/moz.build
index a528123ae0685..cc0f8ce8cc5f6 100644
--- a/third_party/libwebrtc/modules/pacing/interval_budget_gn/moz.build
+++ b/third_party/libwebrtc/modules/pacing/interval_budget_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("interval_budget_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/pacing/pacing_gn/moz.build b/third_party/libwebrtc/modules/pacing/pacing_gn/moz.build
index 6b7f69865fd15..e2d5637720183 100644
--- a/third_party/libwebrtc/modules/pacing/pacing_gn/moz.build
+++ b/third_party/libwebrtc/modules/pacing/pacing_gn/moz.build
@@ -242,3 +242,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("pacing_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/portal/portal_gn/moz.build b/third_party/libwebrtc/modules/portal/portal_gn/moz.build
index 2760d7e5e1254..6b008b42f69e2 100644
--- a/third_party/libwebrtc/modules/portal/portal_gn/moz.build
+++ b/third_party/libwebrtc/modules/portal/portal_gn/moz.build
@@ -108,3 +108,6 @@ if CONFIG["MOZ_X11"] == "1" and CONFIG["OS_TARGET"] == "Linux":
     DEFINES["USE_X11"] = "1"
 
 Library("portal_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/remote_bitrate_estimator/remote_bitrate_estimator_gn/moz.build b/third_party/libwebrtc/modules/remote_bitrate_estimator/remote_bitrate_estimator_gn/moz.build
index 2876755e91190..e02eb6b63ec8a 100644
--- a/third_party/libwebrtc/modules/remote_bitrate_estimator/remote_bitrate_estimator_gn/moz.build
+++ b/third_party/libwebrtc/modules/remote_bitrate_estimator/remote_bitrate_estimator_gn/moz.build
@@ -246,3 +246,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("remote_bitrate_estimator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/rtp_rtcp/leb128_gn/moz.build b/third_party/libwebrtc/modules/rtp_rtcp/leb128_gn/moz.build
index 88f2cb22e03bb..010424a785b80 100644
--- a/third_party/libwebrtc/modules/rtp_rtcp/leb128_gn/moz.build
+++ b/third_party/libwebrtc/modules/rtp_rtcp/leb128_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("leb128_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/rtp_rtcp/rtp_rtcp_format_gn/moz.build b/third_party/libwebrtc/modules/rtp_rtcp/rtp_rtcp_format_gn/moz.build
index da304ae5a4f97..ec10dbb4516ef 100644
--- a/third_party/libwebrtc/modules/rtp_rtcp/rtp_rtcp_format_gn/moz.build
+++ b/third_party/libwebrtc/modules/rtp_rtcp/rtp_rtcp_format_gn/moz.build
@@ -276,3 +276,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_rtcp_format_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/rtp_rtcp/rtp_rtcp_gn/moz.build b/third_party/libwebrtc/modules/rtp_rtcp/rtp_rtcp_gn/moz.build
index 382194837b7fa..971168a0cd136 100644
--- a/third_party/libwebrtc/modules/rtp_rtcp/rtp_rtcp_gn/moz.build
+++ b/third_party/libwebrtc/modules/rtp_rtcp/rtp_rtcp_gn/moz.build
@@ -290,3 +290,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_rtcp_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/rtp_rtcp/rtp_video_header_gn/moz.build b/third_party/libwebrtc/modules/rtp_rtcp/rtp_video_header_gn/moz.build
index 2c8b5e232175e..f4542d4df7f52 100644
--- a/third_party/libwebrtc/modules/rtp_rtcp/rtp_video_header_gn/moz.build
+++ b/third_party/libwebrtc/modules/rtp_rtcp/rtp_video_header_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_video_header_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/third_party/fft/fft_gn/moz.build b/third_party/libwebrtc/modules/third_party/fft/fft_gn/moz.build
index d2e3ea012808b..946816abc2c45 100644
--- a/third_party/libwebrtc/modules/third_party/fft/fft_gn/moz.build
+++ b/third_party/libwebrtc/modules/third_party/fft/fft_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("fft_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/third_party/g711/g711_3p_gn/moz.build b/third_party/libwebrtc/modules/third_party/g711/g711_3p_gn/moz.build
index aa7a21a68032c..e6196812293fb 100644
--- a/third_party/libwebrtc/modules/third_party/g711/g711_3p_gn/moz.build
+++ b/third_party/libwebrtc/modules/third_party/g711/g711_3p_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("g711_3p_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/third_party/g722/g722_3p_gn/moz.build b/third_party/libwebrtc/modules/third_party/g722/g722_3p_gn/moz.build
index 41a8c05baecd9..79207efdb709d 100644
--- a/third_party/libwebrtc/modules/third_party/g722/g722_3p_gn/moz.build
+++ b/third_party/libwebrtc/modules/third_party/g722/g722_3p_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("g722_3p_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/utility/utility_gn/moz.build b/third_party/libwebrtc/modules/utility/utility_gn/moz.build
index b6921b76262e3..10c8c92271329 100644
--- a/third_party/libwebrtc/modules/utility/utility_gn/moz.build
+++ b/third_party/libwebrtc/modules/utility/utility_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("utility_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_capture/video_capture_internal_impl_gn/moz.build b/third_party/libwebrtc/modules/video_capture/video_capture_internal_impl_gn/moz.build
index 24988a1ffc060..893e13bbb103d 100644
--- a/third_party/libwebrtc/modules/video_capture/video_capture_internal_impl_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_capture/video_capture_internal_impl_gn/moz.build
@@ -374,3 +374,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     ]
 
 Library("video_capture_internal_impl_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_capture/video_capture_module_gn/moz.build b/third_party/libwebrtc/modules/video_capture/video_capture_module_gn/moz.build
index 49c62d5cf608e..ec52997099542 100644
--- a/third_party/libwebrtc/modules/video_capture/video_capture_module_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_capture/video_capture_module_gn/moz.build
@@ -239,3 +239,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_capture_module_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/chain_diff_calculator_gn/moz.build b/third_party/libwebrtc/modules/video_coding/chain_diff_calculator_gn/moz.build
index dd8e979e41fe8..838df2cf58fd8 100644
--- a/third_party/libwebrtc/modules/video_coding/chain_diff_calculator_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/chain_diff_calculator_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("chain_diff_calculator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/codec_globals_headers_gn/moz.build b/third_party/libwebrtc/modules/video_coding/codec_globals_headers_gn/moz.build
index 73fce5bf02bb7..ecdee81be1ef3 100644
--- a/third_party/libwebrtc/modules/video_coding/codec_globals_headers_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/codec_globals_headers_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("codec_globals_headers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/codecs/av1/av1_svc_config_gn/moz.build b/third_party/libwebrtc/modules/video_coding/codecs/av1/av1_svc_config_gn/moz.build
index e67bb6616d49a..236f6ffe6eaa2 100644
--- a/third_party/libwebrtc/modules/video_coding/codecs/av1/av1_svc_config_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/codecs/av1/av1_svc_config_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("av1_svc_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/encoded_frame_gn/moz.build b/third_party/libwebrtc/modules/video_coding/encoded_frame_gn/moz.build
index 9b8e33b7d542f..f558f53fe860f 100644
--- a/third_party/libwebrtc/modules/video_coding/encoded_frame_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/encoded_frame_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("encoded_frame_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/frame_dependencies_calculator_gn/moz.build b/third_party/libwebrtc/modules/video_coding/frame_dependencies_calculator_gn/moz.build
index 487fc5b4d6e58..85564d71d7d36 100644
--- a/third_party/libwebrtc/modules/video_coding/frame_dependencies_calculator_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/frame_dependencies_calculator_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_dependencies_calculator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/frame_helpers_gn/moz.build b/third_party/libwebrtc/modules/video_coding/frame_helpers_gn/moz.build
index dd901a5371a07..dbeafab2737c8 100644
--- a/third_party/libwebrtc/modules/video_coding/frame_helpers_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/frame_helpers_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_helpers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/nack_requester_gn/moz.build b/third_party/libwebrtc/modules/video_coding/nack_requester_gn/moz.build
index 0f6654f1ab6ff..a657cb331fbde 100644
--- a/third_party/libwebrtc/modules/video_coding/nack_requester_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/nack_requester_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("nack_requester_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/packet_buffer_gn/moz.build b/third_party/libwebrtc/modules/video_coding/packet_buffer_gn/moz.build
index f3f85aacaa191..3bfb0e0d9ffb1 100644
--- a/third_party/libwebrtc/modules/video_coding/packet_buffer_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/packet_buffer_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("packet_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/svc/scalability_mode_util_gn/moz.build b/third_party/libwebrtc/modules/video_coding/svc/scalability_mode_util_gn/moz.build
index 8a1dfd6377d5a..f51d4b540e1e2 100644
--- a/third_party/libwebrtc/modules/video_coding/svc/scalability_mode_util_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/svc/scalability_mode_util_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("scalability_mode_util_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/svc/scalability_structures_gn/moz.build b/third_party/libwebrtc/modules/video_coding/svc/scalability_structures_gn/moz.build
index a3ea8b3495735..9699435a29921 100644
--- a/third_party/libwebrtc/modules/video_coding/svc/scalability_structures_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/svc/scalability_structures_gn/moz.build
@@ -237,3 +237,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("scalability_structures_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/svc/scalable_video_controller_gn/moz.build b/third_party/libwebrtc/modules/video_coding/svc/scalable_video_controller_gn/moz.build
index a285154a79edc..6f7ad211485d0 100644
--- a/third_party/libwebrtc/modules/video_coding/svc/scalable_video_controller_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/svc/scalable_video_controller_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("scalable_video_controller_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/svc/svc_rate_allocator_gn/moz.build b/third_party/libwebrtc/modules/video_coding/svc/svc_rate_allocator_gn/moz.build
index 412f719d18cd5..36d7951793180 100644
--- a/third_party/libwebrtc/modules/video_coding/svc/svc_rate_allocator_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/svc/svc_rate_allocator_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("svc_rate_allocator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/timing/decode_time_percentile_filter_gn/moz.build b/third_party/libwebrtc/modules/video_coding/timing/decode_time_percentile_filter_gn/moz.build
index 36867642c7baf..8d4db0f6924a0 100644
--- a/third_party/libwebrtc/modules/video_coding/timing/decode_time_percentile_filter_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/timing/decode_time_percentile_filter_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("decode_time_percentile_filter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/timing/frame_delay_variation_kalman_filter_gn/moz.build b/third_party/libwebrtc/modules/video_coding/timing/frame_delay_variation_kalman_filter_gn/moz.build
index caf0efc16596b..9c58d70c51aa7 100644
--- a/third_party/libwebrtc/modules/video_coding/timing/frame_delay_variation_kalman_filter_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/timing/frame_delay_variation_kalman_filter_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_delay_variation_kalman_filter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/timing/inter_frame_delay_variation_calculator_gn/moz.build b/third_party/libwebrtc/modules/video_coding/timing/inter_frame_delay_variation_calculator_gn/moz.build
index 8c6e826a4a85b..a8745a755a878 100644
--- a/third_party/libwebrtc/modules/video_coding/timing/inter_frame_delay_variation_calculator_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/timing/inter_frame_delay_variation_calculator_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("inter_frame_delay_variation_calculator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/timing/jitter_estimator_gn/moz.build b/third_party/libwebrtc/modules/video_coding/timing/jitter_estimator_gn/moz.build
index c7ca3c7fd85f6..bc364e2cb8356 100644
--- a/third_party/libwebrtc/modules/video_coding/timing/jitter_estimator_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/timing/jitter_estimator_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("jitter_estimator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/timing/rtt_filter_gn/moz.build b/third_party/libwebrtc/modules/video_coding/timing/rtt_filter_gn/moz.build
index f3993a17b1c28..5fe33778877c6 100644
--- a/third_party/libwebrtc/modules/video_coding/timing/rtt_filter_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/timing/rtt_filter_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtt_filter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/timing/timestamp_extrapolator_gn/moz.build b/third_party/libwebrtc/modules/video_coding/timing/timestamp_extrapolator_gn/moz.build
index ad8a6874e406f..bfdd96d7ad591 100644
--- a/third_party/libwebrtc/modules/video_coding/timing/timestamp_extrapolator_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/timing/timestamp_extrapolator_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("timestamp_extrapolator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/timing/timing_module_gn/moz.build b/third_party/libwebrtc/modules/video_coding/timing/timing_module_gn/moz.build
index 60cc81a2292b4..b2103c07f7f47 100644
--- a/third_party/libwebrtc/modules/video_coding/timing/timing_module_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/timing/timing_module_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("timing_module_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/video_codec_interface_gn/moz.build b/third_party/libwebrtc/modules/video_coding/video_codec_interface_gn/moz.build
index b14bef2dec4f2..20517efef99dc 100644
--- a/third_party/libwebrtc/modules/video_coding/video_codec_interface_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/video_codec_interface_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_codec_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/video_coding_gn/moz.build b/third_party/libwebrtc/modules/video_coding/video_coding_gn/moz.build
index 5af51f1238a8f..01ea64c924809 100644
--- a/third_party/libwebrtc/modules/video_coding/video_coding_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/video_coding_gn/moz.build
@@ -249,3 +249,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_coding_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/video_coding_utility_gn/moz.build b/third_party/libwebrtc/modules/video_coding/video_coding_utility_gn/moz.build
index d42eb284cd9a1..2702ff88e5804 100644
--- a/third_party/libwebrtc/modules/video_coding/video_coding_utility_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/video_coding_utility_gn/moz.build
@@ -246,3 +246,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_coding_utility_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/webrtc_libvpx_interface_gn/moz.build b/third_party/libwebrtc/modules/video_coding/webrtc_libvpx_interface_gn/moz.build
index 81c9b9d4043c5..8bf2c28414206 100644
--- a/third_party/libwebrtc/modules/video_coding/webrtc_libvpx_interface_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/webrtc_libvpx_interface_gn/moz.build
@@ -226,3 +226,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_libvpx_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/webrtc_vp8_gn/moz.build b/third_party/libwebrtc/modules/video_coding/webrtc_vp8_gn/moz.build
index 82a4d24e97a9f..46b8dcebfe0bd 100644
--- a/third_party/libwebrtc/modules/video_coding/webrtc_vp8_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/webrtc_vp8_gn/moz.build
@@ -241,3 +241,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_vp8_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/webrtc_vp8_scalability_gn/moz.build b/third_party/libwebrtc/modules/video_coding/webrtc_vp8_scalability_gn/moz.build
index 6799224dff303..0de22fee21896 100644
--- a/third_party/libwebrtc/modules/video_coding/webrtc_vp8_scalability_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/webrtc_vp8_scalability_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_vp8_scalability_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/webrtc_vp8_temporal_layers_gn/moz.build b/third_party/libwebrtc/modules/video_coding/webrtc_vp8_temporal_layers_gn/moz.build
index 2423950ba5117..194744d4365cb 100644
--- a/third_party/libwebrtc/modules/video_coding/webrtc_vp8_temporal_layers_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/webrtc_vp8_temporal_layers_gn/moz.build
@@ -240,3 +240,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_vp8_temporal_layers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/webrtc_vp9_gn/moz.build b/third_party/libwebrtc/modules/video_coding/webrtc_vp9_gn/moz.build
index 5bb64f341208f..6fb7c1febbcd7 100644
--- a/third_party/libwebrtc/modules/video_coding/webrtc_vp9_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/webrtc_vp9_gn/moz.build
@@ -243,3 +243,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_vp9_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/modules/video_coding/webrtc_vp9_helpers_gn/moz.build b/third_party/libwebrtc/modules/video_coding/webrtc_vp9_helpers_gn/moz.build
index 6f1575870eade..0a87dca38962b 100644
--- a/third_party/libwebrtc/modules/video_coding/webrtc_vp9_helpers_gn/moz.build
+++ b/third_party/libwebrtc/modules/video_coding/webrtc_vp9_helpers_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("webrtc_vp9_helpers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/moz.build b/third_party/libwebrtc/moz.build
index 86d4f0f288b40..7557b2b7bf49a 100644
--- a/third_party/libwebrtc/moz.build
+++ b/third_party/libwebrtc/moz.build
@@ -693,3 +693,6 @@ if CONFIG["MOZ_X11"] == "1" and CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGE
         "/third_party/libwebrtc/modules/desktop_capture/desktop_capture_gn",
         "/third_party/libwebrtc/modules/desktop_capture/primitives_gn"
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/async_packet_socket_gn/moz.build b/third_party/libwebrtc/rtc_base/async_packet_socket_gn/moz.build
index 0038aa7ef88c7..3f260ebbd1600 100644
--- a/third_party/libwebrtc/rtc_base/async_packet_socket_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/async_packet_socket_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("async_packet_socket_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/async_resolver_interface_gn/moz.build b/third_party/libwebrtc/rtc_base/async_resolver_interface_gn/moz.build
index 485ef7ae1c5de..c8a298e0cdde5 100644
--- a/third_party/libwebrtc/rtc_base/async_resolver_interface_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/async_resolver_interface_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("async_resolver_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/audio_format_to_string_gn/moz.build b/third_party/libwebrtc/rtc_base/audio_format_to_string_gn/moz.build
index 62b75c06ce21a..a2aba43eeae00 100644
--- a/third_party/libwebrtc/rtc_base/audio_format_to_string_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/audio_format_to_string_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("audio_format_to_string_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/bit_buffer_gn/moz.build b/third_party/libwebrtc/rtc_base/bit_buffer_gn/moz.build
index a4a4e8c6e42a0..6a4eb07adda82 100644
--- a/third_party/libwebrtc/rtc_base/bit_buffer_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/bit_buffer_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bit_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/bitrate_tracker_gn/moz.build b/third_party/libwebrtc/rtc_base/bitrate_tracker_gn/moz.build
index 8836b1e089409..282f62b3f19b3 100644
--- a/third_party/libwebrtc/rtc_base/bitrate_tracker_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/bitrate_tracker_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bitrate_tracker_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/bitstream_reader_gn/moz.build b/third_party/libwebrtc/rtc_base/bitstream_reader_gn/moz.build
index b6a5de1971d5d..776673578b1dd 100644
--- a/third_party/libwebrtc/rtc_base/bitstream_reader_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/bitstream_reader_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bitstream_reader_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/buffer_gn/moz.build b/third_party/libwebrtc/rtc_base/buffer_gn/moz.build
index cb5a45ce58bbf..7e0d6c3bb0148 100644
--- a/third_party/libwebrtc/rtc_base/buffer_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/buffer_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/byte_buffer_gn/moz.build b/third_party/libwebrtc/rtc_base/byte_buffer_gn/moz.build
index b093b72f1f14e..23ad1ecfbc6db 100644
--- a/third_party/libwebrtc/rtc_base/byte_buffer_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/byte_buffer_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("byte_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/byte_order_gn/moz.build b/third_party/libwebrtc/rtc_base/byte_order_gn/moz.build
index 21ea639dd4c34..eb6f24be601f3 100644
--- a/third_party/libwebrtc/rtc_base/byte_order_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/byte_order_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("byte_order_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/checks_gn/moz.build b/third_party/libwebrtc/rtc_base/checks_gn/moz.build
index f2ef2e2a78ef2..b642fd9f5e659 100644
--- a/third_party/libwebrtc/rtc_base/checks_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/checks_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("checks_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/compile_assert_c_gn/moz.build b/third_party/libwebrtc/rtc_base/compile_assert_c_gn/moz.build
index 9f6999032d534..b935003f95ac7 100644
--- a/third_party/libwebrtc/rtc_base/compile_assert_c_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/compile_assert_c_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("compile_assert_c_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/containers/flat_containers_internal_gn/moz.build b/third_party/libwebrtc/rtc_base/containers/flat_containers_internal_gn/moz.build
index 8fd59a6ce285f..4c6f6016ae273 100644
--- a/third_party/libwebrtc/rtc_base/containers/flat_containers_internal_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/containers/flat_containers_internal_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("flat_containers_internal_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/containers/flat_map_gn/moz.build b/third_party/libwebrtc/rtc_base/containers/flat_map_gn/moz.build
index 164aae296917f..d310c7329e06e 100644
--- a/third_party/libwebrtc/rtc_base/containers/flat_map_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/containers/flat_map_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("flat_map_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/containers/flat_set_gn/moz.build b/third_party/libwebrtc/rtc_base/containers/flat_set_gn/moz.build
index 5283c7e3d3be0..82b950b9f8910 100644
--- a/third_party/libwebrtc/rtc_base/containers/flat_set_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/containers/flat_set_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("flat_set_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/copy_on_write_buffer_gn/moz.build b/third_party/libwebrtc/rtc_base/copy_on_write_buffer_gn/moz.build
index f026e25abd0b6..ffb3d984eb7b5 100644
--- a/third_party/libwebrtc/rtc_base/copy_on_write_buffer_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/copy_on_write_buffer_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("copy_on_write_buffer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/criticalsection_gn/moz.build b/third_party/libwebrtc/rtc_base/criticalsection_gn/moz.build
index 4aa1aa43535aa..abe8ef43e439f 100644
--- a/third_party/libwebrtc/rtc_base/criticalsection_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/criticalsection_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("criticalsection_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/divide_round_gn/moz.build b/third_party/libwebrtc/rtc_base/divide_round_gn/moz.build
index 79146161c229d..cdbfc85d2099c 100644
--- a/third_party/libwebrtc/rtc_base/divide_round_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/divide_round_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("divide_round_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/dscp_gn/moz.build b/third_party/libwebrtc/rtc_base/dscp_gn/moz.build
index 7bfe2d0c75c03..7f3366ca0535b 100644
--- a/third_party/libwebrtc/rtc_base/dscp_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/dscp_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("dscp_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/event_tracer_gn/moz.build b/third_party/libwebrtc/rtc_base/event_tracer_gn/moz.build
index 06daf6b03a027..bbe70e9b2d5e8 100644
--- a/third_party/libwebrtc/rtc_base/event_tracer_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/event_tracer_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("event_tracer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/alr_experiment_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/alr_experiment_gn/moz.build
index 4435f010b6bdb..d4b9520904408 100644
--- a/third_party/libwebrtc/rtc_base/experiments/alr_experiment_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/alr_experiment_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("alr_experiment_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/balanced_degradation_settings_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/balanced_degradation_settings_gn/moz.build
index cbbb32ab70726..4ce19e134d885 100644
--- a/third_party/libwebrtc/rtc_base/experiments/balanced_degradation_settings_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/balanced_degradation_settings_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("balanced_degradation_settings_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/bandwidth_quality_scaler_settings_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/bandwidth_quality_scaler_settings_gn/moz.build
index 95a92d20e1829..fe0424992efa2 100644
--- a/third_party/libwebrtc/rtc_base/experiments/bandwidth_quality_scaler_settings_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/bandwidth_quality_scaler_settings_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bandwidth_quality_scaler_settings_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/cpu_speed_experiment_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/cpu_speed_experiment_gn/moz.build
index 5151c986c4b84..b805760fca2f0 100644
--- a/third_party/libwebrtc/rtc_base/experiments/cpu_speed_experiment_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/cpu_speed_experiment_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("cpu_speed_experiment_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/encoder_info_settings_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/encoder_info_settings_gn/moz.build
index b7a699fe03d06..b6c4443e504f1 100644
--- a/third_party/libwebrtc/rtc_base/experiments/encoder_info_settings_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/encoder_info_settings_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("encoder_info_settings_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/field_trial_parser_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/field_trial_parser_gn/moz.build
index ea63aafc99e43..fa490b190fe30 100644
--- a/third_party/libwebrtc/rtc_base/experiments/field_trial_parser_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/field_trial_parser_gn/moz.build
@@ -233,3 +233,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("field_trial_parser_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/keyframe_interval_settings_experiment_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/keyframe_interval_settings_experiment_gn/moz.build
index 3857bc9451e57..e80db4a197704 100644
--- a/third_party/libwebrtc/rtc_base/experiments/keyframe_interval_settings_experiment_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/keyframe_interval_settings_experiment_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("keyframe_interval_settings_experiment_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/min_video_bitrate_experiment_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/min_video_bitrate_experiment_gn/moz.build
index 5f811a6c6da45..7c691ee9caa71 100644
--- a/third_party/libwebrtc/rtc_base/experiments/min_video_bitrate_experiment_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/min_video_bitrate_experiment_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("min_video_bitrate_experiment_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/normalize_simulcast_size_experiment_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/normalize_simulcast_size_experiment_gn/moz.build
index 68ad8a0f14138..936ec3bf9aaa4 100644
--- a/third_party/libwebrtc/rtc_base/experiments/normalize_simulcast_size_experiment_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/normalize_simulcast_size_experiment_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("normalize_simulcast_size_experiment_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/quality_rampup_experiment_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/quality_rampup_experiment_gn/moz.build
index c4b1f5bc22c71..51b6c7d11f160 100644
--- a/third_party/libwebrtc/rtc_base/experiments/quality_rampup_experiment_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/quality_rampup_experiment_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("quality_rampup_experiment_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/quality_scaler_settings_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/quality_scaler_settings_gn/moz.build
index 298ca9297c501..f0a960c4dc25c 100644
--- a/third_party/libwebrtc/rtc_base/experiments/quality_scaler_settings_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/quality_scaler_settings_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("quality_scaler_settings_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/quality_scaling_experiment_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/quality_scaling_experiment_gn/moz.build
index d606a38148cac..08d601cf8dead 100644
--- a/third_party/libwebrtc/rtc_base/experiments/quality_scaling_experiment_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/quality_scaling_experiment_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("quality_scaling_experiment_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/rate_control_settings_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/rate_control_settings_gn/moz.build
index be85251358d7b..67a614b5a3d48 100644
--- a/third_party/libwebrtc/rtc_base/experiments/rate_control_settings_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/rate_control_settings_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rate_control_settings_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/rtt_mult_experiment_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/rtt_mult_experiment_gn/moz.build
index 7229d639e8a42..b043d33d93007 100644
--- a/third_party/libwebrtc/rtc_base/experiments/rtt_mult_experiment_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/rtt_mult_experiment_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtt_mult_experiment_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/experiments/stable_target_rate_experiment_gn/moz.build b/third_party/libwebrtc/rtc_base/experiments/stable_target_rate_experiment_gn/moz.build
index d031f8ace4be9..34b3e56894136 100644
--- a/third_party/libwebrtc/rtc_base/experiments/stable_target_rate_experiment_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/experiments/stable_target_rate_experiment_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("stable_target_rate_experiment_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/frequency_tracker_gn/moz.build b/third_party/libwebrtc/rtc_base/frequency_tracker_gn/moz.build
index 30c52de724634..7afab2ec7b8a6 100644
--- a/third_party/libwebrtc/rtc_base/frequency_tracker_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/frequency_tracker_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frequency_tracker_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/gtest_prod_gn/moz.build b/third_party/libwebrtc/rtc_base/gtest_prod_gn/moz.build
index eb85347810091..4eb61a92ad860 100644
--- a/third_party/libwebrtc/rtc_base/gtest_prod_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/gtest_prod_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("gtest_prod_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/histogram_percentile_counter_gn/moz.build b/third_party/libwebrtc/rtc_base/histogram_percentile_counter_gn/moz.build
index ee30758d89d1a..00f397af035b9 100644
--- a/third_party/libwebrtc/rtc_base/histogram_percentile_counter_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/histogram_percentile_counter_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("histogram_percentile_counter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/ifaddrs_android_gn/moz.build b/third_party/libwebrtc/rtc_base/ifaddrs_android_gn/moz.build
index 7985a5f7feba5..b4468f2a5b84e 100644
--- a/third_party/libwebrtc/rtc_base/ifaddrs_android_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/ifaddrs_android_gn/moz.build
@@ -98,3 +98,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("ifaddrs_android_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/ignore_wundef_gn/moz.build b/third_party/libwebrtc/rtc_base/ignore_wundef_gn/moz.build
index 15c6052f7b32d..f11d7b1a26144 100644
--- a/third_party/libwebrtc/rtc_base/ignore_wundef_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/ignore_wundef_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("ignore_wundef_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/ip_address_gn/moz.build b/third_party/libwebrtc/rtc_base/ip_address_gn/moz.build
index a893dab3c2e58..ddebae3f15473 100644
--- a/third_party/libwebrtc/rtc_base/ip_address_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/ip_address_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("ip_address_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/logging_gn/moz.build b/third_party/libwebrtc/rtc_base/logging_gn/moz.build
index 02f74cddfac65..00f6ad5c3f8d9 100644
--- a/third_party/libwebrtc/rtc_base/logging_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/logging_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("logging_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/macromagic_gn/moz.build b/third_party/libwebrtc/rtc_base/macromagic_gn/moz.build
index b44dfa38f59eb..ef5197275ad87 100644
--- a/third_party/libwebrtc/rtc_base/macromagic_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/macromagic_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("macromagic_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/memory/aligned_malloc_gn/moz.build b/third_party/libwebrtc/rtc_base/memory/aligned_malloc_gn/moz.build
index f5720480dd0cd..26b75e644f754 100644
--- a/third_party/libwebrtc/rtc_base/memory/aligned_malloc_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/memory/aligned_malloc_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("aligned_malloc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/mod_ops_gn/moz.build b/third_party/libwebrtc/rtc_base/mod_ops_gn/moz.build
index 84e775fe74290..ce0955b2b22e1 100644
--- a/third_party/libwebrtc/rtc_base/mod_ops_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/mod_ops_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("mod_ops_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/moving_max_counter_gn/moz.build b/third_party/libwebrtc/rtc_base/moving_max_counter_gn/moz.build
index 5cd827786ed48..0ea989f25372f 100644
--- a/third_party/libwebrtc/rtc_base/moving_max_counter_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/moving_max_counter_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("moving_max_counter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/net_helpers_gn/moz.build b/third_party/libwebrtc/rtc_base/net_helpers_gn/moz.build
index c036110d1a92b..7303ce6d71520 100644
--- a/third_party/libwebrtc/rtc_base/net_helpers_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/net_helpers_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("net_helpers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/network/sent_packet_gn/moz.build b/third_party/libwebrtc/rtc_base/network/sent_packet_gn/moz.build
index a1276d9a7a783..6b10b074e3490 100644
--- a/third_party/libwebrtc/rtc_base/network/sent_packet_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/network/sent_packet_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("sent_packet_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/network_constants_gn/moz.build b/third_party/libwebrtc/rtc_base/network_constants_gn/moz.build
index 083e18ac8eb2e..144ff942045f0 100644
--- a/third_party/libwebrtc/rtc_base/network_constants_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/network_constants_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("network_constants_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/network_route_gn/moz.build b/third_party/libwebrtc/rtc_base/network_route_gn/moz.build
index c35c498d443da..431fbabf60af7 100644
--- a/third_party/libwebrtc/rtc_base/network_route_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/network_route_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("network_route_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/null_socket_server_gn/moz.build b/third_party/libwebrtc/rtc_base/null_socket_server_gn/moz.build
index 7385764373a01..4f07685088d92 100644
--- a/third_party/libwebrtc/rtc_base/null_socket_server_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/null_socket_server_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("null_socket_server_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/one_time_event_gn/moz.build b/third_party/libwebrtc/rtc_base/one_time_event_gn/moz.build
index d5afd56fb614f..6ed52fbd49b8b 100644
--- a/third_party/libwebrtc/rtc_base/one_time_event_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/one_time_event_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("one_time_event_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/platform_thread_gn/moz.build b/third_party/libwebrtc/rtc_base/platform_thread_gn/moz.build
index 6e962e328066c..7c649d9685cd7 100644
--- a/third_party/libwebrtc/rtc_base/platform_thread_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/platform_thread_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("platform_thread_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/platform_thread_types_gn/moz.build b/third_party/libwebrtc/rtc_base/platform_thread_types_gn/moz.build
index 0e817e6eb9868..a9f39300cd204 100644
--- a/third_party/libwebrtc/rtc_base/platform_thread_types_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/platform_thread_types_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("platform_thread_types_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/protobuf_utils_gn/moz.build b/third_party/libwebrtc/rtc_base/protobuf_utils_gn/moz.build
index 7f1e533b39c49..f992b2975fc26 100644
--- a/third_party/libwebrtc/rtc_base/protobuf_utils_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/protobuf_utils_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("protobuf_utils_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/race_checker_gn/moz.build b/third_party/libwebrtc/rtc_base/race_checker_gn/moz.build
index 2fab6231568d1..61b224d2006ad 100644
--- a/third_party/libwebrtc/rtc_base/race_checker_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/race_checker_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("race_checker_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/random_gn/moz.build b/third_party/libwebrtc/rtc_base/random_gn/moz.build
index 394eefde596ae..2cc89bdbfb568 100644
--- a/third_party/libwebrtc/rtc_base/random_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/random_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("random_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/rate_limiter_gn/moz.build b/third_party/libwebrtc/rtc_base/rate_limiter_gn/moz.build
index cf10767d72d00..8f1952fc401bf 100644
--- a/third_party/libwebrtc/rtc_base/rate_limiter_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/rate_limiter_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rate_limiter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/rate_statistics_gn/moz.build b/third_party/libwebrtc/rtc_base/rate_statistics_gn/moz.build
index 657f0a65979ab..7b35059150149 100644
--- a/third_party/libwebrtc/rtc_base/rate_statistics_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/rate_statistics_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rate_statistics_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/rate_tracker_gn/moz.build b/third_party/libwebrtc/rtc_base/rate_tracker_gn/moz.build
index f8ebf228f169e..8f2ac67423f33 100644
--- a/third_party/libwebrtc/rtc_base/rate_tracker_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/rate_tracker_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rate_tracker_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/refcount_gn/moz.build b/third_party/libwebrtc/rtc_base/refcount_gn/moz.build
index a1b2bcfeccf23..fc70ee65d095c 100644
--- a/third_party/libwebrtc/rtc_base/refcount_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/refcount_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("refcount_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/rolling_accumulator_gn/moz.build b/third_party/libwebrtc/rtc_base/rolling_accumulator_gn/moz.build
index c5cbc0cb54b57..d7d295b06c758 100644
--- a/third_party/libwebrtc/rtc_base/rolling_accumulator_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/rolling_accumulator_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rolling_accumulator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/rtc_event_gn/moz.build b/third_party/libwebrtc/rtc_base/rtc_event_gn/moz.build
index a3bb657070e16..cd514c0940101 100644
--- a/third_party/libwebrtc/rtc_base/rtc_event_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/rtc_event_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_event_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/rtc_numerics_gn/moz.build b/third_party/libwebrtc/rtc_base/rtc_numerics_gn/moz.build
index 1c0d84013b288..e4803234264cd 100644
--- a/third_party/libwebrtc/rtc_base/rtc_numerics_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/rtc_numerics_gn/moz.build
@@ -225,3 +225,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_numerics_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/rtc_task_queue_gn/moz.build b/third_party/libwebrtc/rtc_base/rtc_task_queue_gn/moz.build
index 21635e570bc3a..f08d7894c4dfd 100644
--- a/third_party/libwebrtc/rtc_base/rtc_task_queue_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/rtc_task_queue_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_task_queue_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/safe_compare_gn/moz.build b/third_party/libwebrtc/rtc_base/safe_compare_gn/moz.build
index fdcf248573b0c..63b476e58ffe9 100644
--- a/third_party/libwebrtc/rtc_base/safe_compare_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/safe_compare_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("safe_compare_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/safe_conversions_gn/moz.build b/third_party/libwebrtc/rtc_base/safe_conversions_gn/moz.build
index 5901f174a6706..21dfc66f907aa 100644
--- a/third_party/libwebrtc/rtc_base/safe_conversions_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/safe_conversions_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("safe_conversions_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/safe_minmax_gn/moz.build b/third_party/libwebrtc/rtc_base/safe_minmax_gn/moz.build
index c01e7c799bcf6..f4359bf0ec7a3 100644
--- a/third_party/libwebrtc/rtc_base/safe_minmax_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/safe_minmax_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("safe_minmax_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/sample_counter_gn/moz.build b/third_party/libwebrtc/rtc_base/sample_counter_gn/moz.build
index 99c6eb8f5374b..41e3577c38df6 100644
--- a/third_party/libwebrtc/rtc_base/sample_counter_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/sample_counter_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("sample_counter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/sanitizer_gn/moz.build b/third_party/libwebrtc/rtc_base/sanitizer_gn/moz.build
index 43e96ee8102fb..8c81dd34b9b89 100644
--- a/third_party/libwebrtc/rtc_base/sanitizer_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/sanitizer_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("sanitizer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/socket_address_gn/moz.build b/third_party/libwebrtc/rtc_base/socket_address_gn/moz.build
index 86ef2dc1a70b7..09ce20837bf7a 100644
--- a/third_party/libwebrtc/rtc_base/socket_address_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/socket_address_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("socket_address_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/socket_factory_gn/moz.build b/third_party/libwebrtc/rtc_base/socket_factory_gn/moz.build
index 3a2f72d1e6b27..24d20580faf08 100644
--- a/third_party/libwebrtc/rtc_base/socket_factory_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/socket_factory_gn/moz.build
@@ -215,3 +215,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("socket_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/socket_gn/moz.build b/third_party/libwebrtc/rtc_base/socket_gn/moz.build
index 0d1760a15cac3..50350fdff881a 100644
--- a/third_party/libwebrtc/rtc_base/socket_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/socket_gn/moz.build
@@ -231,3 +231,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("socket_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/socket_server_gn/moz.build b/third_party/libwebrtc/rtc_base/socket_server_gn/moz.build
index 48972cbb4c6a9..38148d6ae5659 100644
--- a/third_party/libwebrtc/rtc_base/socket_server_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/socket_server_gn/moz.build
@@ -215,3 +215,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("socket_server_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/ssl_gn/moz.build b/third_party/libwebrtc/rtc_base/ssl_gn/moz.build
index 4be1ae97668d7..9592ccb3b6c4e 100644
--- a/third_party/libwebrtc/rtc_base/ssl_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/ssl_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("ssl_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/stringutils_gn/moz.build b/third_party/libwebrtc/rtc_base/stringutils_gn/moz.build
index 58008d114a2bd..3dff8e39c6e5f 100644
--- a/third_party/libwebrtc/rtc_base/stringutils_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/stringutils_gn/moz.build
@@ -227,3 +227,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("stringutils_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/swap_queue_gn/moz.build b/third_party/libwebrtc/rtc_base/swap_queue_gn/moz.build
index 3bffe145d6792..39e159471ebb4 100644
--- a/third_party/libwebrtc/rtc_base/swap_queue_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/swap_queue_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("swap_queue_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/synchronization/mutex_gn/moz.build b/third_party/libwebrtc/rtc_base/synchronization/mutex_gn/moz.build
index 9799330606527..3061f66410084 100644
--- a/third_party/libwebrtc/rtc_base/synchronization/mutex_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/synchronization/mutex_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("mutex_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/synchronization/sequence_checker_internal_gn/moz.build b/third_party/libwebrtc/rtc_base/synchronization/sequence_checker_internal_gn/moz.build
index a43e97a8c23cc..f384e990e5662 100644
--- a/third_party/libwebrtc/rtc_base/synchronization/sequence_checker_internal_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/synchronization/sequence_checker_internal_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("sequence_checker_internal_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/synchronization/yield_gn/moz.build b/third_party/libwebrtc/rtc_base/synchronization/yield_gn/moz.build
index ac962ac0a2816..430b802865b63 100644
--- a/third_party/libwebrtc/rtc_base/synchronization/yield_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/synchronization/yield_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("yield_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/synchronization/yield_policy_gn/moz.build b/third_party/libwebrtc/rtc_base/synchronization/yield_policy_gn/moz.build
index 7adceec9b45ad..3471013fa7a50 100644
--- a/third_party/libwebrtc/rtc_base/synchronization/yield_policy_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/synchronization/yield_policy_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("yield_policy_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/arch_gn/moz.build b/third_party/libwebrtc/rtc_base/system/arch_gn/moz.build
index 136948d0f2b84..296f059fd51f5 100644
--- a/third_party/libwebrtc/rtc_base/system/arch_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/arch_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("arch_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/asm_defines_gn/moz.build b/third_party/libwebrtc/rtc_base/system/asm_defines_gn/moz.build
index b99d782d883b9..3db112ed81c68 100644
--- a/third_party/libwebrtc/rtc_base/system/asm_defines_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/asm_defines_gn/moz.build
@@ -79,3 +79,6 @@ if CONFIG["MOZ_X11"] == "1" and CONFIG["OS_TARGET"] == "Linux":
     DEFINES["USE_X11"] = "1"
 
 Library("asm_defines_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/cocoa_threading_gn/moz.build b/third_party/libwebrtc/rtc_base/system/cocoa_threading_gn/moz.build
index 429299b4807ac..ea1145df63aed 100644
--- a/third_party/libwebrtc/rtc_base/system/cocoa_threading_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/cocoa_threading_gn/moz.build
@@ -65,3 +65,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("cocoa_threading_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/file_wrapper_gn/moz.build b/third_party/libwebrtc/rtc_base/system/file_wrapper_gn/moz.build
index 6d0a523103370..f35e30c7ee3b4 100644
--- a/third_party/libwebrtc/rtc_base/system/file_wrapper_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/file_wrapper_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("file_wrapper_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/gcd_helpers_gn/moz.build b/third_party/libwebrtc/rtc_base/system/gcd_helpers_gn/moz.build
index 243694e1d5524..ed549bec36655 100644
--- a/third_party/libwebrtc/rtc_base/system/gcd_helpers_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/gcd_helpers_gn/moz.build
@@ -65,3 +65,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("gcd_helpers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/ignore_warnings_gn/moz.build b/third_party/libwebrtc/rtc_base/system/ignore_warnings_gn/moz.build
index 61bbeefabcc61..884bef9aca8ed 100644
--- a/third_party/libwebrtc/rtc_base/system/ignore_warnings_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/ignore_warnings_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("ignore_warnings_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/inline_gn/moz.build b/third_party/libwebrtc/rtc_base/system/inline_gn/moz.build
index 574d7958f1213..14c21388d4868 100644
--- a/third_party/libwebrtc/rtc_base/system/inline_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/inline_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("inline_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/no_unique_address_gn/moz.build b/third_party/libwebrtc/rtc_base/system/no_unique_address_gn/moz.build
index 4d51581c1b453..d0067926c8257 100644
--- a/third_party/libwebrtc/rtc_base/system/no_unique_address_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/no_unique_address_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("no_unique_address_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/rtc_export_gn/moz.build b/third_party/libwebrtc/rtc_base/system/rtc_export_gn/moz.build
index e4d340d3c6be4..2bef40a841b78 100644
--- a/third_party/libwebrtc/rtc_base/system/rtc_export_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/rtc_export_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtc_export_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/unused_gn/moz.build b/third_party/libwebrtc/rtc_base/system/unused_gn/moz.build
index c6dd8a6bab8fe..5efc4416a7ac7 100644
--- a/third_party/libwebrtc/rtc_base/system/unused_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/unused_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("unused_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/system/warn_current_thread_is_deadlocked_gn/moz.build b/third_party/libwebrtc/rtc_base/system/warn_current_thread_is_deadlocked_gn/moz.build
index 3aa57ac48eab1..cff72ef0ab06a 100644
--- a/third_party/libwebrtc/rtc_base/system/warn_current_thread_is_deadlocked_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/system/warn_current_thread_is_deadlocked_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("warn_current_thread_is_deadlocked_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/task_utils/repeating_task_gn/moz.build b/third_party/libwebrtc/rtc_base/task_utils/repeating_task_gn/moz.build
index 224f77682849b..fee1a58d3e97a 100644
--- a/third_party/libwebrtc/rtc_base/task_utils/repeating_task_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/task_utils/repeating_task_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("repeating_task_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/third_party/base64/base64_gn/moz.build b/third_party/libwebrtc/rtc_base/third_party/base64/base64_gn/moz.build
index 0d35da2f19ba4..2f5365e2628f1 100644
--- a/third_party/libwebrtc/rtc_base/third_party/base64/base64_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/third_party/base64/base64_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("base64_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/third_party/sigslot/sigslot_gn/moz.build b/third_party/libwebrtc/rtc_base/third_party/sigslot/sigslot_gn/moz.build
index 906a4a9e8155e..3e87889a5d806 100644
--- a/third_party/libwebrtc/rtc_base/third_party/sigslot/sigslot_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/third_party/sigslot/sigslot_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("sigslot_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/threading_gn/moz.build b/third_party/libwebrtc/rtc_base/threading_gn/moz.build
index 199af4b1d30e7..34929fc232e0c 100644
--- a/third_party/libwebrtc/rtc_base/threading_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/threading_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("threading_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/timeutils_gn/moz.build b/third_party/libwebrtc/rtc_base/timeutils_gn/moz.build
index c4eb7ac8de413..1713580ecc2c9 100644
--- a/third_party/libwebrtc/rtc_base/timeutils_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/timeutils_gn/moz.build
@@ -232,3 +232,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("timeutils_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/type_traits_gn/moz.build b/third_party/libwebrtc/rtc_base/type_traits_gn/moz.build
index 1f72327af376b..4f2277810e87d 100644
--- a/third_party/libwebrtc/rtc_base/type_traits_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/type_traits_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("type_traits_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/unique_id_generator_gn/moz.build b/third_party/libwebrtc/rtc_base/unique_id_generator_gn/moz.build
index 975562a208703..ff08670181ff2 100644
--- a/third_party/libwebrtc/rtc_base/unique_id_generator_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/unique_id_generator_gn/moz.build
@@ -203,3 +203,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("unique_id_generator_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/units/unit_base_gn/moz.build b/third_party/libwebrtc/rtc_base/units/unit_base_gn/moz.build
index bb68c4ea3c976..93238b8382fc9 100644
--- a/third_party/libwebrtc/rtc_base/units/unit_base_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/units/unit_base_gn/moz.build
@@ -207,3 +207,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("unit_base_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/weak_ptr_gn/moz.build b/third_party/libwebrtc/rtc_base/weak_ptr_gn/moz.build
index a7cf9dd19e0f8..3612a8cdfd61e 100644
--- a/third_party/libwebrtc/rtc_base/weak_ptr_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/weak_ptr_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("weak_ptr_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/win/create_direct3d_device_gn/moz.build b/third_party/libwebrtc/rtc_base/win/create_direct3d_device_gn/moz.build
index a33d306080388..66fbb308c6773 100644
--- a/third_party/libwebrtc/rtc_base/win/create_direct3d_device_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/win/create_direct3d_device_gn/moz.build
@@ -83,3 +83,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("create_direct3d_device_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/win/get_activation_factory_gn/moz.build b/third_party/libwebrtc/rtc_base/win/get_activation_factory_gn/moz.build
index 387109c968dca..db0ed6162acab 100644
--- a/third_party/libwebrtc/rtc_base/win/get_activation_factory_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/win/get_activation_factory_gn/moz.build
@@ -83,3 +83,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("get_activation_factory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/win/hstring_gn/moz.build b/third_party/libwebrtc/rtc_base/win/hstring_gn/moz.build
index c69cce6983f8e..d0704e8e1ec3e 100644
--- a/third_party/libwebrtc/rtc_base/win/hstring_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/win/hstring_gn/moz.build
@@ -83,3 +83,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("hstring_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/win/windows_version_gn/moz.build b/third_party/libwebrtc/rtc_base/win/windows_version_gn/moz.build
index 33b46947a4975..6c45c5b4aced4 100644
--- a/third_party/libwebrtc/rtc_base/win/windows_version_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/win/windows_version_gn/moz.build
@@ -83,3 +83,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("windows_version_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/win32_gn/moz.build b/third_party/libwebrtc/rtc_base/win32_gn/moz.build
index 607a23eb5e969..9b0e180745619 100644
--- a/third_party/libwebrtc/rtc_base/win32_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/win32_gn/moz.build
@@ -90,3 +90,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("win32_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/rtc_base/zero_memory_gn/moz.build b/third_party/libwebrtc/rtc_base/zero_memory_gn/moz.build
index 1029a25252bc5..d7e2b19034ba6 100644
--- a/third_party/libwebrtc/rtc_base/zero_memory_gn/moz.build
+++ b/third_party/libwebrtc/rtc_base/zero_memory_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("zero_memory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/sdk/base_objc_gn/moz.build b/third_party/libwebrtc/sdk/base_objc_gn/moz.build
index 7b25d1f0596a5..2a697dcd6f0c8 100644
--- a/third_party/libwebrtc/sdk/base_objc_gn/moz.build
+++ b/third_party/libwebrtc/sdk/base_objc_gn/moz.build
@@ -77,3 +77,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("base_objc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/sdk/helpers_objc_gn/moz.build b/third_party/libwebrtc/sdk/helpers_objc_gn/moz.build
index a910dc1cb5799..544203b0bae35 100644
--- a/third_party/libwebrtc/sdk/helpers_objc_gn/moz.build
+++ b/third_party/libwebrtc/sdk/helpers_objc_gn/moz.build
@@ -73,3 +73,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("helpers_objc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/sdk/videocapture_objc_gn/moz.build b/third_party/libwebrtc/sdk/videocapture_objc_gn/moz.build
index 7bfe020e4d495..a84d6c003f239 100644
--- a/third_party/libwebrtc/sdk/videocapture_objc_gn/moz.build
+++ b/third_party/libwebrtc/sdk/videocapture_objc_gn/moz.build
@@ -68,3 +68,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("videocapture_objc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/sdk/videoframebuffer_objc_gn/moz.build b/third_party/libwebrtc/sdk/videoframebuffer_objc_gn/moz.build
index 9e7f52704a52c..a7bf40e08c6b9 100644
--- a/third_party/libwebrtc/sdk/videoframebuffer_objc_gn/moz.build
+++ b/third_party/libwebrtc/sdk/videoframebuffer_objc_gn/moz.build
@@ -71,3 +71,6 @@ if CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["WEBRTC_ENABLE_AVX2"] = True
 
 Library("videoframebuffer_objc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/system_wrappers/denormal_disabler_gn/moz.build b/third_party/libwebrtc/system_wrappers/denormal_disabler_gn/moz.build
index 5a007d6343e2f..ad4801f7ebdd4 100644
--- a/third_party/libwebrtc/system_wrappers/denormal_disabler_gn/moz.build
+++ b/third_party/libwebrtc/system_wrappers/denormal_disabler_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("denormal_disabler_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/system_wrappers/field_trial_gn/moz.build b/third_party/libwebrtc/system_wrappers/field_trial_gn/moz.build
index e23512e425796..e8b45a66e2665 100644
--- a/third_party/libwebrtc/system_wrappers/field_trial_gn/moz.build
+++ b/third_party/libwebrtc/system_wrappers/field_trial_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("field_trial_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/system_wrappers/metrics_gn/moz.build b/third_party/libwebrtc/system_wrappers/metrics_gn/moz.build
index aa35ad0401a82..7bc7e8f6fa76d 100644
--- a/third_party/libwebrtc/system_wrappers/metrics_gn/moz.build
+++ b/third_party/libwebrtc/system_wrappers/metrics_gn/moz.build
@@ -223,3 +223,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("metrics_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/system_wrappers/system_wrappers_gn/moz.build b/third_party/libwebrtc/system_wrappers/system_wrappers_gn/moz.build
index e53ea6babd3dd..b5ec98eaceb1a 100644
--- a/third_party/libwebrtc/system_wrappers/system_wrappers_gn/moz.build
+++ b/third_party/libwebrtc/system_wrappers/system_wrappers_gn/moz.build
@@ -248,3 +248,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("system_wrappers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/test/rtp_test_utils_gn/moz.build b/third_party/libwebrtc/test/rtp_test_utils_gn/moz.build
index f3ffb448cd30f..70706a9821fe3 100644
--- a/third_party/libwebrtc/test/rtp_test_utils_gn/moz.build
+++ b/third_party/libwebrtc/test/rtp_test_utils_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rtp_test_utils_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/algorithm/algorithm_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/algorithm/algorithm_gn/moz.build
index f0562eabf500f..dcb72869b0cec 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/algorithm/algorithm_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/algorithm/algorithm_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("algorithm_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/algorithm/container_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/algorithm/container_gn/moz.build
index 74a9d1986ea51..bb82660edc2a3 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/algorithm/container_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/algorithm/container_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("container_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/atomic_hook_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/atomic_hook_gn/moz.build
index e3b931a7b2fe1..23bfb68c331ca 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/atomic_hook_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/atomic_hook_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("atomic_hook_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/base_internal_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/base_internal_gn/moz.build
index 783c3186bb9e0..0f70de6c00318 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/base_internal_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/base_internal_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("base_internal_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/config_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/config_gn/moz.build
index ba78602e5eea4..606c13f76ebe2 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/config_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/config_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/core_headers_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/core_headers_gn/moz.build
index e19ecba14a747..8fcf73dd22fd8 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/core_headers_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/core_headers_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("core_headers_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/log_severity_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/log_severity_gn/moz.build
index a24939362860f..61b980c8a735e 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/log_severity_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/log_severity_gn/moz.build
@@ -171,3 +171,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("log_severity_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/raw_logging_internal_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/raw_logging_internal_gn/moz.build
index 8402338b9899d..f6840d3b67589 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/raw_logging_internal_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/raw_logging_internal_gn/moz.build
@@ -171,3 +171,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("raw_logging_internal_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/throw_delegate_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/throw_delegate_gn/moz.build
index 78f0a49f704c3..807e82a0740a0 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/base/throw_delegate_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/base/throw_delegate_gn/moz.build
@@ -171,3 +171,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("throw_delegate_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/cleanup/cleanup_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/cleanup/cleanup_gn/moz.build
index 590a21038a80b..d5cfec1b8b288 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/cleanup/cleanup_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/cleanup/cleanup_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("cleanup_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/cleanup/cleanup_internal_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/cleanup/cleanup_internal_gn/moz.build
index 269410ddabce7..5605db1e6e7f5 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/cleanup/cleanup_internal_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/cleanup/cleanup_internal_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("cleanup_internal_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/container/compressed_tuple_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/container/compressed_tuple_gn/moz.build
index ee9640db8bb11..2898fee9f8580 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/container/compressed_tuple_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/container/compressed_tuple_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("compressed_tuple_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/container/inlined_vector_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/container/inlined_vector_gn/moz.build
index bdf3ab137437c..aadd7a8d8da37 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/container/inlined_vector_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/container/inlined_vector_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("inlined_vector_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/container/inlined_vector_internal_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/container/inlined_vector_internal_gn/moz.build
index a77c5b9bbf029..011669c795bf4 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/container/inlined_vector_internal_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/container/inlined_vector_internal_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("inlined_vector_internal_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/functional/any_invocable_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/functional/any_invocable_gn/moz.build
index 34944872348dd..9d51153c4aee8 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/functional/any_invocable_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/functional/any_invocable_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("any_invocable_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/functional/bind_front_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/functional/bind_front_gn/moz.build
index 564670abf0d0d..87d27d0c25401 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/functional/bind_front_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/functional/bind_front_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bind_front_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/memory/memory_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/memory/memory_gn/moz.build
index bd6abd19836c3..9e2e1060b35f3 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/memory/memory_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/memory/memory_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("memory_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/meta/type_traits_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/meta/type_traits_gn/moz.build
index 5d0b080cb8801..240f5b8f7abfa 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/meta/type_traits_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/meta/type_traits_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("type_traits_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/numeric/bits_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/numeric/bits_gn/moz.build
index 1923a18b1f3dd..42cf9441add2c 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/numeric/bits_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/numeric/bits_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bits_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/numeric/int128_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/numeric/int128_gn/moz.build
index ec45e9281f85a..e9201033dfb3a 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/numeric/int128_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/numeric/int128_gn/moz.build
@@ -171,3 +171,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("int128_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/strings/string_view_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/strings/string_view_gn/moz.build
index 16fa4aa493838..a260b3e9cfa31 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/strings/string_view_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/strings/string_view_gn/moz.build
@@ -171,3 +171,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("string_view_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/strings/strings_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/strings/strings_gn/moz.build
index f748c5d9c15f2..4b37ce03dff19 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/strings/strings_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/strings/strings_gn/moz.build
@@ -176,3 +176,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("strings_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/bad_optional_access_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/bad_optional_access_gn/moz.build
index a2eeaa3f05f38..5fa2cafc5d169 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/bad_optional_access_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/bad_optional_access_gn/moz.build
@@ -171,3 +171,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bad_optional_access_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/bad_variant_access_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/bad_variant_access_gn/moz.build
index e20623795d696..024519168bef8 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/bad_variant_access_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/bad_variant_access_gn/moz.build
@@ -171,3 +171,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("bad_variant_access_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/optional_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/optional_gn/moz.build
index 252d8a8376434..0a23747ccb80c 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/optional_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/optional_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("optional_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/span_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/span_gn/moz.build
index 91f8106b27881..71f0e575a5535 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/span_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/span_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("span_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/variant_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/variant_gn/moz.build
index 1f2c40273d74c..b499481570136 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/types/variant_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/types/variant_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("variant_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/abseil-cpp/absl/utility/utility_gn/moz.build b/third_party/libwebrtc/third_party/abseil-cpp/absl/utility/utility_gn/moz.build
index 172b27fecbd95..726f4ea5539ec 100644
--- a/third_party/libwebrtc/third_party/abseil-cpp/absl/utility/utility_gn/moz.build
+++ b/third_party/libwebrtc/third_party/abseil-cpp/absl/utility/utility_gn/moz.build
@@ -153,3 +153,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("utility_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/drm/drm_gn/moz.build b/third_party/libwebrtc/third_party/drm/drm_gn/moz.build
index a397ac2643f2a..8f9d151de1877 100644
--- a/third_party/libwebrtc/third_party/drm/drm_gn/moz.build
+++ b/third_party/libwebrtc/third_party/drm/drm_gn/moz.build
@@ -87,3 +87,6 @@ if CONFIG["MOZ_X11"] == "1" and CONFIG["OS_TARGET"] == "Linux":
     DEFINES["USE_X11"] = "1"
 
 Library("drm_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/gbm/gbm_gn/moz.build b/third_party/libwebrtc/third_party/gbm/gbm_gn/moz.build
index badbac28ea59e..59ea2964a845f 100644
--- a/third_party/libwebrtc/third_party/gbm/gbm_gn/moz.build
+++ b/third_party/libwebrtc/third_party/gbm/gbm_gn/moz.build
@@ -85,3 +85,6 @@ if CONFIG["MOZ_X11"] == "1" and CONFIG["OS_TARGET"] == "Linux":
     DEFINES["USE_X11"] = "1"
 
 Library("gbm_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/libepoxy/libepoxy_gn/moz.build b/third_party/libwebrtc/third_party/libepoxy/libepoxy_gn/moz.build
index 0003801059011..b33e6f1390a57 100644
--- a/third_party/libwebrtc/third_party/libepoxy/libepoxy_gn/moz.build
+++ b/third_party/libwebrtc/third_party/libepoxy/libepoxy_gn/moz.build
@@ -86,3 +86,6 @@ if CONFIG["MOZ_X11"] == "1" and CONFIG["OS_TARGET"] == "Linux":
     DEFINES["USE_X11"] = "1"
 
 Library("epoxy_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/libvpx/libvpx_gn/moz.build b/third_party/libwebrtc/third_party/libvpx/libvpx_gn/moz.build
index b57c7bd060a9a..4b91153a2fd3d 100644
--- a/third_party/libwebrtc/third_party/libvpx/libvpx_gn/moz.build
+++ b/third_party/libwebrtc/third_party/libvpx/libvpx_gn/moz.build
@@ -204,3 +204,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("vpx_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/libyuv/libyuv_gn/moz.build b/third_party/libwebrtc/third_party/libyuv/libyuv_gn/moz.build
index 5c9e66f4083dc..bd2890a28d688 100644
--- a/third_party/libwebrtc/third_party/libyuv/libyuv_gn/moz.build
+++ b/third_party/libwebrtc/third_party/libyuv/libyuv_gn/moz.build
@@ -205,3 +205,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("yuv_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/pffft/pffft_gn/moz.build b/third_party/libwebrtc/third_party/pffft/pffft_gn/moz.build
index ee4fd18a3eb48..4e827582a8151 100644
--- a/third_party/libwebrtc/third_party/pffft/pffft_gn/moz.build
+++ b/third_party/libwebrtc/third_party/pffft/pffft_gn/moz.build
@@ -185,3 +185,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("pffft_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/pipewire/pipewire_gn/moz.build b/third_party/libwebrtc/third_party/pipewire/pipewire_gn/moz.build
index 6209fa98cc55a..52b01b19734a3 100644
--- a/third_party/libwebrtc/third_party/pipewire/pipewire_gn/moz.build
+++ b/third_party/libwebrtc/third_party/pipewire/pipewire_gn/moz.build
@@ -86,3 +86,6 @@ if CONFIG["MOZ_X11"] == "1" and CONFIG["OS_TARGET"] == "Linux":
     DEFINES["USE_X11"] = "1"
 
 Library("pipewire_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/third_party/rnnoise/rnn_vad_gn/moz.build b/third_party/libwebrtc/third_party/rnnoise/rnn_vad_gn/moz.build
index afb7f87ccf807..fb2ea1a3a4165 100644
--- a/third_party/libwebrtc/third_party/rnnoise/rnn_vad_gn/moz.build
+++ b/third_party/libwebrtc/third_party/rnnoise/rnn_vad_gn/moz.build
@@ -174,3 +174,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("rnn_vad_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/adaptation/video_adaptation_gn/moz.build b/third_party/libwebrtc/video/adaptation/video_adaptation_gn/moz.build
index 2d1fd69ed05d2..9ed6ef4b9cd49 100644
--- a/third_party/libwebrtc/video/adaptation/video_adaptation_gn/moz.build
+++ b/third_party/libwebrtc/video/adaptation/video_adaptation_gn/moz.build
@@ -244,3 +244,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_adaptation_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/config/encoder_config_gn/moz.build b/third_party/libwebrtc/video/config/encoder_config_gn/moz.build
index 1c2c9ef83579d..13fdc172ca0e4 100644
--- a/third_party/libwebrtc/video/config/encoder_config_gn/moz.build
+++ b/third_party/libwebrtc/video/config/encoder_config_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("encoder_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/config/streams_config_gn/moz.build b/third_party/libwebrtc/video/config/streams_config_gn/moz.build
index e2d2f9963d845..212fed2b75551 100644
--- a/third_party/libwebrtc/video/config/streams_config_gn/moz.build
+++ b/third_party/libwebrtc/video/config/streams_config_gn/moz.build
@@ -236,3 +236,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("streams_config_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/decode_synchronizer_gn/moz.build b/third_party/libwebrtc/video/decode_synchronizer_gn/moz.build
index d0e4adeda2396..108a9ec7d7733 100644
--- a/third_party/libwebrtc/video/decode_synchronizer_gn/moz.build
+++ b/third_party/libwebrtc/video/decode_synchronizer_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("decode_synchronizer_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/frame_cadence_adapter_gn/moz.build b/third_party/libwebrtc/video/frame_cadence_adapter_gn/moz.build
index 51ec86b2cf18d..e2f15eb723827 100644
--- a/third_party/libwebrtc/video/frame_cadence_adapter_gn/moz.build
+++ b/third_party/libwebrtc/video/frame_cadence_adapter_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_cadence_adapter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/frame_decode_scheduler_gn/moz.build b/third_party/libwebrtc/video/frame_decode_scheduler_gn/moz.build
index a53fde81f2071..b2e48d78d6196 100644
--- a/third_party/libwebrtc/video/frame_decode_scheduler_gn/moz.build
+++ b/third_party/libwebrtc/video/frame_decode_scheduler_gn/moz.build
@@ -218,3 +218,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_decode_scheduler_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/frame_decode_timing_gn/moz.build b/third_party/libwebrtc/video/frame_decode_timing_gn/moz.build
index ca09fac23b1dc..d407b72f6a937 100644
--- a/third_party/libwebrtc/video/frame_decode_timing_gn/moz.build
+++ b/third_party/libwebrtc/video/frame_decode_timing_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_decode_timing_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/frame_dumping_decoder_gn/moz.build b/third_party/libwebrtc/video/frame_dumping_decoder_gn/moz.build
index 39e9878bd2297..6f553b33a5036 100644
--- a/third_party/libwebrtc/video/frame_dumping_decoder_gn/moz.build
+++ b/third_party/libwebrtc/video/frame_dumping_decoder_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_dumping_decoder_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/frame_dumping_encoder_gn/moz.build b/third_party/libwebrtc/video/frame_dumping_encoder_gn/moz.build
index 615033eb1d1c1..ffa318a54387a 100644
--- a/third_party/libwebrtc/video/frame_dumping_encoder_gn/moz.build
+++ b/third_party/libwebrtc/video/frame_dumping_encoder_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("frame_dumping_encoder_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/render/incoming_video_stream_gn/moz.build b/third_party/libwebrtc/video/render/incoming_video_stream_gn/moz.build
index ad1d7fbfb348e..2ab5080854b2c 100644
--- a/third_party/libwebrtc/video/render/incoming_video_stream_gn/moz.build
+++ b/third_party/libwebrtc/video/render/incoming_video_stream_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("incoming_video_stream_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/render/video_render_frames_gn/moz.build b/third_party/libwebrtc/video/render/video_render_frames_gn/moz.build
index d5de8cd1781e1..541cb14825341 100644
--- a/third_party/libwebrtc/video/render/video_render_frames_gn/moz.build
+++ b/third_party/libwebrtc/video/render/video_render_frames_gn/moz.build
@@ -230,3 +230,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_render_frames_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/task_queue_frame_decode_scheduler_gn/moz.build b/third_party/libwebrtc/video/task_queue_frame_decode_scheduler_gn/moz.build
index 2651f290bc5ba..d5a4243493f7f 100644
--- a/third_party/libwebrtc/video/task_queue_frame_decode_scheduler_gn/moz.build
+++ b/third_party/libwebrtc/video/task_queue_frame_decode_scheduler_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("task_queue_frame_decode_scheduler_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/unique_timestamp_counter_gn/moz.build b/third_party/libwebrtc/video/unique_timestamp_counter_gn/moz.build
index 24b3c5a30b6e8..0ebe04cbc83b0 100644
--- a/third_party/libwebrtc/video/unique_timestamp_counter_gn/moz.build
+++ b/third_party/libwebrtc/video/unique_timestamp_counter_gn/moz.build
@@ -219,3 +219,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("unique_timestamp_counter_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/video_gn/moz.build b/third_party/libwebrtc/video/video_gn/moz.build
index e8ac15dc40e6c..f537e75cfbf4b 100644
--- a/third_party/libwebrtc/video/video_gn/moz.build
+++ b/third_party/libwebrtc/video/video_gn/moz.build
@@ -255,3 +255,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/video_receive_stream_timeout_tracker_gn/moz.build b/third_party/libwebrtc/video/video_receive_stream_timeout_tracker_gn/moz.build
index 8fb9a9c737121..54ed4adeae1bf 100644
--- a/third_party/libwebrtc/video/video_receive_stream_timeout_tracker_gn/moz.build
+++ b/third_party/libwebrtc/video/video_receive_stream_timeout_tracker_gn/moz.build
@@ -234,3 +234,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_receive_stream_timeout_tracker_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/video_stream_buffer_controller_gn/moz.build b/third_party/libwebrtc/video/video_stream_buffer_controller_gn/moz.build
index e60151d9678e4..fea4f16673309 100644
--- a/third_party/libwebrtc/video/video_stream_buffer_controller_gn/moz.build
+++ b/third_party/libwebrtc/video/video_stream_buffer_controller_gn/moz.build
@@ -235,3 +235,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_stream_buffer_controller_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/video_stream_encoder_impl_gn/moz.build b/third_party/libwebrtc/video/video_stream_encoder_impl_gn/moz.build
index 2ea2fce60b587..4c97a8ca9793e 100644
--- a/third_party/libwebrtc/video/video_stream_encoder_impl_gn/moz.build
+++ b/third_party/libwebrtc/video/video_stream_encoder_impl_gn/moz.build
@@ -240,3 +240,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_stream_encoder_impl_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/video/video_stream_encoder_interface_gn/moz.build b/third_party/libwebrtc/video/video_stream_encoder_interface_gn/moz.build
index 0d40ef9c8f22a..1a15799c9dab4 100644
--- a/third_party/libwebrtc/video/video_stream_encoder_interface_gn/moz.build
+++ b/third_party/libwebrtc/video/video_stream_encoder_interface_gn/moz.build
@@ -214,3 +214,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     DEFINES["_GNU_SOURCE"] = True
 
 Library("video_stream_encoder_interface_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/libwebrtc/webrtc_gn/moz.build b/third_party/libwebrtc/webrtc_gn/moz.build
index f71e5851253d0..6ee62f5a8eedf 100644
--- a/third_party/libwebrtc/webrtc_gn/moz.build
+++ b/third_party/libwebrtc/webrtc_gn/moz.build
@@ -282,3 +282,6 @@ if CONFIG["OS_TARGET"] == "Linux" and CONFIG["TARGET_CPU"] == "x86_64":
     ]
 
 Library("webrtc_gn")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/moz.build b/third_party/moz.build
index abb3aff2c164e..f36e94c10596c 100644
--- a/third_party/moz.build
+++ b/third_party/moz.build
@@ -94,3 +94,6 @@ with Files('WinToast/**'):
 with Files('libsrtp/**'):
     BUG_COMPONENT = ('Core', 'WebRTC: Networking')
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/msgpack/moz.build b/third_party/msgpack/moz.build
index 0ce52d9dbd1a3..53ec74e52dbfa 100644
--- a/third_party/msgpack/moz.build
+++ b/third_party/msgpack/moz.build
@@ -22,4 +22,6 @@ SOURCES += [
     'src/vrefbuffer.c',
 ]
 
-FINAL_LIBRARY = 'xul'
\ No newline at end of file
+FINAL_LIBRARY = 'xul'
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/pipewire/libpipewire/moz.build b/third_party/pipewire/libpipewire/moz.build
index 3102b3cb69b79..a48c9cc703dc3 100644
--- a/third_party/pipewire/libpipewire/moz.build
+++ b/third_party/pipewire/libpipewire/moz.build
@@ -14,3 +14,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 LOCAL_INCLUDES += ['/third_party/pipewire']
 
 FINAL_LIBRARY = 'xul'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/python/moz.build b/third_party/python/moz.build
index c67e814a1bdd0..c78e4bf3b8ce9 100644
--- a/third_party/python/moz.build
+++ b/third_party/python/moz.build
@@ -56,3 +56,6 @@ with Files('taskcluster/**'):
 
 with Files('voluptuous/**'):
     BUG_COMPONENT = ('Firefox Build System', 'Task Configuration')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/sipcc/moz.build b/third_party/sipcc/moz.build
index 851032c37020c..79631693be497 100644
--- a/third_party/sipcc/moz.build
+++ b/third_party/sipcc/moz.build
@@ -43,3 +43,6 @@ if CONFIG['MOZ_WEBRTC_SIGNALING']:
 
     FINAL_LIBRARY = 'xul'
 
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/sqlite3/ext/moz.build b/third_party/sqlite3/ext/moz.build
index ffd938b601fbb..be7e582886d5d 100644
--- a/third_party/sqlite3/ext/moz.build
+++ b/third_party/sqlite3/ext/moz.build
@@ -24,3 +24,6 @@ if CONFIG["OS_TARGET"] == "Linux" or CONFIG["OS_TARGET"] == "Android":
     OS_LIBS += [
         "m",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/sqlite3/src/moz.build b/third_party/sqlite3/src/moz.build
index e7cc2346569ae..e9b6cf8992f06 100644
--- a/third_party/sqlite3/src/moz.build
+++ b/third_party/sqlite3/src/moz.build
@@ -126,3 +126,6 @@ DEFINES['SQLITE_DEFAULT_JOURNAL_SIZE_LIMIT'] = 1572864
 # syntax (SQLITE_ENABLE_FTS3_PARENTHESIS) yet.
 if CONFIG["MOZ_THUNDERBIRD"] or CONFIG["MOZ_SUITE"]:
     DEFINES['SQLITE_ENABLE_FTS3'] = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/third_party/wayland-proxy/moz.build b/third_party/wayland-proxy/moz.build
index e95f18f54115c..803c9e4d1d27b 100644
--- a/third_party/wayland-proxy/moz.build
+++ b/third_party/wayland-proxy/moz.build
@@ -14,3 +14,6 @@ EXPORTS += [
     "wayland-proxy.h",
 ]
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/actors/moz.build b/toolkit/actors/moz.build
index 8e2d8a5efc0f5..09e8a22f407d5 100644
--- a/toolkit/actors/moz.build
+++ b/toolkit/actors/moz.build
@@ -81,3 +81,6 @@ FINAL_TARGET_FILES.actors += [
     "WebChannelChild.sys.mjs",
     "WebChannelParent.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/aboutcheckerboard/moz.build b/toolkit/components/aboutcheckerboard/moz.build
index 6d0b2c5000aa9..af6bfaa0f739c 100644
--- a/toolkit/components/aboutcheckerboard/moz.build
+++ b/toolkit/components/aboutcheckerboard/moz.build
@@ -8,3 +8,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "Panning and Zooming")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/aboutconfig/moz.build b/toolkit/components/aboutconfig/moz.build
index cfeb1a5e8703e..6e4e74609e521 100644
--- a/toolkit/components/aboutconfig/moz.build
+++ b/toolkit/components/aboutconfig/moz.build
@@ -7,3 +7,6 @@
 BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/aboutmemory/moz.build b/toolkit/components/aboutmemory/moz.build
index fb20d5bf49081..a71abb80e852c 100644
--- a/toolkit/components/aboutmemory/moz.build
+++ b/toolkit/components/aboutmemory/moz.build
@@ -13,3 +13,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "about:memory")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/aboutprocesses/moz.build b/toolkit/components/aboutprocesses/moz.build
index 5206b02fe02aa..57d9664c10ade 100644
--- a/toolkit/components/aboutprocesses/moz.build
+++ b/toolkit/components/aboutprocesses/moz.build
@@ -10,3 +10,6 @@ with Files("**"):
 JAR_MANIFESTS += ["jar.mn"]
 
 BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/aboutthirdparty/moz.build b/toolkit/components/aboutthirdparty/moz.build
index 4703eab304e84..3d625feb38bc5 100644
--- a/toolkit/components/aboutthirdparty/moz.build
+++ b/toolkit/components/aboutthirdparty/moz.build
@@ -35,3 +35,6 @@ if CONFIG["ENABLE_TESTS"]:
 TEST_DIRS += ["tests/TestShellEx"]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/aboutthirdparty/tests/TestShellEx/moz.build b/toolkit/components/aboutthirdparty/tests/TestShellEx/moz.build
index 44344a0e2e5cc..ef50481cb3c01 100644
--- a/toolkit/components/aboutthirdparty/tests/TestShellEx/moz.build
+++ b/toolkit/components/aboutthirdparty/tests/TestShellEx/moz.build
@@ -31,3 +31,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.testing.mochitest.browser.toolkit.components.aboutthirdparty.tests.browser += [
         shared_library
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/aboutthirdparty/tests/gtest/moz.build b/toolkit/components/aboutthirdparty/tests/gtest/moz.build
index 659c0836db476..55702cf566e7c 100644
--- a/toolkit/components/aboutthirdparty/tests/gtest/moz.build
+++ b/toolkit/components/aboutthirdparty/tests/gtest/moz.build
@@ -11,3 +11,6 @@ LOCAL_INCLUDES += [
 UNIFIED_SOURCES += ["TestAboutThirdParty.cpp"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/aboutwebauthn/moz.build b/toolkit/components/aboutwebauthn/moz.build
index 4cf77ef103e98..cd4485373aa50 100644
--- a/toolkit/components/aboutwebauthn/moz.build
+++ b/toolkit/components/aboutwebauthn/moz.build
@@ -11,3 +11,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] not in ("windows", "android"):
     BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/aboutwindowsmessages/moz.build b/toolkit/components/aboutwindowsmessages/moz.build
index 5827cca885987..62de1c1d83cd0 100644
--- a/toolkit/components/aboutwindowsmessages/moz.build
+++ b/toolkit/components/aboutwindowsmessages/moz.build
@@ -22,3 +22,6 @@ EXPORTS.mozilla += [
 SOURCES += [
     "AboutWindowsMessages.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/alerts/moz.build b/toolkit/components/alerts/moz.build
index b07ce72f0d522..26354d4b0e302 100644
--- a/toolkit/components/alerts/moz.build
+++ b/toolkit/components/alerts/moz.build
@@ -43,3 +43,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Alerts Service")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/antitracking/bouncetrackingprotection/moz.build b/toolkit/components/antitracking/bouncetrackingprotection/moz.build
index 828efc394e2bb..31a2c6905309a 100644
--- a/toolkit/components/antitracking/bouncetrackingprotection/moz.build
+++ b/toolkit/components/antitracking/bouncetrackingprotection/moz.build
@@ -45,3 +45,6 @@ BROWSER_CHROME_MANIFESTS += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/antitracking/moz.build b/toolkit/components/antitracking/moz.build
index 6e9ab6f1295ad..ca008c2efbd81 100644
--- a/toolkit/components/antitracking/moz.build
+++ b/toolkit/components/antitracking/moz.build
@@ -99,3 +99,6 @@ XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 TEST_DIRS += ["test/gtest"]
 
 SPHINX_TREES["anti-tracking"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/antitracking/test/gtest/moz.build b/toolkit/components/antitracking/test/gtest/moz.build
index a7e8595c5e4ce..9e470a36d377c 100644
--- a/toolkit/components/antitracking/test/gtest/moz.build
+++ b/toolkit/components/antitracking/test/gtest/moz.build
@@ -17,3 +17,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/apppicker/moz.build b/toolkit/components/apppicker/moz.build
index 199926b764acb..fbf12c26de097 100644
--- a/toolkit/components/apppicker/moz.build
+++ b/toolkit/components/apppicker/moz.build
@@ -8,3 +8,6 @@ with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Preferences")
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/asyncshutdown/moz.build b/toolkit/components/asyncshutdown/moz.build
index fafa0c05667dc..8c2398e1a1329 100644
--- a/toolkit/components/asyncshutdown/moz.build
+++ b/toolkit/components/asyncshutdown/moz.build
@@ -23,3 +23,6 @@ XPCOM_MANIFESTS += [
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Async Tooling")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/autocomplete/moz.build b/toolkit/components/autocomplete/moz.build
index c8adb0bd5bdf1..5ca8e9ae2d6b6 100644
--- a/toolkit/components/autocomplete/moz.build
+++ b/toolkit/components/autocomplete/moz.build
@@ -35,3 +35,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Autocomplete")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/backgroundhangmonitor/moz.build b/toolkit/components/backgroundhangmonitor/moz.build
index 78cc8065b618c..a0082658332c7 100644
--- a/toolkit/components/backgroundhangmonitor/moz.build
+++ b/toolkit/components/backgroundhangmonitor/moz.build
@@ -66,3 +66,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/backgroundtasks/moz.build b/toolkit/components/backgroundtasks/moz.build
index 5f8b17c68825c..818a2a09bbc34 100644
--- a/toolkit/components/backgroundtasks/moz.build
+++ b/toolkit/components/backgroundtasks/moz.build
@@ -101,3 +101,6 @@ FINAL_TARGET_PP_FILES.defaults.backgroundtasks += [
 
 # For base::LaunchApp
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/bitsdownload/moz.build b/toolkit/components/bitsdownload/moz.build
index 9a2c6e23dba20..38ad4ad53ccde 100644
--- a/toolkit/components/bitsdownload/moz.build
+++ b/toolkit/components/bitsdownload/moz.build
@@ -26,3 +26,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Application Update")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/browser/build/moz.build b/toolkit/components/browser/build/moz.build
index 64df8d564c871..f306259d85b2b 100644
--- a/toolkit/components/browser/build/moz.build
+++ b/toolkit/components/browser/build/moz.build
@@ -9,3 +9,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/browser/moz.build b/toolkit/components/browser/moz.build
index 903390a3c86bc..e704a764e0f72 100644
--- a/toolkit/components/browser/moz.build
+++ b/toolkit/components/browser/moz.build
@@ -39,3 +39,6 @@ EXPORTS += [
     "nsEmbedCID.h",
     "nsWebBrowser.h",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/browser/nsIWebBrowserChrome.idl b/toolkit/components/browser/nsIWebBrowserChrome.idl
index 517c87a285dd9..e3010421d8dbe 100644
--- a/toolkit/components/browser/nsIWebBrowserChrome.idl
+++ b/toolkit/components/browser/nsIWebBrowserChrome.idl
@@ -74,6 +74,9 @@ interface nsIWebBrowserChrome : nsISupports
     // Whether this window should use out-of-process cross-origin subframes.
     const unsigned long CHROME_FISSION_WINDOW         = 1 << 21;
 
+    // Whether this window has "width" or "height" defined in features
+    const unsigned long JUGGLER_WINDOW_EXPLICIT_SIZE  = 0x00400000;
+
     // Prevents new window animations on MacOS and Windows. Currently
     // ignored for Linux.
     const unsigned long CHROME_SUPPRESS_ANIMATION     = 1 << 24;
diff --git a/toolkit/components/build/moz.build b/toolkit/components/build/moz.build
index a685d18c877c7..d2ed16e899139 100644
--- a/toolkit/components/build/moz.build
+++ b/toolkit/components/build/moz.build
@@ -24,3 +24,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "../url-classifier",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/captivedetect/moz.build b/toolkit/components/captivedetect/moz.build
index 5fa41fa97ece2..d42541c3e1903 100644
--- a/toolkit/components/captivedetect/moz.build
+++ b/toolkit/components/captivedetect/moz.build
@@ -22,3 +22,6 @@ EXTRA_JS_MODULES += [
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/cascade_bloom_filter/moz.build b/toolkit/components/cascade_bloom_filter/moz.build
index 7df5325bff6ce..f614ef831bd8a 100644
--- a/toolkit/components/cascade_bloom_filter/moz.build
+++ b/toolkit/components/cascade_bloom_filter/moz.build
@@ -24,3 +24,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/certviewer/moz.build b/toolkit/components/certviewer/moz.build
index d35a1bb0c1c8c..f3f92dd771513 100644
--- a/toolkit/components/certviewer/moz.build
+++ b/toolkit/components/certviewer/moz.build
@@ -17,3 +17,6 @@ EXTRA_JS_MODULES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Security")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/cleardata/moz.build b/toolkit/components/cleardata/moz.build
index d3f06d8221a69..a57aede34cfe0 100644
--- a/toolkit/components/cleardata/moz.build
+++ b/toolkit/components/cleardata/moz.build
@@ -36,3 +36,6 @@ with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Data Sanitization")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/clearsitedata/moz.build b/toolkit/components/clearsitedata/moz.build
index 3d57093466c0e..e5bcd8adf26de 100644
--- a/toolkit/components/clearsitedata/moz.build
+++ b/toolkit/components/clearsitedata/moz.build
@@ -23,3 +23,6 @@ with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Data Sanitization")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/commandlines/moz.build b/toolkit/components/commandlines/moz.build
index 6169726f2bd51..06b69cedb037d 100644
--- a/toolkit/components/commandlines/moz.build
+++ b/toolkit/components/commandlines/moz.build
@@ -32,3 +32,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Startup and Profile System")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/contentanalysis/moz.build b/toolkit/components/contentanalysis/moz.build
index e602d30302cd9..9dd6eaa55eadf 100644
--- a/toolkit/components/contentanalysis/moz.build
+++ b/toolkit/components/contentanalysis/moz.build
@@ -60,3 +60,6 @@ DEFINES["GOOGLE_PROTOBUF_NO_STATIC_INITIALIZER"] = True
 FINAL_LIBRARY = "xul"
 
 TEST_DIRS += ["tests/gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/contentanalysis/tests/gtest/agent/moz.build b/toolkit/components/contentanalysis/tests/gtest/agent/moz.build
index 71a3a029ed421..ece7b4074c069 100644
--- a/toolkit/components/contentanalysis/tests/gtest/agent/moz.build
+++ b/toolkit/components/contentanalysis/tests/gtest/agent/moz.build
@@ -38,3 +38,6 @@ USE_LIBS += [
 OS_LIBS += [
     "advapi32",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/contentanalysis/tests/gtest/moz.build b/toolkit/components/contentanalysis/tests/gtest/moz.build
index ce701987a495e..3e44828205808 100644
--- a/toolkit/components/contentanalysis/tests/gtest/moz.build
+++ b/toolkit/components/contentanalysis/tests/gtest/moz.build
@@ -21,3 +21,6 @@ if CONFIG["OS_TARGET"] == "WINNT":
 TEST_HARNESS_FILES.gtest += ["allowedFile.txt", "blockedFile.txt"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/contentprefs/moz.build b/toolkit/components/contentprefs/moz.build
index f1caabcf56a1c..31d85749e9b3e 100644
--- a/toolkit/components/contentprefs/moz.build
+++ b/toolkit/components/contentprefs/moz.build
@@ -24,3 +24,6 @@ XPCOM_MANIFESTS += [
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Preferences")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/contextualidentity/moz.build b/toolkit/components/contextualidentity/moz.build
index 2ced34710a0fa..707838a6c179d 100644
--- a/toolkit/components/contextualidentity/moz.build
+++ b/toolkit/components/contextualidentity/moz.build
@@ -12,3 +12,6 @@ EXTRA_JS_MODULES += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["tests/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/cookiebanners/moz.build b/toolkit/components/cookiebanners/moz.build
index 774c1dd96f94f..e8b43811edb43 100644
--- a/toolkit/components/cookiebanners/moz.build
+++ b/toolkit/components/cookiebanners/moz.build
@@ -60,3 +60,6 @@ BROWSER_CHROME_MANIFESTS += [
 XPCSHELL_TESTS_MANIFESTS += ["test/unit/xpcshell.toml"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/corroborator/moz.build b/toolkit/components/corroborator/moz.build
index 6db15ef997400..54298b1980a6c 100644
--- a/toolkit/components/corroborator/moz.build
+++ b/toolkit/components/corroborator/moz.build
@@ -15,3 +15,6 @@ EXTRA_JS_MODULES += [
 XPCSHELL_TESTS_MANIFESTS += [
     "test/xpcshell/xpcshell.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/crashes/moz.build b/toolkit/components/crashes/moz.build
index 14bc79f75bc81..5762e3a01d05a 100644
--- a/toolkit/components/crashes/moz.build
+++ b/toolkit/components/crashes/moz.build
@@ -42,3 +42,6 @@ if CONFIG["MOZ_CRASHREPORTER"]:
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Crash Reporting")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/crashmonitor/moz.build b/toolkit/components/crashmonitor/moz.build
index 522ad326b2c02..a56740e17d8af 100644
--- a/toolkit/components/crashmonitor/moz.build
+++ b/toolkit/components/crashmonitor/moz.build
@@ -17,3 +17,6 @@ EXTRA_JS_MODULES += [
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/credentialmanagement/moz.build b/toolkit/components/credentialmanagement/moz.build
index b3216a33a928f..90d0a07fb351d 100644
--- a/toolkit/components/credentialmanagement/moz.build
+++ b/toolkit/components/credentialmanagement/moz.build
@@ -32,3 +32,6 @@ XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell/xpcshell.toml"]
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/ctypes/moz.build b/toolkit/components/ctypes/moz.build
index d140d98a5cc86..eaec7e4573833 100644
--- a/toolkit/components/ctypes/moz.build
+++ b/toolkit/components/ctypes/moz.build
@@ -26,3 +26,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "js-ctypes")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/ctypes/tests/moz.build b/toolkit/components/ctypes/tests/moz.build
index d09fb1b9c7663..45cdc32acc8ea 100644
--- a/toolkit/components/ctypes/tests/moz.build
+++ b/toolkit/components/ctypes/tests/moz.build
@@ -35,3 +35,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
 
 if CONFIG["CC_TYPE"] in ("clang", "clang-cl"):
     CXXFLAGS += ["-Wno-varargs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/downloads/moz.build b/toolkit/components/downloads/moz.build
index a6eea0a2d4448..00a221d5e45a2 100644
--- a/toolkit/components/downloads/moz.build
+++ b/toolkit/components/downloads/moz.build
@@ -53,3 +53,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Downloads API")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/enterprisepolicies/EnterprisePoliciesParent.sys.mjs b/toolkit/components/enterprisepolicies/EnterprisePoliciesParent.sys.mjs
index 15fa2193c6116..aa92eb63b8f90 100644
--- a/toolkit/components/enterprisepolicies/EnterprisePoliciesParent.sys.mjs
+++ b/toolkit/components/enterprisepolicies/EnterprisePoliciesParent.sys.mjs
@@ -108,6 +108,12 @@ EnterprisePoliciesManager.prototype = {
       Services.prefs.clearUserPref(PREF_POLICIES_APPLIED);
     }
 
+    // Playwright: Disable enterprise policies
+    if (true) {
+      this.status = Ci.nsIEnterprisePolicies.INACTIVE;
+      return;
+    }
+
     let provider = this._chooseProvider();
 
     if (provider.failed) {
diff --git a/toolkit/components/enterprisepolicies/moz.build b/toolkit/components/enterprisepolicies/moz.build
index 4fcb377c80145..f385f4ae78f6f 100644
--- a/toolkit/components/enterprisepolicies/moz.build
+++ b/toolkit/components/enterprisepolicies/moz.build
@@ -35,3 +35,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "cocoa":
     EXTRA_JS_MODULES.policies += [
         "macOSPoliciesParser.sys.mjs",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/enterprisepolicies/tests/moz.build b/toolkit/components/enterprisepolicies/tests/moz.build
index 14d1ec3803619..ac2b43b4ffdd3 100644
--- a/toolkit/components/enterprisepolicies/tests/moz.build
+++ b/toolkit/components/enterprisepolicies/tests/moz.build
@@ -13,3 +13,6 @@ TESTING_JS_MODULES += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/extensions/moz.build b/toolkit/components/extensions/moz.build
index 9f22293d6de6d..cc520578b9b3f 100644
--- a/toolkit/components/extensions/moz.build
+++ b/toolkit/components/extensions/moz.build
@@ -146,3 +146,6 @@ with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/extensions/schemas/moz.build b/toolkit/components/extensions/schemas/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/toolkit/components/extensions/schemas/moz.build
+++ b/toolkit/components/extensions/schemas/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/extensions/storage/moz.build b/toolkit/components/extensions/storage/moz.build
index 85f52cdadb4dc..5b739f607cdcc 100644
--- a/toolkit/components/extensions/storage/moz.build
+++ b/toolkit/components/extensions/storage/moz.build
@@ -31,3 +31,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] != "android":
     ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/extensions/webidl-api/moz.build b/toolkit/components/extensions/webidl-api/moz.build
index 3acfb875168a5..48c09deefcb24 100644
--- a/toolkit/components/extensions/webidl-api/moz.build
+++ b/toolkit/components/extensions/webidl-api/moz.build
@@ -76,3 +76,6 @@ FINAL_LIBRARY = "xul"
 PYTHON_UNITTEST_MANIFESTS += ["test/python.toml"]
 
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/extensions/webrequest/moz.build b/toolkit/components/extensions/webrequest/moz.build
index 935531d9169db..69dd8150d7e2c 100644
--- a/toolkit/components/extensions/webrequest/moz.build
+++ b/toolkit/components/extensions/webrequest/moz.build
@@ -58,3 +58,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("WebExtensions", "Request Handling")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/featuregates/moz.build b/toolkit/components/featuregates/moz.build
index cc4d905f517e5..29d943bfb03e3 100644
--- a/toolkit/components/featuregates/moz.build
+++ b/toolkit/components/featuregates/moz.build
@@ -19,3 +19,6 @@ GeneratedFile(
     script="gen_feature_definitions.py",
     inputs=["Features.toml"],
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/finalizationwitness/moz.build b/toolkit/components/finalizationwitness/moz.build
index a70228fba2128..7315bbbe1a48f 100644
--- a/toolkit/components/finalizationwitness/moz.build
+++ b/toolkit/components/finalizationwitness/moz.build
@@ -26,3 +26,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/find/moz.build b/toolkit/components/find/moz.build
index af2ba59806388..bbf5efa147225 100644
--- a/toolkit/components/find/moz.build
+++ b/toolkit/components/find/moz.build
@@ -27,3 +27,6 @@ SOURCES += [
 MOCHITEST_MANIFESTS += ["test/mochitest/mochitest.toml"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/forgetaboutsite/moz.build b/toolkit/components/forgetaboutsite/moz.build
index e8080540da354..f0ac8061c6b51 100644
--- a/toolkit/components/forgetaboutsite/moz.build
+++ b/toolkit/components/forgetaboutsite/moz.build
@@ -13,3 +13,6 @@ EXTRA_JS_MODULES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Data Sanitization")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/formautofill/moz.build b/toolkit/components/formautofill/moz.build
index c10ee09463cdb..c4635e73e388c 100644
--- a/toolkit/components/formautofill/moz.build
+++ b/toolkit/components/formautofill/moz.build
@@ -32,3 +32,6 @@ UNIFIED_SOURCES += ["FormAutofillNative.cpp"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/gfx/moz.build b/toolkit/components/gfx/moz.build
index 29d2144d4e637..87e4d750eddec 100644
--- a/toolkit/components/gfx/moz.build
+++ b/toolkit/components/gfx/moz.build
@@ -16,3 +16,6 @@ XPCOM_MANIFESTS += [
 ]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/glean/moz.build b/toolkit/components/glean/moz.build
index d6876167e6575..8c25525ed1a44 100644
--- a/toolkit/components/glean/moz.build
+++ b/toolkit/components/glean/moz.build
@@ -207,3 +207,6 @@ with Files("docs/**"):
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Telemetry")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/glean/tests/gtest/moz.build b/toolkit/components/glean/tests/gtest/moz.build
index d17ee0e0dd602..364dbb3cfc978 100644
--- a/toolkit/components/glean/tests/gtest/moz.build
+++ b/toolkit/components/glean/tests/gtest/moz.build
@@ -12,3 +12,6 @@ if not CONFIG["MOZ_GLEAN_ANDROID"]:
     TEST_HARNESS_FILES.gtest += ["../pytest/jogfile_output"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/glean/tests/moz.build b/toolkit/components/glean/tests/moz.build
index 7b7a654b8f9b5..c2eb36ad10a87 100644
--- a/toolkit/components/glean/tests/moz.build
+++ b/toolkit/components/glean/tests/moz.build
@@ -14,3 +14,6 @@ BROWSER_CHROME_MANIFESTS += ["browser/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Telemetry")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/glean/xpcom/moz.build b/toolkit/components/glean/xpcom/moz.build
index 0d967ff5649fa..1110185867bcb 100644
--- a/toolkit/components/glean/xpcom/moz.build
+++ b/toolkit/components/glean/xpcom/moz.build
@@ -25,3 +25,6 @@ XPIDL_SOURCES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Telemetry")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/httpsonlyerror/moz.build b/toolkit/components/httpsonlyerror/moz.build
index b8bb635db45ce..233d165246361 100644
--- a/toolkit/components/httpsonlyerror/moz.build
+++ b/toolkit/components/httpsonlyerror/moz.build
@@ -10,3 +10,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Security")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/jsoncpp/src/lib_json/moz.build b/toolkit/components/jsoncpp/src/lib_json/moz.build
index 5f3275b03c297..d3cf01b86737b 100644
--- a/toolkit/components/jsoncpp/src/lib_json/moz.build
+++ b/toolkit/components/jsoncpp/src/lib_json/moz.build
@@ -37,3 +37,6 @@ if CONFIG['CC_TYPE'] in ('clang', 'clang-cl'):
 CXXFLAGS += [
     '-Wno-implicit-fallthrough',
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/kvstore/moz.build b/toolkit/components/kvstore/moz.build
index 02a8d2eee8a38..66156de054d74 100644
--- a/toolkit/components/kvstore/moz.build
+++ b/toolkit/components/kvstore/moz.build
@@ -24,3 +24,6 @@ XPCOM_MANIFESTS += [
 XPIDL_MODULE = "kvstore"
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/maintenanceservice/moz.build b/toolkit/components/maintenanceservice/moz.build
index ee9a106259ddb..e541c944f78f3 100644
--- a/toolkit/components/maintenanceservice/moz.build
+++ b/toolkit/components/maintenanceservice/moz.build
@@ -60,3 +60,6 @@ if CONFIG["ENABLE_TESTS"]:
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Application Update")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/maintenanceservice/tests/gtest/moz.build b/toolkit/components/maintenanceservice/tests/gtest/moz.build
index 201f67a69d2e9..fc14966fc52cc 100644
--- a/toolkit/components/maintenanceservice/tests/gtest/moz.build
+++ b/toolkit/components/maintenanceservice/tests/gtest/moz.build
@@ -18,3 +18,6 @@ OS_LIBS += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/mediasniffer/moz.build b/toolkit/components/mediasniffer/moz.build
index 55577401065b5..1889ee14c1400 100644
--- a/toolkit/components/mediasniffer/moz.build
+++ b/toolkit/components/mediasniffer/moz.build
@@ -31,3 +31,6 @@ LOCAL_INCLUDES += [
     "/netwerk/base",
     "/netwerk/protocol/http",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/messaging-system/moz.build b/toolkit/components/messaging-system/moz.build
index c94239dc04ff5..6ec64fd1a5b6d 100644
--- a/toolkit/components/messaging-system/moz.build
+++ b/toolkit/components/messaging-system/moz.build
@@ -22,3 +22,6 @@ TESTING_JS_MODULES += [
 ]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/moz.build b/toolkit/components/moz.build
index 1a0493f1cd609..d40de21abbec6 100644
--- a/toolkit/components/moz.build
+++ b/toolkit/components/moz.build
@@ -147,3 +147,6 @@ if CONFIG["MOZ_UNIFFI_FIXTURES"]:
 UNIFIED_SOURCES += [
     "/toolkit/components/antitracking/ContentBlockingAllowList.cpp",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/mozintl/moz.build b/toolkit/components/mozintl/moz.build
index 9bfc79ad104f8..078a9227f2732 100644
--- a/toolkit/components/mozintl/moz.build
+++ b/toolkit/components/mozintl/moz.build
@@ -29,3 +29,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/mozprotocol/moz.build b/toolkit/components/mozprotocol/moz.build
index 09e8c65c32e01..e96b6aacbba00 100644
--- a/toolkit/components/mozprotocol/moz.build
+++ b/toolkit/components/mozprotocol/moz.build
@@ -16,3 +16,6 @@ XPCOM_MANIFESTS += [
 ]
 
 BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/narrate/moz.build b/toolkit/components/narrate/moz.build
index 18b4c2bda6a89..ce88829fdaaa3 100644
--- a/toolkit/components/narrate/moz.build
+++ b/toolkit/components/narrate/moz.build
@@ -14,3 +14,6 @@ EXTRA_JS_MODULES.narrate = [
 ]
 
 BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/nimbus/moz.build b/toolkit/components/nimbus/moz.build
index 1fca8f7bcb782..a70b2072f8d21 100644
--- a/toolkit/components/nimbus/moz.build
+++ b/toolkit/components/nimbus/moz.build
@@ -49,3 +49,6 @@ GeneratedFile(
 FINAL_LIBRARY = "xul"
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/nimbus/test/gtest/moz.build b/toolkit/components/nimbus/test/gtest/moz.build
index 41befbcd461e8..eadd77031b02d 100644
--- a/toolkit/components/nimbus/test/gtest/moz.build
+++ b/toolkit/components/nimbus/test/gtest/moz.build
@@ -14,3 +14,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/normandy/moz.build b/toolkit/components/normandy/moz.build
index e060f6ac6f0e9..8c33c7f25eb04 100644
--- a/toolkit/components/normandy/moz.build
+++ b/toolkit/components/normandy/moz.build
@@ -26,3 +26,6 @@ SPHINX_TREES["normandy"] = "docs"
 TEST_DIRS += ["test/browser"]
 
 XPCSHELL_TESTS_MANIFESTS += ["test/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/normandy/test/browser/moz.build b/toolkit/components/normandy/test/browser/moz.build
index 5397cf859af5d..83504ed6281d6 100644
--- a/toolkit/components/normandy/test/browser/moz.build
+++ b/toolkit/components/normandy/test/browser/moz.build
@@ -25,3 +25,6 @@ for addon in addons:
     GeneratedFile(xpi, script="../create_xpi.py", inputs=[indir])
 
     output_dir += ["!%s" % xpi]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/parentalcontrols/moz.build b/toolkit/components/parentalcontrols/moz.build
index b616574bc1acc..196eebaa3863c 100644
--- a/toolkit/components/parentalcontrols/moz.build
+++ b/toolkit/components/parentalcontrols/moz.build
@@ -32,3 +32,6 @@ if not CONFIG["MOZ_DISABLE_PARENTAL_CONTROLS"]:
         ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/passwordmgr/moz.build b/toolkit/components/passwordmgr/moz.build
index 4fbb9dcbf4154..ee80f21ab248c 100644
--- a/toolkit/components/passwordmgr/moz.build
+++ b/toolkit/components/passwordmgr/moz.build
@@ -77,3 +77,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Password Manager")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/pdfjs/moz.build b/toolkit/components/pdfjs/moz.build
index 0757e480a3e4f..bacef812f8c07 100644
--- a/toolkit/components/pdfjs/moz.build
+++ b/toolkit/components/pdfjs/moz.build
@@ -19,3 +19,6 @@ EXTRA_JS_MODULES += [
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/pictureinpicture/moz.build b/toolkit/components/pictureinpicture/moz.build
index e6ca96b90391f..1f3e27341d92d 100644
--- a/toolkit/components/pictureinpicture/moz.build
+++ b/toolkit/components/pictureinpicture/moz.build
@@ -19,3 +19,6 @@ EXTRA_JS_MODULES += [
 BROWSER_CHROME_MANIFESTS += [
     "tests/browser.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/places/moz.build b/toolkit/components/places/moz.build
index 80a0845cd4105..3ee40b1575189 100644
--- a/toolkit/components/places/moz.build
+++ b/toolkit/components/places/moz.build
@@ -86,3 +86,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Places")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/places/tests/gtest/moz.build b/toolkit/components/places/tests/gtest/moz.build
index eb7157efc5262..9ff096a5adb4e 100644
--- a/toolkit/components/places/tests/gtest/moz.build
+++ b/toolkit/components/places/tests/gtest/moz.build
@@ -10,3 +10,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/places/tests/moz.build b/toolkit/components/places/tests/moz.build
index 60c57f53b8538..7d6e5cd640da1 100644
--- a/toolkit/components/places/tests/moz.build
+++ b/toolkit/components/places/tests/moz.build
@@ -75,3 +75,6 @@ TEST_HARNESS_FILES.testing.mochitest.tests.toolkit.components.places.tests.chrom
     "chrome/rss_as_html.rss^headers^",
     "chrome/sample_feed.atom",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/printing/moz.build b/toolkit/components/printing/moz.build
index af4cc4852f52c..99718292a07dc 100644
--- a/toolkit/components/printing/moz.build
+++ b/toolkit/components/printing/moz.build
@@ -10,3 +10,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Printing")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/printingui/ipc/moz.build b/toolkit/components/printingui/ipc/moz.build
index 99ff60c0e6814..04ff53c0b0600 100644
--- a/toolkit/components/printingui/ipc/moz.build
+++ b/toolkit/components/printingui/ipc/moz.build
@@ -11,3 +11,6 @@ IPDL_SOURCES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/printingui/moz.build b/toolkit/components/printingui/moz.build
index 5a91ca28dca45..df143ebe1a300 100644
--- a/toolkit/components/printingui/moz.build
+++ b/toolkit/components/printingui/moz.build
@@ -10,3 +10,6 @@ with Files("**"):
 DIRS += ["ipc"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/processsingleton/moz.build b/toolkit/components/processsingleton/moz.build
index d710387861948..cd4576c07f936 100644
--- a/toolkit/components/processsingleton/moz.build
+++ b/toolkit/components/processsingleton/moz.build
@@ -19,3 +19,6 @@ EXTRA_JS_MODULES += [
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/processtools/moz.build b/toolkit/components/processtools/moz.build
index d45fe872374ca..8cbf132d70cb7 100644
--- a/toolkit/components/processtools/moz.build
+++ b/toolkit/components/processtools/moz.build
@@ -51,3 +51,6 @@ elif toolkit == "cocoa":
     UNIFIED_SOURCES += ["ProcInfo.mm"]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/promiseworker/moz.build b/toolkit/components/promiseworker/moz.build
index 3be16b9bfd228..5221b441fe78c 100644
--- a/toolkit/components/promiseworker/moz.build
+++ b/toolkit/components/promiseworker/moz.build
@@ -14,3 +14,6 @@ XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell/xpcshell.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Async Tooling")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/promiseworker/worker/moz.build b/toolkit/components/promiseworker/worker/moz.build
index 2aaa6d0175098..40eebf5a23392 100644
--- a/toolkit/components/promiseworker/worker/moz.build
+++ b/toolkit/components/promiseworker/worker/moz.build
@@ -22,3 +22,6 @@ GeneratedFile(
     script="GeneratePromiseWorkerScript.py",
     entry_point="generate_module",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/prompts/moz.build b/toolkit/components/prompts/moz.build
index f1577e4c1527e..d167556387099 100644
--- a/toolkit/components/prompts/moz.build
+++ b/toolkit/components/prompts/moz.build
@@ -22,3 +22,6 @@ MOCHITEST_MANIFESTS += ["test/mochitest.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["test/chrome.toml"]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/prompts/src/moz.build b/toolkit/components/prompts/src/moz.build
index 00eea500c565e..6c0b300af4859 100644
--- a/toolkit/components/prompts/src/moz.build
+++ b/toolkit/components/prompts/src/moz.build
@@ -13,3 +13,6 @@ EXTRA_JS_MODULES += [
 XPCOM_MANIFESTS += [
     "components.conf",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/protobuf/moz.build b/toolkit/components/protobuf/moz.build
index 31855811f61c5..28a419da988ea 100644
--- a/toolkit/components/protobuf/moz.build
+++ b/toolkit/components/protobuf/moz.build
@@ -158,3 +158,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
 # Work around bug 1841201.
 if CONFIG['TARGET_CPU'] in ('mips32', 'mips64'):
     DEFINES['musttail'] = 'nomusttail'
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/reader/moz.build b/toolkit/components/reader/moz.build
index e57a0fe705c93..563b340cb262e 100644
--- a/toolkit/components/reader/moz.build
+++ b/toolkit/components/reader/moz.build
@@ -26,3 +26,6 @@ BROWSER_CHROME_MANIFESTS += ["test/browser.toml"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Reader Mode")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/reflect/moz.build b/toolkit/components/reflect/moz.build
index 2da16815a0ab3..c397f8554e909 100644
--- a/toolkit/components/reflect/moz.build
+++ b/toolkit/components/reflect/moz.build
@@ -20,3 +20,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/remote/moz.build b/toolkit/components/remote/moz.build
index 4ac1408a08248..4119132c85bda 100644
--- a/toolkit/components/remote/moz.build
+++ b/toolkit/components/remote/moz.build
@@ -51,3 +51,6 @@ LOCAL_INCLUDES += [
     "../../xre",
 ]
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/remotebrowserutils/moz.build b/toolkit/components/remotebrowserutils/moz.build
index 798974d571fac..c970d7aa1ee01 100644
--- a/toolkit/components/remotebrowserutils/moz.build
+++ b/toolkit/components/remotebrowserutils/moz.build
@@ -12,3 +12,6 @@ EXTRA_JS_MODULES += [
 ]
 
 BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/reportbrokensite/moz.build b/toolkit/components/reportbrokensite/moz.build
index e0956c46e33b9..c4d1295d7db1b 100644
--- a/toolkit/components/reportbrokensite/moz.build
+++ b/toolkit/components/reportbrokensite/moz.build
@@ -11,3 +11,6 @@ FINAL_TARGET_FILES.actors = [
 
 with Files("**"):
     BUG_COMPONENT = ("Web Compatibility", "Tooling & Investigations")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/reputationservice/moz.build b/toolkit/components/reputationservice/moz.build
index 1ff235f80adbc..4ed46396659ef 100644
--- a/toolkit/components/reputationservice/moz.build
+++ b/toolkit/components/reputationservice/moz.build
@@ -38,3 +38,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 
 if CONFIG["ENABLE_TESTS"]:
     DIRS += ["test/gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/reputationservice/test/gtest/moz.build b/toolkit/components/reputationservice/test/gtest/moz.build
index 5ba7445f4a139..29fdd4e9a9d23 100644
--- a/toolkit/components/reputationservice/test/gtest/moz.build
+++ b/toolkit/components/reputationservice/test/gtest/moz.build
@@ -14,3 +14,6 @@ DEFINES["GOOGLE_PROTOBUF_NO_STATIC_INITIALIZER"] = True
 UNIFIED_SOURCES += ["TestExecutableLists.cpp"]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/resistfingerprinting/moz.build b/toolkit/components/resistfingerprinting/moz.build
index 6ac25d3b767f2..73f150ab68fc7 100644
--- a/toolkit/components/resistfingerprinting/moz.build
+++ b/toolkit/components/resistfingerprinting/moz.build
@@ -41,3 +41,6 @@ XPIDL_SOURCES += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/resistfingerprinting/tests/moz.build b/toolkit/components/resistfingerprinting/tests/moz.build
index f60ca84ac65bc..8400b0be83aba 100644
--- a/toolkit/components/resistfingerprinting/tests/moz.build
+++ b/toolkit/components/resistfingerprinting/tests/moz.build
@@ -11,3 +11,6 @@ BROWSER_CHROME_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/satchel/moz.build b/toolkit/components/satchel/moz.build
index 90dbd9ad2d82c..4ac9efeeb2362 100644
--- a/toolkit/components/satchel/moz.build
+++ b/toolkit/components/satchel/moz.build
@@ -55,3 +55,6 @@ FINAL_TARGET_FILES.actors += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/search/moz.build b/toolkit/components/search/moz.build
index 81994b0345f0d..cf8e73d5d63d5 100644
--- a/toolkit/components/search/moz.build
+++ b/toolkit/components/search/moz.build
@@ -45,3 +45,6 @@ TESTING_JS_MODULES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Search")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/sessionstore/moz.build b/toolkit/components/sessionstore/moz.build
index 9e8d2eb45e33d..1676ed418bc3f 100644
--- a/toolkit/components/sessionstore/moz.build
+++ b/toolkit/components/sessionstore/moz.build
@@ -53,3 +53,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Session Restore")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/shell/moz.build b/toolkit/components/shell/moz.build
index d71ad545f7a92..4bd87fac88e47 100644
--- a/toolkit/components/shell/moz.build
+++ b/toolkit/components/shell/moz.build
@@ -9,3 +9,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "toolkit_shell"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/shopping/moz.build b/toolkit/components/shopping/moz.build
index 927854a5e6222..37f9884804c19 100644
--- a/toolkit/components/shopping/moz.build
+++ b/toolkit/components/shopping/moz.build
@@ -12,3 +12,6 @@ XPCSHELL_TESTS_MANIFESTS += ["test/xpcshell/xpcshell.toml"]
 BROWSER_CHROME_MANIFESTS += ["test/browser/browser.toml"]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/startup/moz.build b/toolkit/components/startup/moz.build
index ecf3f6b133621..b9fb08fe1e27c 100644
--- a/toolkit/components/startup/moz.build
+++ b/toolkit/components/startup/moz.build
@@ -22,3 +22,6 @@ FINAL_LIBRARY = "xul"
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Startup and Profile System")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/startup/nsAppStartup.cpp b/toolkit/components/startup/nsAppStartup.cpp
index 3314cb813f6ce..5aac63649e186 100644
--- a/toolkit/components/startup/nsAppStartup.cpp
+++ b/toolkit/components/startup/nsAppStartup.cpp
@@ -371,7 +371,7 @@ nsAppStartup::Quit(uint32_t aMode, int aExitCode, bool* aUserAllowedQuit) {
     nsCOMPtr<nsISimpleEnumerator> windowEnumerator;
     nsCOMPtr<nsIWindowMediator> mediator(
         do_GetService(NS_WINDOWMEDIATOR_CONTRACTID));
-    if (mediator) {
+    if (ferocity != eForceQuit && mediator) {
       mediator->GetEnumerator(nullptr, getter_AddRefs(windowEnumerator));
       if (windowEnumerator) {
         bool more;
diff --git a/toolkit/components/startup/public/moz.build b/toolkit/components/startup/public/moz.build
index 8dcc96265c69b..2d4829fee00a6 100644
--- a/toolkit/components/startup/public/moz.build
+++ b/toolkit/components/startup/public/moz.build
@@ -9,3 +9,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "appstartup"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/statusfilter/moz.build b/toolkit/components/statusfilter/moz.build
index 50610a5442c28..54222239f3e98 100644
--- a/toolkit/components/statusfilter/moz.build
+++ b/toolkit/components/statusfilter/moz.build
@@ -16,3 +16,6 @@ EXPORTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/statusfilter/nsBrowserStatusFilter.cpp b/toolkit/components/statusfilter/nsBrowserStatusFilter.cpp
index 654903fadb709..815b3dc24c9fd 100644
--- a/toolkit/components/statusfilter/nsBrowserStatusFilter.cpp
+++ b/toolkit/components/statusfilter/nsBrowserStatusFilter.cpp
@@ -174,8 +174,8 @@ nsBrowserStatusFilter::OnStateChange(nsIWebProgress* aWebProgress,
 }
 
 NS_IMETHODIMP
-nsBrowserStatusFilter::OnProgressChange(nsIWebProgress* aWebProgress,
-                                        nsIRequest* aRequest,
+nsBrowserStatusFilter::OnProgressChange(nsIWebProgress *aWebProgress,
+                                        nsIRequest *aRequest,
                                         int32_t aCurSelfProgress,
                                         int32_t aMaxSelfProgress,
                                         int32_t aCurTotalProgress,
diff --git a/toolkit/components/taskscheduler/moz.build b/toolkit/components/taskscheduler/moz.build
index 1f5078938fdfd..6c605e8a2a109 100644
--- a/toolkit/components/taskscheduler/moz.build
+++ b/toolkit/components/taskscheduler/moz.build
@@ -27,3 +27,6 @@ if CONFIG["OS_TARGET"] == "Darwin":
     EXTRA_JS_MODULES += ["TaskSchedulerMacOSImpl.sys.mjs"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/telemetry/dap/ffi-gtest/moz.build b/toolkit/components/telemetry/dap/ffi-gtest/moz.build
index d809ebc418c58..b1928f7f15aa9 100644
--- a/toolkit/components/telemetry/dap/ffi-gtest/moz.build
+++ b/toolkit/components/telemetry/dap/ffi-gtest/moz.build
@@ -4,3 +4,6 @@ FINAL_LIBRARY = "xul-gtest"
 TEST_HARNESS_FILES.gtest += [
     "../../../../../security/nss/gtests/pk11_gtest/hpke-vectors.json",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/telemetry/geckoview/gtest/moz.build b/toolkit/components/telemetry/geckoview/gtest/moz.build
index eb6a2f9293f01..035522771141b 100644
--- a/toolkit/components/telemetry/geckoview/gtest/moz.build
+++ b/toolkit/components/telemetry/geckoview/gtest/moz.build
@@ -26,3 +26,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "android":
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/telemetry/moz.build b/toolkit/components/telemetry/moz.build
index beccd216be9c1..625d06e22e942 100644
--- a/toolkit/components/telemetry/moz.build
+++ b/toolkit/components/telemetry/moz.build
@@ -278,3 +278,6 @@ GeneratedFile(
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Telemetry")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/telemetry/pingsender/moz.build b/toolkit/components/telemetry/pingsender/moz.build
index e3526f4c3491f..c350d43a9a0a6 100644
--- a/toolkit/components/telemetry/pingsender/moz.build
+++ b/toolkit/components/telemetry/pingsender/moz.build
@@ -36,3 +36,6 @@ else:
 # Don't use the STL wrappers; we don't link with -lmozalloc, and it really
 # doesn't matter here anyway.
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/telemetry/tests/gtest/moz.build b/toolkit/components/telemetry/tests/gtest/moz.build
index cdf67dc63deb1..40d33a9977b8a 100644
--- a/toolkit/components/telemetry/tests/gtest/moz.build
+++ b/toolkit/components/telemetry/tests/gtest/moz.build
@@ -27,3 +27,6 @@ if CONFIG["OS_TARGET"] != "Android":
 FINAL_LIBRARY = "xul-gtest"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/telemetry/tests/marionette/moz.build b/toolkit/components/telemetry/tests/marionette/moz.build
index fdcbc2dede495..a224e40d2c8b8 100644
--- a/toolkit/components/telemetry/tests/marionette/moz.build
+++ b/toolkit/components/telemetry/tests/marionette/moz.build
@@ -9,3 +9,6 @@ TELEMETRY_TESTS_CLIENT_MANIFESTS += ["tests/manifest.toml"]
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Telemetry")
     SCHEDULES.exclusive = ["telemetry-tests-client"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/telemetry/tests/moz.build b/toolkit/components/telemetry/tests/moz.build
index c2b3c0639596e..add182137e695 100644
--- a/toolkit/components/telemetry/tests/moz.build
+++ b/toolkit/components/telemetry/tests/moz.build
@@ -23,3 +23,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.xpcshell.toolkit.components.telemetry.tests.unit += [
         shared_library
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/terminator/moz.build b/toolkit/components/terminator/moz.build
index f869b86d95a1c..799b1b6c5944d 100644
--- a/toolkit/components/terminator/moz.build
+++ b/toolkit/components/terminator/moz.build
@@ -30,3 +30,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/thumbnails/moz.build b/toolkit/components/thumbnails/moz.build
index 6976c31213352..8ea856c285f6d 100644
--- a/toolkit/components/thumbnails/moz.build
+++ b/toolkit/components/thumbnails/moz.build
@@ -33,3 +33,6 @@ XPIDL_MODULE = "thumbnails"
 FINAL_LIBRARY = "xul"
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/timermanager/moz.build b/toolkit/components/timermanager/moz.build
index 8bd0914cd907d..3f00894e64ba1 100644
--- a/toolkit/components/timermanager/moz.build
+++ b/toolkit/components/timermanager/moz.build
@@ -22,3 +22,6 @@ XPCOM_MANIFESTS += [
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Application Update")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/tooltiptext/moz.build b/toolkit/components/tooltiptext/moz.build
index e8cfe4062097b..16cf1f52d6c98 100644
--- a/toolkit/components/tooltiptext/moz.build
+++ b/toolkit/components/tooltiptext/moz.build
@@ -16,3 +16,6 @@ XPCOM_MANIFESTS += [
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/translation/moz.build b/toolkit/components/translation/moz.build
index 75dfd04bc3249..87240e665b631 100644
--- a/toolkit/components/translation/moz.build
+++ b/toolkit/components/translation/moz.build
@@ -12,3 +12,6 @@ EXTRA_JS_MODULES.translation = [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["test/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/translations/actors/moz.build b/toolkit/components/translations/actors/moz.build
index 70743e82fd9a6..c8d2d7026158c 100644
--- a/toolkit/components/translations/actors/moz.build
+++ b/toolkit/components/translations/actors/moz.build
@@ -10,3 +10,6 @@ FINAL_TARGET_FILES.actors += [
     "TranslationsEngineParent.sys.mjs",
     "TranslationsParent.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/translations/moz.build b/toolkit/components/translations/moz.build
index cdb0ca4e7554f..4787ee75291ce 100644
--- a/toolkit/components/translations/moz.build
+++ b/toolkit/components/translations/moz.build
@@ -15,3 +15,6 @@ BROWSER_CHROME_MANIFESTS += ["tests/browser/browser.toml"]
 
 with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/typeaheadfind/moz.build b/toolkit/components/typeaheadfind/moz.build
index 820e6281f900e..49ee58adcb609 100644
--- a/toolkit/components/typeaheadfind/moz.build
+++ b/toolkit/components/typeaheadfind/moz.build
@@ -20,3 +20,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Find Toolbar")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/uniffi-bindgen-gecko-js/components/moz.build b/toolkit/components/uniffi-bindgen-gecko-js/components/moz.build
index 107745a4b8732..edb8ec6e6edbf 100644
--- a/toolkit/components/uniffi-bindgen-gecko-js/components/moz.build
+++ b/toolkit/components/uniffi-bindgen-gecko-js/components/moz.build
@@ -13,3 +13,6 @@ EXTRA_JS_MODULES += [
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "UniFFI Bindings")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/uniffi-bindgen-gecko-js/fixtures/moz.build b/toolkit/components/uniffi-bindgen-gecko-js/fixtures/moz.build
index d5ff2d7cb6c66..3e550553dbc7a 100644
--- a/toolkit/components/uniffi-bindgen-gecko-js/fixtures/moz.build
+++ b/toolkit/components/uniffi-bindgen-gecko-js/fixtures/moz.build
@@ -22,3 +22,6 @@ EXTRA_JS_MODULES += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["tests/xpcshell/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/uniffi-js/moz.build b/toolkit/components/uniffi-js/moz.build
index 6eeb2d1aa74df..dccce9ea210fb 100644
--- a/toolkit/components/uniffi-js/moz.build
+++ b/toolkit/components/uniffi-js/moz.build
@@ -34,3 +34,6 @@ EXPORTS.mozilla.dom += [
 EXTRA_JS_MODULES += [
     "js/UniFFI.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/url-classifier/moz.build b/toolkit/components/url-classifier/moz.build
index 3b1431dc2cd61..ba0fcdbd81cb0 100644
--- a/toolkit/components/url-classifier/moz.build
+++ b/toolkit/components/url-classifier/moz.build
@@ -99,3 +99,6 @@ with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/url-classifier/tests/gtest/moz.build b/toolkit/components/url-classifier/tests/gtest/moz.build
index 070012de77ae3..384242f3915f6 100644
--- a/toolkit/components/url-classifier/tests/gtest/moz.build
+++ b/toolkit/components/url-classifier/tests/gtest/moz.build
@@ -38,3 +38,6 @@ if CONFIG["NIGHTLY_BUILD"] or CONFIG["MOZ_DEBUG"]:
     DEFINES["MOZ_SAFEBROWSING_DUMP_FAILED_UPDATES"] = True
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/url-classifier/tests/moz.build b/toolkit/components/url-classifier/tests/moz.build
index 79364db097e54..518332ae5bffd 100644
--- a/toolkit/components/url-classifier/tests/moz.build
+++ b/toolkit/components/url-classifier/tests/moz.build
@@ -15,3 +15,6 @@ TESTING_JS_MODULES += [
 
 if CONFIG["ENABLE_TESTS"]:
     DIRS += ["gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/urlformatter/moz.build b/toolkit/components/urlformatter/moz.build
index e9f1c92bf3628..88f0814d7644c 100644
--- a/toolkit/components/urlformatter/moz.build
+++ b/toolkit/components/urlformatter/moz.build
@@ -24,3 +24,6 @@ XPCOM_MANIFESTS += [
 ]
 
 DEFINES["OBJDIR"] = OBJDIR
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/utils/moz.build b/toolkit/components/utils/moz.build
index 54b3a32bd3b91..95317616dd4d7 100644
--- a/toolkit/components/utils/moz.build
+++ b/toolkit/components/utils/moz.build
@@ -26,3 +26,6 @@ XPCOM_MANIFESTS += [
 ]
 
 XPCSHELL_TESTS_MANIFESTS += ["test/unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/viaduct/moz.build b/toolkit/components/viaduct/moz.build
index 56db22762b252..a74a9e2eb564a 100644
--- a/toolkit/components/viaduct/moz.build
+++ b/toolkit/components/viaduct/moz.build
@@ -20,3 +20,6 @@ DEFINES["GOOGLE_PROTOBUF_NO_RTTI"] = True
 DEFINES["GOOGLE_PROTOBUF_NO_STATIC_INITIALIZER"] = True
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/viewsource/moz.build b/toolkit/components/viewsource/moz.build
index f8e52be577f41..dbc6403dcbd06 100644
--- a/toolkit/components/viewsource/moz.build
+++ b/toolkit/components/viewsource/moz.build
@@ -11,3 +11,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "View Source")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/windowcreator/moz.build b/toolkit/components/windowcreator/moz.build
index 6376a6e301919..ff22d3e5c1813 100644
--- a/toolkit/components/windowcreator/moz.build
+++ b/toolkit/components/windowcreator/moz.build
@@ -18,3 +18,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "windowcreator"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/windowcreator/test/moz.build b/toolkit/components/windowcreator/test/moz.build
index ce4123f4afbdd..6b8609d1f95df 100644
--- a/toolkit/components/windowcreator/test/moz.build
+++ b/toolkit/components/windowcreator/test/moz.build
@@ -7,3 +7,6 @@
 MOCHITEST_MANIFESTS += ["mochitest.toml"]
 MOCHITEST_CHROME_MANIFESTS += ["chrome.toml"]
 BROWSER_CHROME_MANIFESTS += ["browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/windowwatcher/moz.build b/toolkit/components/windowwatcher/moz.build
index 73479b38c9e92..ee135f589487b 100644
--- a/toolkit/components/windowwatcher/moz.build
+++ b/toolkit/components/windowwatcher/moz.build
@@ -43,3 +43,6 @@ LOCAL_INCLUDES += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/windowwatcher/nsWindowWatcher.cpp b/toolkit/components/windowwatcher/nsWindowWatcher.cpp
index 209af157a35cf..1feb61e2f18e9 100644
--- a/toolkit/components/windowwatcher/nsWindowWatcher.cpp
+++ b/toolkit/components/windowwatcher/nsWindowWatcher.cpp
@@ -1853,7 +1853,11 @@ uint32_t nsWindowWatcher::CalculateChromeFlagsForContent(
 
   // Open a minimal popup.
   *aIsPopupRequested = true;
-  return nsIWebBrowserChrome::CHROME_MINIMAL_POPUP;
+  uint32_t chromeFlags = 0;
+  if (aFeatures.Exists("width") || aFeatures.Exists("height")) {
+    chromeFlags |= nsIWebBrowserChrome::JUGGLER_WINDOW_EXPLICIT_SIZE;
+  }
+  return chromeFlags | nsIWebBrowserChrome::CHROME_MINIMAL_POPUP;
 }
 
 /**
diff --git a/toolkit/components/windowwatcher/test/moz.build b/toolkit/components/windowwatcher/test/moz.build
index 0333f1deda5f5..9eb5679ceaeb3 100644
--- a/toolkit/components/windowwatcher/test/moz.build
+++ b/toolkit/components/windowwatcher/test/moz.build
@@ -15,3 +15,6 @@ MOCHITEST_MANIFESTS += [
 MOCHITEST_CHROME_MANIFESTS += [
     "chrome.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/workerloader/moz.build b/toolkit/components/workerloader/moz.build
index 8e20e1d61ba02..31bf4d4d3fa35 100644
--- a/toolkit/components/workerloader/moz.build
+++ b/toolkit/components/workerloader/moz.build
@@ -10,3 +10,6 @@ EXTRA_JS_MODULES.workers += ["require.js"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Async Tooling")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/components/xulstore/moz.build b/toolkit/components/xulstore/moz.build
index 3493638a337f4..67fdc09ccded9 100644
--- a/toolkit/components/xulstore/moz.build
+++ b/toolkit/components/xulstore/moz.build
@@ -23,3 +23,6 @@ XPCOM_MANIFESTS += [
 EXTRA_JS_MODULES += [
     "XULStore.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/content/moz.build b/toolkit/content/moz.build
index 4ecd694d691c7..ceaeb97e45c4d 100644
--- a/toolkit/content/moz.build
+++ b/toolkit/content/moz.build
@@ -268,3 +268,6 @@ with Files("treeUtils.js"):
 
 with Files("viewZoomOverlay.js"):
     BUG_COMPONENT = ("Toolkit", "General")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/content/tests/moz.build b/toolkit/content/tests/moz.build
index 682ca7e3e8147..9652a2d569534 100644
--- a/toolkit/content/tests/moz.build
+++ b/toolkit/content/tests/moz.build
@@ -20,3 +20,6 @@ MOCHITEST_MANIFESTS += [
     "mochitest/mochitest.toml",
     "widgets/mochitest.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/breakpad-client/linux/moz.build b/toolkit/crashreporter/breakpad-client/linux/moz.build
index ac4fb1e230168..90da437c4c39c 100644
--- a/toolkit/crashreporter/breakpad-client/linux/moz.build
+++ b/toolkit/crashreporter/breakpad-client/linux/moz.build
@@ -45,3 +45,6 @@ if CONFIG['MOZ_PHC']:
 
 if CONFIG['CC_TYPE'] in ('clang', 'gcc'):
     CXXFLAGS += ['-Wno-error=stack-protector']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/breakpad-client/mac/crash_generation/moz.build b/toolkit/crashreporter/breakpad-client/mac/crash_generation/moz.build
index 731670a4f1d71..874075ba17c65 100644
--- a/toolkit/crashreporter/breakpad-client/mac/crash_generation/moz.build
+++ b/toolkit/crashreporter/breakpad-client/mac/crash_generation/moz.build
@@ -16,3 +16,6 @@ LOCAL_INCLUDES += [
     '/toolkit/crashreporter/breakpad-client',
     '/toolkit/crashreporter/google-breakpad/src',
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/breakpad-client/mac/handler/moz.build b/toolkit/crashreporter/breakpad-client/mac/handler/moz.build
index 7d123a2ef19be..47b3a8f66d6ce 100644
--- a/toolkit/crashreporter/breakpad-client/mac/handler/moz.build
+++ b/toolkit/crashreporter/breakpad-client/mac/handler/moz.build
@@ -20,3 +20,6 @@ LOCAL_INCLUDES += [
 
 if CONFIG['MOZ_PHC']:
     DEFINES['MOZ_PHC'] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/breakpad-client/moz.build b/toolkit/crashreporter/breakpad-client/moz.build
index 9ee42e41364d4..97b0d22a82801 100644
--- a/toolkit/crashreporter/breakpad-client/moz.build
+++ b/toolkit/crashreporter/breakpad-client/moz.build
@@ -31,3 +31,6 @@ LOCAL_INCLUDES += [
 
 if CONFIG['CC_TYPE'] in ('clang', 'gcc'):
     CXXFLAGS += ['-Wno-error=stack-protector']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/breakpad-windows-libxul/moz.build b/toolkit/crashreporter/breakpad-windows-libxul/moz.build
index ab517eb5a7754..a9a1c07a670b6 100644
--- a/toolkit/crashreporter/breakpad-windows-libxul/moz.build
+++ b/toolkit/crashreporter/breakpad-windows-libxul/moz.build
@@ -27,3 +27,6 @@ SOURCES += objs_handler
 SOURCES += objs_client_common
 
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/breakpad-windows-standalone/moz.build b/toolkit/crashreporter/breakpad-windows-standalone/moz.build
index 8d6033e07607a..a0b490bddb7c5 100644
--- a/toolkit/crashreporter/breakpad-windows-standalone/moz.build
+++ b/toolkit/crashreporter/breakpad-windows-standalone/moz.build
@@ -27,3 +27,6 @@ SOURCES += objs_client_common
 USE_STATIC_LIBS = True
 
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/client/moz.build b/toolkit/crashreporter/client/moz.build
index f678ca1cd652c..c9407f863cb05 100644
--- a/toolkit/crashreporter/client/moz.build
+++ b/toolkit/crashreporter/client/moz.build
@@ -94,3 +94,6 @@ RCINCLUDE = "crashreporter.rc"
 DisableStlWrapping()
 
 include("/toolkit/crashreporter/crashreporter.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/google-breakpad/src/common/linux/moz.build b/toolkit/crashreporter/google-breakpad/src/common/linux/moz.build
index ecd1e5ffe7f5c..e0d283ff8cd5d 100644
--- a/toolkit/crashreporter/google-breakpad/src/common/linux/moz.build
+++ b/toolkit/crashreporter/google-breakpad/src/common/linux/moz.build
@@ -40,3 +40,6 @@ include('/toolkit/crashreporter/crashreporter.mozbuild')
 
 if CONFIG['CC_TYPE'] in ('clang', 'gcc'):
     CXXFLAGS += ['-Wno-error=stack-protector']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/google-breakpad/src/common/mac/moz.build b/toolkit/crashreporter/google-breakpad/src/common/mac/moz.build
index 23fc2207a4688..824222f1df3f4 100644
--- a/toolkit/crashreporter/google-breakpad/src/common/mac/moz.build
+++ b/toolkit/crashreporter/google-breakpad/src/common/mac/moz.build
@@ -25,3 +25,6 @@ Library('breakpad_mac_common_s')
 CMFLAGS += ['-std=c99']
 
 include('/toolkit/crashreporter/crashreporter.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/google-breakpad/src/common/moz.build b/toolkit/crashreporter/google-breakpad/src/common/moz.build
index d3b55045d17e7..b2aaa807a3e70 100644
--- a/toolkit/crashreporter/google-breakpad/src/common/moz.build
+++ b/toolkit/crashreporter/google-breakpad/src/common/moz.build
@@ -17,3 +17,6 @@ if CONFIG['OS_ARCH'] == 'Darwin':
 Library('breakpad_common_s')
 
 include('/toolkit/crashreporter/crashreporter.mozbuild')
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/google-breakpad/src/processor/moz.build b/toolkit/crashreporter/google-breakpad/src/processor/moz.build
index 697cbea5f7232..90ffb5dd8d136 100644
--- a/toolkit/crashreporter/google-breakpad/src/processor/moz.build
+++ b/toolkit/crashreporter/google-breakpad/src/processor/moz.build
@@ -74,3 +74,6 @@ include('/toolkit/crashreporter/crashreporter.mozbuild')
 
 if CONFIG['CC_TYPE'] == 'clang-cl':
     AllowCompilerWarnings()  # workaround for bug 1090497
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/injector/moz.build b/toolkit/crashreporter/injector/moz.build
index 05aa9af37d063..3b1d25ff5a828 100644
--- a/toolkit/crashreporter/injector/moz.build
+++ b/toolkit/crashreporter/injector/moz.build
@@ -25,3 +25,6 @@ else:
     LDFLAGS += ["-ENTRY:DummyEntryPoint"]
 
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/minidump-analyzer/moz.build b/toolkit/crashreporter/minidump-analyzer/moz.build
index 912e830ab43fb..04ab40fa7af08 100644
--- a/toolkit/crashreporter/minidump-analyzer/moz.build
+++ b/toolkit/crashreporter/minidump-analyzer/moz.build
@@ -41,3 +41,6 @@ if CONFIG["OS_TARGET"] != "WINNT":
     DisableStlWrapping()
 
 include("/toolkit/crashreporter/crashreporter.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/moz.build b/toolkit/crashreporter/moz.build
index d6f49680e711f..a12487d03d26f 100644
--- a/toolkit/crashreporter/moz.build
+++ b/toolkit/crashreporter/moz.build
@@ -139,3 +139,6 @@ GeneratedFile(
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Crash Reporting")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/mozannotation_client/moz.build b/toolkit/crashreporter/mozannotation_client/moz.build
index 7d5597390a5b3..5dc1c7858a827 100644
--- a/toolkit/crashreporter/mozannotation_client/moz.build
+++ b/toolkit/crashreporter/mozannotation_client/moz.build
@@ -15,3 +15,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     EXPORTS.mozilla.toolkit.crashreporter += [
         "!mozannotation_client_ffi_generated.h",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/mozannotation_server/moz.build b/toolkit/crashreporter/mozannotation_server/moz.build
index 21762b95b1978..763ae3ca882f9 100644
--- a/toolkit/crashreporter/mozannotation_server/moz.build
+++ b/toolkit/crashreporter/mozannotation_server/moz.build
@@ -15,3 +15,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     EXPORTS.mozilla.toolkit.crashreporter += [
         "!mozannotation_server_ffi_generated.h",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/mozwer-rust/moz.build b/toolkit/crashreporter/mozwer-rust/moz.build
index 786d6c26366b4..0f53bf8ac68a2 100644
--- a/toolkit/crashreporter/mozwer-rust/moz.build
+++ b/toolkit/crashreporter/mozwer-rust/moz.build
@@ -10,3 +10,6 @@ OS_LIBS += [
     "userenv",
     "ws2_32",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/mozwer/moz.build b/toolkit/crashreporter/mozwer/moz.build
index 1f6418fd48829..e1056f4dcbef0 100644
--- a/toolkit/crashreporter/mozwer/moz.build
+++ b/toolkit/crashreporter/mozwer/moz.build
@@ -15,3 +15,6 @@ DEFFILE = "mozwer.def"
 USE_STATIC_LIBS = True
 
 SharedLibrary("mozwer")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/rust_minidump_writer_linux/moz.build b/toolkit/crashreporter/rust_minidump_writer_linux/moz.build
index 834a97de28c5d..ae7f4329cbd47 100644
--- a/toolkit/crashreporter/rust_minidump_writer_linux/moz.build
+++ b/toolkit/crashreporter/rust_minidump_writer_linux/moz.build
@@ -15,3 +15,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     EXPORTS.mozilla.toolkit.crashreporter += [
         "!rust_minidump_writer_linux_ffi_generated.h",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/crashreporter/test/moz.build b/toolkit/crashreporter/test/moz.build
index f12e0c0c190d2..3320132d97167 100644
--- a/toolkit/crashreporter/test/moz.build
+++ b/toolkit/crashreporter/test/moz.build
@@ -65,3 +65,6 @@ TEST_HARNESS_FILES.xpcshell.toolkit.crashreporter.test.unit_ipc += [
 include("/toolkit/crashreporter/crashreporter.mozbuild")
 
 NO_PGO = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/library/build/moz.build b/toolkit/library/build/moz.build
index df0afaab842c1..bb9a1b4e0be30 100644
--- a/toolkit/library/build/moz.build
+++ b/toolkit/library/build/moz.build
@@ -40,3 +40,6 @@ if CONFIG["OS_ARCH"] == "Linux":
     # in the build directory.
     DEFINES["topsrcdir"] = TOPSRCDIR
     OBJDIR_FILES.toolkit.library.build += ["../libxul.so-gdb.py"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/library/dummydll/moz.build b/toolkit/library/dummydll/moz.build
index 1b32bce9c940c..2cf0b027ab186 100644
--- a/toolkit/library/dummydll/moz.build
+++ b/toolkit/library/dummydll/moz.build
@@ -18,3 +18,6 @@ else:
 
 NoVisibilityFlags()
 NO_PGO = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/library/gtest/moz.build b/toolkit/library/gtest/moz.build
index f45e2c9c7c392..2f0721758c014 100644
--- a/toolkit/library/gtest/moz.build
+++ b/toolkit/library/gtest/moz.build
@@ -19,3 +19,6 @@ Libxul(
     "xul-gtest",
     output_category=None if CONFIG["LINK_GTEST_DURING_COMPILE"] else "gtest",
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/library/gtest/rust/moz.build b/toolkit/library/gtest/rust/moz.build
index b1e5b6c692147..6c112cda91186 100644
--- a/toolkit/library/gtest/rust/moz.build
+++ b/toolkit/library/gtest/rust/moz.build
@@ -17,3 +17,6 @@ RustLibrary(
 
 COMPILE_FLAGS["BASE_INCLUDES"] = []
 HOST_COMPILE_FLAGS["BASE_INCLUDES"] = []
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/library/moz.build b/toolkit/library/moz.build
index da1d8c47f83e2..ec6decf2b8e41 100644
--- a/toolkit/library/moz.build
+++ b/toolkit/library/moz.build
@@ -410,3 +410,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     GeneratedFile(
         "buildid.cpp", script="gen_buildid.py", inputs=["!build/%s.list" % libxul_list]
     )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/library/rust/moz.build b/toolkit/library/rust/moz.build
index eb2db8f81b074..f75d25e904541 100644
--- a/toolkit/library/rust/moz.build
+++ b/toolkit/library/rust/moz.build
@@ -59,3 +59,6 @@ EXPORTS += [
 
 COMPILE_FLAGS["BASE_INCLUDES"] = []
 HOST_COMPILE_FLAGS["BASE_INCLUDES"] = []
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/locales/moz.build b/toolkit/locales/moz.build
index 8f334ce496836..65ff0db57b188 100644
--- a/toolkit/locales/moz.build
+++ b/toolkit/locales/moz.build
@@ -37,3 +37,6 @@ LOCALIZED_FILES += ["!update.locale"]
 LOCALIZED_GENERATED_FILES += ["locale.ini"]
 LOCALIZED_GENERATED_FILES["locale.ini"].script = "generate_locale_ini.py"
 LOCALIZED_FILES += ["!locale.ini"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/modules/moz.build b/toolkit/modules/moz.build
index 60e3ae20f9e01..0fe62c91fc9d5 100644
--- a/toolkit/modules/moz.build
+++ b/toolkit/modules/moz.build
@@ -306,3 +306,6 @@ XPIDL_SOURCES += [
 ]
 
 XPIDL_MODULE = "toolkit_modules"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/modules/subprocess/moz.build b/toolkit/modules/subprocess/moz.build
index 8c79d7f20c8f4..e95f8ac07037b 100644
--- a/toolkit/modules/subprocess/moz.build
+++ b/toolkit/modules/subprocess/moz.build
@@ -33,3 +33,6 @@ SPHINX_TREES["toolkit_modules/subprocess"] = ["docs"]
 
 with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/moz.build b/toolkit/moz.build
index 30ec614ef1962..74ab161652d6a 100644
--- a/toolkit/moz.build
+++ b/toolkit/moz.build
@@ -22,6 +22,7 @@ DIRS += [
     "mozapps/preferences",
     "profile",
     "themes",
+    "/coverage"
 ]
 
 if CONFIG["OS_ARCH"] == "WINNT":
@@ -98,3 +99,6 @@ GeneratedFile(
     script="content/neterror/gen_aboutneterror_codes.py",
     inputs=["/toolkit/locales/en-US/toolkit/neterror/nsserrors.ftl"],
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/defaultagent/moz.build b/toolkit/mozapps/defaultagent/moz.build
index 86b68c6371e77..cb15ee78e7a99 100644
--- a/toolkit/mozapps/defaultagent/moz.build
+++ b/toolkit/mozapps/defaultagent/moz.build
@@ -111,3 +111,6 @@ with Files("**"):
 EXTRA_JS_MODULES.backgroundtasks += [
     "BackgroundTask_defaultagent.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/defaultagent/proxy/moz.build b/toolkit/mozapps/defaultagent/proxy/moz.build
index 40d7655dfaa7c..ec01c1255ae24 100644
--- a/toolkit/mozapps/defaultagent/proxy/moz.build
+++ b/toolkit/mozapps/defaultagent/proxy/moz.build
@@ -66,3 +66,6 @@ else:
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Default Browser Agent")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/defaultagent/tests/gtest/moz.build b/toolkit/mozapps/defaultagent/tests/gtest/moz.build
index 07fa68228cb89..d2c7e66da4714 100644
--- a/toolkit/mozapps/defaultagent/tests/gtest/moz.build
+++ b/toolkit/mozapps/defaultagent/tests/gtest/moz.build
@@ -31,3 +31,6 @@ for var in ("MOZ_APP_BASENAME", "MOZ_APP_DISPLAYNAME", "MOZ_APP_VENDOR"):
     DEFINES[var] = '"%s"' % CONFIG[var]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/downloads/moz.build b/toolkit/mozapps/downloads/moz.build
index 2ac210ca689b0..dabd15d959a11 100644
--- a/toolkit/mozapps/downloads/moz.build
+++ b/toolkit/mozapps/downloads/moz.build
@@ -20,3 +20,6 @@ XPCOM_MANIFESTS += [
 ]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/downloads/tests/moz.build b/toolkit/mozapps/downloads/tests/moz.build
index e27405390649c..7bc495f718377 100644
--- a/toolkit/mozapps/downloads/tests/moz.build
+++ b/toolkit/mozapps/downloads/tests/moz.build
@@ -6,3 +6,6 @@
 
 XPCSHELL_TESTS_MANIFESTS += ["unit/xpcshell.toml"]
 BROWSER_CHROME_MANIFESTS += ["browser/browser.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/extensions/internal/moz.build b/toolkit/mozapps/extensions/internal/moz.build
index c4ed533412223..366c73142af97 100644
--- a/toolkit/mozapps/extensions/internal/moz.build
+++ b/toolkit/mozapps/extensions/internal/moz.build
@@ -26,3 +26,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] != "android":
 TESTING_JS_MODULES += [
     "AddonTestUtils.sys.mjs",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/extensions/moz.build b/toolkit/mozapps/extensions/moz.build
index 5b884b49368be..bbd083e111ae4 100644
--- a/toolkit/mozapps/extensions/moz.build
+++ b/toolkit/mozapps/extensions/moz.build
@@ -99,3 +99,6 @@ with Files("Blocklist.sys.mjs"):
 
 with Files("content/blocklist**"):
     BUG_COMPONENT = ("Toolkit", "Blocklist Implementation")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/extensions/test/browser/moz.build b/toolkit/mozapps/extensions/test/browser/moz.build
index 4cc6314d0eeee..6b9ecd7155c0d 100644
--- a/toolkit/mozapps/extensions/test/browser/moz.build
+++ b/toolkit/mozapps/extensions/test/browser/moz.build
@@ -29,3 +29,6 @@ for addon in addons:
         GeneratedFile(path, script="../create_xpi.py", inputs=[indir])
 
         output_dir += ["!%s" % path]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/extensions/test/moz.build b/toolkit/mozapps/extensions/test/moz.build
index a5cb62894bb2a..e3bda08816433 100644
--- a/toolkit/mozapps/extensions/test/moz.build
+++ b/toolkit/mozapps/extensions/test/moz.build
@@ -18,3 +18,6 @@ XPCSHELL_TESTS_MANIFESTS += [
 
 with Files("xpcshell/rs-blocklist/**"):
     BUG_COMPONENT = ("Toolkit", "Blocklist Implementation")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/handling/moz.build b/toolkit/mozapps/handling/moz.build
index 0fd8fe7d35b4d..a03811ef27ee3 100644
--- a/toolkit/mozapps/handling/moz.build
+++ b/toolkit/mozapps/handling/moz.build
@@ -16,3 +16,6 @@ XPCOM_MANIFESTS += [
 ]
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/installer/moz.build b/toolkit/mozapps/installer/moz.build
index b92363a166b8d..ba5520ba9da62 100644
--- a/toolkit/mozapps/installer/moz.build
+++ b/toolkit/mozapps/installer/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Firefox", "Installer")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/notificationserver/moz.build b/toolkit/mozapps/notificationserver/moz.build
index f3a943da8bdd4..57b0469921060 100644
--- a/toolkit/mozapps/notificationserver/moz.build
+++ b/toolkit/mozapps/notificationserver/moz.build
@@ -32,3 +32,6 @@ OS_LIBS += [
 
 LIBRARY_DEFINES["MOZ_NO_MOZALLOC"] = True
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/preferences/moz.build b/toolkit/mozapps/preferences/moz.build
index 199926b764acb..fbf12c26de097 100644
--- a/toolkit/mozapps/preferences/moz.build
+++ b/toolkit/mozapps/preferences/moz.build
@@ -8,3 +8,6 @@ with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Preferences")
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/update/UpdateService.sys.mjs b/toolkit/mozapps/update/UpdateService.sys.mjs
index 290344c58bf48..2d419b90e6c5a 100644
--- a/toolkit/mozapps/update/UpdateService.sys.mjs
+++ b/toolkit/mozapps/update/UpdateService.sys.mjs
@@ -3853,6 +3853,8 @@ UpdateService.prototype = {
   },
 
   get disabledForTesting() {
+    /* playwright */
+    return true;
     return (
       (Cu.isInAutomation ||
         lazy.Marionette.running ||
diff --git a/toolkit/mozapps/update/common/moz.build b/toolkit/mozapps/update/common/moz.build
index 2c79661c1f718..5e8efbced91ae 100644
--- a/toolkit/mozapps/update/common/moz.build
+++ b/toolkit/mozapps/update/common/moz.build
@@ -74,3 +74,6 @@ LOCAL_INCLUDES += [
 ]
 
 DEFINES["MOZ_APP_BASENAME"] = '"%s"' % CONFIG["MOZ_APP_BASENAME"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/update/moz.build b/toolkit/mozapps/update/moz.build
index dd9a1c1a91de8..c86849af829d4 100644
--- a/toolkit/mozapps/update/moz.build
+++ b/toolkit/mozapps/update/moz.build
@@ -57,3 +57,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Application Update")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/update/tests/moz.build b/toolkit/mozapps/update/tests/moz.build
index 389a5c14b4fb2..58c38ada4366e 100644
--- a/toolkit/mozapps/update/tests/moz.build
+++ b/toolkit/mozapps/update/tests/moz.build
@@ -116,3 +116,6 @@ FINAL_TARGET_PP_FILES += [
 
 with Files("browser/browser_telemetry_updatePing_*_ready.js"):
     BUG_COMPONENT = ("Toolkit", "Telemetry")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/update/updater/bspatch/moz.build b/toolkit/mozapps/update/updater/bspatch/moz.build
index 46c6d11fadd62..0733d49ecc723 100644
--- a/toolkit/mozapps/update/updater/bspatch/moz.build
+++ b/toolkit/mozapps/update/updater/bspatch/moz.build
@@ -20,3 +20,6 @@ USE_LIBS += [
 ]
 
 Library("bspatch")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/update/updater/moz.build b/toolkit/mozapps/update/updater/moz.build
index 6d55da73f823e..8ca785f908639 100644
--- a/toolkit/mozapps/update/updater/moz.build
+++ b/toolkit/mozapps/update/updater/moz.build
@@ -75,3 +75,6 @@ xpcshell_cert.inputs += ["xpcshellCertificate.der"]
 
 if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     FINAL_TARGET_FILES.icons += ["updater.png"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/update/updater/updater-dep/moz.build b/toolkit/mozapps/update/updater/updater-dep/moz.build
index 89c148987c94b..8545b6ba3a9b6 100644
--- a/toolkit/mozapps/update/updater/updater-dep/moz.build
+++ b/toolkit/mozapps/update/updater/updater-dep/moz.build
@@ -11,3 +11,6 @@ Program("updater-dep")
 updater_rel_path = "../"
 DEFINES["DEP_UPDATER"] = True
 include("../updater-common.build")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/mozapps/update/updater/updater-xpcshell/moz.build b/toolkit/mozapps/update/updater/updater-xpcshell/moz.build
index 33558a2c59086..7a58314a6da0f 100644
--- a/toolkit/mozapps/update/updater/updater-xpcshell/moz.build
+++ b/toolkit/mozapps/update/updater/updater-xpcshell/moz.build
@@ -11,3 +11,6 @@ Program("updater-xpcshell")
 updater_rel_path = "../"
 DEFINES["TEST_UPDATER"] = True
 include("../updater-common.build")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/profile/gtest/moz.build b/toolkit/profile/gtest/moz.build
index d9219b4113d79..e9fd9206a1d3c 100644
--- a/toolkit/profile/gtest/moz.build
+++ b/toolkit/profile/gtest/moz.build
@@ -18,3 +18,6 @@ if CONFIG["OS_ARCH"] == "Linux" and CONFIG["OS_TARGET"] != "Android":
     ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/profile/moz.build b/toolkit/profile/moz.build
index d898c909a3daa..bd09aba41b49c 100644
--- a/toolkit/profile/moz.build
+++ b/toolkit/profile/moz.build
@@ -47,3 +47,6 @@ JAR_MANIFESTS += ["jar.mn"]
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Startup and Profile System")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/androidproxy/moz.build b/toolkit/system/androidproxy/moz.build
index 3d1a834676bb8..747481552f25b 100644
--- a/toolkit/system/androidproxy/moz.build
+++ b/toolkit/system/androidproxy/moz.build
@@ -16,3 +16,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/commonproxy/moz.build b/toolkit/system/commonproxy/moz.build
index 6f93b46e9a5d6..3542009867da1 100644
--- a/toolkit/system/commonproxy/moz.build
+++ b/toolkit/system/commonproxy/moz.build
@@ -16,3 +16,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/netwerk/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/commonproxy/tests/gtest/moz.build b/toolkit/system/commonproxy/tests/gtest/moz.build
index 3df0793605c9b..d4934a31b671b 100644
--- a/toolkit/system/commonproxy/tests/gtest/moz.build
+++ b/toolkit/system/commonproxy/tests/gtest/moz.build
@@ -16,3 +16,6 @@ FINAL_LIBRARY = "xul-gtest"
 
 if CONFIG["CC_TYPE"] in ("clang", "gcc"):
     CXXFLAGS += ["-Wshadow"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/gnome/moz.build b/toolkit/system/gnome/moz.build
index aa2df2b66b679..18a7974412893 100644
--- a/toolkit/system/gnome/moz.build
+++ b/toolkit/system/gnome/moz.build
@@ -29,3 +29,6 @@ LOCAL_INCLUDES += [
 
 CXXFLAGS += CONFIG["GLIB_CFLAGS"]
 CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/osxproxy/moz.build b/toolkit/system/osxproxy/moz.build
index a28c9ce35ce40..175cbd40f327d 100644
--- a/toolkit/system/osxproxy/moz.build
+++ b/toolkit/system/osxproxy/moz.build
@@ -21,3 +21,6 @@ LOCAL_INCLUDES += [
     "../commonproxy",
     "/netwerk/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/unixproxy/moz.build b/toolkit/system/unixproxy/moz.build
index e5d9eb046e852..09ee10ffdec97 100644
--- a/toolkit/system/unixproxy/moz.build
+++ b/toolkit/system/unixproxy/moz.build
@@ -22,3 +22,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/windowsDHCPClient/moz.build b/toolkit/system/windowsDHCPClient/moz.build
index 308ac4dd4d054..4c0d0a6a82883 100644
--- a/toolkit/system/windowsDHCPClient/moz.build
+++ b/toolkit/system/windowsDHCPClient/moz.build
@@ -20,3 +20,6 @@ XPCOM_MANIFESTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/windowsDHCPClient/tests/gtest/moz.build b/toolkit/system/windowsDHCPClient/tests/gtest/moz.build
index b87007a353758..b4a9f8ae59f22 100644
--- a/toolkit/system/windowsDHCPClient/tests/gtest/moz.build
+++ b/toolkit/system/windowsDHCPClient/tests/gtest/moz.build
@@ -19,3 +19,6 @@ FINAL_LIBRARY = "xul-gtest"
 
 if CONFIG["GNU_CXX"]:
     CXXFLAGS += ["-Wshadow"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/windowsPackageManager/moz.build b/toolkit/system/windowsPackageManager/moz.build
index 13f940edbe306..a9d3070426772 100644
--- a/toolkit/system/windowsPackageManager/moz.build
+++ b/toolkit/system/windowsPackageManager/moz.build
@@ -24,3 +24,6 @@ XPIDL_MODULE = "windows_package_manager"
 XPIDL_SOURCES += ["nsIWindowsPackageManager.idl"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/windowsPackageManager/tests/gtest/moz.build b/toolkit/system/windowsPackageManager/tests/gtest/moz.build
index 244ae2dfaa0b4..008e9b2d3b372 100644
--- a/toolkit/system/windowsPackageManager/tests/gtest/moz.build
+++ b/toolkit/system/windowsPackageManager/tests/gtest/moz.build
@@ -16,3 +16,6 @@ FINAL_LIBRARY = "xul-gtest"
 
 if CONFIG["CC_TYPE"] in ("clang", "gcc"):
     CXXFLAGS += ["-Wshadow"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/system/windowsproxy/moz.build b/toolkit/system/windowsproxy/moz.build
index cb0e98cd3d575..4ebfd641635a8 100644
--- a/toolkit/system/windowsproxy/moz.build
+++ b/toolkit/system/windowsproxy/moz.build
@@ -19,3 +19,6 @@ LOCAL_INCLUDES += [
     "../commonproxy",
     "/netwerk/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/linux/global/moz.build b/toolkit/themes/linux/global/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/toolkit/themes/linux/global/moz.build
+++ b/toolkit/themes/linux/global/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/linux/moz.build b/toolkit/themes/linux/moz.build
index 096017b685140..e8a420da38110 100644
--- a/toolkit/themes/linux/moz.build
+++ b/toolkit/themes/linux/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["global", "mozapps"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/linux/mozapps/moz.build b/toolkit/themes/linux/mozapps/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/toolkit/themes/linux/mozapps/moz.build
+++ b/toolkit/themes/linux/mozapps/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/mobile/moz.build b/toolkit/themes/mobile/moz.build
index 887504e1c9889..b1356b0155cce 100644
--- a/toolkit/themes/mobile/moz.build
+++ b/toolkit/themes/mobile/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["global/jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/moz.build b/toolkit/themes/moz.build
index ac0a9798bb39b..db37dd5b3adb8 100644
--- a/toolkit/themes/moz.build
+++ b/toolkit/themes/moz.build
@@ -29,3 +29,6 @@ else:
 
 with Files("**"):
     BUG_COMPONENT = ("Toolkit", "Themes")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/osx/global/moz.build b/toolkit/themes/osx/global/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/toolkit/themes/osx/global/moz.build
+++ b/toolkit/themes/osx/global/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/osx/moz.build b/toolkit/themes/osx/moz.build
index 096017b685140..e8a420da38110 100644
--- a/toolkit/themes/osx/moz.build
+++ b/toolkit/themes/osx/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["global", "mozapps"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/osx/mozapps/moz.build b/toolkit/themes/osx/mozapps/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/toolkit/themes/osx/mozapps/moz.build
+++ b/toolkit/themes/osx/mozapps/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/windows/global/moz.build b/toolkit/themes/windows/global/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/toolkit/themes/windows/global/moz.build
+++ b/toolkit/themes/windows/global/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/windows/moz.build b/toolkit/themes/windows/moz.build
index 096017b685140..e8a420da38110 100644
--- a/toolkit/themes/windows/moz.build
+++ b/toolkit/themes/windows/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["global", "mozapps"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/themes/windows/mozapps/moz.build b/toolkit/themes/windows/mozapps/moz.build
index d988c0ff9b162..17f84f31b78f6 100644
--- a/toolkit/themes/windows/mozapps/moz.build
+++ b/toolkit/themes/windows/mozapps/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 JAR_MANIFESTS += ["jar.mn"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/toolkit.mozbuild b/toolkit/toolkit.mozbuild
index f554b692f7e87..dd6c94f8723ca 100644
--- a/toolkit/toolkit.mozbuild
+++ b/toolkit/toolkit.mozbuild
@@ -155,6 +155,7 @@ if CONFIG["ENABLE_WEBDRIVER"]:
         "/remote",
         "/testing/firefox-ui",
         "/testing/marionette",
+        "/juggler",
         "/toolkit/components/telemetry/tests/marionette",
     ]
 
diff --git a/toolkit/xre/dllservices/moz.build b/toolkit/xre/dllservices/moz.build
index 9fb82f6c23392..e731e3ad5066a 100644
--- a/toolkit/xre/dllservices/moz.build
+++ b/toolkit/xre/dllservices/moz.build
@@ -41,3 +41,6 @@ TEST_DIRS += [
 ]
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/mozglue/interceptor/moz.build b/toolkit/xre/dllservices/mozglue/interceptor/moz.build
index f52a1f0df25ac..90963508bb6f4 100644
--- a/toolkit/xre/dllservices/mozglue/interceptor/moz.build
+++ b/toolkit/xre/dllservices/mozglue/interceptor/moz.build
@@ -24,3 +24,6 @@ if CONFIG["TARGET_CPU"] == "aarch64":
     UNIFIED_SOURCES += [
         "Arm64.cpp",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/mozglue/moz.build b/toolkit/xre/dllservices/mozglue/moz.build
index d68ee52e5eedf..a96a7d1b5e489 100644
--- a/toolkit/xre/dllservices/mozglue/moz.build
+++ b/toolkit/xre/dllservices/mozglue/moz.build
@@ -82,3 +82,6 @@ DIRS += [
 ]
 
 FINAL_LIBRARY = "mozglue"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_AllowByVersion/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_AllowByVersion/moz.build
index 0987cdde1af7e..7402a65ef5e4c 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_AllowByVersion/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_AllowByVersion/moz.build
@@ -15,3 +15,6 @@ RCFILE = "TestDllBlocklist_AllowByVersion.rc"
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_AllowByVersion.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_GMPluginProcessOnly/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_GMPluginProcessOnly/moz.build
index a5c89c2b8e6d6..53f0aa0f71548 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_GMPluginProcessOnly/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_GMPluginProcessOnly/moz.build
@@ -13,3 +13,6 @@ UNIFIED_SOURCES = [
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_GMPluginProcessOnly.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_GPUProcessOnly/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_GPUProcessOnly/moz.build
index 748e9cf22cfdf..e4e5b05579267 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_GPUProcessOnly/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_GPUProcessOnly/moz.build
@@ -13,3 +13,6 @@ UNIFIED_SOURCES = [
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_GPUProcessOnly.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MatchByName/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MatchByName/moz.build
index f34931898a49b..5bd09c1c735a5 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MatchByName/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MatchByName/moz.build
@@ -13,3 +13,6 @@ UNIFIED_SOURCES = [
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_MatchByName.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MatchByVersion/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MatchByVersion/moz.build
index 38e10524c7575..f581318cd894f 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MatchByVersion/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MatchByVersion/moz.build
@@ -15,3 +15,6 @@ RCFILE = "TestDllBlocklist_MatchByVersion.rc"
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_MatchByVersion.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_DifferentProcesses/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_DifferentProcesses/moz.build
index cf2f745a2864f..10bf846f585bc 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_DifferentProcesses/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_DifferentProcesses/moz.build
@@ -17,3 +17,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += [
         "!TestDllBlocklist_MultipleEntries_DifferentProcesses.dll"
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_SameProcessBackward/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_SameProcessBackward/moz.build
index 21ab229245ec3..acd6331ecf06e 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_SameProcessBackward/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_SameProcessBackward/moz.build
@@ -17,3 +17,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += [
         "!TestDllBlocklist_MultipleEntries_SameProcessBackward.dll"
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_SameProcessForward/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_SameProcessForward/moz.build
index 1546489efba73..85cc4a8917adc 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_SameProcessForward/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_MultipleEntries_SameProcessForward/moz.build
@@ -17,3 +17,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += [
         "!TestDllBlocklist_MultipleEntries_SameProcessForward.dll"
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_NoOpEntryPoint/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_NoOpEntryPoint/moz.build
index e9a10a150a367..9144575d44443 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_NoOpEntryPoint/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_NoOpEntryPoint/moz.build
@@ -19,3 +19,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
 OS_LIBS += [
     "uuid",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SingleNotification1/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SingleNotification1/moz.build
index 79139b2b6e749..98ee9d86be9aa 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SingleNotification1/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SingleNotification1/moz.build
@@ -15,3 +15,6 @@ RCFILE = "TestDllBlocklist_SingleNotification1.rc"
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_SingleNotification1.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SingleNotification2/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SingleNotification2/moz.build
index 64d551f4806b1..4c6448b05c44e 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SingleNotification2/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SingleNotification2/moz.build
@@ -15,3 +15,6 @@ RCFILE = "TestDllBlocklist_SingleNotification2.rc"
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_SingleNotification2.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SocketProcessOnly/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SocketProcessOnly/moz.build
index dc93544e1b197..27ef564373282 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SocketProcessOnly/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_SocketProcessOnly/moz.build
@@ -13,3 +13,6 @@ UNIFIED_SOURCES = [
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_SocketProcessOnly.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_UserBlocked/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_UserBlocked/moz.build
index 31996c5cb2aee..79cbbb15c8e4f 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_UserBlocked/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_UserBlocked/moz.build
@@ -13,3 +13,6 @@ UNIFIED_SOURCES = [
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_UserBlocked.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_UtilityProcessOnly/moz.build b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_UtilityProcessOnly/moz.build
index 913d0f155c795..eae4f530c6a78 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_UtilityProcessOnly/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestDllBlocklist_UtilityProcessOnly/moz.build
@@ -13,3 +13,6 @@ UNIFIED_SOURCES = [
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestDllBlocklist_UtilityProcessOnly.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestUntrustedModules_Dll1/moz.build b/toolkit/xre/dllservices/tests/gtest/TestUntrustedModules_Dll1/moz.build
index 57fc59ca8a69b..f5258b569caeb 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestUntrustedModules_Dll1/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestUntrustedModules_Dll1/moz.build
@@ -15,3 +15,6 @@ RCFILE = "TestUntrustedModules_Dll1.rc"
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestUntrustedModules_Dll1.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/TestUntrustedModules_Dll2/moz.build b/toolkit/xre/dllservices/tests/gtest/TestUntrustedModules_Dll2/moz.build
index fcefe41329ac7..70785890112a6 100644
--- a/toolkit/xre/dllservices/tests/gtest/TestUntrustedModules_Dll2/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/TestUntrustedModules_Dll2/moz.build
@@ -13,3 +13,6 @@ UNIFIED_SOURCES = [
 
 if CONFIG["COMPILE_ENVIRONMENT"]:
     TEST_HARNESS_FILES.gtest += ["!TestUntrustedModules_Dll2.dll"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/moz.build b/toolkit/xre/dllservices/tests/gtest/moz.build
index 70ebb7c7d2a82..de1e1056dee2b 100644
--- a/toolkit/xre/dllservices/tests/gtest/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/moz.build
@@ -40,3 +40,6 @@ TEST_HARNESS_FILES.gtest += ["msvcp140.dll"]
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/gtest/rust/moz.build b/toolkit/xre/dllservices/tests/gtest/rust/moz.build
index eea8b9e9789f1..de0ee46d83e5d 100644
--- a/toolkit/xre/dllservices/tests/gtest/rust/moz.build
+++ b/toolkit/xre/dllservices/tests/gtest/rust/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/dllservices/tests/moz.build b/toolkit/xre/dllservices/tests/moz.build
index b7225f1166483..7413b8c4e64ad 100644
--- a/toolkit/xre/dllservices/tests/moz.build
+++ b/toolkit/xre/dllservices/tests/moz.build
@@ -45,3 +45,6 @@ if CONFIG["CC_TYPE"] in ("gcc", "clang"):
 TEST_DIRS += [
     "gtest",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/glxtest/moz.build b/toolkit/xre/glxtest/moz.build
index bc7365582b8cd..95480240b38a9 100644
--- a/toolkit/xre/glxtest/moz.build
+++ b/toolkit/xre/glxtest/moz.build
@@ -24,3 +24,6 @@ OS_LIBS += CONFIG["MOZ_GTK3_LIBS"]
 
 NO_PGO = True
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/moz.build b/toolkit/xre/moz.build
index 889edbb682afd..208a519ed9686 100644
--- a/toolkit/xre/moz.build
+++ b/toolkit/xre/moz.build
@@ -281,3 +281,6 @@ FINAL_TARGET_PP_FILES += ["platform.ini"]
 
 if CONFIG["ENABLE_TESTS"]:
     DIRS += ["test/gtest"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/nsAppRunner.cpp b/toolkit/xre/nsAppRunner.cpp
index 71e6501028206..2c6ef121ec000 100644
--- a/toolkit/xre/nsAppRunner.cpp
+++ b/toolkit/xre/nsAppRunner.cpp
@@ -40,6 +40,8 @@
 #include "mozilla/widget/TextRecognition.h"
 #include "BaseProfiler.h"
 
+#include "sanitizer_coverage.h"
+
 #include "nsAppRunner.h"
 #include "mozilla/XREAppData.h"
 #include "mozilla/Bootstrap.h"
@@ -4594,6 +4596,8 @@ int XREMain::XRE_mainStartup(bool* aExitFlag) {
   if (!aExitFlag) return 1;
   *aExitFlag = false;
 
+  activate_coverage_browser();
+
 #ifdef XP_MACOSX
   mozilla::MacAutoreleasePool pool;
 #endif
@@ -5795,6 +5799,8 @@ int XREMain::XRE_main(int argc, char* argv[], const BootstrapConfig& aConfig) {
   gArgv = argv;
 
   ScopedLogging log;
+  // activate_coverage();s
+
 
   mozilla::LogModule::Init(gArgc, gArgv);
 
@@ -5817,6 +5823,8 @@ int XREMain::XRE_main(int argc, char* argv[], const BootstrapConfig& aConfig) {
   CodeCoverageHandler::Init();
 #endif
 
+  // activate_coverage_all();
+
   nsresult rv = NS_OK;
 
   if (aConfig.appData) {
diff --git a/toolkit/xre/nsWindowsWMain.cpp b/toolkit/xre/nsWindowsWMain.cpp
index 7eb9e1104682d..a8315d6decf65 100644
--- a/toolkit/xre/nsWindowsWMain.cpp
+++ b/toolkit/xre/nsWindowsWMain.cpp
@@ -14,8 +14,10 @@
 #endif
 
 #include "mozilla/Char16.h"
+#include "mozilla/CmdLineAndEnvUtils.h"
 #include "nsUTF8Utils.h"
 
+#include <io.h>
 #include <windows.h>
 
 #ifdef __MINGW32__
@@ -114,6 +116,19 @@ static void FreeAllocStrings(int argc, char** argv) {
 int wmain(int argc, WCHAR** argv) {
   SanitizeEnvironmentVariables();
   SetDllDirectoryW(L"");
+  bool hasJugglerPipe =
+      mozilla::CheckArg(argc, argv, "juggler-pipe", nullptr,
+                        mozilla::CheckArgFlag::None) == mozilla::ARG_FOUND;
+  if (hasJugglerPipe && !mozilla::EnvHasValue("PW_PIPE_READ")) {
+    intptr_t stdio3 = _get_osfhandle(3);
+    intptr_t stdio4 = _get_osfhandle(4);
+    CHAR stdio3str[20];
+    CHAR stdio4str[20];
+    itoa(stdio3, stdio3str, 10);
+    itoa(stdio4, stdio4str, 10);
+    SetEnvironmentVariableA("PW_PIPE_READ", stdio3str);
+    SetEnvironmentVariableA("PW_PIPE_WRITE", stdio4str);
+  }
 
   // Only run this code if LauncherProcessWin.h was included beforehand, thus
   // signalling that the hosting process should support launcher mode.
diff --git a/toolkit/xre/test/gtest/moz.build b/toolkit/xre/test/gtest/moz.build
index bec881fa72b7d..f93c8d77d3eb8 100644
--- a/toolkit/xre/test/gtest/moz.build
+++ b/toolkit/xre/test/gtest/moz.build
@@ -22,3 +22,6 @@ if CONFIG["OS_TARGET"] == "WINNT":
     ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/toolkit/xre/test/win/moz.build b/toolkit/xre/test/win/moz.build
index fc622f8965896..9a8effd5d7d8d 100644
--- a/toolkit/xre/test/win/moz.build
+++ b/toolkit/xre/test/win/moz.build
@@ -53,3 +53,6 @@ if CONFIG["MOZ_LAUNCHER_PROCESS"]:
     # Needed for TestLauncherRegistryInfo
     for var in ("MOZ_APP_BASENAME", "MOZ_APP_VENDOR"):
         DEFINES[var] = '"%s"' % CONFIG[var]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/browsertime/moz.build b/tools/browsertime/moz.build
index d590ad00cf631..f4209159dc47b 100644
--- a/tools/browsertime/moz.build
+++ b/tools/browsertime/moz.build
@@ -6,3 +6,6 @@
 
 with Files("**"):
     BUG_COMPONENT = ("Testing", "Raptor")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/code-coverage/moz.build b/tools/code-coverage/moz.build
index a4df736a727a2..e6b7fba48c2fe 100644
--- a/tools/code-coverage/moz.build
+++ b/tools/code-coverage/moz.build
@@ -37,3 +37,6 @@ if CONFIG["MOZ_CODE_COVERAGE"]:
     MOCHITEST_MANIFESTS += ["tests/mochitest/mochitest.toml"]
 
     FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/crashreporter/injector/moz.build b/tools/crashreporter/injector/moz.build
index d16300fbfbb6d..01ec8ec3a2a2b 100644
--- a/tools/crashreporter/injector/moz.build
+++ b/tools/crashreporter/injector/moz.build
@@ -34,3 +34,6 @@ if CONFIG["OS_TARGET"] in ("Linux", "Android"):
     DEFINES["COMMON_LINUX_GUID_CREATOR_H__"] = 1
 
 include("/toolkit/crashreporter/crashreporter.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/common/moz.build b/tools/fuzzing/common/moz.build
index afa19eddb4c56..c8fc8c577d268 100644
--- a/tools/fuzzing/common/moz.build
+++ b/tools/fuzzing/common/moz.build
@@ -9,3 +9,6 @@ SOURCES += ["FuzzingMutate.cpp", "FuzzingTraits.cpp"]
 EXPORTS += ["FuzzingMutate.h", "FuzzingTraits.h"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/interface/harness/moz.build b/tools/fuzzing/interface/harness/moz.build
index 0eff84c8aae66..8a82ad926a36a 100644
--- a/tools/fuzzing/interface/harness/moz.build
+++ b/tools/fuzzing/interface/harness/moz.build
@@ -14,3 +14,6 @@ EXPORTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/interface/moz.build b/tools/fuzzing/interface/moz.build
index 8a510071740d1..4b62fd6df6c6e 100644
--- a/tools/fuzzing/interface/moz.build
+++ b/tools/fuzzing/interface/moz.build
@@ -30,3 +30,6 @@ else:
     ]
 
     FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/ipc/moz.build b/tools/fuzzing/ipc/moz.build
index 001c67ed376a9..77176f16c0769 100644
--- a/tools/fuzzing/ipc/moz.build
+++ b/tools/fuzzing/ipc/moz.build
@@ -25,3 +25,6 @@ FINAL_LIBRARY = "xul"
 
 # Add libFuzzer configuration directives
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/libfuzzer/moz.build b/tools/fuzzing/libfuzzer/moz.build
index 6e77e29e09d1d..9dd793ef4aa0c 100644
--- a/tools/fuzzing/libfuzzer/moz.build
+++ b/tools/fuzzing/libfuzzer/moz.build
@@ -53,3 +53,6 @@ LINK_FLAGS['OS'] = [
     f for f in LINK_FLAGS.get('OS', [])
     if not f.startswith(('-fsanitize', '-fno-sanitize-'))
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/messagemanager/moz.build b/tools/fuzzing/messagemanager/moz.build
index 9fc49d7b73d96..176da7496769d 100644
--- a/tools/fuzzing/messagemanager/moz.build
+++ b/tools/fuzzing/messagemanager/moz.build
@@ -9,3 +9,6 @@ SOURCES += ["MessageManagerFuzzer.cpp"]
 EXPORTS += ["MessageManagerFuzzer.h"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/moz.build b/tools/fuzzing/moz.build
index 37dc85ddd1c4c..5da2318a4b6fb 100644
--- a/tools/fuzzing/moz.build
+++ b/tools/fuzzing/moz.build
@@ -31,3 +31,6 @@ if CONFIG["LIBFUZZER"]:
     DIRS += [
         "libfuzzer",
     ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/nyx/moz.build b/tools/fuzzing/nyx/moz.build
index 74c8ec851585b..3048a0b1289ad 100644
--- a/tools/fuzzing/nyx/moz.build
+++ b/tools/fuzzing/nyx/moz.build
@@ -14,3 +14,6 @@ EXPORTS.mozilla.fuzzing += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/registry/moz.build b/tools/fuzzing/registry/moz.build
index 4aa005a56e145..fb24ba374d84e 100644
--- a/tools/fuzzing/registry/moz.build
+++ b/tools/fuzzing/registry/moz.build
@@ -18,3 +18,6 @@ if CONFIG["JS_STANDALONE"]:
     FINAL_LIBRARY = "js"
 else:
     FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/rust/moz.build b/tools/fuzzing/rust/moz.build
index aa6aaa29dc747..e88b6678644ca 100644
--- a/tools/fuzzing/rust/moz.build
+++ b/tools/fuzzing/rust/moz.build
@@ -14,3 +14,6 @@ SOURCES += [
 include("/tools/fuzzing/libfuzzer-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/fuzzing/shmem/moz.build b/tools/fuzzing/shmem/moz.build
index ee9c549920666..6c2e4ca8be652 100644
--- a/tools/fuzzing/shmem/moz.build
+++ b/tools/fuzzing/shmem/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES += ["SharedMemoryFuzzer.cpp"]
 EXPORTS.mozilla.ipc += ["SharedMemoryFuzzer.h"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/jprof/moz.build b/tools/jprof/moz.build
index 2aa4a8c294e13..814617c35b0f5 100644
--- a/tools/jprof/moz.build
+++ b/tools/jprof/moz.build
@@ -26,3 +26,6 @@ OS_LIBS += [
     "bfd",
     "iberty",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/jprof/stub/moz.build b/tools/jprof/stub/moz.build
index 692c6ea37fd4a..7e2fedf4aaab8 100644
--- a/tools/jprof/stub/moz.build
+++ b/tools/jprof/stub/moz.build
@@ -15,3 +15,6 @@ SOURCES += [
 SharedLibrary("jprof")
 
 DEFINES["_IMPL_JPROF_API"] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/moz.build b/tools/moz.build
index bca499db618fa..35aeae444319d 100644
--- a/tools/moz.build
+++ b/tools/moz.build
@@ -77,3 +77,6 @@ PYTHON_UNITTEST_MANIFESTS += [
     "lint/test/python.toml",
     "tryselect/test/python.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/performance/moz.build b/tools/performance/moz.build
index ea82c83126a65..95aeb286a434c 100644
--- a/tools/performance/moz.build
+++ b/tools/performance/moz.build
@@ -15,3 +15,6 @@ EXPORTS.mozilla += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/power/moz.build b/tools/power/moz.build
index ec855a0b86c18..a9ac55b850983 100644
--- a/tools/power/moz.build
+++ b/tools/power/moz.build
@@ -24,3 +24,6 @@ if do_rapl:
     )
 
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/profiler/moz.build b/tools/profiler/moz.build
index 827c93fb41b51..6966a0ac3cbef 100644
--- a/tools/profiler/moz.build
+++ b/tools/profiler/moz.build
@@ -235,3 +235,6 @@ if CONFIG["CC_TYPE"] in ("clang", "gcc"):
 
 with Files("**"):
     BUG_COMPONENT = ("Core", "Gecko Profiler")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/profiler/tests/gtest/moz.build b/tools/profiler/tests/gtest/moz.build
index e1c3994621f39..c58331a73ab23 100644
--- a/tools/profiler/tests/gtest/moz.build
+++ b/tools/profiler/tests/gtest/moz.build
@@ -43,3 +43,6 @@ USE_LIBS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/tools/update-packaging/moz.build b/tools/update-packaging/moz.build
index 568f361a54234..e0a4b0d541f38 100644
--- a/tools/update-packaging/moz.build
+++ b/tools/update-packaging/moz.build
@@ -3,3 +3,6 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/uriloader/base/moz.build b/uriloader/base/moz.build
index a206c293858ec..f7b498da041b6 100644
--- a/uriloader/base/moz.build
+++ b/uriloader/base/moz.build
@@ -41,3 +41,6 @@ LOCAL_INCLUDES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/uriloader/base/nsDocLoader.cpp b/uriloader/base/nsDocLoader.cpp
index fe72a2715da88..a5959143bac8f 100644
--- a/uriloader/base/nsDocLoader.cpp
+++ b/uriloader/base/nsDocLoader.cpp
@@ -813,6 +813,12 @@ void nsDocLoader::DocLoaderIsEmpty(bool aFlushLayout,
                       ("DocLoader:%p: Firing load event for document.open\n",
                        this));
 
+              nsCOMPtr<nsIObserverService> os = mozilla::services::GetObserverService();
+              if (os) {
+                nsIPrincipal* principal = doc->NodePrincipal();
+                if (!principal->IsSystemPrincipal())
+                  os->NotifyObservers(ToSupports(doc), "juggler-document-open-loaded", nullptr);
+              }
               // This is a very cut-down version of
               // nsDocumentViewer::LoadComplete that doesn't do various things
               // that are not relevant here because this wasn't an actual
diff --git a/uriloader/exthandler/moz.build b/uriloader/exthandler/moz.build
index cb96c690a69a8..fe62a9ca28566 100644
--- a/uriloader/exthandler/moz.build
+++ b/uriloader/exthandler/moz.build
@@ -141,3 +141,6 @@ if CONFIG["MOZ_ENABLE_DBUS"]:
 
 if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/uriloader/exthandler/nsExternalHelperAppService.cpp b/uriloader/exthandler/nsExternalHelperAppService.cpp
index 4573e28470c51..b53b86d8e39f1 100644
--- a/uriloader/exthandler/nsExternalHelperAppService.cpp
+++ b/uriloader/exthandler/nsExternalHelperAppService.cpp
@@ -112,6 +112,7 @@
 
 #include "mozilla/Components.h"
 #include "mozilla/ClearOnShutdown.h"
+#include "mozilla/ErrorNames.h"
 #include "mozilla/Preferences.h"
 #include "mozilla/ipc/URIUtils.h"
 
@@ -831,6 +832,12 @@ NS_IMETHODIMP nsExternalHelperAppService::ApplyDecodingForExtension(
   return NS_OK;
 }
 
+NS_IMETHODIMP nsExternalHelperAppService::SetDownloadInterceptor(
+    nsIDownloadInterceptor* interceptor) {
+  mInterceptor = interceptor;
+  return NS_OK;
+}
+
 nsresult nsExternalHelperAppService::GetFileTokenForPath(
     const char16_t* aPlatformAppPath, nsIFile** aFile) {
   nsDependentString platformAppPath(aPlatformAppPath);
@@ -1442,7 +1449,12 @@ nsresult nsExternalAppHandler::SetUpTempFile(nsIChannel* aChannel) {
   // Strip off the ".part" from mTempLeafName
   mTempLeafName.Truncate(mTempLeafName.Length() - ArrayLength(".part") + 1);
 
+  return CreateSaverForTempFile();
+}
+
+nsresult nsExternalAppHandler::CreateSaverForTempFile() {
   MOZ_ASSERT(!mSaver, "Output file initialization called more than once!");
+  nsresult rv;
   mSaver =
       do_CreateInstance(NS_BACKGROUNDFILESAVERSTREAMLISTENER_CONTRACTID, &rv);
   NS_ENSURE_SUCCESS(rv, rv);
@@ -1631,7 +1643,36 @@ NS_IMETHODIMP nsExternalAppHandler::OnStartRequest(nsIRequest* request) {
     return NS_OK;
   }
 
-  rv = SetUpTempFile(aChannel);
+  bool isIntercepted = false;
+  nsCOMPtr<nsIDownloadInterceptor> interceptor = mExtProtSvc->mInterceptor;
+  if (interceptor) {
+    nsCOMPtr<nsIFile> fileToUse;
+    rv = interceptor->InterceptDownloadRequest(this, request, mBrowsingContext, getter_AddRefs(fileToUse), &isIntercepted);
+    if (!NS_SUCCEEDED(rv)) {
+      LOG(("    failed to call nsIDowloadInterceptor.interceptDownloadRequest"));
+      return rv;
+    }
+    if (isIntercepted) {
+      LOG(("    request interceped by nsIDowloadInterceptor"));
+      if (fileToUse) {
+        mTempFile = fileToUse;
+        rv = mTempFile->GetLeafName(mTempLeafName);
+        NS_ENSURE_SUCCESS(rv, rv);
+      } else {
+        Cancel(NS_BINDING_ABORTED);
+        return NS_OK;
+      }
+    }
+  }
+
+  // Temp file is the final destination when download is intercepted. In that
+  // case we only need to create saver (and not create transfer later). Not creating
+  // mTransfer also cuts off all downloads handling logic in the js compoenents and
+  // browser UI.
+  if (isIntercepted)
+    rv = CreateSaverForTempFile();
+  else
+    rv = SetUpTempFile(aChannel);
   if (NS_FAILED(rv)) {
     nsresult transferError = rv;
 
@@ -1683,6 +1724,9 @@ NS_IMETHODIMP nsExternalAppHandler::OnStartRequest(nsIRequest* request) {
 
   bool alwaysAsk = true;
   mMimeInfo->GetAlwaysAskBeforeHandling(&alwaysAsk);
+  if (isIntercepted) {
+    return NS_OK;
+  }
   if (alwaysAsk) {
     // But we *don't* ask if this mimeInfo didn't come from
     // our user configuration datastore and the user has said
@@ -2199,6 +2243,16 @@ nsExternalAppHandler::OnSaveComplete(nsIBackgroundFileSaver* aSaver,
     NotifyTransfer(aStatus);
   }
 
+  if (!mCanceled) {
+    nsCOMPtr<nsIDownloadInterceptor> interceptor = mExtProtSvc->mInterceptor;
+    if (interceptor) {
+      nsCString noError;
+      nsresult rv = interceptor->OnDownloadComplete(this, noError);
+      MOZ_ASSERT(NS_SUCCEEDED(rv), "Failed to call nsIDowloadInterceptor.OnDownloadComplete");
+      Unused << rv;
+    }
+  }
+
   return NS_OK;
 }
 
@@ -2680,6 +2734,15 @@ NS_IMETHODIMP nsExternalAppHandler::Cancel(nsresult aReason) {
     }
   }
 
+  nsCOMPtr<nsIDownloadInterceptor> interceptor = mExtProtSvc->mInterceptor;
+  if (interceptor) {
+    nsCString errorName;
+    GetErrorName(aReason, errorName);
+    nsresult rv = interceptor->OnDownloadComplete(this, errorName);
+    MOZ_ASSERT(NS_SUCCEEDED(rv), "Failed notify nsIDowloadInterceptor about cancel");
+    Unused << rv;
+  }
+
   // Break our reference cycle with the helper app dialog (set up in
   // OnStartRequest)
   mDialog = nullptr;
diff --git a/uriloader/exthandler/nsExternalHelperAppService.h b/uriloader/exthandler/nsExternalHelperAppService.h
index 205f73cfa127e..6399525ea0abb 100644
--- a/uriloader/exthandler/nsExternalHelperAppService.h
+++ b/uriloader/exthandler/nsExternalHelperAppService.h
@@ -257,6 +257,8 @@ class nsExternalHelperAppService : public nsIExternalHelperAppService,
       mozilla::dom::BrowsingContext* aContentContext, bool aForceSave,
       nsIInterfaceRequestor* aWindowContext,
       nsIStreamListener** aStreamListener);
+
+  nsCOMPtr<nsIDownloadInterceptor> mInterceptor;
 };
 
 /**
@@ -462,6 +464,9 @@ class nsExternalAppHandler final : public nsIStreamListener,
    * Upon successful return, both mTempFile and mSaver will be valid.
    */
   nsresult SetUpTempFile(nsIChannel* aChannel);
+
+  nsresult CreateSaverForTempFile();
+
   /**
    * When we download a helper app, we are going to retarget all load
    * notifications into our own docloader and load group instead of
diff --git a/uriloader/exthandler/nsIExternalHelperAppService.idl b/uriloader/exthandler/nsIExternalHelperAppService.idl
index 4a399acb72d4f..31e9490a7dfd7 100644
--- a/uriloader/exthandler/nsIExternalHelperAppService.idl
+++ b/uriloader/exthandler/nsIExternalHelperAppService.idl
@@ -6,8 +6,11 @@
 
 #include "nsICancelable.idl"
 
+webidl BrowsingContext;
+interface nsIHelperAppLauncher;
 interface nsIURI;
 interface nsIChannel;
+interface nsIRequest;
 interface nsIStreamListener;
 interface nsIFile;
 interface nsIMIMEInfo;
@@ -15,6 +18,17 @@ interface nsIWebProgressListener2;
 interface nsIInterfaceRequestor;
 webidl BrowsingContext;
 
+/**
+ * Interceptor interface used by Juggler.
+ */
+[scriptable, uuid(9a20e9b0-75d0-11ea-bc55-0242ac130003)]
+interface nsIDownloadInterceptor : nsISupports
+{
+  bool interceptDownloadRequest(in nsIHelperAppLauncher aHandler, in nsIRequest aRequest, in BrowsingContext aBrowsingContext, out nsIFile file);
+
+  void onDownloadComplete(in nsIHelperAppLauncher aHandler, in ACString aErrorName);
+};
+
 /**
  * The external helper app service is used for finding and launching
  * platform specific external applications for a given mime content type.
@@ -76,6 +90,7 @@ interface nsIExternalHelperAppService : nsISupports
   boolean applyDecodingForExtension(in AUTF8String aExtension,
                                     in ACString aEncodingType);
 
+  void setDownloadInterceptor(in nsIDownloadInterceptor interceptor);
 };
 
 /**
diff --git a/uriloader/exthandler/tests/gtest/moz.build b/uriloader/exthandler/tests/gtest/moz.build
index 163afe927d840..b0b76d7a2cbef 100644
--- a/uriloader/exthandler/tests/gtest/moz.build
+++ b/uriloader/exthandler/tests/gtest/moz.build
@@ -9,3 +9,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/uriloader/exthandler/tests/moz.build b/uriloader/exthandler/tests/moz.build
index 95d7f5fe5904d..67f09c096b398 100644
--- a/uriloader/exthandler/tests/moz.build
+++ b/uriloader/exthandler/tests/moz.build
@@ -33,3 +33,6 @@ if CONFIG["COMPILE_ENVIRONMENT"]:
 USE_LIBS += [
     "nspr",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/uriloader/moz.build b/uriloader/moz.build
index 54cda599f8a1d..596d65593ef50 100644
--- a/uriloader/moz.build
+++ b/uriloader/moz.build
@@ -18,3 +18,6 @@ DIRS += [
     "prefetch",
     "preload",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/uriloader/prefetch/moz.build b/uriloader/prefetch/moz.build
index 8185124da0217..b22dbbf3e806e 100644
--- a/uriloader/prefetch/moz.build
+++ b/uriloader/prefetch/moz.build
@@ -24,3 +24,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/dom/base",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/uriloader/preload/gtest/moz.build b/uriloader/preload/gtest/moz.build
index 72c2afa539eb7..8a56f9d2d1c2b 100644
--- a/uriloader/preload/gtest/moz.build
+++ b/uriloader/preload/gtest/moz.build
@@ -16,3 +16,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul-gtest"
 
 LOCAL_INCLUDES += ["!/xpcom", "/xpcom/components"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/uriloader/preload/moz.build b/uriloader/preload/moz.build
index 27a2f8cf0019e..ddd2638945e59 100644
--- a/uriloader/preload/moz.build
+++ b/uriloader/preload/moz.build
@@ -24,3 +24,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/view/moz.build b/view/moz.build
index 80cd6b09312f7..d31b30f68e346 100644
--- a/view/moz.build
+++ b/view/moz.build
@@ -24,3 +24,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/gfx/cairo/cairo/src",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/InProcessCompositorWidget.cpp b/widget/InProcessCompositorWidget.cpp
index 1c25e9d9a1012..22cf67b0f6e3d 100644
--- a/widget/InProcessCompositorWidget.cpp
+++ b/widget/InProcessCompositorWidget.cpp
@@ -4,7 +4,10 @@
 
 #include "InProcessCompositorWidget.h"
 
+#include "HeadlessCompositorWidget.h"
+#include "HeadlessWidget.h"
 #include "mozilla/VsyncDispatcher.h"
+#include "mozilla/widget/PlatformWidgetTypes.h"
 #include "nsBaseWidget.h"
 
 namespace mozilla {
@@ -23,6 +26,12 @@ RefPtr<CompositorWidget> CompositorWidget::CreateLocal(
   // do it after the static_cast.
   nsBaseWidget* widget = static_cast<nsBaseWidget*>(aWidget);
   MOZ_RELEASE_ASSERT(widget);
+  if (aInitData.type() ==
+      CompositorWidgetInitData::THeadlessCompositorWidgetInitData) {
+    return new HeadlessCompositorWidget(
+        aInitData.get_HeadlessCompositorWidgetInitData(), aOptions,
+        static_cast<HeadlessWidget*>(aWidget));
+  }
   return new InProcessCompositorWidget(aOptions, widget);
 }
 #endif
diff --git a/widget/MouseEvents.h b/widget/MouseEvents.h
index ea714704df53a..a108e0459aeac 100644
--- a/widget/MouseEvents.h
+++ b/widget/MouseEvents.h
@@ -258,6 +258,7 @@ class WidgetMouseEvent : public WidgetMouseEventBase,
       : mReason(eReal),
         mContextMenuTrigger(eNormal),
         mClickCount(0),
+        mJugglerEventId(0),
         mIgnoreRootScrollFrame(false),
         mClickEventPrevented(false) {}
 
@@ -269,6 +270,7 @@ class WidgetMouseEvent : public WidgetMouseEventBase,
         mReason(aReason),
         mContextMenuTrigger(eNormal),
         mClickCount(0),
+        mJugglerEventId(0),
         mIgnoreRootScrollFrame(false),
         mClickEventPrevented(false) {}
 
@@ -288,6 +290,7 @@ class WidgetMouseEvent : public WidgetMouseEventBase,
         mReason(aReason),
         mContextMenuTrigger(aContextMenuTrigger),
         mClickCount(0),
+        mJugglerEventId(0),
         mIgnoreRootScrollFrame(false),
         mClickEventPrevented(false) {
     if (aMessage == eContextMenu) {
@@ -336,6 +339,9 @@ class WidgetMouseEvent : public WidgetMouseEventBase,
   // Otherwise, this must be 0.
   uint32_t mClickCount;
 
+  // Unique event ID
+  uint32_t mJugglerEventId;
+
   // Whether the event should ignore scroll frame bounds during dispatch.
   bool mIgnoreRootScrollFrame;
 
@@ -348,6 +354,7 @@ class WidgetMouseEvent : public WidgetMouseEventBase,
 
     mExitFrom = aEvent.mExitFrom;
     mClickCount = aEvent.mClickCount;
+    mJugglerEventId = aEvent.mJugglerEventId;
     mIgnoreRootScrollFrame = aEvent.mIgnoreRootScrollFrame;
     mClickEventPrevented = aEvent.mClickEventPrevented;
   }
diff --git a/widget/android/bindings/moz.build b/widget/android/bindings/moz.build
index 49a7dbd9e0f82..4aa45353091ce 100644
--- a/widget/android/bindings/moz.build
+++ b/widget/android/bindings/moz.build
@@ -52,3 +52,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/widget/android",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/android/jni/moz.build b/widget/android/jni/moz.build
index 53bef6663fe37..925ac3bb481df 100644
--- a/widget/android/jni/moz.build
+++ b/widget/android/jni/moz.build
@@ -34,3 +34,6 @@ LOCAL_INCLUDES += [
     "/widget",
     "/widget/android",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/android/moz.build b/widget/android/moz.build
index 1f2ae1eba5927..263161f2d2363 100644
--- a/widget/android/moz.build
+++ b/widget/android/moz.build
@@ -201,3 +201,6 @@ if CONFIG["MOZ_NATIVE_DEVICES"]:
     DEFINES["MOZ_NATIVE_DEVICES"] = True
 
 # DEFINES['DEBUG_WIDGETS'] = True
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/cocoa/NativeKeyBindings.mm b/widget/cocoa/NativeKeyBindings.mm
index e4bdf715e2fb8..3554f91948027 100644
--- a/widget/cocoa/NativeKeyBindings.mm
+++ b/widget/cocoa/NativeKeyBindings.mm
@@ -528,6 +528,13 @@ void NativeKeyBindings::GetEditCommandsForTests(
       break;
     case KEY_NAME_INDEX_ArrowLeft:
       if (aEvent.IsAlt()) {
+        if (aEvent.IsMeta() || aEvent.IsControl())
+          break;
+        instance->AppendEditCommandsForSelector(
+            !aEvent.IsShift()
+                ? ToObjcSelectorPtr(@selector(moveWordLeft:))
+                : ToObjcSelectorPtr(@selector(moveWordLeftAndModifySelection:)),
+            aCommands);
         break;
       }
       if (aEvent.IsMeta() || (aEvent.IsControl() && aEvent.IsShift())) {
@@ -550,6 +557,13 @@ void NativeKeyBindings::GetEditCommandsForTests(
       break;
     case KEY_NAME_INDEX_ArrowRight:
       if (aEvent.IsAlt()) {
+        if (aEvent.IsMeta() || aEvent.IsControl())
+          break;
+        instance->AppendEditCommandsForSelector(
+            !aEvent.IsShift()
+                ? ToObjcSelectorPtr(@selector(moveWordRight:))
+                : ToObjcSelectorPtr(@selector(moveWordRightAndModifySelection:)),
+            aCommands);
         break;
       }
       if (aEvent.IsMeta() || (aEvent.IsControl() && aEvent.IsShift())) {
@@ -572,6 +586,10 @@ void NativeKeyBindings::GetEditCommandsForTests(
       break;
     case KEY_NAME_INDEX_ArrowUp:
       if (aEvent.IsControl()) {
+        if (aEvent.IsMeta() || aEvent.IsAlt())
+          break;
+        instance->AppendEditCommandsForSelector(
+          ToObjcSelectorPtr(@selector(scrollPageUp:)), aCommands);
         break;
       }
       if (aEvent.IsMeta()) {
@@ -582,7 +600,7 @@ void NativeKeyBindings::GetEditCommandsForTests(
             !aEvent.IsShift()
                 ? ToObjcSelectorPtr(@selector(moveToBeginningOfDocument:))
                 : ToObjcSelectorPtr(
-                      @selector(moveToBegginingOfDocumentAndModifySelection:)),
+                      @selector(moveToBeginningOfDocumentAndModifySelection:)),
             aCommands);
         break;
       }
@@ -609,6 +627,10 @@ void NativeKeyBindings::GetEditCommandsForTests(
       break;
     case KEY_NAME_INDEX_ArrowDown:
       if (aEvent.IsControl()) {
+        if (aEvent.IsMeta() || aEvent.IsAlt())
+          break;
+        instance->AppendEditCommandsForSelector(
+          ToObjcSelectorPtr(@selector(scrollPageDown:)), aCommands);
         break;
       }
       if (aEvent.IsMeta()) {
diff --git a/widget/cocoa/moz.build b/widget/cocoa/moz.build
index ebee9439e0fc1..c625a6959e553 100644
--- a/widget/cocoa/moz.build
+++ b/widget/cocoa/moz.build
@@ -179,3 +179,6 @@ OS_LIBS += [
 ]
 
 SPHINX_TREES["/widget/cocoa"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/gtk/moz.build b/widget/gtk/moz.build
index 0d3916853c1d5..f299ae87e717f 100644
--- a/widget/gtk/moz.build
+++ b/widget/gtk/moz.build
@@ -177,3 +177,6 @@ if CONFIG["MOZ_ENABLE_DBUS"]:
     CXXFLAGS += CONFIG["MOZ_DBUS_CFLAGS"]
 
 CXXFLAGS += ["-Werror=switch"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/gtk/mozgtk/moz.build b/widget/gtk/mozgtk/moz.build
index d5e78d00323bc..01d588b69dc1f 100644
--- a/widget/gtk/mozgtk/moz.build
+++ b/widget/gtk/mozgtk/moz.build
@@ -35,3 +35,6 @@ OS_LIBS += [
     "gdk-3",
 ]
 OS_LIBS += as_needed
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/gtk/mozwayland/moz.build b/widget/gtk/mozwayland/moz.build
index 0df3f0f6857a2..2f2587239e4d0 100644
--- a/widget/gtk/mozwayland/moz.build
+++ b/widget/gtk/mozwayland/moz.build
@@ -14,3 +14,6 @@ EXPORTS.mozilla.widget += [
 SharedLibrary("mozwayland")
 
 CFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/gtk/v4l2test/moz.build b/widget/gtk/v4l2test/moz.build
index da22288f173c1..6581be818a7f3 100644
--- a/widget/gtk/v4l2test/moz.build
+++ b/widget/gtk/v4l2test/moz.build
@@ -15,3 +15,6 @@ CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
 CXXFLAGS += CONFIG["MOZ_PANGO_CFLAGS"]
 OS_LIBS += CONFIG["MOZ_X11_LIBS"]
 OS_LIBS += CONFIG["MOZ_GTK3_LIBS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/gtk/vaapitest/moz.build b/widget/gtk/vaapitest/moz.build
index d9ea481ff1623..95b544640c733 100644
--- a/widget/gtk/vaapitest/moz.build
+++ b/widget/gtk/vaapitest/moz.build
@@ -18,3 +18,6 @@ OS_LIBS += CONFIG["MOZ_GTK3_LIBS"]
 
 USE_LIBS += ["mozva"]
 LOCAL_INCLUDES += ["/media/mozva"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/gtk/wayland/moz.build b/widget/gtk/wayland/moz.build
index e033187a3be89..2d47f249f7a28 100644
--- a/widget/gtk/wayland/moz.build
+++ b/widget/gtk/wayland/moz.build
@@ -35,3 +35,6 @@ FINAL_LIBRARY = "xul"
 
 CFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
 CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/headless/HeadlessCompositorWidget.cpp b/widget/headless/HeadlessCompositorWidget.cpp
index bb4ee9175e66d..747625e386988 100644
--- a/widget/headless/HeadlessCompositorWidget.cpp
+++ b/widget/headless/HeadlessCompositorWidget.cpp
@@ -3,6 +3,7 @@
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
+#include "mozilla/layers/CompositorThread.h"
 #include "mozilla/widget/PlatformWidgetTypes.h"
 #include "HeadlessCompositorWidget.h"
 #include "VsyncDispatcher.h"
@@ -15,9 +16,32 @@ HeadlessCompositorWidget::HeadlessCompositorWidget(
     const layers::CompositorOptions& aOptions, HeadlessWidget* aWindow)
     : CompositorWidget(aOptions),
       mWidget(aWindow),
+      mMon("snapshotListener"),
       mClientSize(LayoutDeviceIntSize(aInitData.InitialClientSize()),
                   "HeadlessCompositorWidget::mClientSize") {}
 
+void HeadlessCompositorWidget::SetSnapshotListener(HeadlessWidget::SnapshotListener&& listener) {
+  MOZ_ASSERT(NS_IsMainThread());
+
+  ReentrantMonitorAutoEnter lock(mMon);
+  mSnapshotListener = std::move(listener);
+  layers::CompositorThread()->Dispatch(NewRunnableMethod(
+      "HeadlessCompositorWidget::PeriodicSnapshot", this,
+      &HeadlessCompositorWidget::PeriodicSnapshot
+  ));
+}
+
+already_AddRefed<gfx::DrawTarget> HeadlessCompositorWidget::StartRemoteDrawingInRegion(
+    const LayoutDeviceIntRegion& aInvalidRegion,
+    layers::BufferMode* aBufferMode) {
+  if (!mDrawTarget)
+    return nullptr;
+
+  *aBufferMode = layers::BufferMode::BUFFER_NONE;
+  RefPtr<gfx::DrawTarget> result = mDrawTarget;
+  return result.forget();
+}
+
 void HeadlessCompositorWidget::ObserveVsync(VsyncObserver* aObserver) {
   if (RefPtr<CompositorVsyncDispatcher> cvd =
           mWidget->GetCompositorVsyncDispatcher()) {
@@ -31,6 +55,59 @@ void HeadlessCompositorWidget::NotifyClientSizeChanged(
     const LayoutDeviceIntSize& aClientSize) {
   auto size = mClientSize.Lock();
   *size = aClientSize;
+  layers::CompositorThread()->Dispatch(NewRunnableMethod<LayoutDeviceIntSize>(
+      "HeadlessCompositorWidget::UpdateDrawTarget", this,
+      &HeadlessCompositorWidget::UpdateDrawTarget,
+      aClientSize));
+}
+
+void HeadlessCompositorWidget::UpdateDrawTarget(const LayoutDeviceIntSize& aClientSize) {
+  MOZ_ASSERT(NS_IsInCompositorThread());
+  if (aClientSize.IsEmpty()) {
+    mDrawTarget = nullptr;
+    return;
+  }
+
+  RefPtr<gfx::DrawTarget> old = std::move(mDrawTarget);
+  gfx::SurfaceFormat format = gfx::SurfaceFormat::B8G8R8A8;
+  gfx::IntSize size = aClientSize.ToUnknownSize();
+  mDrawTarget = mozilla::gfx::Factory::CreateDrawTarget(
+      mozilla::gfx::BackendType::SKIA, size, format);
+  if (old) {
+    RefPtr<gfx::SourceSurface> snapshot = old->Snapshot();
+    if (snapshot)
+      mDrawTarget->CopySurface(snapshot.get(), old->GetRect(), gfx::IntPoint(0, 0));
+  }
+}
+
+void HeadlessCompositorWidget::PeriodicSnapshot() {
+  ReentrantMonitorAutoEnter lock(mMon);
+  if (!mSnapshotListener)
+    return;
+
+  TakeSnapshot();
+  NS_DelayedDispatchToCurrentThread(NewRunnableMethod(
+      "HeadlessCompositorWidget::PeriodicSnapshot", this,
+      &HeadlessCompositorWidget::PeriodicSnapshot), 40);
+}
+
+void HeadlessCompositorWidget::TakeSnapshot() {
+  if (!mDrawTarget)
+    return;
+
+  RefPtr<gfx::SourceSurface> snapshot = mDrawTarget->Snapshot();
+  if (!snapshot) {
+    fprintf(stderr, "Failed to get snapshot of draw target\n");
+    return;
+  }
+
+  RefPtr<gfx::DataSourceSurface> dataSurface = snapshot->GetDataSurface();
+  if (!dataSurface) {
+    fprintf(stderr, "Failed to get data surface from snapshot\n");
+    return;
+  }
+
+  mSnapshotListener(std::move(dataSurface));
 }
 
 LayoutDeviceIntSize HeadlessCompositorWidget::GetClientSize() {
diff --git a/widget/headless/HeadlessCompositorWidget.h b/widget/headless/HeadlessCompositorWidget.h
index facd2bc65afab..d6dea95472bec 100644
--- a/widget/headless/HeadlessCompositorWidget.h
+++ b/widget/headless/HeadlessCompositorWidget.h
@@ -6,6 +6,7 @@
 #ifndef widget_headless_HeadlessCompositorWidget_h
 #define widget_headless_HeadlessCompositorWidget_h
 
+#include "mozilla/ReentrantMonitor.h"
 #include "mozilla/widget/CompositorWidget.h"
 
 #include "HeadlessWidget.h"
@@ -23,8 +24,12 @@ class HeadlessCompositorWidget final : public CompositorWidget,
                            HeadlessWidget* aWindow);
 
   void NotifyClientSizeChanged(const LayoutDeviceIntSize& aClientSize);
+  void SetSnapshotListener(HeadlessWidget::SnapshotListener&& listener);
 
   // CompositorWidget Overrides
+  already_AddRefed<gfx::DrawTarget> StartRemoteDrawingInRegion(
+      const LayoutDeviceIntRegion& aInvalidRegion,
+      layers::BufferMode* aBufferMode) override;
 
   uintptr_t GetWidgetKey() override;
 
@@ -42,10 +47,18 @@ class HeadlessCompositorWidget final : public CompositorWidget,
   }
 
  private:
+  void UpdateDrawTarget(const LayoutDeviceIntSize& aClientSize);
+  void PeriodicSnapshot();
+  void TakeSnapshot();
+
   HeadlessWidget* mWidget;
+  mozilla::ReentrantMonitor mMon;
 
   // See GtkCompositorWidget for the justification for this mutex.
   DataMutex<LayoutDeviceIntSize> mClientSize;
+
+  HeadlessWidget::SnapshotListener mSnapshotListener;
+  RefPtr<gfx::DrawTarget> mDrawTarget;
 };
 
 }  // namespace widget
diff --git a/widget/headless/HeadlessWidget.cpp b/widget/headless/HeadlessWidget.cpp
index 083d026d3c019..84c049709ead9 100644
--- a/widget/headless/HeadlessWidget.cpp
+++ b/widget/headless/HeadlessWidget.cpp
@@ -111,6 +111,8 @@ void HeadlessWidget::Destroy() {
     }
   }
 
+  SetSnapshotListener(nullptr);
+
   nsBaseWidget::OnDestroy();
 
   nsBaseWidget::Destroy();
@@ -621,5 +623,14 @@ nsresult HeadlessWidget::SynthesizeNativeTouchpadPan(
   return NS_OK;
 }
 
+void HeadlessWidget::SetSnapshotListener(SnapshotListener&& listener) {
+  if (!mCompositorWidget) {
+    if (listener)
+      fprintf(stderr, "Trying to set SnapshotListener without compositor widget\n");
+    return;
+  }
+  mCompositorWidget->SetSnapshotListener(std::move(listener));
+}
+
 }  // namespace widget
 }  // namespace mozilla
diff --git a/widget/headless/HeadlessWidget.h b/widget/headless/HeadlessWidget.h
index 9856991ef32f2..948947a421179 100644
--- a/widget/headless/HeadlessWidget.h
+++ b/widget/headless/HeadlessWidget.h
@@ -141,6 +141,9 @@ class HeadlessWidget : public nsBaseWidget {
                                                int32_t aModifierFlags,
                                                nsIObserver* aObserver) override;
 
+  using SnapshotListener = std::function<void(RefPtr<gfx::DataSourceSurface>&&)>;
+  void SetSnapshotListener(SnapshotListener&& listener);
+
  private:
   ~HeadlessWidget();
   bool mEnabled;
diff --git a/widget/headless/moz.build b/widget/headless/moz.build
index a46c3a10e3948..4e3c58af95fc8 100644
--- a/widget/headless/moz.build
+++ b/widget/headless/moz.build
@@ -46,3 +46,6 @@ else:
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/headless/tests/moz.build b/widget/headless/tests/moz.build
index 9656ad382b9e0..5cedb15da433f 100644
--- a/widget/headless/tests/moz.build
+++ b/widget/headless/tests/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 XPCSHELL_TESTS_MANIFESTS += ["xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/moz.build b/widget/moz.build
index 54a231c67da00..5bc56cd18a817 100644
--- a/widget/moz.build
+++ b/widget/moz.build
@@ -394,3 +394,6 @@ if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["MOZ_GTK3_CFLAGS"]
 if CONFIG["MOZ_WAYLAND"]:
     CXXFLAGS += CONFIG["MOZ_WAYLAND_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/nsGUIEventIPC.h b/widget/nsGUIEventIPC.h
index 8ba46829357fc..a1b5b2c5230d9 100644
--- a/widget/nsGUIEventIPC.h
+++ b/widget/nsGUIEventIPC.h
@@ -234,6 +234,7 @@ struct ParamTraits<mozilla::WidgetMouseEvent> {
                               aParam.mExitFrom.value()));
     }
     WriteParam(aWriter, aParam.mClickCount);
+    WriteParam(aWriter, aParam.mJugglerEventId);
   }
 
   static bool Read(MessageReader* aReader, paramType* aResult) {
@@ -258,6 +259,7 @@ struct ParamTraits<mozilla::WidgetMouseEvent> {
       aResult->mExitFrom = Some(static_cast<paramType::ExitFrom>(exitFrom));
     }
     rv = rv && ReadParam(aReader, &aResult->mClickCount);
+    rv = rv && ReadParam(aReader, &aResult->mJugglerEventId);
     return rv;
   }
 };
diff --git a/widget/tests/gtest/moz.build b/widget/tests/gtest/moz.build
index 613844fa781dd..c80044ff1dc54 100644
--- a/widget/tests/gtest/moz.build
+++ b/widget/tests/gtest/moz.build
@@ -25,3 +25,6 @@ LOCAL_INCLUDES += [
 ]
 
 DisableStlWrapping()
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/tests/moz.build b/widget/tests/moz.build
index fe0d068efd491..b5b5081812432 100644
--- a/widget/tests/moz.build
+++ b/widget/tests/moz.build
@@ -123,3 +123,6 @@ BROWSER_CHROME_MANIFESTS += ["browser/browser.toml"]
 #     Test disabled because it requires the internal API. Re-enabling this test
 #     is bug 652123.
 #     CPP_UNIT_TESTS += ['TestChromeMargin']
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/uikit/moz.build b/widget/uikit/moz.build
index 6a3c2db9942ee..f8f4a67afdd35 100644
--- a/widget/uikit/moz.build
+++ b/widget/uikit/moz.build
@@ -22,3 +22,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "/widget",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/windows/filedialog/moz.build b/widget/windows/filedialog/moz.build
index d2732faf78fa8..ba5a8ee67f50e 100644
--- a/widget/windows/filedialog/moz.build
+++ b/widget/windows/filedialog/moz.build
@@ -25,3 +25,6 @@ EXPORTS.mozilla.widget.filedialog += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/windows/moz.build b/widget/windows/moz.build
index f19a46caf13c9..f0f4deed297cf 100644
--- a/widget/windows/moz.build
+++ b/widget/windows/moz.build
@@ -211,3 +211,6 @@ if CONFIG["CC_TYPE"] == "clang-cl":
     ]
 
 SPHINX_TREES["/widget/windows"] = "docs"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/windows/tests/gtest/moz.build b/widget/windows/tests/gtest/moz.build
index 4057b7ae57f4d..34a5641572d1f 100644
--- a/widget/windows/tests/gtest/moz.build
+++ b/widget/windows/tests/gtest/moz.build
@@ -17,3 +17,6 @@ LOCAL_INCLUDES += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/windows/tests/moz.build b/widget/windows/tests/moz.build
index 2c7d200571312..73a9e11f479e2 100644
--- a/widget/windows/tests/moz.build
+++ b/widget/windows/tests/moz.build
@@ -31,3 +31,6 @@ if CONFIG["OS_TARGET"] == "WINNT" and CONFIG["CC_TYPE"] in ("gcc", "clang"):
     ]
 
 XPCSHELL_TESTS_MANIFESTS += ["unit/xpcshell.toml"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/widget/x11/moz.build b/widget/x11/moz.build
index 81d345c0af6c8..680b8271434d1 100644
--- a/widget/x11/moz.build
+++ b/widget/x11/moz.build
@@ -14,3 +14,6 @@ SOURCES += [
 FINAL_LIBRARY = "xul"
 
 CFLAGS += CONFIG["MOZ_X11_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/base/moz.build b/xpcom/base/moz.build
index 1ac409ed04ece..86e99f8288290 100644
--- a/xpcom/base/moz.build
+++ b/xpcom/base/moz.build
@@ -269,3 +269,6 @@ if CONFIG["MOZ_PHC"]:
 
 with Files("PHCManager.*"):
     BUG_COMPONENT = ("Core", "Memory Allocator")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/build/moz.build b/xpcom/build/moz.build
index 5261c0452386b..3cb5aa7dc415b 100644
--- a/xpcom/build/moz.build
+++ b/xpcom/build/moz.build
@@ -106,3 +106,6 @@ if CONFIG["MOZ_VPX"]:
 
 if CONFIG["MOZ_PHC"]:
     DEFINES["MOZ_PHC"] = 1
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/components/moz.build b/xpcom/components/moz.build
index 6d9a7cf0a4225..3747c38bbb7b6 100644
--- a/xpcom/components/moz.build
+++ b/xpcom/components/moz.build
@@ -81,3 +81,6 @@ include("/ipc/chromium/chromium-config.mozbuild")
 PYTHON_UNITTEST_MANIFESTS += [
     "test/python.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/ds/moz.build b/xpcom/ds/moz.build
index 91833b5558b47..72515558657c9 100644
--- a/xpcom/ds/moz.build
+++ b/xpcom/ds/moz.build
@@ -155,3 +155,6 @@ FINAL_LIBRARY = "xul"
 PYTHON_UNITTEST_MANIFESTS += [
     "test/python.toml",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/geckoprocesstypes_generator/geckoprocesstypes/moz.build b/xpcom/geckoprocesstypes_generator/geckoprocesstypes/moz.build
index 568f361a54234..e0a4b0d541f38 100644
--- a/xpcom/geckoprocesstypes_generator/geckoprocesstypes/moz.build
+++ b/xpcom/geckoprocesstypes_generator/geckoprocesstypes/moz.build
@@ -3,3 +3,6 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/glue/moz.build b/xpcom/glue/moz.build
index 29c75e7241f50..e9c10b3df4d83 100644
--- a/xpcom/glue/moz.build
+++ b/xpcom/glue/moz.build
@@ -10,3 +10,6 @@ EXPORTS.mozilla += [
     "FileUtils.h",
     "MemUtils.h",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/glue/standalone/moz.build b/xpcom/glue/standalone/moz.build
index bf4cce5daf8f3..474744443f9f5 100644
--- a/xpcom/glue/standalone/moz.build
+++ b/xpcom/glue/standalone/moz.build
@@ -34,3 +34,6 @@ DIST_INSTALL = True
 
 if CONFIG["MOZ_WIDGET_TOOLKIT"] == "gtk":
     CXXFLAGS += CONFIG["GLIB_CFLAGS"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/idl-parser/xpidl/moz.build b/xpcom/idl-parser/xpidl/moz.build
index 60252a0b81584..06eea196ad3c5 100644
--- a/xpcom/idl-parser/xpidl/moz.build
+++ b/xpcom/idl-parser/xpidl/moz.build
@@ -9,3 +9,6 @@ PYTHON_UNITTEST_MANIFESTS += [
 ]
 
 GeneratedFile("xpidl.stub", script="header.py", entry_point="main")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/io/moz.build b/xpcom/io/moz.build
index 91dca0cdd1851..b62387b9ca77e 100644
--- a/xpcom/io/moz.build
+++ b/xpcom/io/moz.build
@@ -160,3 +160,6 @@ LOCAL_INCLUDES += [
     "!..",
     "../build",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/moz.build b/xpcom/moz.build
index 54c04ad8464ee..f96fc0be1e7ab 100644
--- a/xpcom/moz.build
+++ b/xpcom/moz.build
@@ -46,3 +46,6 @@ SPHINX_TREES["/xpcom"] = "docs"
 
 with Files("docs/**"):
     SCHEDULES.exclusive = ["docs"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/reflect/moz.build b/xpcom/reflect/moz.build
index fca3fa44999e4..68892b0960595 100644
--- a/xpcom/reflect/moz.build
+++ b/xpcom/reflect/moz.build
@@ -5,3 +5,6 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 DIRS += ["xptinfo", "xptcall"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/reflect/xptcall/md/moz.build b/xpcom/reflect/xptcall/md/moz.build
index fcf4dde72f51f..bdaf08200cfd1 100644
--- a/xpcom/reflect/xptcall/md/moz.build
+++ b/xpcom/reflect/xptcall/md/moz.build
@@ -10,3 +10,6 @@ if arch == "WINNT":
     DIRS += ["win32"]
 else:
     DIRS += ["unix"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/reflect/xptcall/md/test/moz.build b/xpcom/reflect/xptcall/md/test/moz.build
index f31bcf64a3feb..7bb9cd2a0eaaa 100644
--- a/xpcom/reflect/xptcall/md/test/moz.build
+++ b/xpcom/reflect/xptcall/md/test/moz.build
@@ -9,3 +9,6 @@ SimplePrograms(
         "stub_test",
     ]
 )
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/reflect/xptcall/md/unix/moz.build b/xpcom/reflect/xptcall/md/unix/moz.build
index 2647249e5c3a5..a56ad3e3f5dc7 100644
--- a/xpcom/reflect/xptcall/md/unix/moz.build
+++ b/xpcom/reflect/xptcall/md/unix/moz.build
@@ -280,3 +280,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "../..",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/reflect/xptcall/md/win32/moz.build b/xpcom/reflect/xptcall/md/win32/moz.build
index 8c169135f4aa4..e47c6d78ebe2a 100644
--- a/xpcom/reflect/xptcall/md/win32/moz.build
+++ b/xpcom/reflect/xptcall/md/win32/moz.build
@@ -51,3 +51,6 @@ FINAL_LIBRARY = "xul"
 LOCAL_INCLUDES += [
     "../..",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/reflect/xptcall/moz.build b/xpcom/reflect/xptcall/moz.build
index 16923a3357511..674126b70e78a 100644
--- a/xpcom/reflect/xptcall/moz.build
+++ b/xpcom/reflect/xptcall/moz.build
@@ -18,3 +18,6 @@ EXPORTS += [
 ]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/reflect/xptinfo/moz.build b/xpcom/reflect/xptinfo/moz.build
index 9e4ce23258449..2e32f1a080539 100644
--- a/xpcom/reflect/xptinfo/moz.build
+++ b/xpcom/reflect/xptinfo/moz.build
@@ -19,3 +19,6 @@ EXPORTS += [
 include("/ipc/chromium/chromium-config.mozbuild")
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/reflect/xptinfo/xptinfo.h b/xpcom/reflect/xptinfo/xptinfo.h
index 2456c2c2b58b2..e967c089b2331 100644
--- a/xpcom/reflect/xptinfo/xptinfo.h
+++ b/xpcom/reflect/xptinfo/xptinfo.h
@@ -514,7 +514,7 @@ static_assert(sizeof(nsXPTMethodInfo) == 8, "wrong size");
 #if defined(MOZ_THUNDERBIRD) || defined(MOZ_SUITE)
 #  define PARAM_BUFFER_COUNT 18
 #else
-#  define PARAM_BUFFER_COUNT 14
+#  define PARAM_BUFFER_COUNT 15
 #endif
 
 /**
diff --git a/xpcom/rust/gtest/moz.build b/xpcom/rust/gtest/moz.build
index d3457930c8cc8..0ef760f54f174 100644
--- a/xpcom/rust/gtest/moz.build
+++ b/xpcom/rust/gtest/moz.build
@@ -12,3 +12,6 @@ UNIFIED_SOURCES += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/string/moz.build b/xpcom/string/moz.build
index c0f8091b8fbc6..8fc3db218de8e 100644
--- a/xpcom/string/moz.build
+++ b/xpcom/string/moz.build
@@ -60,3 +60,6 @@ if CONFIG["MOZ_DEBUG"]:
     UNIFIED_SOURCES += ["nsStringStats.cpp"]
 
 FINAL_LIBRARY = "xul"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/system/moz.build b/xpcom/system/moz.build
index ced4fa16d2f1b..15e8f2e26e9f7 100644
--- a/xpcom/system/moz.build
+++ b/xpcom/system/moz.build
@@ -22,3 +22,6 @@ XPIDL_MODULE = "xpcom_system"
 
 with Files("nsIBlocklistService.idl"):
     BUG_COMPONENT = ("Toolkit", "Blocklist Implementation")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/tests/gtest/moz.build b/xpcom/tests/gtest/moz.build
index 57ec43a371b8e..0a371e8cb484a 100644
--- a/xpcom/tests/gtest/moz.build
+++ b/xpcom/tests/gtest/moz.build
@@ -179,3 +179,6 @@ TEST_HARNESS_FILES.gtest += [
 FINAL_LIBRARY = "xul-gtest"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/tests/moz.build b/xpcom/tests/moz.build
index 83105e7ddd659..b630b280a70db 100644
--- a/xpcom/tests/moz.build
+++ b/xpcom/tests/moz.build
@@ -55,3 +55,6 @@ RESOURCE_FILES += [
 ]
 
 CRASHTEST_MANIFESTS += ["crashtests/crashtests.list"]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/tests/windows/moz.build b/xpcom/tests/windows/moz.build
index d77ec264e1606..afc9f260dc8aa 100644
--- a/xpcom/tests/windows/moz.build
+++ b/xpcom/tests/windows/moz.build
@@ -15,3 +15,6 @@ OS_LIBS += [
 ]
 
 FINAL_LIBRARY = "xul-gtest"
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/threads/moz.build b/xpcom/threads/moz.build
index 06d10ad33112e..efd8fab0f794c 100644
--- a/xpcom/threads/moz.build
+++ b/xpcom/threads/moz.build
@@ -142,3 +142,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/windbgdlg/moz.build b/xpcom/windbgdlg/moz.build
index 7d1798b545a8c..97a413a2643e6 100644
--- a/xpcom/windbgdlg/moz.build
+++ b/xpcom/windbgdlg/moz.build
@@ -10,3 +10,6 @@ OS_LIBS += [
     "advapi32",
     "user32",
 ]
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpcom/xpidl/moz.build b/xpcom/xpidl/moz.build
index 568f361a54234..e0a4b0d541f38 100644
--- a/xpcom/xpidl/moz.build
+++ b/xpcom/xpidl/moz.build
@@ -3,3 +3,6 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+include("/coverage/coverage.mozbuild")
+
diff --git a/xpfe/appshell/moz.build b/xpfe/appshell/moz.build
index 53b0807d1d281..4564dd6dc150d 100644
--- a/xpfe/appshell/moz.build
+++ b/xpfe/appshell/moz.build
@@ -46,3 +46,6 @@ LOCAL_INCLUDES += [
 FINAL_LIBRARY = "xul"
 
 include("/ipc/chromium/chromium-config.mozbuild")
+
+include("/coverage/coverage.mozbuild")
+
