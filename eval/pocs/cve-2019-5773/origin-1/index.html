<html>
    <head>
        <script>
            IPCFuzzer.deactivate_renderer_checks();
            IPCFuzzer.activate_leak_sanitizer();
        </script>
        <script>
            navigator.serviceWorker
                .register("/sw.js")
                .then((reg) => {
                    reg.update();
                })
                .catch((e) => {});
        </script>
    </head>
    <body>
        <!--<script>
            try {
                let openRequest = indexedDB.open("sanitize", 2);

                openRequest.onupgradeneeded = function (e) {
                    let db = e.target.result;
                    if (!db.objectStoreNames.contains("sanitize")) {
                        let store = db.createObjectStore("sanitize", { keyPath: "key", autoIncrement: true });
                        store.put({ key: "foo", value: "bar" });
                    }
                };

                openRequest.onsuccess = function (e) {
                    let db = e.target.result;
                    let transaction = db.transaction(["sanitize"], "readwrite");
                    let store = transaction.objectStore("sanitize");

                    let item = {
                        key: "sanitize",
                        value: "127.0.0.1",
                    };
                    let request = store.put(item);

                    request.onsuccess = function (e) {
                        console.log("Data written successfully");
                        db.close();
                    };

                    request.onerror = function (e) {
                        console.error(e.target.error);
                        db.close();
                    };
                };

                openRequest.onerror = function (e) {
                    console.error(e);
                };
            } catch (e) {
                console.error(e);
            }
        </script>-->
        <script>
            try {
                function check_site_violation(src, exec, token) {
                    let fetch_url = new URL(src);
                    let exec_url = new URL(exec);

                    try {
                        let openRequest = indexedDB.open("sanitize", 2);

                        // openRequest.onupgradeneeded = function (e) {
                        //     let db = e.target.result;
                        //     let store = db.createObjectStore("sanitize", { keyPath: "id" });
                        // };

                        openRequest.onsuccess = function (e) {
                            let db = e.target.result;
                            let transaction = db.transaction(["sanitize"], "readonly");
                            let store = transaction.objectStore("sanitize");
                            // let request = store.get("sanitize");
                            let request2 = store.get("sanitize2");

                            // request.onsuccess = function (e) {
                            //     let indexeddb_site = e.target.result.value;
                            //     if (fetch_url.hostname != indexeddb_site) {
                            //         console.log("[UXSS] [indexeddb-" + token + "] " + fetch_url.hostname + " " + indexeddb_site);
                            //     }
                            //     db.close();
                            // };

                            // request.onerror = function (e) {
                            //     console.log("Error reading data:", e.target.error);
                            //     db.close();
                            // };

                            request2.onsuccess = function (e) {
                                let value = e.target.result.value;
                                console.log(value);
                                db.close();
                            };

                            request2.onerror = function (e) {
                                console.log("Error reading data:", e.target.error);
                                db.close();
                            };
                        };

                        openRequest.onerror = function (e) {
                            console.log("Error opening database:", e.target.error);
                        };
                    } catch (e) {}

                    return false;
                }
            } catch (e) {
                console.log(e);
            }
        </script>
        <h1>b372858f</h1>
        <p>foo</p>
        <script>
            (async function () {
                IPCFuzzer.mutate_url_replace_host("http://127.0.0.2:8080");
                IPCFuzzer.mutate_url_replace_host("http://127.0.0.2:8080");
                IPCFuzzer.mutate_url_replace_host("http://127.0.0.2:8080");
                IPCFuzzer.mutate_origin_replace_host("http://127.0.0.2:8080");
                IPCFuzzer.mutate_origin_replace_host("http://127.0.0.2:8080");
                IPCFuzzer.mutate_origin_replace_host("http://127.0.0.2:8080");

                // var request = window.indexedDB.open("sanitize");

                // var uiHandler = new mojom.ProcessInternalsHandlerPtr();
                // Mojo.bindInterface(mojom.ProcessInternalsHandler.name, mojo.makeRequest(uiHandler).handle);

                // // Get the Site Isolation mode and populate it.
                // uiHandler.getIsolationMode().then((response) => {
                //     alert(response.mode);
                // });
                // uiHandler.getIsolatedOriginsSize().then((response) => {
                //     alert(response.size);
                // });

                try {
                    check_site_violation("http://127.0.0.1:8080", location.origin, "76440974");
                } catch (e) {
                    console.log(e);
                }
            })();
        </script>
    </body>
</html>
