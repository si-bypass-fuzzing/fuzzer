<!DOCTYPE html>
<html>

<head>
    <script>IPCFuzzer.deactivate_renderer_checks();</script>
</head>

<body>
    <p>127.0.0.3</p>

    <script>
        function check_site_violation(fetch, exec, token) {
            try {
                if (IPCFuzzer.check_isolation(fetch)) {
                    console.log('[process-' + token + ']', '[UXSS]', fetch);
                    return true;
                }
            } catch (error) {
                console.log('Process Isolation Check: ' + error);
            }
            if (exec == null) { return false; }
            if (exec.includes('0.0.0.0')) { return false; }

            var fetch_url = new URL(fetch);
            var exec_url = new URL(exec);
            if (fetch_url.hostname != exec_url.hostname) {
                console.log('[exec-' + token + ']', '[UXSS]', fetch_url.hostname, exec_url.hostname);
                return true;
            }
            try {
                let cookie_site = document.cookie.split('; ').find((row) => row.startsWith('sanitize='))?.split('=')[1];
                if (cookie_site == null) { console.log('cookie_site ERROR'); }
                if (cookie_site != null && fetch_url.hostname != cookie_site) {
                    console.log('[cookie-' + token + ']', '[UXSS]', fetch_url.hostname, cookie_site);
                    return true;
                }
            } catch (error) {
                console.log('Cookie: ' + error);
            }
            try {
                let storage_site = localStorage.getItem('sanitize');
                if (storage_site == null) { console.log('storage_site ERROR'); }
                if (storage_site != null && fetch_url.hostname != storage_site) {
                    console.log('[localStorage-' + token + ']', '[UXSS]', fetch_url.hostname, storage_site)
                    return true;
                }
            } catch (error) {
                console.log('localStorage: ' + error);
            }

            async function readOriginPrivateFilesystem() {
                try {
                    const dirHandle = await navigator.storage.getDirectory();
                    const fileHandle = await dirHandle.getFileHandle('sanitize', { create: false });
                    const file = await fileHandle.getFile();
                    const opfs_site = await file.text();
                    if (opfs_site != '' && fetch_url.hostname != opfs_site) {
                        console.log('[opfs-' + token + ']', '[UXSS]', fetch_url.hostname, opfs_site);
                    }
                } catch (error) {
                    console.log('OPFS: ' + error);
                }
            }
            try {
                readOriginPrivateFilesystem();
            } catch (error) {
                console.log('OPFS: ' + error);
            }
            function onFsError(error) {
                console.log('FileSystem: ' + error)
            }

            function onFileEntryRead(fe) {
                try {
                    fe.file((f) => {
                        f.text()
                            .then((filesystem_site) => {
                                if (filesystem_site != '' && fetch_url.hostname != filesystem_site) {
                                    console.log('[filesystem-' + token + ']', '[UXSS]', fetch_url.hostname, filesystem_site);
                                }
                            })
                    });
                } catch (error) {
                    console.log('FileSystem: ' + error);
                }
            }

            function onFsRead(fs) {
                fs.root.getFile('sanitize', { create: false }, onFileEntryRead, onFsError);
            }

            try {
                webkitRequestFileSystem(Window.PERSISTENT, 256, onFsRead, onFsError);
            } catch (error) {
                console.log('OPFS: ' + error);
            }
            return false;
        }


        try {
            var _origin_fetch_ = 'http://127.0.0.1:8080';
            var _origin_exec_ = location.origin;
            check_site_violation(_origin_fetch_, _origin_exec_, 'b');
        } catch (e) { }
    </script>

    <script>

        IPCFuzzer.mutate_url_replace_host("http://127.0.0.2:8080");
        IPCFuzzer.mutate_origin_replace_host("http://127.0.0.2:8080");
        IPCFuzzer.mutate_site_for_cookies_replace_host("http://127.0.0.2:8080");

        win = window.open('data:blank', '_blank');

        try {
            function check_window_site_violation(fetch, win, token) {
                try {
                    let fetch_url = new URL(fetch);
                    let cookie_site = win.document.cookie.split('; ').find((row) => row.startsWith('sanitize='))?.split('=')[1];
                    if (cookie_site != null && fetch_url.hostname != cookie_site) {
                        console.log('[win-cookie-' + token + ']', '[UXSS]', fetch_url.hostname, cookie_site);
                    }
                } catch (error) {
                    // console.log('Window Cookie: ' + error);
                }
            }
        } catch (e) { }

        var _origin_fetch_ = 'http://127.0.0.1:8080';
        check_window_site_violation(_origin_fetch_, win, '2a8ef457');


    </script>


</body>

</html>